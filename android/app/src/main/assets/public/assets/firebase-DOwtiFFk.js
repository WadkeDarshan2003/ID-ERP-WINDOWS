var e={};const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++r)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<e.length;s+=3){const t=e[s],i=s+1<e.length,o=i?e[s+1]:0,a=s+2<e.length,c=a?e[s+2]:0,u=t>>2,h=(3&t)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(e):this.encodeByteArray(t(e),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const s=e[n++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[n++];t[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0;++i;const a=i<e.length?n[e.charAt(i)]:64;++i;const c=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==o||null==a||null==c)throw new r;const u=t<<2|o>>4;if(s.push(u),64!==a){const e=o<<4&240|a>>2;if(s.push(e),64!==c){const e=a<<6&192|c;s.push(e)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(e){return function(e){const r=t(e);return n.encodeByteArray(r,!0)}(e).replace(/\./g,"")},i=function(e){try{return n.decodeString(e,!0)}catch(t){}return null};function o(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}const a=()=>{try{return o().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;const t=e.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&i(e[1]);return t&&JSON.parse(t)})()}catch(t){return}},c=e=>a()?.emulatorHosts?.[e],u=e=>{const t=c(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},h=()=>a()?.config,l=e=>a()?.[`_${e}`];class d{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function f(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function p(e){return(await fetch(e,{credentials:"include"})).ok}function m(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}const g={};let y=!1;function w(e,t){if("undefined"==typeof window||"undefined"==typeof document||!f(window.location.host)||g[e]===t||g[e]||y)return;function n(e){return`__firebase__banner__${e}`}g[e]=t;const r="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(g))g[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(r),t=n("text"),i=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const n=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{y=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,c),t.append(u,i,a,n),document.body.appendChild(t)}s?(i.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',i.innerText="Preview backend running in this workspace."),i.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",i):i()}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function I(){const e=a()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}function _(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function b(){return!I()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function E(){return!I()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function T(){try{return"object"==typeof indexedDB}catch(e){return!1}}function S(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(n){t(n)}})}function C(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class k extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,k.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,A.prototype.create)}}class A{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],i=s?function(e,t){return e.replace(N,(e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`})}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new k(r,o,n)}}const N=/\{\$([^}]+)}/g;function R(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const s of n){if(!r.includes(s))return!1;const n=e[s],i=t[s];if(D(n)&&D(i)){if(!R(n,i))return!1}else if(n!==i)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function D(e){return null!==e&&"object"==typeof e}function x(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function P(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function O(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class L{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=M),void 0===r.error&&(r.error=M),void 0===r.complete&&(r.complete=M);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function M(){}function V(e,t=1e3,n=2){const r=t*Math.pow(n,e),s=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+s)}function U(e){return e&&e._delegate?e._delegate:e}class F{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const B="[DEFAULT]";class j{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new d;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(n)return null;throw r}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:B})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(e=B){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=B){return this.instances.has(e)}getOptions(e=B){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,i]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(s)&&i.resolve(r);return r}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);const s=this.instances.get(n);return s&&e(s,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===B?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var r;return n||null}normalizeInstanceIdentifier(e=B){return this.component?this.component.multipleInstances?e:B:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class q{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new j(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var z,K;(K=z||(z={}))[K.DEBUG=0]="DEBUG",K[K.VERBOSE=1]="VERBOSE",K[K.INFO=2]="INFO",K[K.WARN=3]="WARN",K[K.ERROR=4]="ERROR",K[K.SILENT=5]="SILENT";const $={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},G=z.INFO,H={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},W=(e,t,...n)=>{if(!(t<e.logLevel||((new Date).toISOString(),H[t])))throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Q{constructor(e){this.name=e,this._logLevel=G,this._logHandler=W,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?$[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...e),this._logHandler(this,z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...e),this._logHandler(this,z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,z.INFO,...e),this._logHandler(this,z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,z.WARN,...e),this._logHandler(this,z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...e),this._logHandler(this,z.ERROR,...e)}}let J,X;const Y=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap;let re={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Z.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ee.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ie(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function se(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(X||(X=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(oe(this),e),ie(Y.get(this))}:function(...e){return ie(t.apply(oe(this),e))}:function(e,...n){const r=t.call(oe(this),e,...n);return ee.set(r,e.sort?e.sort():[e]),ie(r)}:(e instanceof IDBTransaction&&function(e){if(Z.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});Z.set(e,t)}(e),n=e,(J||(J=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>n instanceof e)?new Proxy(e,re):e);var t,n}function ie(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(ie(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&Y.set(t,e)}).catch(()=>{}),ne.set(t,e),t}(e);if(te.has(e))return te.get(e);const t=se(e);return t!==e&&(te.set(e,t),ne.set(t,e)),t}const oe=e=>ne.get(e);function ae(e,t,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=ie(o);return r&&o.addEventListener("upgradeneeded",e=>{r(ie(o.result),e.oldVersion,e.newVersion,ie(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{i&&e.addEventListener("close",()=>i()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}function ce(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",e=>t(e.oldVersion,e)),ie(n).then(()=>{})}const ue=["get","getKey","getAll","getAllKeys","count"],he=["put","add","delete","clear"],le=new Map;function de(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(le.get(t))return le.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=he.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!ue.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&i.done]))[0]};return le.set(t,i),i}var fe;fe=re,re={...fe,get:(e,t,n)=>de(e,t)||fe.get(e,t,n),has:(e,t)=>!!de(e,t)||fe.has(e,t)};class pe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===t?.type}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const me="@firebase/app",ge="0.14.6",ye=new Q("@firebase/app"),we="@firebase/app-compat",ve="@firebase/analytics-compat",Ie="@firebase/analytics",_e="@firebase/app-check-compat",be="@firebase/app-check",Ee="@firebase/auth",Te="@firebase/auth-compat",Se="@firebase/database",Ce="@firebase/data-connect",ke="@firebase/database-compat",Ae="@firebase/functions",Ne="@firebase/functions-compat",Re="@firebase/installations",De="@firebase/installations-compat",xe="@firebase/messaging",Pe="@firebase/messaging-compat",Oe="@firebase/performance",Le="@firebase/performance-compat",Me="@firebase/remote-config",Ve="@firebase/remote-config-compat",Ue="@firebase/storage",Fe="@firebase/storage-compat",Be="@firebase/firestore",je="@firebase/ai",qe="@firebase/firestore-compat",ze="firebase",Ke="[DEFAULT]",$e={[me]:"fire-core",[we]:"fire-core-compat",[Ie]:"fire-analytics",[ve]:"fire-analytics-compat",[be]:"fire-app-check",[_e]:"fire-app-check-compat",[Ee]:"fire-auth",[Te]:"fire-auth-compat",[Se]:"fire-rtdb",[Ce]:"fire-data-connect",[ke]:"fire-rtdb-compat",[Ae]:"fire-fn",[Ne]:"fire-fn-compat",[Re]:"fire-iid",[De]:"fire-iid-compat",[xe]:"fire-fcm",[Pe]:"fire-fcm-compat",[Oe]:"fire-perf",[Le]:"fire-perf-compat",[Me]:"fire-rc",[Ve]:"fire-rc-compat",[Ue]:"fire-gcs",[Fe]:"fire-gcs-compat",[Be]:"fire-fst",[qe]:"fire-fst-compat",[je]:"fire-vertex","fire-js":"fire-js",[ze]:"fire-js-all"},Ge=new Map,He=new Map,We=new Map;function Qe(e,t){try{e.container.addComponent(t)}catch(n){ye.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Je(e){const t=e.name;if(We.has(t))return ye.debug(`There were multiple attempts to register component ${t}.`),!1;We.set(t,e);for(const n of Ge.values())Qe(n,e);for(const n of He.values())Qe(n,e);return!0}function Xe(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Ye(e){return null!=e&&void 0!==e.settings}const Ze=new A("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class et{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new F("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ze.create("app-deleted",{appName:this._name})}}const tt="12.6.0";function nt(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r={name:Ke,automaticDataCollectionEnabled:!0,...t},s=r.name;if("string"!=typeof s||!s)throw Ze.create("bad-app-name",{appName:String(s)});if(n||(n=h()),!n)throw Ze.create("no-options");const i=Ge.get(s);if(i){if(R(n,i.options)&&R(r,i.config))return i;throw Ze.create("duplicate-app",{appName:s})}const o=new q(s);for(const c of We.values())o.addComponent(c);const a=new et(n,r,o);return Ge.set(s,a),a}function rt(e=Ke){const t=Ge.get(e);if(!t&&e===Ke&&h())return nt();if(!t)throw Ze.create("no-app",{appName:e});return t}function st(){return Array.from(Ge.values())}async function it(e){let t=!1;const n=e.name;Ge.has(n)?(t=!0,Ge.delete(n)):He.has(n)&&e.decRefCount()<=0&&(He.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function ot(e,t,n){let r=$e[e]??e;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=t.match(/\s|\//);if(s||i){const e=[`Unable to register library "${r}" with version "${t}":`];return s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&e.push("and"),i&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ye.warn(e.join(" "))}Je(new F(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const at="firebase-heartbeat-store";let ct=null;function ut(){return ct||(ct=ae("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(at)}catch(n){}}}).catch(e=>{throw Ze.create("idb-open",{originalErrorMessage:e.message})})),ct}async function ht(e,t){try{const n=(await ut()).transaction(at,"readwrite"),r=n.objectStore(at);await r.put(t,lt(e)),await n.done}catch(n){if(n instanceof k)ye.warn(n.message);else{const e=Ze.create("idb-set",{originalErrorMessage:n?.message});ye.warn(e.message)}}}function lt(e){return`${e.name}!${e.options.appId}`}class dt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new pt(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=ft();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ye.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const e=ft(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const s of e){const e=n.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),mt(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),mt(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=s(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return ye.warn(e),""}}}function ft(){return(new Date).toISOString().substring(0,10)}class pt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!T()&&S().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await ut()).transaction(at),n=await t.objectStore(at).get(lt(e));return await t.done,n}catch(t){if(t instanceof k)ye.warn(t.message);else{const e=Ze.create("idb-get",{originalErrorMessage:t?.message});ye.warn(e.message)}}}(this.app);return e?.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return ht(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return ht(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function mt(e){return s(JSON.stringify({version:2,heartbeats:e})).length}Je(new F("platform-logger",e=>new pe(e),"PRIVATE")),Je(new F("heartbeat",e=>new dt(e),"PRIVATE")),ot(me,ge,""),ot(me,ge,"esm2020"),ot("fire-js","");const gt=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},yt=new A("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),wt=new Q("@firebase/auth");function vt(e,...t){wt.logLevel<=z.ERROR&&wt.error(`Auth (${tt}): ${e}`,...t)}function It(e,...t){throw Tt(e,...t)}function _t(e,...t){return Tt(e,...t)}function bt(e,t,n){const r={...gt(),[t]:n};return new A("auth","Firebase",r).create(t,{appName:e.name})}function Et(e){return bt(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Tt(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return yt.create(e,...t)}function St(e,t,...n){if(!e)throw Tt(t,...n)}function Ct(e){const t="INTERNAL ASSERTION FAILED: "+e;throw vt(t),new Error(t)}function kt(e,t){e||Ct(t)}function At(){return"undefined"!=typeof self&&self.location?.href||""}function Nt(){return"http:"===Rt()||"https:"===Rt()}function Rt(){return"undefined"!=typeof self&&self.location?.protocol||null}class Dt{constructor(e,t){this.shortDelay=e,this.longDelay=t,kt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Nt()||_()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function xt(e,t){kt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Pt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Ct("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Ct("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Ct("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ot={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Lt=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Mt=new Dt(3e4,6e4);function Vt(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function Ut(e,t,n,r,s={}){return Ft(e,s,async()=>{let s={},i={};r&&("GET"===t?i=r:s={body:JSON.stringify(r)});const o=x({key:e.config.apiKey,...i}).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c={method:t,headers:a,...s};return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&f(e.emulatorConfig.host)&&(c.credentials="include"),Pt.fetch()(await jt(e,e.config.apiHost,n,o),c)})}async function Ft(e,t,n){e._canInitEmulator=!1;const r={...Ot,...t};try{const t=new zt(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await s.json();if("needConfirmation"in i)throw Kt(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{const t=s.ok?i.errorMessage:i.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Kt(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw Kt(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw Kt(e,"user-disabled",i);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw bt(e,a,o);It(e,a)}}catch(s){if(s instanceof k)throw s;It(e,"network-request-failed",{message:String(s)})}}async function Bt(e,t,n,r,s={}){const i=await Ut(e,t,n,r,s);return"mfaPendingCredential"in i&&It(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function jt(e,t,n,r){const s=`${t}${n}?${r}`,i=e,o=i.config.emulator?xt(e.config,s):`${e.config.apiScheme}://${s}`;return Lt.includes(n)&&(await i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())?i._getPersistence()._getFinalTarget(o).toString():o}function qt(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class zt{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(_t(this.auth,"network-request-failed")),Mt.get())})}}function Kt(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=_t(e,t,r);return s.customData._tokenResponse=n,s}function $t(e){return void 0!==e&&void 0!==e.getResponse}function Gt(e){return void 0!==e&&void 0!==e.enterprise}class Ht{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return qt(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Wt(e,t){return Ut(e,"GET","/v2/recaptchaConfig",Vt(e,t))}async function Qt(e,t){return Ut(e,"POST","/v1/accounts:lookup",t)}function Jt(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function Xt(e){return 1e3*Number(e)}function Yt(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return vt("JWT malformed, contained fewer than 3 sections"),null;try{const e=i(n);return e?JSON.parse(e):(vt("Failed to decode base64 JWT payload"),null)}catch(s){return vt("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Zt(e){const t=Yt(e);return St(t,"internal-error"),St(void 0!==t.exp,"internal-error"),St(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function en(e,t,n=!1){if(n)return t;try{return await t}catch(r){throw r instanceof k&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(r)&&e.auth.currentUser===e&&await e.auth.signOut(),r}}class tn{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e?.code&&this.schedule(!0))}this.schedule()}}class nn{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Jt(this.lastLoginAt),this.creationTime=Jt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function rn(e){const t=e.auth,n=await e.getIdToken(),r=await en(e,Qt(t,{idToken:n}));St(r?.users.length,t,"internal-error");const s=r.users[0];e._notifyReloadListener(s);const i=s.providerUserInfo?.length?sn(s.providerUserInfo):[],o=(a=e.providerData,c=i,[...a.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var a,c;const u=e.isAnonymous,h=!(e.email&&s.passwordHash||o?.length),l=!!u&&h,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new nn(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(e,d)}function sn(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}class on{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){St(e.idToken,"internal-error"),St(void 0!==e.idToken,"internal-error"),St(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Zt(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){St(0!==e.length,"internal-error");const t=Zt(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(St(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await Ft(e,{},async()=>{const n=x({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,i=await jt(e,r,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:o,body:n};return e.emulatorConfig&&f(e.emulatorConfig.host)&&(a.credentials="include"),Pt.fetch()(i,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:s}=t,i=new on;return n&&(St("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(St("string"==typeof r,"internal-error",{appName:e}),i.accessToken=r),s&&(St("number"==typeof s,"internal-error",{appName:e}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new on,this.toJSON())}_performRefresh(){return Ct("not implemented")}}function an(e,t){St("string"==typeof e||void 0===e,"internal-error",{appName:t})}class cn{constructor({uid:e,auth:t,stsTokenManager:n,...r}){this.providerId="firebase",this.proactiveRefresh=new tn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new nn(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await en(this,this.stsTokenManager.getToken(this.auth,e));return St(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=U(e),r=await n.getIdToken(t),s=Yt(r);St(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i="object"==typeof s.firebase?s.firebase:void 0,o=i?.sign_in_provider;return{claims:s,token:r,authTime:Jt(Xt(s.auth_time)),issuedAtTime:Jt(Xt(s.iat)),expirationTime:Jt(Xt(s.exp)),signInProvider:o||null,signInSecondFactor:i?.sign_in_second_factor||null}}(this,e)}reload(){return async function(e){const t=U(e);await rn(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(St(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new cn({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){St(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await rn(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ye(this.auth.app))return Promise.reject(Et(this.auth));const e=await this.getIdToken();return await en(this,async function(e,t){return Ut(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,r=t.email??void 0,s=t.phoneNumber??void 0,i=t.photoURL??void 0,o=t.tenantId??void 0,a=t._redirectEventId??void 0,c=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:h,emailVerified:l,isAnonymous:d,providerData:f,stsTokenManager:p}=t;St(h&&p,e,"internal-error");const m=on.fromJSON(this.name,p);St("string"==typeof h,e,"internal-error"),an(n,e.name),an(r,e.name),St("boolean"==typeof l,e,"internal-error"),St("boolean"==typeof d,e,"internal-error"),an(s,e.name),an(i,e.name),an(o,e.name),an(a,e.name),an(c,e.name),an(u,e.name);const g=new cn({uid:h,auth:e,email:r,emailVerified:l,displayName:n,isAnonymous:d,photoURL:i,phoneNumber:s,tenantId:o,stsTokenManager:m,createdAt:c,lastLoginAt:u});return f&&Array.isArray(f)&&(g.providerData=f.map(e=>({...e}))),a&&(g._redirectEventId=a),g}static async _fromIdTokenResponse(e,t,n=!1){const r=new on;r.updateFromServerResponse(t);const s=new cn({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await rn(s),s}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];St(void 0!==r.localId,"internal-error");const s=void 0!==r.providerUserInfo?sn(r.providerUserInfo):[],i=!(r.email&&r.passwordHash||s?.length),o=new on;o.updateFromIdToken(n);const a=new cn({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:i}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new nn(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||s?.length)};return Object.assign(a,c),a}}const un=new Map;function hn(e){kt(e instanceof Function,"Expected a class definition");let t=un.get(e);return t?(kt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,un.set(e,t),t)}class ln{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ln.type="NONE";const dn=ln;function fn(e,t,n){return`firebase:${e}:${t}:${n}`}class pn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:s}=this.auth;this.fullUserKey=fn(this.userKey,r.apiKey,s),this.fullPersistenceKey=fn("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await Qt(this.auth,{idToken:e}).catch(()=>{});return t?cn._fromGetAccountInfoResponse(this.auth,t,e):null}return cn._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new pn(hn(dn),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=r[0]||hn(dn);const i=fn(n,e.config.apiKey,e.name);let o=null;for(const c of t)try{const t=await c._get(i);if(t){let n;if("string"==typeof t){const r=await Qt(e,{idToken:t}).catch(()=>{});if(!r)break;n=await cn._fromGetAccountInfoResponse(e,r,t)}else n=cn._fromJSON(e,t);c!==s&&(o=n),s=c;break}}catch{}const a=r.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(i,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(i)}catch{}})),new pn(s,e,n)):new pn(s,e,n)}}function mn(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(vn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(gn(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(_n(t))return"Blackberry";if(bn(t))return"Webos";if(yn(t))return"Safari";if((t.includes("chrome/")||wn(t))&&!t.includes("edge/"))return"Chrome";if(In(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===n?.length)return n[1]}return"Other"}function gn(e=v()){return/firefox\//i.test(e)}function yn(e=v()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function wn(e=v()){return/crios\//i.test(e)}function vn(e=v()){return/iemobile/i.test(e)}function In(e=v()){return/android/i.test(e)}function _n(e=v()){return/blackberry/i.test(e)}function bn(e=v()){return/webos/i.test(e)}function En(e=v()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Tn(e=v()){return En(e)||In(e)||bn(e)||_n(e)||/windows phone/i.test(e)||vn(e)}function Sn(e,t=[]){let n;switch(e){case"Browser":n=mn(v());break;case"Worker":n=`${mn(v())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${tt}/${r}`}class Cn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(s){r(s)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}class kn{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class An{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Rn(this),this.idTokenSubscription=new Rn(this),this.beforeStateQueue=new Cn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=yt,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=hn(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await pn.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(n){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e,!0)):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Qt(this,{idToken:e}),n=await cn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Ye(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const t=this.redirectUser?._redirectEventId,s=n?._redirectEventId,i=await this.tryRedirectSignIn(e);t&&t!==s||!i?.user||(n=i.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(s){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return St(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await rn(e)}catch(t){if("auth/network-request-failed"!==t?.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ye(this.app))return Promise.reject(Et(this));const t=e?U(e):null;return t&&St(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&St(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ye(this.app)?Promise.reject(Et(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ye(this.app)?Promise.reject(Et(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(hn(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return Ut(e,"GET","/v2/passwordPolicy",Vt(e,t))}(this),t=new kn(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new A("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Ut(e,"POST","/v2/accounts:revokeToken",Vt(e,t))}(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&hn(e)||this._popupRedirectResolver;St(t,this,"argument-error"),this.redirectPersistenceManager=await pn.create(this,[hn(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t);let i=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(St(o,this,"internal-error"),o.then(()=>{i||s(this.currentUser)}),"function"==typeof t){const s=e.addObserver(t,n,r);return()=>{i=!0,s()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return St(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Sn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await(this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(Ye(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await(this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken());return e?.error&&function(e,...t){wt.logLevel<=z.WARN&&wt.warn(`Auth (${tt}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Nn(e){return U(e)}class Rn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new L(e,void 0);return t.subscribe.bind(t)}(e=>this.observer=e)}get next(){return St(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Dn={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function xn(e){return Dn.loadJS(e)}function Pn(e){return`__${e}${Math.floor(1e6*Math.random())}`}const On=1e12;class Ln{constructor(e){this.auth=e,this.counter=On,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new Un(e,this.auth.name,t||{})),this.counter++,n}reset(e){const t=e||On;this._widgets.get(t)?.delete(),this._widgets.delete(t)}getResponse(e){const t=e||On;return this._widgets.get(t)?.getResponse()||""}async execute(e){const t=e||On;return this._widgets.get(t)?.execute(),""}}class Mn{constructor(){this.enterprise=new Vn}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Vn{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Un{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;St(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<50;n++)e.push(t.charAt(Math.floor(62*Math.random())));return e.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Fn="NO_RECAPTCHA";class Bn{constructor(e){this.type="recaptcha-enterprise",this.auth=Nn(e)}async verify(e="verify",t=!1){function n(t,n,r){const s=window.grecaptcha;Gt(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(Fn)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new Mn).execute("siteKey",{action:"verify"}):new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{Wt(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new Ht(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(s=>{if(!t&&Gt(window.grecaptcha))n(s,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Dn.recaptchaEnterpriseScript;0!==t.length&&(t+=s),xn(t).then(()=>{n(s,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function jn(e,t,n,r=!1,s=!1){const i=new Bn(e);let o;if(s)o=Fn;else try{o=await i.verify(n)}catch(c){o=await i.verify(n,!0)}const a={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function qn(e,t,n,r,s){if("EMAIL_PASSWORD_PROVIDER"===s){if(e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await jn(e,t,n,"getOobCode"===n);return r(e,s)}return r(e,t).catch(async s=>{if("auth/missing-recaptcha-token"===s.code){const s=await jn(e,t,n,"getOobCode"===n);return r(e,s)}return Promise.reject(s)})}if("PHONE_PROVIDER"===s){if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){const s=await jn(e,t,n);return r(e,s).catch(async s=>{if("AUDIT"===e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")&&("auth/missing-recaptcha-token"===s.code||"auth/invalid-app-credential"===s.code)){const s=await jn(e,t,n,!1,!0);return r(e,s)}return Promise.reject(s)})}{const s=await jn(e,t,n,!1,!0);return r(e,s)}}return Promise.reject(s+" provider is not supported.")}function zn(e,t){const n=Xe(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(R(n.getOptions(),t??{}))return e;It(e,"already-initialized")}return n.initialize({options:t})}function Kn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function $n(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Gn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ct("not implemented")}_getIdTokenResponse(e){return Ct("not implemented")}_linkToIdToken(e,t){return Ct("not implemented")}_getReauthenticationResolver(e){return Ct("not implemented")}}async function Hn(e,t){return Ut(e,"POST","/v1/accounts:signUp",t)}async function Wn(e,t){return Bt(e,"POST","/v1/accounts:signInWithPassword",Vt(e,t))}class Qn extends Gn{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Qn(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Qn(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return qn(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Wn,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Bt(e,"POST","/v1/accounts:signInWithEmailLink",Vt(e,t))}(e,{email:this._email,oobCode:this._password});default:It(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return qn(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Hn,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Bt(e,"POST","/v1/accounts:signInWithEmailLink",Vt(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:It(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Jn(e,t){return Bt(e,"POST","/v1/accounts:signInWithIdp",Vt(e,t))}class Xn extends Gn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Xn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):It("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,...s}=t;if(!n||!r)return null;const i=new Xn(n,r);return i.idToken=s.idToken||void 0,i.accessToken=s.accessToken||void 0,i.secret=s.secret,i.nonce=s.nonce,i.pendingToken=s.pendingToken||null,i}_getIdTokenResponse(e){return Jn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Jn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Jn(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=x(t)}return e}}async function Yn(e,t){return Ut(e,"POST","/v1/accounts:sendVerificationCode",Vt(e,t))}const Zn={USER_NOT_FOUND:"user-not-found"};class er extends Gn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new er({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new er({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Bt(e,"POST","/v1/accounts:signInWithPhoneNumber",Vt(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Bt(e,"POST","/v1/accounts:signInWithPhoneNumber",Vt(e,t));if(n.temporaryProof)throw Kt(e,"account-exists-with-different-credential",n);return n}(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return async function(e,t){return Bt(e,"POST","/v1/accounts:signInWithPhoneNumber",Vt(e,{...t,operation:"REAUTH"}),Zn)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}=e;return n||t||r||s?new er({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}):null}}class tr{constructor(e){const t=P(O(e)),n=t.apiKey??null,r=t.oobCode??null,s=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);St(n&&r&&s,"argument-error"),this.apiKey=n,this.operation=s,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=function(e){const t=P(O(e)).link,n=t?P(O(t)).deep_link_id:null,r=P(O(e)).deep_link_id;return(r?P(O(r)).link:null)||r||n||t||e}(e);try{return new tr(t)}catch{return null}}}class nr{constructor(){this.providerId=nr.PROVIDER_ID}static credential(e,t){return Qn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=tr.parseLink(t);return St(n,"argument-error"),Qn._fromEmailAndCode(e,n.code,n.tenantId)}}nr.PROVIDER_ID="password",nr.EMAIL_PASSWORD_SIGN_IN_METHOD="password",nr.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class rr{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class sr extends rr{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ir extends sr{constructor(){super("facebook.com")}static credential(e){return Xn._fromParams({providerId:ir.PROVIDER_ID,signInMethod:ir.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ir.credentialFromTaggedObject(e)}static credentialFromError(e){return ir.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ir.credential(e.oauthAccessToken)}catch{return null}}}ir.FACEBOOK_SIGN_IN_METHOD="facebook.com",ir.PROVIDER_ID="facebook.com";class or extends sr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Xn._fromParams({providerId:or.PROVIDER_ID,signInMethod:or.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return or.credentialFromTaggedObject(e)}static credentialFromError(e){return or.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return or.credential(t,n)}catch{return null}}}or.GOOGLE_SIGN_IN_METHOD="google.com",or.PROVIDER_ID="google.com";class ar extends sr{constructor(){super("github.com")}static credential(e){return Xn._fromParams({providerId:ar.PROVIDER_ID,signInMethod:ar.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ar.credentialFromTaggedObject(e)}static credentialFromError(e){return ar.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ar.credential(e.oauthAccessToken)}catch{return null}}}ar.GITHUB_SIGN_IN_METHOD="github.com",ar.PROVIDER_ID="github.com";class cr extends sr{constructor(){super("twitter.com")}static credential(e,t){return Xn._fromParams({providerId:cr.PROVIDER_ID,signInMethod:cr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return cr.credentialFromTaggedObject(e)}static credentialFromError(e){return cr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return cr.credential(t,n)}catch{return null}}}async function ur(e,t){return Bt(e,"POST","/v1/accounts:signUp",Vt(e,t))}cr.TWITTER_SIGN_IN_METHOD="twitter.com",cr.PROVIDER_ID="twitter.com";class hr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const s=await cn._fromIdTokenResponse(e,n,r),i=lr(n);return new hr({user:s,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=lr(n);return new hr({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function lr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class dr extends k{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,dr.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new dr(e,t,n,r)}}function fr(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw dr._fromErrorAndOperation(e,n,t,r);throw n})}async function pr(e,t,n=!1){if(Ye(e.app))return Promise.reject(Et(e));const r="signIn",s=await fr(e,r,t),i=await hr._fromIdTokenResponse(e,r,s);return n||await e._updateCurrentUser(i.user),i}async function mr(e,t){return pr(Nn(e),t)}async function gr(e){const t=Nn(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function yr(e,t,n){if(Ye(e.app))return Promise.reject(Et(e));const r=Nn(e),s=qn(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ur,"EMAIL_PASSWORD_PROVIDER"),i=await s.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&gr(e),t}),o=await hr._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(o.user),o}function wr(e,t,n){return Ye(e.app)?Promise.reject(Et(e)):mr(U(e),nr.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&gr(e),t})}function vr(e,t,n,r){return U(e).onAuthStateChanged(t,n,r)}function Ir(e){return U(e).signOut()}function _r(e,t){return Ut(e,"POST","/v2/accounts/mfaEnrollment:start",Vt(e,t))}const br="__sak";class Er{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(br,"1"),this.storage.removeItem(br),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Tr extends Er{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Tn(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);!function(){const e=v();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||s===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Tr.type="LOCAL";const Sr=Tr;class Cr extends Er{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Cr.type="SESSION";const kr=Cr;class Ar{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new Ar(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:s}=t.data,i=this.handlersMap[r];if(!i?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(i).map(async e=>e(t.origin,s)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Nr(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Ar.receivers=[];class Rr{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,i;return new Promise((o,a)=>{const c=Nr("",20);r.port1.start();const u=setTimeout(()=>{a(new Error("unsupported_event"))},n);i={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(u),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(i),r.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function Dr(){return window}function xr(){return void 0!==Dr().WorkerGlobalScope&&"function"==typeof Dr().importScripts}const Pr="firebaseLocalStorageDb",Or="firebaseLocalStorage",Lr="fbase_key";class Mr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Vr(e,t){return e.transaction([Or],t?"readwrite":"readonly").objectStore(Or)}function Ur(){const e=indexedDB.open(Pr,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Or,{keyPath:Lr})}catch(r){n(r)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(Or)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Pr);return new Mr(e).toPromise()}(),t(await Ur()))})})}async function Fr(e,t,n){const r=Vr(e,!0).put({[Lr]:t,value:n});return new Mr(r).toPromise()}function Br(e,t){const n=Vr(e,!0).delete(t);return new Mr(n).toPromise()}class jr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Ur()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return xr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ar._getInstance(xr()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await async function(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}(),!this.activeServiceWorker)return;this.sender=new Rr(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ur();return await Fr(e,br,"1"),await Br(e,br),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Fr(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=Vr(e,!1).get(t),r=await new Mr(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Br(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=Vr(e,!1).getAll();return new Mr(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:s}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}jr.type="LOCAL";const qr=jr;function zr(e,t){return Ut(e,"POST","/v2/accounts/mfaSignIn:start",Vt(e,t))}const Kr=Pn("rcb"),$r=new Dt(3e4,6e4);class Gr{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!Dr().grecaptcha?.render}load(e,t=""){return St(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&$t(Dr().grecaptcha)?Promise.resolve(Dr().grecaptcha):new Promise((n,r)=>{const s=Dr().setTimeout(()=>{r(_t(e,"network-request-failed"))},$r.get());Dr()[Kr]=()=>{Dr().clearTimeout(s),delete Dr()[Kr];const i=Dr().grecaptcha;if(!i||!$t(i))return void r(_t(e,"internal-error"));const o=i.render;i.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(i)},xn(`${Dn.recaptchaV2Script}?${x({onload:Kr,render:"explicit",hl:t})}`).catch(()=>{clearTimeout(s),r(_t(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!Dr().grecaptcha?.render&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Hr{async load(e){return new Ln(e)}clearedOneInstance(){}}const Wr="recaptcha",Qr={theme:"light",type:"image"};class Jr{constructor(e,t,n={...Qr}){this.parameters=n,this.type=Wr,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Nn(e),this.isInvisible="invisible"===this.parameters.size,St("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof t?document.getElementById(t):t;St(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Hr:new Gr,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha();return t.getResponse(e)||new Promise(n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){St(!this.parameters.sitekey,this.auth,"argument-error"),St(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),St("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof e)e(t);else if("string"==typeof e){const n=Dr()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){St(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){St(Nt()&&!xr(),this.auth,"internal-error"),await function(){let e=null;return new Promise(t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()}).catch(t=>{throw e&&window.removeEventListener("load",e),t})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await Ut(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);St(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return St(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Xr{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=er._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Yr(e,t,n){if(Ye(e.app))return Promise.reject(Et(e));const r=Nn(e),s=await async function(e,t,n){if(!e._getRecaptchaConfig())try{await async function(e){const t=Nn(e),n=await Wt(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Ht(n);null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new Bn(t).verify()}(e)}catch(r){}try{let r;if(r="string"==typeof t?{phoneNumber:t}:t,"session"in r){const t=r.session;if("phoneNumber"in r){St("enroll"===t.type,e,"internal-error");const s=qn(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===Fn?(St(n?.type===Wr,e,"argument-error"),_r(e,await Zr(e,t,n))):_r(e,t),"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{St("signin"===t.type,e,"internal-error");const s=r.multiFactorHint?.uid||r.multiFactorUid;St(s,e,"missing-multi-factor-info");const i=qn(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",async(e,t)=>t.phoneSignInInfo.captchaResponse===Fn?(St(n?.type===Wr,e,"argument-error"),zr(e,await Zr(e,t,n))):zr(e,t),"PHONE_PROVIDER");return(await i.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t=qn(e,{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",async(e,t)=>t.captchaResponse===Fn?(St(n?.type===Wr,e,"argument-error"),Yn(e,await Zr(e,t,n))):Yn(e,t),"PHONE_PROVIDER");return(await t.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}(r,t,U(n));return new Xr(s,e=>mr(r,e))}async function Zr(e,t,n){St(n.type===Wr,e,"argument-error");const r=await n.verify();St("string"==typeof r,e,"argument-error");const s={...t};if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,n=s.phoneEnrollmentInfo.clientType,i=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:i}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,n=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),s}return Object.assign(s,{recaptchaToken:r}),s}class es extends Gn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Jn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Jn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Jn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ts(e){return pr(e.auth,new es(e),e.bypassAuthState)}function ns(e){const{auth:t,user:n}=e;return St(n,t,"internal-error"),async function(e,t,n=!1){const{auth:r}=e;if(Ye(r.app))return Promise.reject(Et(r));const s="reauthenticate";try{const i=await en(e,fr(r,s,t,e),n);St(i.idToken,r,"internal-error");const o=Yt(i.idToken);St(o,r,"internal-error");const{sub:a}=o;return St(e.uid===a,r,"user-mismatch"),hr._forOperation(e,s,i)}catch(i){throw"auth/user-not-found"===i?.code&&It(r,"user-mismatch"),i}}(n,new es(e),e.bypassAuthState)}async function rs(e){const{auth:t,user:n}=e;return St(n,t,"internal-error"),async function(e,t,n=!1){const r=await en(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return hr._forOperation(e,"link",r)}(n,new es(e),e.bypassAuthState)}class ss{constructor(e,t,n,r,s=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:s,error:i,type:o}=e;if(i)return void this.reject(i);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ts;case"linkViaPopup":case"linkViaRedirect":return rs;case"reauthViaPopup":case"reauthViaRedirect":return ns;default:It(this.auth,"internal-error")}}resolve(e){kt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){kt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const is=new Dt(2e3,1e4);class os extends ss{constructor(e,t,n,r,s){super(e,t,r,s),this.provider=n,this.authWindow=null,this.pollId=null,os.currentPopupAction&&os.currentPopupAction.cancel(),os.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return St(e,this.auth,"internal-error"),e}async onExecution(){kt(1===this.filter.length,"Popup operations only handle one event");const e=Nr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(_t(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(_t(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,os.currentPopupAction=null}pollUserCancellation(){const e=()=>{this.authWindow?.window?.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_t(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,is.get())};e()}}os.currentPopupAction=null;const as=new Map;class cs extends ss{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=as.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return fn("pendingRedirect",e.config.apiKey,e.name)}(t),r=function(e){return hn(e._redirectPersistence)}(e);if(!(await r._isAvailable()))return!1;const s="true"===await r._get(n);return await r._remove(n),s}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}as.set(this.auth._key(),e)}return this.bypassAuthState||as.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function us(e,t){as.set(e._key(),t)}async function hs(e,t,n=!1){if(Ye(e.app))return Promise.reject(Et(e));const r=Nn(e),s=function(e,t){return t?hn(t):(St(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(r,t),i=new cs(r,s,n),o=await i.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class ls{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return fs(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!fs(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(_t(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ds(e))}saveEventToCache(e){this.cachedEventUids.add(ds(e)),this.lastProcessedEventTime=Date.now()}}function ds(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function fs({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===t?.code}const ps=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ms=/^https?/;function gs(e){const t=At(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===r}if(!ms.test(n))return!1;if(ps.test(e))return r===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const ys=new Dt(3e4,6e4);function ws(){const e=Dr().___jsl;if(e?.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let vs=null;const Is=new Dt(5e3,15e3),_s={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},bs=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Es(e){const t=e.config;St(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?xt(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:tt},s=bs.get(e.config.apiHost);s&&(r.eid=s);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${x(r).slice(1)}`}async function Ts(e){const t=await function(e){return vs=vs||function(e){return new Promise((t,n)=>{function r(){ws(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ws(),n(_t(e,"network-request-failed"))},timeout:ys.get()})}if(Dr().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else{if(!Dr().gapi?.load){const t=Pn("iframefcb");return Dr()[t]=()=>{gapi.load?r():n(_t(e,"network-request-failed"))},xn(`${Dn.gapiScript}?onload=${t}`).catch(e=>n(e))}r()}}).catch(e=>{throw vs=null,e})}(e),vs}(e),n=Dr().gapi;return St(n,e,"internal-error"),t.open({where:document.body,url:Es(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:_s,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const s=_t(e,"network-request-failed"),i=Dr().setTimeout(()=>{r(s)},Is.get());function o(){Dr().clearTimeout(i),n(t)}t.ping(o).then(o,()=>{r(s)})}))}const Ss={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Cs{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const ks=encodeURIComponent("fac");async function As(e,t,n,r,s,i){St(e.config.authDomain,e,"auth-domain-config-required"),St(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:tt,eventId:s};if(t instanceof rr){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))o[e]=t}if(t instanceof sr){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const h of Object.keys(a))void 0===a[h]&&delete a[h];const c=await e._getAppCheckToken(),u=c?`#${ks}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?xt(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${x(a).slice(1)}${u}`}const Ns="webStorageSupport",Rs=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=kr,this._completeRedirectFn=hs,this._overrideRedirectResult=us}async _openPopup(e,t,n,r){return kt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,s=600){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c={...Ss,width:r.toString(),height:s.toString(),top:i,left:o},u=v().toLowerCase();n&&(a=wn(u)?"_blank":n),gn(u)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=v()){return En(e)&&!!window.navigator?.standalone}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new Cs(null);const l=window.open(t||"",a,h);St(l,e,"popup-blocked");try{l.focus()}catch(d){}return new Cs(l)}(e,await As(e,t,n,At(),r),Nr())}async _openRedirect(e,t,n,r){return await this._originValidation(e),s=await As(e,t,n,At(),r),Dr().location.href=s,new Promise(()=>{});var s}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(kt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Ts(e),n=new ls(e);return t.register("authEvent",t=>(St(t?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ns,{type:Ns},n=>{const r=n?.[0]?.[Ns];void 0!==r&&t(!!r),It(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return Ut(e,"GET","/v1/projects",t)}(e);for(const n of t)try{if(gs(n))return}catch{}It(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Tn()||yn()||En()}};var Ds="@firebase/auth",xs="1.11.1";class Ps{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){St(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Os=l("authIdTokenMaxAge")||300;let Ls=null;function Ms(e=rt()){const t=Xe(e,"auth");if(t.isInitialized())return t.getImmediate();const n=zn(e,{popupRedirectResolver:Rs,persistence:[qr,Sr,kr]}),r=l("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(s=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Os)return;const r=t?.token;Ls!==r&&(Ls=r,await fetch(s,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){U(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e){U(e).onIdTokenChanged(e=>t(e),void 0,void 0)}(n)}}var s;const i=c("auth");return i&&function(e,t){const n=Nn(e);St(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const r=Kn(t),{host:s,port:i}=function(e){const t=Kn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const e=s[1];return{host:e,port:$n(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:$n(t)}}}(t),o=null===i?"":`:${i}`,a={url:`${r}//${s}${o}/`},c=Object.freeze({host:s,port:i,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator)return St(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),void St(R(a,n.config.emulator)&&R(c,n.emulatorConfig),n,"emulator-config-failed");n.config.emulator=a,n.emulatorConfig=c,n.settings.appVerificationDisabledForTesting=!0,f(s)?(p(`${r}//${s}${o}`),w("Auth",!0)):function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&console.info,"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${i}`),n}var Vs;Dn={loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=_t("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Vs="Browser",Je(new F("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:i,authDomain:o}=n.options;St(i&&!i.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:i,authDomain:o,clientPlatform:Vs,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Sn(Vs)},c=new An(n,r,s,a);return function(e,t){const n=t?.persistence||[],r=(Array.isArray(n)?n:[n]).map(hn);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,t?.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Je(new F("auth-internal",e=>{const t=Nn(e.getProvider("auth").getImmediate());return new Ps(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ot(Ds,xs,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Vs)),ot(Ds,xs,"esm2020"),ot("firebase","12.6.0","app");var Us,Fs,Bs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(e,t,n){n||(n=0);const r=Array(16);if("string"==typeof t)for(var s=0;s<16;++s)r[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;s<16;++s)r[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];let i,o=e.g[3];i=t+(o^n&(s^o))+r[0]+3614090360&4294967295,i=o+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[1]+3905402710&4294967295,o=t+(i<<12&4294967295|i>>>20),i=s+(n^o&(t^n))+r[2]+606105819&4294967295,i=n+(t^(s=o+(i<<17&4294967295|i>>>15))&(o^t))+r[3]+3250441966&4294967295,i=t+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[4]+4118548399&4294967295,i=o+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[5]+1200080426&4294967295,o=t+(i<<12&4294967295|i>>>20),i=s+(n^o&(t^n))+r[6]+2821735955&4294967295,i=n+(t^(s=o+(i<<17&4294967295|i>>>15))&(o^t))+r[7]+4249261313&4294967295,i=t+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[8]+1770035416&4294967295,i=o+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[9]+2336552879&4294967295,o=t+(i<<12&4294967295|i>>>20),i=s+(n^o&(t^n))+r[10]+4294925233&4294967295,i=n+(t^(s=o+(i<<17&4294967295|i>>>15))&(o^t))+r[11]+2304563134&4294967295,i=t+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[12]+1804603682&4294967295,i=o+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[13]+4254626195&4294967295,o=t+(i<<12&4294967295|i>>>20),i=s+(n^o&(t^n))+r[14]+2792965006&4294967295,i=n+(t^(s=o+(i<<17&4294967295|i>>>15))&(o^t))+r[15]+1236535329&4294967295,i=t+(s^o&((n=s+(i<<22&4294967295|i>>>10))^s))+r[1]+4129170786&4294967295,i=o+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[6]+3225465664&4294967295,o=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(o^t))+r[11]+643717713&4294967295,i=n+(o^t&((s=o+(i<<14&4294967295|i>>>18))^o))+r[0]+3921069994&4294967295,i=t+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[5]+3593408605&4294967295,i=o+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[10]+38016083&4294967295,o=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(o^t))+r[15]+3634488961&4294967295,i=n+(o^t&((s=o+(i<<14&4294967295|i>>>18))^o))+r[4]+3889429448&4294967295,i=t+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[9]+568446438&4294967295,i=o+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[14]+3275163606&4294967295,o=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(o^t))+r[3]+4107603335&4294967295,i=n+(o^t&((s=o+(i<<14&4294967295|i>>>18))^o))+r[8]+1163531501&4294967295,i=t+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[13]+2850285829&4294967295,i=o+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[2]+4243563512&4294967295,o=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(o^t))+r[7]+1735328473&4294967295,i=n+(o^t&((s=o+(i<<14&4294967295|i>>>18))^o))+r[12]+2368359562&4294967295,i=t+((n=s+(i<<20&4294967295|i>>>12))^s^o)+r[5]+4294588738&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[8]+2272392833&4294967295,o=t+(i<<11&4294967295|i>>>21),i=s+(o^t^n)+r[11]+1839030562&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^t)+r[14]+4259657740&4294967295,i=t+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[1]+2763975236&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[4]+1272893353&4294967295,o=t+(i<<11&4294967295|i>>>21),i=s+(o^t^n)+r[7]+4139469664&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^t)+r[10]+3200236656&4294967295,i=t+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[13]+681279174&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[0]+3936430074&4294967295,o=t+(i<<11&4294967295|i>>>21),i=s+(o^t^n)+r[3]+3572445317&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^t)+r[6]+76029189&4294967295,i=t+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[9]+3654602809&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[12]+3873151461&4294967295,o=t+(i<<11&4294967295|i>>>21),i=s+(o^t^n)+r[15]+530742520&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^t)+r[2]+3299628645&4294967295,i=t+(s^((n=s+(i<<23&4294967295|i>>>9))|~o))+r[0]+4096336452&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[7]+1126891415&4294967295,o=t+(i<<10&4294967295|i>>>22),i=s+(t^(o|~n))+r[14]+2878612391&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~t))+r[5]+4237533241&4294967295,i=t+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[12]+1700485571&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[3]+2399980690&4294967295,o=t+(i<<10&4294967295|i>>>22),i=s+(t^(o|~n))+r[10]+4293915773&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~t))+r[1]+2240044497&4294967295,i=t+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[8]+1873313359&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[15]+4264355552&4294967295,o=t+(i<<10&4294967295|i>>>22),i=s+(t^(o|~n))+r[6]+2734768916&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~t))+r[13]+1309151649&4294967295,i=t+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[4]+4149444226&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[11]+3174756917&4294967295,o=t+(i<<10&4294967295|i>>>22),i=s+(t^(o|~n))+r[2]+718787259&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(i<<21&4294967295|i>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+o&4294967295}function r(e,t){this.h=t;const n=[];let r=!0;for(let s=e.length-1;s>=0;s--){const i=0|e[s];r&&i==t||(n[s]=i,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const r=t-this.blockSize,s=this.C;let i=this.h,o=0;for(;o<t;){if(0==i)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(s[i++]=e.charCodeAt(o++),i==this.blockSize){n(this,s),i=0;break}}else for(;o<t;)if(s[i++]=e[o++],i==this.blockSize){n(this,s),i=0;break}}this.h=i,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var s={};function i(e){return-128<=e&&e<128?function(e){var t=s;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new r([0|e],e<0?-1:0)}(e)}(e):new r([0|e],e<0?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(e<0)return d(o(-e));const t=[];let n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new r(t,0)}var a=i(0),c=i(1),u=i(16777216);function h(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function l(e){return-1==e.h}function d(e){const t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new r(n,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(h(t))throw Error("division by zero");if(h(e))return new m(a,a);if(l(e))return t=g(d(e),t),new m(d(t.g),d(t.h));if(l(t))return t=g(e,d(t)),new m(d(t.g),t.h);if(e.g.length>30){if(l(e)||l(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=t;r.l(e)<=0;)n=y(n),r=y(r);var s=w(n,1),i=w(r,1);for(r=w(r,2),n=w(n,2);!h(r);){var u=i.add(r);u.l(e)<=0&&(s=s.add(n),i=u),r=w(r,1),n=w(n,1)}return t=f(e,s.j(t)),new m(s,t)}for(s=a;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),u=(i=o(n)).j(t);l(u)||u.l(e)>0;)u=(i=o(n-=r)).j(t);h(i)&&(i=c),s=s.add(i),e=f(e,u)}return new m(s,e)}function y(e){const t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new r(n,e.h)}function w(e,t){const n=t>>5;t%=32;const s=e.g.length-n,i=[];for(let r=0;r<s;r++)i[r]=t>0?e.i(r+n)>>>t|e.i(r+n+1)<<32-t:e.i(r+n);return new r(i,e.h)}(e=r.prototype).m=function(){if(l(this))return-d(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){const r=this.i(n);e+=(r>=0?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(h(this))return"0";if(l(this))return"-"+d(this).toString(e);const t=o(Math.pow(e,6));var n=this;let r="";for(;;){const s=g(n,t).g;let i=(((n=f(n,s.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(h(n=s))return i+r;for(;i.length<6;)i="0"+i;r=i+r}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return l(e=f(this,e))?-1:h(e)?0:1},e.abs=function(){return l(this)?d(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),n=[];let s=0;for(let r=0;r<=t;r++){let t=s+(65535&this.i(r))+(65535&e.i(r)),i=(t>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);s=i>>>16,t&=65535,i&=65535,n[r]=i<<16|t}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(h(this)||h(e))return a;if(l(this))return l(e)?d(this).j(d(e)):d(d(this).j(e));if(l(e))return d(this.j(d(e)));if(this.l(u)<0&&e.l(u)<0)return o(this.m()*e.m());const t=this.g.length+e.g.length,n=[];for(var s=0;s<2*t;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(let t=0;t<e.g.length;t++){const r=this.i(s)>>>16,i=65535&this.i(s),o=e.i(t)>>>16,a=65535&e.i(t);n[2*s+2*t]+=i*a,p(n,2*s+2*t),n[2*s+2*t+1]+=r*a,p(n,2*s+2*t+1),n[2*s+2*t+1]+=i*o,p(n,2*s+2*t+1),n[2*s+2*t+2]+=r*o,p(n,2*s+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new r(n,0)},e.B=function(e){return g(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new r(n,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new r(n,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,Fs=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.B,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const r=o(Math.pow(n,8));let s=a;for(let a=0;a<t.length;a+=8){var i=Math.min(8,t.length-a);const e=parseInt(t.substring(a,a+i),n);i<8?(i=o(Math.pow(n,i)),s=s.j(i).add(o(e))):(s=s.j(r),s=s.add(o(e)))}return s},Us=r}).apply(void 0!==Bs?Bs:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var js,qs,zs,Ks,$s,Gs,Hs,Ws,Qs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e,t=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Qs&&Qs];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function r(e,r){if(r)e:{var s=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var o=e[i];if(!(o in s))break e;s=s[o]}(r=r(i=s[e=e[e.length-1]]))!=i&&null!=r&&t(s,e,{configurable:!0,writable:!0,value:r})}}r("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},i=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){return(c=a).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}var l="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function d(e){const t=e.length;if(t>0){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let r=1;r<arguments.length;r++){const t=arguments[r];var n=typeof t;if("array"==(n="object"!=n?n:t?Array.isArray(t)?"array":n:"null")||"object"==n&&"number"==typeof t.length){n=e.length||0;const r=t.length||0;e.length=n+r;for(let s=0;s<r;s++)e[n+s]=t[s]}else e.push(t)}}function p(e){i.setTimeout(()=>{throw e},0)}function m(){var e=I;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var g=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new y,e=>e.reset());class y{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let w,v=!1,I=new class{constructor(){this.h=this.g=null}add(e,t){const n=g.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},_=()=>{const e=Promise.resolve(void 0);w=()=>{e.then(b)}};function b(){for(var e;e=m();){try{e.h.call(e.g)}catch(n){p(n)}var t=g;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}v=!1}function E(){this.u=this.u,this.C=this.C}function T(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},T.prototype.h=function(){this.defaultPrevented=!0};var S=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function C(e){return/^[\s\xa0]*$/.test(e)}function k(e,t){T.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}h(k,T),k.prototype.init=function(e,t){const n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&k.Z.h.call(this)},k.prototype.h=function(){k.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var A="closure_listenable_"+(1e6*Math.random()|0),N=0;function R(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=s,this.key=++N,this.da=this.fa=!1}function D(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function x(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function P(e){const t={};for(const n in e)t[n]=e[n];return t}const O="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function L(e,t){let n,r;for(let s=1;s<arguments.length;s++){for(n in r=arguments[s],r)e[n]=r[n];for(let t=0;t<O.length;t++)n=O[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function M(e){this.src=e,this.g={},this.h=0}function V(e,t){const n=t.type;if(n in e.g){var r,s=e.g[n],i=Array.prototype.indexOf.call(s,t,void 0);(r=i>=0)&&Array.prototype.splice.call(s,i,1),r&&(D(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function U(e,t,n,r){for(let s=0;s<e.length;++s){const i=e[s];if(!i.da&&i.listener==t&&i.capture==!!n&&i.ha==r)return s}return-1}M.prototype.add=function(e,t,n,r,s){const i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);const o=U(e,t,r,s);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new R(t,this.src,i,!!r,s)).fa=n,e.push(t)),t};var F="closure_lm_"+(1e6*Math.random()|0),B={};function j(e,t,n,r,s){if(Array.isArray(t)){for(let i=0;i<t.length;i++)j(e,t[i],n,r,s);return null}return n=W(n),e&&e[A]?e.J(t,n,!!o(r)&&!!r.capture,s):function(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");const a=o(s)?!!s.capture:!!s;let c=G(e);if(c||(e[F]=c=new M(e)),(n=c.add(t,n,r,a,i)).proxy)return n;if(r=function(){const e=$;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)S||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(K(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}(e,t,n,!1,r,s)}function q(e,t,n,r,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)q(e,t[i],n,r,s);else r=o(r)?!!r.capture:!!r,n=W(n),e&&e[A]?(e=e.i,(i=String(t).toString())in e.g&&(n=U(t=e.g[i],n,r,s))>-1&&(D(t[n]),Array.prototype.splice.call(t,n,1),0==t.length&&(delete e.g[i],e.h--))):e&&(e=G(e))&&(t=e.g[t.toString()],e=-1,t&&(e=U(t,n,r,s)),(n=e>-1?t[e]:null)&&z(n))}function z(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[A])V(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(K(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=G(t))?(V(n,e),0==n.h&&(n.src=null,t[F]=null)):D(e)}}}function K(e){return e in B?B[e]:B[e]="on"+e}function $(e,t){if(e.da)e=!0;else{t=new k(t,this);const n=e.listener,r=e.ha||e.src;e.fa&&z(e),e=n.call(r,t)}return e}function G(e){return(e=e[F])instanceof M?e:null}var H="__closure_events_fn_"+(1e9*Math.random()>>>0);function W(e){return"function"==typeof e?e:(e[H]||(e[H]=function(t){return e.handleEvent(t)}),e[H])}function Q(){E.call(this),this.i=new M(this),this.M=this,this.G=null}function J(e,t){var n,r=e.G;if(r)for(n=[];r;r=r.G)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new T(t,e);else if(t instanceof T)t.target=t.target||e;else{var s=t;L(t=new T(r,e),s)}let i,o;if(s=!0,n)for(o=n.length-1;o>=0;o--)i=t.g=n[o],s=X(i,r,!0,t)&&s;if(i=t.g=e,s=X(i,r,!0,t)&&s,s=X(i,r,!1,t)&&s,n)for(o=0;o<n.length;o++)i=t.g=n[o],s=X(i,r,!1,t)&&s}function X(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let s=!0;for(let i=0;i<t.length;++i){const o=t[i];if(o&&!o.da&&o.capture==n){const t=o.listener,n=o.ha||o.src;o.fa&&V(e.i,o),s=!1!==t.call(n,r)&&s}}return s&&!r.defaultPrevented}function Y(e){e.g=function(e,t){if("function"!=typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return Number(t)>2147483647?-1:i.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,Y(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(Q,E),Q.prototype[A]=!0,Q.prototype.removeEventListener=function(e,t,n,r){q(this,e,t,n,r)},Q.prototype.N=function(){if(Q.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const n=e.g[t];for(let e=0;e<n.length;e++)D(n[e]);delete e.g[t],e.h--}}this.G=null},Q.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Q.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class Z extends E{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:Y(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ee(e){E.call(this),this.h=e,this.g={}}h(ee,E);var te=[];function ne(e){x(e.g,function(e,t){this.g.hasOwnProperty(t)&&z(e)},e),e.g={}}ee.prototype.N=function(){ee.Z.N.call(this),ne(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var re=i.JSON.stringify,se=i.JSON.parse,ie=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function oe(){}function ae(){}var ce={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ue(){T.call(this,"d")}function he(){T.call(this,"c")}h(ue,T),h(he,T);var le={},de=null;function fe(){return de=de||new Q}function pe(e){T.call(this,le.Ia,e)}function me(e){const t=fe();J(t,new pe(t))}function ge(e,t){T.call(this,le.STAT_EVENT,e),this.stat=t}function ye(e){const t=fe();J(t,new ge(t,e))}function we(e,t){T.call(this,le.Ja,e),this.size=t}function ve(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function Ie(){this.g=!0}function _e(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var n=i[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(let e=1;e<r.length;e++)r[e]=""}}}return re(i)}catch(i){return t}}(e,n)+(r?" "+r:"")})}le.Ia="serverreachability",h(pe,T),le.STAT_EVENT="statevent",h(ge,T),le.Ja="timingevent",h(we,T),Ie.prototype.ua=function(){this.g=!1},Ie.prototype.info=function(){};var be,Ee={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Te={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Se(){}function Ce(e){return encodeURIComponent(String(e))}function ke(e){var t=1;e=e.split(":");const n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Ae(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new ee(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ne}function Ne(){this.i=null,this.g="",this.h=!1}h(Se,oe),Se.prototype.g=function(){return new XMLHttpRequest},be=new Se;var Re={},De={};function xe(e,t,n){e.M=1,e.A=rt(Ye(t)),e.u=n,e.R=!0,Pe(e,null)}function Pe(e,t){e.F=Date.now(),Me(e),e.B=Ye(e.A);var n=e.B,r=e.S;Array.isArray(r)||(r=[String(r)]),yt(n.i,"t",r),e.C=0,n=e.j.L,e.h=new Ne,e.g=rn(e.j,n?t:null,!e.u),e.P>0&&(e.O=new Z(c(e.Y,e,e.g),e.P)),t=e.V,n=e.g,r=e.ba;var s="readystatechange";Array.isArray(s)||(s&&(te[0]=s.toString()),s=te);for(let i=0;i<s.length;i++){const e=j(n,s[i],r||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?P(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),me(),function(e,t,n,r,s,i){e.info(function(){if(e.g)if(i){var o="",a=i.split("&");for(let e=0;e<a.length;e++){var c=a[e].split("=");if(c.length>1){const e=c[0];c=c[1];const t=e.split("_");o=t.length>=2&&"type"==t[1]?o+(e+"=")+c+"&":o+(e+"=redacted&")}}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.v,e.B,e.l,e.S,e.u)}function Oe(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function Le(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?De:(n=Number(t.substring(n,r)),isNaN(n)?Re:(r+=1)+n>t.length?De:(t=t.slice(r,r+n),e.C=r+n,t))}function Me(e){e.T=Date.now()+e.H,Ve(e,e.H)}function Ve(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=ve(c(e.aa,e),t)}function Ue(e){e.D&&(i.clearTimeout(e.D),e.D=null)}function Fe(e){0==e.j.I||e.K||Yt(e.j,e)}function Be(e){Ue(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,ne(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function je(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||Ge(n.h,e)))if(!e.L&&Ge(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(h){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.v){if(n.g){if(!(n.g.F+3e3<e.F))break e;Xt(n),jt(n)}Wt(n),ye(18)}}else n.xa=s[1],0<n.xa-n.K&&s[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=ve(c(n.Va,n),6e3));$e(n.h)<=1&&n.ta&&(n.ta=void 0)}else en(n,11)}else if((e.L||n.g==e)&&Xt(n),!C(t))for(s=n.Ba.g.parse(t),t=0;t<s.length;t++){let c=s[t];const h=c[0];if(!(h<=n.K))if(n.K=h,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const t=c[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));const s=c[4];null!=s&&(n.za=s,n.j.info("SVER="+n.za));const h=c[5];null!=h&&"number"==typeof h&&h>0&&(r=1.5*h,n.O=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=r.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(He(i,i.h),i.h=null))}if(r.G){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,nt(r.J,r.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=e;if((r=n).na=nn(r,r.L?r.ba:null,r.W),o.L){We(r.h,o);var a=o,u=r.O;u&&(a.H=u),a.D&&(Ue(a),Me(a)),r.g=o}else Ht(r);n.i.length>0&&zt(n)}else"stop"!=c[0]&&"close"!=c[0]||en(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?en(n,7):Bt(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}me()}catch(h){}}Ae.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Mt(e)?t.j():this.Y(e)},Ae.prototype.Y=function(e){try{if(e==this.g)e:{const c=Mt(this.g),u=this.g.ya();if(this.g.ca(),!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||Vt(this.g)))){this.K||4!=c||7==u||me(),Ue(this);var t=this.g.ca();this.X=t;var n=function(e){if(!Oe(e))return e.g.la();const t=Vt(e.g);if(""===t)return"";let n="";const r=t.length,s=4==Mt(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return Be(e),Fe(e),"";e.h.i=new i.TextDecoder}for(let i=0;i<r;i++)e.h.h=!0,n+=e.h.i.decode(t[i],{stream:!(s&&i==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,n,r,s,i,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+i+" "+o})}(this.i,this.v,this.B,this.l,this.S,c,t),this.o){if(this.U&&!this.L){t:{if(this.g){var r,s=this.g;if((r=s.g?s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(r)){var o=r;break t}}o=null}if(!(e=o)){this.o=!1,this.m=3,ye(12),Be(this),Fe(this);break e}_e(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,je(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;){if(t=Le(this,n),t==De){4==c&&(this.m=4,ye(14),e=!1),_e(this.i,this.l,null,"[Incomplete Response]");break}if(t==Re){this.m=4,ye(15),_e(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}_e(this.i,this.l,t,null),je(this,t)}if(Oe(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,ye(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qt(a),a.P=!0,ye(11))}}else _e(this.i,this.l,n,"[Invalid Chunked Response]"),Be(this),Fe(this)}else _e(this.i,this.l,n,null),je(this,n);4==c&&Be(this),this.o&&!this.K&&(4==c?Yt(this.j,this):(this.o=!1,Me(this)))}else(function(e){const t={};e=(e.g&&Mt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(C(e[r]))continue;var n=ke(e[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=t[s]||[];t[s]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,ye(12)):(this.m=0,ye(13)),Be(this),Fe(this)}}}catch(c){}},Ae.prototype.cancel=function(){this.K=!0,Be(this)},Ae.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(me(),ye(17)),Be(this),this.m=2,Fe(this)):Ve(this,this.T-e)};var qe=class{constructor(e,t){this.g=e,this.map=t}};function ze(e){this.l=e||10,e=i.PerformanceNavigationTiming?(e=i.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ke(e){return!!e.h||!!e.g&&e.g.size>=e.j}function $e(e){return e.h?1:e.g?e.g.size:0}function Ge(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function He(e,t){e.g?e.g.add(t):e.h=t}function We(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Qe(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.G);return t}return d(e.i)}ze.prototype.cancel=function(){if(this.i=Qe(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Je=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Xe(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof Xe?(this.l=e.l,Ze(this,e.j),this.o=e.o,this.g=e.g,et(this,e.u),this.h=e.h,tt(this,wt(e.i)),this.m=e.m):e&&(t=String(e).match(Je))?(this.l=!1,Ze(this,t[1]||"",!0),this.o=st(t[2]||""),this.g=st(t[3]||"",!0),et(this,t[4]),this.h=st(t[5]||"",!0),tt(this,t[6]||"",!0),this.m=st(t[7]||"")):(this.l=!1,this.i=new dt(null,this.l))}function Ye(e){return new Xe(e)}function Ze(e,t,n){e.j=n?st(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function et(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function tt(e,t,n){t instanceof dt?(e.i=t,function(e,t){t&&!e.j&&(ft(e),e.i=null,e.g.forEach(function(e,t){const n=t.toLowerCase();t!=n&&(pt(this,t),yt(this,n,e))},e)),e.j=t}(e.i,e.l)):(n||(t=it(t,ht)),e.i=new dt(t,e.l))}function nt(e,t,n){e.i.set(t,n)}function rt(e){return nt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function st(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function it(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ot),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ot(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Xe.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(it(t,at,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(it(t,at,!0),"@"),e.push(Ce(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(it(n,"/"==n.charAt(0)?ut:ct,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",it(n,lt)),e.join("")},Xe.prototype.resolve=function(e){const t=Ye(this);let n=!!e.j;n?Ze(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)et(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var s=t.h.lastIndexOf("/");-1!=s&&(r=t.h.slice(0,s+1)+r)}if(".."==(s=r)||"."==s)r="";else if(-1!=s.indexOf("./")||-1!=s.indexOf("/.")){r=0==s.lastIndexOf("/",0),s=s.split("/");const e=[];for(let t=0;t<s.length;){const n=s[t++];"."==n?r&&t==s.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==s.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=s}return n?t.h=r:n=""!==e.i.toString(),n?tt(t,wt(e.i)):n=!!e.m,n&&(t.m=e.m),t};var at=/[#\/\?@]/g,ct=/[#\?:]/g,ut=/[#\?]/g,ht=/[#\?@]/g,lt=/#/g;function dt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ft(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){const r=e[n].indexOf("=");let s,i=null;r>=0?(s=e[n].substring(0,r),i=e[n].substring(r+1)):s=e[n],t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function pt(e,t){ft(e),t=vt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function mt(e,t){return ft(e),t=vt(e,t),e.g.has(t)}function gt(e,t){ft(e);let n=[];if("string"==typeof t)mt(e,t)&&(n=n.concat(e.g.get(vt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function yt(e,t,n){pt(e,t),n.length>0&&(e.i=null,e.g.set(vt(e,t),d(n)),e.h+=n.length)}function wt(e){const t=new dt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function vt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function It(e,t,n,r,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),r(n)}catch(i){}}function _t(){this.g=new ie}function bt(e){this.i=e.Sb||null,this.h=e.ab||!1}function Et(e,t){Q.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Tt(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function St(e){e.readyState=4,e.l=null,e.j=null,e.B=null,Ct(e)}function Ct(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function kt(e){let t="";return x(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function At(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=kt(n),"string"==typeof e?null!=n&&Ce(n):nt(e,t,n))}function Nt(e){Q.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=dt.prototype).add=function(e,t){ft(this),this.i=null,e=vt(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){ft(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.set=function(e,t){return ft(this),this.i=null,mt(this,e=vt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=gt(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];const s=Ce(n);n=gt(this,n);for(let t=0;t<n.length;t++){let r=s;""!==n[t]&&(r+="="+Ce(n[t])),e.push(r)}}return this.i=e.join("&")},h(bt,oe),bt.prototype.g=function(){return new Et(this.i,this.h)},h(Et,Q),(e=Et.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,Ct(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||i).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,St(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ct(this)),this.g&&(this.readyState=3,Ct(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Tt(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?St(this):Ct(this),3==this.readyState&&Tt(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,St(this))},e.Na=function(e){this.g&&(this.response=e,St(this))},e.ga=function(){this.g&&St(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Et.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Nt,Q);var Rt=/^https?$/i,Dt=["POST","PUT"];function xt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Pt(e),Lt(e)}function Pt(e){e.A||(e.A=!0,J(e,"complete"),J(e,"error"))}function Ot(e){if(e.h&&void 0!==s)if(e.v&&4==Mt(e))setTimeout(e.Ca.bind(e),0);else if(J(e,"readystatechange"),4==Mt(e)){e.h=!1;try{const s=e.ca();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===s){let t=String(e.D).match(Je)[1]||null;!t&&i.self&&i.self.location&&(t=i.self.location.protocol.slice(0,-1)),r=!Rt.test(t?t.toLowerCase():"")}n=r}if(n)J(e,"complete"),J(e,"success");else{e.o=6;try{var o=Mt(e)>2?e.g.statusText:""}catch(a){o=""}e.l=o+" ["+e.ca()+"]",Pt(e)}}finally{Lt(e)}}}function Lt(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const r=e.g;e.g=null,t||J(e,"ready");try{r.onreadystatechange=null}catch(n){}}}function Mt(e){return e.g?e.g.readyState:0}function Vt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ut(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ft(e){this.za=0,this.i=[],this.j=new Ie,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ut("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ut("baseRetryDelayMs",5e3,e),this.Za=Ut("retryDelaySeedMs",1e4,e),this.Ta=Ut("forwardChannelMaxRetries",2,e),this.va=Ut("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new ze(e&&e.concurrentRequestLimit),this.Ba=new _t,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Bt(e){if(qt(e),3==e.I){var t=e.V++,n=Ye(e.J);if(nt(n,"SID",e.M),nt(n,"RID",t),nt(n,"TYPE","terminate"),$t(e,n),(t=new Ae(e,e.j,t)).M=2,t.A=rt(Ye(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.A.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=t.A,n=!0),n||(t.g=rn(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Me(t)}tn(e)}function jt(e){e.g&&(Qt(e),e.g.cancel(),e.g=null)}function qt(e){jt(e),e.v&&(i.clearTimeout(e.v),e.v=null),Xt(e),e.h.cancel(),e.m&&("number"==typeof e.m&&i.clearTimeout(e.m),e.m=null)}function zt(e){if(!Ke(e.h)&&!e.m){e.m=!0;var t=e.Ea;w||_(),v||(w(),v=!0),I.add(t,e),e.D=0}}function Kt(e,t){var n;n=t?t.l:e.V++;const r=Ye(e.J);nt(r,"SID",e.M),nt(r,"RID",n),nt(r,"AID",e.K),$t(e,r),e.u&&e.o&&At(r,e.u,e.o),n=new Ae(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=Gt(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),He(e.h,n),xe(n,r,t)}function $t(e,t){e.H&&x(e.H,function(e,n){nt(t,n,e)}),e.l&&x({},function(e,n){nt(t,n,e)})}function Gt(e,t,n){n=Math.min(e.i.length,n);const r=e.l?c(e.l.Ka,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?n>0?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let c=!0;for(let h=0;h<n;h++){var i=s[h].g;const n=s[h].map;if((i-=t)<0)t=Math.max(0,s[h].g-100),c=!1;else try{i="req"+i+"_"||"";try{var a=n instanceof Map?n:Object.entries(n);for(const[t,n]of a){let r=n;o(n)&&(r=re(n)),e.push(i+t+"="+encodeURIComponent(r))}}catch(u){throw e.push(i+"type="+encodeURIComponent("_badmap")),u}}catch(u){r&&r(n)}}if(c){a=e.join("&");break e}}a=void 0}return e=e.i.splice(0,n),t.G=e,a}function Ht(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;w||_(),v||(w(),v=!0),I.add(t,e),e.A=0}}function Wt(e){return!(e.g||e.v||e.A>=3||(e.Y++,e.v=ve(c(e.Da,e),Zt(e,e.A)),e.A++,0))}function Qt(e){null!=e.B&&(i.clearTimeout(e.B),e.B=null)}function Jt(e){e.g=new Ae(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=Ye(e.na);nt(t,"RID","rpc"),nt(t,"SID",e.M),nt(t,"AID",e.K),nt(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&nt(t,"TO",e.ia),nt(t,"TYPE","xmlhttp"),$t(e,t),e.u&&e.o&&At(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=rt(Ye(t)),n.u=null,n.R=!0,Pe(n,e)}function Xt(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function Yt(e,t){var n=null;if(e.g==t){Xt(e),Qt(e),e.g=null;var r=2}else{if(!Ge(e.h,t))return;n=t.G,We(e.h,t),r=1}if(0!=e.I)if(t.o)if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;J(r=fe(),new we(r,n)),zt(e)}else Ht(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==r&&function(e,t){return!($e(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.G.concat(e.i),0):1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta)||(e.m=ve(c(e.Ea,e,t),Zt(e,e.D)),e.D++,0)))}(e,t)||2==r&&Wt(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),s){case 1:en(e,5);break;case 4:en(e,10);break;case 3:en(e,6);break;default:en(e,2)}}function Zt(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function en(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.bb,e),r=e.Ua;const t=!r;r=new Xe(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||Ze(r,"https"),rt(r),t?function(e,t){const n=new Ie;if(i.Image){const r=new Image;r.onload=u(It,n,"TestLoadImage: loaded",!0,t,r),r.onerror=u(It,n,"TestLoadImage: error",!1,t,r),r.onabort=u(It,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=u(It,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ie;const n=new AbortController,r=setTimeout(()=>{n.abort(),It(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?It(0,0,!0,t):It(0,0,!1,t)}).catch(()=>{clearTimeout(r),It(0,0,!1,t)})}(r.toString(),n)}else ye(2);e.I=0,e.l&&e.l.pa(t),tn(e),qt(e)}function tn(e){if(e.I=0,e.ja=[],e.l){const t=Qe(e.h);0==t.length&&0==e.i.length||(f(e.ja,t),f(e.ja,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.oa()}}function nn(e,t,n){var r=n instanceof Xe?Ye(n):new Xe(n);if(""!=r.g)t&&(r.g=t+"."+r.g),et(r,r.u);else{var s=i.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;const e=new Xe(null);r&&Ze(e,r),t&&(e.g=t),s&&et(e,s),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&nt(r,n,t),nt(r,"VER",e.ka),$t(e,r),r}function rn(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Nt(new bt({ab:n})):new Nt(e.ma)).Fa(e.L),t}function sn(){}function on(){}function an(e,t){Q.call(this),this.g=new Ft(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!C(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!C(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new hn(this)}function cn(e){ue.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function un(){he.call(this),this.status=1}function hn(e){this.g=e}(e=Nt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():be.g(),this.g.onreadystatechange=l(c(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(o){return void xt(this,o)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=i.FormData&&e instanceof i.FormData,!(Array.prototype.indexOf.call(Dt,t,void 0)>=0)||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(o){xt(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,J(this,"complete"),J(this,"abort"),Lt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Lt(this,!0)),Nt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Ot(this):this.Xa())},e.Xa=function(){Ot(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Mt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),se(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Ft.prototype).ka=8,e.I=1,e.connect=function(e,t,n,r){ye(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=nn(this,null,this.W),zt(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const s=new Ae(this,this.j,e);let i=this.o;if(this.U&&(i?(i=P(i),L(i,this.U)):i=this.U),null!==this.u||this.R||(s.J=i,i=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Gt(this,s,t),nt(n=Ye(this.J),"RID",e),nt(n,"CVER",22),this.G&&nt(n,"X-HTTP-Session-Id",this.G),$t(this,n),i&&(this.R?t="headers="+Ce(kt(i))+"&"+t:this.u&&At(n,this.u,i)),He(this.h,s),this.Ra&&nt(n,"TYPE","init"),this.S?(nt(n,"$req",t),nt(n,"SID","null"),s.U=!0,xe(s,n,null)):xe(s,n,t),this.I=2}}else 3==this.I&&(e?Kt(this,e):0==this.i.length||Ke(this.h)||Kt(this))},e.Da=function(){if(this.v=null,Jt(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=ve(c(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,ye(10),jt(this),Jt(this))},e.Va=function(){null!=this.C&&(this.C=null,jt(this),Wt(this),ye(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),ye(2)):(this.j.info("Failed to ping google.com"),ye(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=sn.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},on.prototype.g=function(e,t){return new an(e,t)},h(an,Q),an.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},an.prototype.close=function(){Bt(this.g)},an.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=re(e),e=n);t.i.push(new qe(t.Ya++,e)),3==t.I&&zt(t)},an.prototype.N=function(){this.g.l=null,delete this.j,Bt(this.g),delete this.g,an.Z.N.call(this)},h(cn,ue),h(un,he),h(hn,sn),hn.prototype.ra=function(){J(this.g,"a")},hn.prototype.qa=function(e){J(this.g,new cn(e))},hn.prototype.pa=function(e){J(this.g,new un)},hn.prototype.oa=function(){J(this.g,"b")},on.prototype.createWebChannel=on.prototype.g,an.prototype.send=an.prototype.o,an.prototype.open=an.prototype.m,an.prototype.close=an.prototype.close,Ws=function(){return new on},Hs=function(){return fe()},Gs=le,$s={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Ks=Ee,Te.COMPLETE="complete",zs=Te,ae.EventType=ce,ce.OPEN="a",ce.CLOSE="b",ce.ERROR="c",ce.MESSAGE="d",Q.prototype.listen=Q.prototype.J,qs=ae,Nt.prototype.listenOnce=Nt.prototype.K,Nt.prototype.getLastError=Nt.prototype.Ha,Nt.prototype.getLastErrorCode=Nt.prototype.ya,Nt.prototype.getStatus=Nt.prototype.ca,Nt.prototype.getResponseJson=Nt.prototype.La,Nt.prototype.getResponseText=Nt.prototype.la,Nt.prototype.send=Nt.prototype.ea,Nt.prototype.setWithCredentials=Nt.prototype.Fa,js=Nt}).apply(void 0!==Qs?Qs:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Js="@firebase/firestore",Xs="4.9.2";class Ys{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ys.UNAUTHENTICATED=new Ys(null),Ys.GOOGLE_CREDENTIALS=new Ys("google-credentials-uid"),Ys.FIRST_PARTY=new Ys("first-party-uid"),Ys.MOCK_USER=new Ys("mock-user");let Zs="12.3.0";const ei=new Q("@firebase/firestore");function ti(){return ei.logLevel}function ni(e,...t){if(ei.logLevel<=z.DEBUG){const n=t.map(ii);ei.debug(`Firestore (${Zs}): ${e}`,...n)}}function ri(e,...t){if(ei.logLevel<=z.ERROR){const n=t.map(ii);ei.error(`Firestore (${Zs}): ${e}`,...n)}}function si(e,...t){if(ei.logLevel<=z.WARN){const n=t.map(ii);ei.warn(`Firestore (${Zs}): ${e}`,...n)}}function ii(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(n){return e}var t}function oi(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,ai(e,r,n)}function ai(e,t,n){let r=`FIRESTORE (${Zs}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(s){r+=" CONTEXT: "+n}throw ri(r),new Error(r)}function ci(e,t,n,r){let s="Unexpected state";"string"==typeof n?s=n:r=n,e||ai(t,s,r)}function ui(e,t){return e}const hi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class li extends k{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class di{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class fi{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class pi{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ys.UNAUTHENTICATED))}shutdown(){}}class mi{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class gi{constructor(e){this.t=e,this.currentUser=Ys.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ci(void 0===this.o,42304);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new di;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new di,e.enqueueRetryable(()=>r(this.currentUser))};const i=()=>{const t=s;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{ni("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(ni("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new di)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(ni("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ci("string"==typeof t.accessToken,31837,{l:t}),new fi(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ci(null===e||"string"==typeof e,2055,{h:e}),new Ys(e)}}class yi{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Ys.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class wi{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new yi(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Ys.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class vi{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ii{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ye(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ci(void 0===this.o,3512);const n=e=>{null!=e.error&&ni("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,ni("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{ni("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):ni("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new vi(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(ci("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new vi(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function _i(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class bi{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=_i(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function Ei(e,t){return e<t?-1:e>t?1:0}function Ti(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.charAt(r),s=t.charAt(r);if(n!==s)return ki(n)===ki(s)?Ei(n,s):ki(n)?1:-1}return Ei(e.length,t.length)}const Si=55296,Ci=57343;function ki(e){const t=e.charCodeAt(0);return t>=Si&&t<=Ci}function Ai(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}function Ni(e){return e+"\0"}const Ri="__name__";class Di{constructor(e,t,n){void 0===t?t=0:t>e.length&&oi(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&oi(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Di.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Di?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=Di.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return Ei(e.length,t.length)}static compareSegments(e,t){const n=Di.isNumericId(e),r=Di.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?Di.extractNumericId(e).compare(Di.extractNumericId(t)):Ti(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Us.fromString(e.substring(4,e.length-2))}}class xi extends Di{construct(e,t,n){return new xi(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new li(hi.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new xi(t)}static emptyPath(){return new xi([])}}const Pi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Oi extends Di{construct(e,t,n){return new Oi(e,t,n)}static isValidIdentifier(e){return Pi.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Oi.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Ri}static keyField(){return new Oi([Ri])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(0===n.length)throw new li(hi.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new li(hi.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new li(hi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(s(),r++)}if(s(),i)throw new li(hi.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Oi(t)}static emptyPath(){return new Oi([])}}class Li{constructor(e){this.path=e}static fromPath(e){return new Li(xi.fromString(e))}static fromName(e){return new Li(xi.fromString(e).popFirst(5))}static empty(){return new Li(xi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===xi.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return xi.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Li(new xi(e.slice()))}}function Mi(e,t,n){if(!n)throw new li(hi.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Vi(e){if(!Li.isDocumentKey(e))throw new li(hi.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Ui(e){if(Li.isDocumentKey(e))throw new li(hi.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Fi(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function Bi(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":oi(12329,{type:typeof e})}function ji(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new li(hi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Bi(e);throw new li(hi.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function qi(e,t){const n={typeString:e};return t&&(n.value=t),n}function zi(e,t){if(!Fi(e))throw new li(hi.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in t)if(t[r]){const s=t[r].typeString,i="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}const o=e[r];if(s&&typeof o!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(void 0!==i&&o!==i.value){n=`Expected '${r}' field to equal '${i.value}'`;break}}if(n)throw new li(hi.INVALID_ARGUMENT,n);return!0}const Ki=-62135596800,$i=1e6;class Gi{static now(){return Gi.fromMillis(Date.now())}static fromDate(e){return Gi.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*$i);return new Gi(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new li(hi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new li(hi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Ki)throw new li(hi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new li(hi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/$i}_compareTo(e){return this.seconds===e.seconds?Ei(this.nanoseconds,e.nanoseconds):Ei(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Gi._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(zi(e,Gi._jsonSchema))return new Gi(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Ki;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Gi._jsonSchemaVersion="firestore/timestamp/1.0",Gi._jsonSchema={type:qi("string",Gi._jsonSchemaVersion),seconds:qi("number"),nanoseconds:qi("number")};class Hi{static fromTimestamp(e){return new Hi(e)}static min(){return new Hi(new Gi(0,0))}static max(){return new Hi(new Gi(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Wi{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Qi(e){return e.fields.find(e=>2===e.kind)}function Ji(e){return e.fields.filter(e=>2!==e.kind)}Wi.UNKNOWN_ID=-1;class Xi{constructor(e,t){this.fieldPath=e,this.kind=t}}class Yi{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Yi(0,eo.min())}}function Zi(e){return new eo(e.readTime,e.key,-1)}class eo{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new eo(Hi.min(),Li.empty(),-1)}static max(){return new eo(Hi.max(),Li.empty(),-1)}}function to(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Li.comparator(e.documentKey,t.documentKey),0!==n?n:Ei(e.largestBatchId,t.largestBatchId))}const no="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ro{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function so(e){if(e.code!==hi.FAILED_PRECONDITION||e.message!==no)throw e;ni("LocalStore","Unexpectedly lost primary lease")}class io{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&oi(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new io((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof io?t:io.resolve(t)}catch(t){return io.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):io.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):io.reject(t)}static resolve(e){return new io((t,n)=>{t(e)})}static reject(e){return new io((t,n)=>{n(e)})}static waitFor(e){return new io((t,n)=>{let r=0,s=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++s,i&&s===r&&t()},e=>n(e))}),i=!0,s===r&&t()})}static or(e){let t=io.resolve(!1);for(const n of e)t=t.next(e=>e?io.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new io((n,r)=>{const s=e.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;t(e[c]).next(e=>{i[c]=e,++o,o===s&&n(i)},e=>r(e))}})}static doWhile(e,t){return new io((n,r)=>{const s=()=>{!0===e()?t().next(()=>{s()},r):n()};s()})}}const oo="SimpleDb";class ao{static open(e,t,n,r){try{return new ao(t,e.transaction(r,n))}catch(s){throw new lo(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new di,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new lo(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{const n=yo(t.target.error);this.S.reject(new lo(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(ni(oo,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new po(t)}}class co{static delete(e){return ni(oo,"Removing database:",e),mo(o().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!T())return!1;if(co.F())return!0;const e=v(),t=co.M(e),n=0<t&&t<10,r=uo(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static F(){return"undefined"!=typeof process&&"YES"===process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,12.2===co.M(v())&&ri("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(ni(oo,"Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new lo(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new li(hi.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new li(hi.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new lo(e,r))},r.onupgradeneeded=e=>{ni(oo,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.N.k(t,r.transaction,e.oldVersion,this.version).next(()=>{ni(oo,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const s="readonly"===t;let i=0;for(;;){++i;try{this.db=await this.L(e);const t=ao.open(this.db,e,s?"readonly":"readwrite",n),i=r(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),io.reject(e))).toPromise();return i.catch(()=>{}),await t.D,i}catch(o){const e=o,t="FirebaseError"!==e.name&&i<3;if(ni(oo,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function uo(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class ho{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return mo(this.U.delete())}}class lo extends li{constructor(e,t){super(hi.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function fo(e){return"IndexedDbTransactionError"===e.name}class po{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(ni(oo,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(ni(oo,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),mo(n)}add(e){return ni(oo,"ADD",this.store.name,e,e),mo(this.store.add(e))}get(e){return mo(this.store.get(e)).next(t=>(void 0===t&&(t=null),ni(oo,"GET",this.store.name,e,t),t))}delete(e){return ni(oo,"DELETE",this.store.name,e),mo(this.store.delete(e))}count(){return ni(oo,"COUNT",this.store.name),mo(this.store.count())}J(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new io((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{const e=this.cursor(n),t=[];return this.H(e,(e,n)=>{t.push(n)}).next(()=>t)}}Y(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new io((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}Z(e,t){ni(oo,"DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;const r=this.cursor(n);return this.H(r,(e,t,n)=>n.delete())}ee(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.H(r,t)}te(e){const t=this.cursor({});return new io((n,r)=>{t.onerror=e=>{const t=yo(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}H(e,t){const n=[];return new io((r,s)=>{e.onerror=e=>{s(e.target.error)},e.onsuccess=e=>{const s=e.target.result;if(!s)return void r();const i=new ho(s),o=t(s.primaryKey,s.value,i);if(o instanceof io){const e=o.catch(e=>(i.done(),io.reject(e)));n.push(e)}i.isDone?r():null===i.G?s.continue():s.continue(i.G)}}).next(()=>io.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function mo(e){return new io((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=yo(e.target.error);n(t)}})}let go=!1;function yo(e){const t=co.M(v());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new li("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return go||(go=!0,setTimeout(()=>{throw e},0)),e}}return e}const wo="IndexBackfiller";class vo{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){ni(wo,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const e=await this.ne.ie();ni(wo,`Documents written: ${e}`)}catch(e){fo(e)?ni(wo,"Ignoring IndexedDB error during index backfill: ",e):await so(e)}await this.re(6e4)})}}class Io{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const n=new Set;let r=t,s=!0;return io.doWhile(()=>!0===s&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return ni(wo,`Processing collection: ${t}`),this.oe(e,t,r).next(e=>{r-=e,n.add(t)});s=!1})).next(()=>t-r)}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{const s=n.changes;return this.localStore.indexManager.updateIndexEntries(e,s).next(()=>this._e(r,n)).next(n=>(ni(wo,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>s.size)}))}_e(e,t){let n=e;return t.changes.forEach((e,t)=>{const r=Zi(t);to(r,n)>0&&(n=r)}),new eo(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class _o{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}_o.ce=-1;const bo=-1;function Eo(e){return null==e}function To(e){return 0===e&&1/e==-1/0}const So="";function Co(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Ao(t)),t=ko(e.get(n),t);return Ao(t)}function ko(e,t){let n=t;const r=e.length;for(let s=0;s<r;s++){const t=e.charAt(s);switch(t){case"\0":n+="";break;case So:n+="";break;default:n+=t}}return n}function Ao(e){return e+So+""}function No(e){const t=e.length;if(ci(t>=2,64408,{path:e}),2===t)return ci(e.charAt(0)===So&&""===e.charAt(1),56145,{path:e}),xi.emptyPath();const n=t-2,r=[];let s="";for(let i=0;i<t;){const t=e.indexOf(So,i);switch((t<0||t>n)&&oi(50515,{path:e}),e.charAt(t+1)){case"":const n=e.substring(i,t);let o;0===s.length?o=n:(s+=n,o=s,s=""),r.push(o);break;case"":s+=e.substring(i,t),s+="\0";break;case"":s+=e.substring(i,t+1);break;default:oi(61167,{path:e})}i=t+2}return new xi(r)}const Ro="remoteDocuments",Do="owner",xo="owner",Po="mutationQueues",Oo="mutations",Lo="batchId",Mo="userMutationsIndex",Vo=["userId","batchId"];function Uo(e,t){return[e,Co(t)]}function Fo(e,t,n){return[e,Co(t),n]}const Bo={},jo="documentMutations",qo="remoteDocumentsV14",zo=["prefixPath","collectionGroup","readTime","documentId"],Ko="documentKeyIndex",$o=["prefixPath","collectionGroup","documentId"],Go="collectionGroupIndex",Ho=["collectionGroup","readTime","prefixPath","documentId"],Wo="remoteDocumentGlobal",Qo="remoteDocumentGlobalKey",Jo="targets",Xo="queryTargetsIndex",Yo=["canonicalId","targetId"],Zo="targetDocuments",ea=["targetId","path"],ta="documentTargetsIndex",na=["path","targetId"],ra="targetGlobalKey",sa="targetGlobal",ia="collectionParents",oa=["collectionId","parent"],aa="clientMetadata",ca="bundles",ua="namedQueries",ha="indexConfiguration",la="collectionGroupIndex",da="indexState",fa=["indexId","uid"],pa="sequenceNumberIndex",ma=["uid","sequenceNumber"],ga="indexEntries",ya=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],wa="documentKeyIndex",va=["indexId","uid","orderedDocumentKey"],Ia="documentOverlays",_a=["userId","collectionPath","documentId"],ba="collectionPathOverlayIndex",Ea=["userId","collectionPath","largestBatchId"],Ta="collectionGroupOverlayIndex",Sa=["userId","collectionGroup","largestBatchId"],Ca="globals",ka=[Po,Oo,jo,Ro,Jo,Do,sa,Zo,aa,Wo,ia,ca,ua],Aa=[...ka,Ia],Na=[Po,Oo,jo,qo,Jo,Do,sa,Zo,aa,Wo,ia,ca,ua,Ia],Ra=Na,Da=[...Ra,ha,da,ga],xa=Da,Pa=[...Da,Ca],Oa=Pa;class La extends ro{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Ma(e,t){const n=ui(e);return co.O(n.le,t)}function Va(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Ua(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Fa(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ba{constructor(e,t){this.comparator=e,this.root=t||qa.EMPTY}insert(e,t){return new Ba(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,qa.BLACK,null,null))}remove(e){return new Ba(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qa.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ja(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ja(this.root,e,this.comparator,!1)}getReverseIterator(){return new ja(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ja(this.root,e,this.comparator,!0)}}class ja{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class qa{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:qa.RED,this.left=null!=r?r:qa.EMPTY,this.right=null!=s?s:qa.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new qa(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return qa.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return qa.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,qa.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,qa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw oi(43730,{key:this.key,value:this.value});if(this.right.isRed())throw oi(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw oi(27949);return e+(this.isRed()?0:1)}}qa.EMPTY=null,qa.RED=!0,qa.BLACK=!1,qa.EMPTY=new class{constructor(){this.size=0}get key(){throw oi(57766)}get value(){throw oi(16141)}get color(){throw oi(16727)}get left(){throw oi(29726)}get right(){throw oi(36894)}copy(e,t,n,r,s){return this}insert(e,t,n){return new qa(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class za{constructor(e){this.comparator=e,this.data=new Ba(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ka(this.data.getIterator())}getIteratorFrom(e){return new Ka(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof za))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new za(this.comparator);return t.data=e,t}}class Ka{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function $a(e){return e.hasNext()?e.getNext():void 0}class Ga{constructor(e){this.fields=e,e.sort(Oi.comparator)}static empty(){return new Ga([])}unionWith(e){let t=new za(Oi.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ga(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ai(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Ha extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Wa{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Ha("Invalid base64 string: "+t):t}}(e);return new Wa(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Wa(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ei(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Wa.EMPTY_BYTE_STRING=new Wa("");const Qa=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ja(e){if(ci(!!e,39018),"string"==typeof e){let t=0;const n=Qa.exec(e);if(ci(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Xa(e.seconds),nanos:Xa(e.nanos)}}function Xa(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ya(e){return"string"==typeof e?Wa.fromBase64String(e):Wa.fromUint8Array(e)}const Za="server_timestamp",ec="__type__",tc="__previous_value__",nc="__local_write_time__";function rc(e){const t=(e?.mapValue?.fields||{})[ec]?.stringValue;return t===Za}function sc(e){const t=e.mapValue.fields[tc];return rc(t)?sc(t):t}function ic(e){const t=Ja(e.mapValue.fields[nc].timestampValue);return new Gi(t.seconds,t.nanos)}class oc{constructor(e,t,n,r,s,i,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const ac="(default)";class cc{constructor(e,t){this.projectId=e,this.database=t||ac}static empty(){return new cc("","")}get isDefaultDatabase(){return this.database===ac}isEqual(e){return e instanceof cc&&e.projectId===this.projectId&&e.database===this.database}}const uc="__type__",hc="__max__",lc={mapValue:{fields:{__type__:{stringValue:hc}}}},dc="__vector__",fc="value",pc={nullValue:"NULL_VALUE"};function mc(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?rc(e)?4:xc(e)?9007199254740991:Rc(e)?10:11:oi(28295,{value:e})}function gc(e,t){if(e===t)return!0;const n=mc(e);if(n!==mc(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ic(e).isEqual(ic(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Ja(e.timestampValue),r=Ja(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,Ya(e.bytesValue).isEqual(Ya(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Xa(e.geoPointValue.latitude)===Xa(t.geoPointValue.latitude)&&Xa(e.geoPointValue.longitude)===Xa(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Xa(e.integerValue)===Xa(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Xa(e.doubleValue),r=Xa(t.doubleValue);return n===r?To(n)===To(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Ai(e.arrayValue.values||[],t.arrayValue.values||[],gc);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Va(n)!==Va(r))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===r[s]||!gc(n[s],r[s])))return!1;return!0}(e,t);default:return oi(52216,{left:e})}var r}function yc(e,t){return void 0!==(e.values||[]).find(e=>gc(e,t))}function wc(e,t){if(e===t)return 0;const n=mc(e),r=mc(t);if(n!==r)return Ei(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ei(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Xa(e.integerValue||e.doubleValue),r=Xa(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return vc(e.timestampValue,t.timestampValue);case 4:return vc(ic(e),ic(t));case 5:return Ti(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ya(e),r=Ya(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let s=0;s<n.length&&s<r.length;s++){const e=Ei(n[s],r[s]);if(0!==e)return e}return Ei(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Ei(Xa(e.latitude),Xa(t.latitude));return 0!==n?n:Ei(Xa(e.longitude),Xa(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Ic(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=t.fields||{},s=n[fc]?.arrayValue,i=r[fc]?.arrayValue,o=Ei(s?.values?.length||0,i?.values?.length||0);return 0!==o?o:Ic(s,i)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===lc.mapValue&&t===lc.mapValue)return 0;if(e===lc.mapValue)return 1;if(t===lc.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let o=0;o<r.length&&o<i.length;++o){const e=Ti(r[o],i[o]);if(0!==e)return e;const t=wc(n[r[o]],s[i[o]]);if(0!==t)return t}return Ei(r.length,i.length)}(e.mapValue,t.mapValue);default:throw oi(23264,{he:n})}}function vc(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ei(e,t);const n=Ja(e),r=Ja(t),s=Ei(n.seconds,r.seconds);return 0!==s?s:Ei(n.nanos,r.nanos)}function Ic(e,t){const n=e.values||[],r=t.values||[];for(let s=0;s<n.length&&s<r.length;++s){const e=wc(n[s],r[s]);if(e)return e}return Ei(n.length,r.length)}function _c(e){return bc(e)}function bc(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Ja(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ya(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,Li.fromName(t).toString()):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=bc(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const s of t)r?r=!1:n+=",",n+=`${s}:${bc(e.fields[s])}`;return n+"}"}(e.mapValue):oi(61005,{value:e});var t}function Ec(e){switch(mc(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=sc(e);return t?16+Ec(t):16;case 5:return 2*e.stringValue.length;case 6:return Ya(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce((e,t)=>e+Ec(t),0);case 10:case 11:return function(e){let t=0;return Ua(e.fields,(e,n)=>{t+=e.length+Ec(n)}),t}(e.mapValue);default:throw oi(13486,{value:e})}}function Tc(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Sc(e){return!!e&&"integerValue"in e}function Cc(e){return!!e&&"arrayValue"in e}function kc(e){return!!e&&"nullValue"in e}function Ac(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Nc(e){return!!e&&"mapValue"in e}function Rc(e){const t=(e?.mapValue?.fields||{})[uc]?.stringValue;return t===dc}function Dc(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return Ua(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Dc(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Dc(e.arrayValue.values[n]);return t}return{...e}}function xc(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===hc}const Pc={mapValue:{fields:{[uc]:{stringValue:dc},[fc]:{arrayValue:{}}}}};function Oc(e){return"nullValue"in e?pc:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Tc(cc.empty(),Li.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?Rc(e)?Pc:{mapValue:{}}:oi(35942,{value:e})}function Lc(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Tc(cc.empty(),Li.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?Pc:"mapValue"in e?Rc(e)?{mapValue:{}}:lc:oi(61959,{value:e})}function Mc(e,t){const n=wc(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Vc(e,t){const n=wc(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Uc{constructor(e){this.value=e}static empty(){return new Uc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Nc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Dc(t)}setAll(e){let t=Oi.emptyPath(),n={},r=[];e.forEach((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=s.popLast()}e?n[s.lastSegment()]=Dc(e):r.push(s.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());Nc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return gc(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Nc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Ua(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new Uc(Dc(this.value))}}function Fc(e){const t=[];return Ua(e.fields,(e,n)=>{const r=new Oi([e]);if(Nc(n)){const e=Fc(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new Ga(t)}class Bc{constructor(e,t,n,r,s,i,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new Bc(e,0,Hi.min(),Hi.min(),Hi.min(),Uc.empty(),0)}static newFoundDocument(e,t,n,r){return new Bc(e,1,t,Hi.min(),n,r,0)}static newNoDocument(e,t){return new Bc(e,2,t,Hi.min(),Hi.min(),Uc.empty(),0)}static newUnknownDocument(e,t){return new Bc(e,3,t,Hi.min(),Hi.min(),Uc.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Hi.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Uc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Uc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Hi.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Bc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Bc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class jc{constructor(e,t){this.position=e,this.inclusive=t}}function qc(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){const i=t[s],o=e.position[s];if(r=i.field.isKeyField()?Li.comparator(Li.fromName(o.referenceValue),n.key):wc(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function zc(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!gc(e.position[n],t.position[n]))return!1;return!0}class Kc{constructor(e,t="asc"){this.field=e,this.dir=t}}function $c(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Gc{}class Hc extends Gc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ru(e,t,n):"array-contains"===t?new au(e,n):"in"===t?new cu(e,n):"not-in"===t?new uu(e,n):"array-contains-any"===t?new hu(e,n):new Hc(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new su(e,n):new iu(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(wc(t,this.value)):null!==t&&mc(this.value)===mc(t)&&this.matchesComparison(wc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return oi(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Wc extends Gc{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Wc(e,t)}matches(e){return Qc(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Qc(e){return"and"===e.op}function Jc(e){return"or"===e.op}function Xc(e){return Yc(e)&&Qc(e)}function Yc(e){for(const t of e.filters)if(t instanceof Wc)return!1;return!0}function Zc(e){if(e instanceof Hc)return e.field.canonicalString()+e.op.toString()+_c(e.value);if(Xc(e))return e.filters.map(e=>Zc(e)).join(",");{const t=e.filters.map(e=>Zc(e)).join(",");return`${e.op}(${t})`}}function eu(e,t){return e instanceof Hc?(n=e,(r=t)instanceof Hc&&n.op===r.op&&n.field.isEqual(r.field)&&gc(n.value,r.value)):e instanceof Wc?function(e,t){return t instanceof Wc&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&eu(n,t.filters[r]),!0)}(e,t):void oi(19439);var n,r}function tu(e,t){const n=e.filters.concat(t);return Wc.create(n,e.op)}function nu(e){return e instanceof Hc?`${(t=e).field.canonicalString()} ${t.op} ${_c(t.value)}`:e instanceof Wc?function(e){return e.op.toString()+" {"+e.getFilters().map(nu).join(" ,")+"}"}(e):"Filter";var t}class ru extends Hc{constructor(e,t,n){super(e,t,n),this.key=Li.fromName(n.referenceValue)}matches(e){const t=Li.comparator(e.key,this.key);return this.matchesComparison(t)}}class su extends Hc{constructor(e,t){super(e,"in",t),this.keys=ou(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class iu extends Hc{constructor(e,t){super(e,"not-in",t),this.keys=ou(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ou(e,t){return(t.arrayValue?.values||[]).map(e=>Li.fromName(e.referenceValue))}class au extends Hc{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Cc(t)&&yc(t.arrayValue,this.value)}}class cu extends Hc{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&yc(this.value.arrayValue,t)}}class uu extends Hc{constructor(e,t){super(e,"not-in",t)}matches(e){if(yc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!yc(this.value.arrayValue,t)}}class hu extends Hc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Cc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>yc(this.value.arrayValue,e))}}class lu{constructor(e,t=null,n=[],r=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.Te=null}}function du(e,t=null,n=[],r=[],s=null,i=null,o=null){return new lu(e,t,n,r,s,i,o)}function fu(e){const t=ui(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Zc(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),Eo(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>_c(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>_c(e)).join(",")),t.Te=e}return t.Te}function pu(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!$c(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!eu(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!zc(e.startAt,t.startAt)&&zc(e.endAt,t.endAt)}function mu(e){return Li.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function gu(e,t){return e.filters.filter(e=>e instanceof Hc&&e.field.isEqual(t))}function yu(e,t,n){let r=pc,s=!0;for(const i of gu(e,t)){let e=pc,t=!0;switch(i.op){case"<":case"<=":e=Oc(i.value);break;case"==":case"in":case">=":e=i.value;break;case">":e=i.value,t=!1;break;case"!=":case"not-in":e=pc}Mc({value:r,inclusive:s},{value:e,inclusive:t})<0&&(r=e,s=t)}if(null!==n)for(let i=0;i<e.orderBy.length;++i)if(e.orderBy[i].field.isEqual(t)){const e=n.position[i];Mc({value:r,inclusive:s},{value:e,inclusive:n.inclusive})<0&&(r=e,s=n.inclusive);break}return{value:r,inclusive:s}}function wu(e,t,n){let r=lc,s=!0;for(const i of gu(e,t)){let e=lc,t=!0;switch(i.op){case">=":case">":e=Lc(i.value),t=!1;break;case"==":case"in":case"<=":e=i.value;break;case"<":e=i.value,t=!1;break;case"!=":case"not-in":e=lc}Vc({value:r,inclusive:s},{value:e,inclusive:t})>0&&(r=e,s=t)}if(null!==n)for(let i=0;i<e.orderBy.length;++i)if(e.orderBy[i].field.isEqual(t)){const e=n.position[i];Vc({value:r,inclusive:s},{value:e,inclusive:n.inclusive})>0&&(r=e,s=n.inclusive);break}return{value:r,inclusive:s}}class vu{constructor(e,t=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Iu(e){return new vu(e)}function _u(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function bu(e){return null!==e.collectionGroup}function Eu(e){const t=ui(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const r of t.explicitOrderBy)t.Ie.push(r),e.add(r.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new za(Oi.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(t).forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new Kc(r,n))}),e.has(Oi.keyField().canonicalString())||t.Ie.push(new Kc(Oi.keyField(),n))}return t.Ie}function Tu(e){const t=ui(e);return t.Ee||(t.Ee=function(e,t){if("F"===e.limitType)return du(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Kc(e.field,t)});const n=e.endAt?new jc(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new jc(e.startAt.position,e.startAt.inclusive):null;return du(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,Eu(e))),t.Ee}function Su(e,t){const n=e.filters.concat([t]);return new vu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Cu(e,t,n){return new vu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ku(e,t){return pu(Tu(e),Tu(t))&&e.limitType===t.limitType}function Au(e){return`${fu(Tu(e))}|lt:${e.limitType}`}function Nu(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>nu(e)).join(", ")}]`),Eo(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>_c(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>_c(e)).join(",")),`Target(${t})`}(Tu(e))}; limitType=${e.limitType})`}function Ru(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Li.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Eu(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(r=t,!((n=e).startAt&&!function(e,t,n){const r=qc(e,t,n);return e.inclusive?r<=0:r<0}(n.startAt,Eu(n),r)||n.endAt&&!function(e,t,n){const r=qc(e,t,n);return e.inclusive?r>=0:r>0}(n.endAt,Eu(n),r)));var n,r}function Du(e){return(t,n)=>{let r=!1;for(const s of Eu(e)){const e=xu(s,t,n);if(0!==e)return e;r=r||s.field.isKeyField()}return 0}}function xu(e,t,n){const r=e.field.isKeyField()?Li.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),s=n.data.field(e);return null!==r&&null!==s?wc(r,s):oi(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return oi(19790,{direction:e.dir})}}class Pu{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,s]of n)if(this.equalsFn(r,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Ua(this.inner,(t,n)=>{for(const[r,s]of n)e(r,s)})}isEmpty(){return Fa(this.inner)}size(){return this.innerSize}}const Ou=new Ba(Li.comparator);function Lu(){return Ou}const Mu=new Ba(Li.comparator);function Vu(...e){let t=Mu;for(const n of e)t=t.insert(n.key,n);return t}function Uu(e){let t=Mu;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Fu(){return ju()}function Bu(){return ju()}function ju(){return new Pu(e=>e.toString(),(e,t)=>e.isEqual(t))}const qu=new Ba(Li.comparator),zu=new za(Li.comparator);function Ku(...e){let t=zu;for(const n of e)t=t.add(n);return t}const $u=new za(Ei);function Gu(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:To(t)?"-0":t}}function Hu(e){return{integerValue:""+e}}class Wu{constructor(){this._=void 0}}function Qu(e,t,n){return e instanceof Yu?function(e,t){const n={fields:{[ec]:{stringValue:Za},[nc]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&rc(t)&&(t=sc(t)),t&&(n.fields[tc]=t),{mapValue:n}}(n,t):e instanceof Zu?eh(e,t):e instanceof th?nh(e,t):function(e,t){const n=Xu(e,t),r=sh(n)+sh(e.Ae);return Sc(n)&&Sc(e.Ae)?Hu(r):Gu(e.serializer,r)}(e,t)}function Ju(e,t,n){return e instanceof Zu?eh(e,t):e instanceof th?nh(e,t):n}function Xu(e,t){return e instanceof rh?Sc(n=t)||(r=n)&&"doubleValue"in r?t:{integerValue:0}:null;var n,r}class Yu extends Wu{}class Zu extends Wu{constructor(e){super(),this.elements=e}}function eh(e,t){const n=ih(t);for(const r of e.elements)n.some(e=>gc(e,r))||n.push(r);return{arrayValue:{values:n}}}class th extends Wu{constructor(e){super(),this.elements=e}}function nh(e,t){let n=ih(t);for(const r of e.elements)n=n.filter(e=>!gc(e,r));return{arrayValue:{values:n}}}class rh extends Wu{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function sh(e){return Xa(e.integerValue||e.doubleValue)}function ih(e){return Cc(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class oh{constructor(e,t){this.field=e,this.transform=t}}class ah{constructor(e,t){this.version=e,this.transformResults=t}}class ch{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ch}static exists(e){return new ch(void 0,e)}static updateTime(e){return new ch(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function uh(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class hh{}function lh(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new _h(e.key,ch.none()):new gh(e.key,e.data,ch.none());{const n=e.data,r=Uc.empty();let s=new za(Oi.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),s=s.add(e)}return new yh(e.key,r,new Ga(s.toArray()),ch.none())}}function dh(e,t,n){var r;e instanceof gh?function(e,t,n){const r=e.value.clone(),s=vh(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof yh?function(e,t,n){if(!uh(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=vh(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(wh(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):(r=n,t.convertToNoDocument(r.version).setHasCommittedMutations())}function fh(e,t,n,r){return e instanceof gh?function(e,t,n,r){if(!uh(e.precondition,t))return n;const s=e.value.clone(),i=Ih(e.fieldTransforms,r,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,r):e instanceof yh?function(e,t,n,r){if(!uh(e.precondition,t))return n;const s=Ih(e.fieldTransforms,r,t),i=t.data;return i.setAll(wh(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(s=t,i=n,uh(e.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):i);var s,i}function ph(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=Xu(r.transform,e||null);null!=s&&(null===n&&(n=Uc.empty()),n.set(r.field,s))}return n||null}function mh(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Ai(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof Zu&&r instanceof Zu||n instanceof th&&r instanceof th?Ai(n.elements,r.elements,gc):n instanceof rh&&r instanceof rh?gc(n.Ae,r.Ae):n instanceof Yu&&r instanceof Yu);var n,r}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class gh extends hh{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class yh extends hh{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function wh(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function vh(e,t,n){const r=new Map;ci(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){const i=e[s],o=i.transform,a=t.data.field(i.field);r.set(i.field,Ju(o,a,n[s]))}return r}function Ih(e,t,n){const r=new Map;for(const s of e){const e=s.transform,i=n.data.field(s.field);r.set(s.field,Qu(e,i,t))}return r}class _h extends hh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class bh extends hh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Eh{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&dh(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=fh(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=fh(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Bu();return this.mutations.forEach(r=>{const s=e.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=t.has(r.key)?null:o;const a=lh(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(Hi.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ku())}isEqual(e){return this.batchId===e.batchId&&Ai(this.mutations,e.mutations,(e,t)=>mh(e,t))&&Ai(this.baseMutations,e.baseMutations,(e,t)=>mh(e,t))}}class Th{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){ci(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=function(){return qu}();const s=e.mutations;for(let i=0;i<s.length;i++)r=r.insert(s[i].key,n[i].version);return new Th(e,t,n,r)}}class Sh{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ch{constructor(e,t){this.count=e,this.unchangedNames=t}}var kh,Ah;function Nh(e){if(void 0===e)return ri("GRPC error has no .code"),hi.UNKNOWN;switch(e){case kh.OK:return hi.OK;case kh.CANCELLED:return hi.CANCELLED;case kh.UNKNOWN:return hi.UNKNOWN;case kh.DEADLINE_EXCEEDED:return hi.DEADLINE_EXCEEDED;case kh.RESOURCE_EXHAUSTED:return hi.RESOURCE_EXHAUSTED;case kh.INTERNAL:return hi.INTERNAL;case kh.UNAVAILABLE:return hi.UNAVAILABLE;case kh.UNAUTHENTICATED:return hi.UNAUTHENTICATED;case kh.INVALID_ARGUMENT:return hi.INVALID_ARGUMENT;case kh.NOT_FOUND:return hi.NOT_FOUND;case kh.ALREADY_EXISTS:return hi.ALREADY_EXISTS;case kh.PERMISSION_DENIED:return hi.PERMISSION_DENIED;case kh.FAILED_PRECONDITION:return hi.FAILED_PRECONDITION;case kh.ABORTED:return hi.ABORTED;case kh.OUT_OF_RANGE:return hi.OUT_OF_RANGE;case kh.UNIMPLEMENTED:return hi.UNIMPLEMENTED;case kh.DATA_LOSS:return hi.DATA_LOSS;default:return oi(39323,{code:e})}}(Ah=kh||(kh={}))[Ah.OK=0]="OK",Ah[Ah.CANCELLED=1]="CANCELLED",Ah[Ah.UNKNOWN=2]="UNKNOWN",Ah[Ah.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ah[Ah.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ah[Ah.NOT_FOUND=5]="NOT_FOUND",Ah[Ah.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ah[Ah.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ah[Ah.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ah[Ah.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ah[Ah.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ah[Ah.ABORTED=10]="ABORTED",Ah[Ah.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ah[Ah.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ah[Ah.INTERNAL=13]="INTERNAL",Ah[Ah.UNAVAILABLE=14]="UNAVAILABLE",Ah[Ah.DATA_LOSS=15]="DATA_LOSS";const Rh=new Us([4294967295,4294967295],0);function Dh(e){const t=(new TextEncoder).encode(e),n=new Fs;return n.update(t),new Uint8Array(n.digest())}function xh(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Us([n,r],0),new Us([s,i],0)]}class Ph{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Oh(`Invalid padding: ${t}`);if(n<0)throw new Oh(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Oh(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Oh(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Us.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(Us.fromNumber(n)));return 1===r.compare(Rh)&&(r=new Us([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=Dh(e),[n,r]=xh(t);for(let s=0;s<this.hashCount;s++){const e=this.ye(n,r,s);if(!this.we(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),i=new Ph(s,r,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.ge)return;const t=Dh(e),[n,r]=xh(t);for(let s=0;s<this.hashCount;s++){const e=this.ye(n,r,s);this.Se(e)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Oh extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Lh{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Mh.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Lh(Hi.min(),r,new Ba(Ei),Lu(),Ku())}}class Mh{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Mh(n,t,Ku(),Ku(),Ku())}}class Vh{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class Uh{constructor(e,t){this.targetId=e,this.Ce=t}}class Fh{constructor(e,t,n=Wa.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Bh{constructor(){this.ve=0,this.Fe=zh(),this.Me=Wa.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ku(),t=Ku(),n=Ku();return this.Fe.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:oi(38017,{changeType:s})}}),new Mh(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=zh()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ci(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class jh{constructor(e){this.Ge=e,this.ze=new Map,this.je=Lu(),this.Je=qh(),this.He=qh(),this.Ye=new Ba(Ei)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:oi(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){const t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){const s=r.target;if(mu(s))if(0===n){const e=new Li(s.path);this.et(t,e,Bc.newNoDocument(e,Hi.min()))}else ci(1===n,20013,{expectedCount:n});else{const r=this._t(t);if(r!==n){const n=this.ut(e),s=n?this.ct(n,e,r):1;if(0!==s){this.it(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=t;let i,o;try{i=Ya(n).toUint8Array()}catch(a){if(a instanceof Ha)return si("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{o=new Ph(i,r,s)}catch(a){return si(a instanceof Oh?"BloomFilter error: ":"Applying bloom filter failed: ",a),null}return 0===o.ge?null:o}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let r=0;return n.forEach(n=>{const s=this.Ge.ht(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;e.mightContain(i)||(this.et(t,n,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((n,r)=>{const s=this.ot(r);if(s){if(n.current&&mu(s.target)){const t=new Li(s.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,Bc.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}});let n=Ku();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));const r=new Lh(e,t,this.Ye,this.je,n);return this.je=Lu(),this.Je=qh(),this.He=qh(),this.Ye=new Ba(Ei),r}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Bh,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new za(Ei),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new za(Ei),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||ni("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Bh),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function qh(){return new Ba(Li.comparator)}function zh(){return new Ba(Li.comparator)}const Kh=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),$h=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),Gh=(()=>({and:"AND",or:"OR"}))();class Hh{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Wh(e,t){return e.useProto3Json||Eo(t)?t:{value:t}}function Qh(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Jh(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Xh(e,t){return Qh(e,t.toTimestamp())}function Yh(e){return ci(!!e,49232),Hi.fromTimestamp(function(e){const t=Ja(e);return new Gi(t.seconds,t.nanos)}(e))}function Zh(e,t){return el(e,t).canonicalString()}function el(e,t){const n=(r=e,new xi(["projects",r.projectId,"databases",r.database])).child("documents");var r;return void 0===t?n:n.child(t)}function tl(e){const t=xi.fromString(e);return ci(bl(t),10190,{key:t.toString()}),t}function nl(e,t){return Zh(e.databaseId,t.path)}function rl(e,t){const n=tl(t);if(n.get(1)!==e.databaseId.projectId)throw new li(hi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new li(hi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Li(al(n))}function sl(e,t){return Zh(e.databaseId,t)}function il(e){const t=tl(e);return 4===t.length?xi.emptyPath():al(t)}function ol(e){return new xi(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function al(e){return ci(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function cl(e,t,n){return{name:nl(e,t),fields:n.value.mapValue.fields}}function ul(e,t){let n;if(t instanceof gh)n={update:cl(e,t.key,t.value)};else if(t instanceof _h)n={delete:nl(e,t.key)};else if(t instanceof yh)n={update:cl(e,t.key,t.data),updateMask:_l(t.fieldMask)};else{if(!(t instanceof bh))return oi(16599,{Vt:t.type});n={verify:nl(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Yu)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Zu)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof th)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof rh)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw oi(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=(r=e,void 0!==(s=t.precondition).updateTime?{updateTime:Xh(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:oi(27497))),n;var r,s}function hl(e,t){const n=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?ch.updateTime(Yh(s.updateTime)):void 0!==s.exists?ch.exists(s.exists):ch.none():ch.none(),r=t.updateTransforms?t.updateTransforms.map(t=>function(e,t){let n=null;if("setToServerValue"in t)ci("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new Yu;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Zu(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new th(e)}else"increment"in t?n=new rh(e,t.increment):oi(16584,{proto:t});const r=Oi.fromServerFormat(t.fieldPath);return new oh(r,n)}(e,t)):[];var s;if(t.update){t.update.name;const s=rl(e,t.update.name),i=new Uc({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new Ga(t.map(e=>Oi.fromServerFormat(e)))}(t.updateMask);return new yh(s,i,e,n,r)}return new gh(s,i,n,r)}if(t.delete){const r=rl(e,t.delete);return new _h(r,n)}if(t.verify){const r=rl(e,t.verify);return new bh(r,n)}return oi(1463,{proto:t})}function ll(e,t){return{documents:[sl(e,t.path)]}}function dl(e,t){const n={structuredQuery:{}},r=t.path;let s;null!==t.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=sl(e,s);const i=function(e){if(0!==e.length)return Il(Wc.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const o=function(e){if(0!==e.length)return e.map(e=>{return{field:wl((t=e).field),direction:ml(t.dir)};var t})}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Wh(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt={before:(c=t.startAt).inclusive,values:c.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:s};var c}function fl(e){let t=il(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){ci(1===r,65062);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=pl(e);return t instanceof Wc&&Xc(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>{return new Kc(vl((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Eo(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new jc(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new jc(n,t)}(n.endAt)),function(e,t,n,r,s,i,o,a){return new vu(e,t,n,r,s,"F",o,a)}(t,s,o,i,a,0,c,u)}function pl(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=vl(e.unaryFilter.field);return Hc.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=vl(e.unaryFilter.field);return Hc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=vl(e.unaryFilter.field);return Hc.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=vl(e.unaryFilter.field);return Hc.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return oi(61313);default:return oi(60726)}}(e):void 0!==e.fieldFilter?(t=e,Hc.create(vl(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return oi(58110);default:return oi(50506)}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return Wc.create(e.compositeFilter.filters.map(e=>pl(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return oi(1026)}}(e.compositeFilter.op))}(e):oi(30097,{filter:e});var t}function ml(e){return Kh[e]}function gl(e){return $h[e]}function yl(e){return Gh[e]}function wl(e){return{fieldPath:e.canonicalString()}}function vl(e){return Oi.fromServerFormat(e.fieldPath)}function Il(e){return e instanceof Hc?function(e){if("=="===e.op){if(Ac(e.value))return{unaryFilter:{field:wl(e.field),op:"IS_NAN"}};if(kc(e.value))return{unaryFilter:{field:wl(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ac(e.value))return{unaryFilter:{field:wl(e.field),op:"IS_NOT_NAN"}};if(kc(e.value))return{unaryFilter:{field:wl(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wl(e.field),op:gl(e.op),value:e.value}}}(e):e instanceof Wc?function(e){const t=e.getFilters().map(e=>Il(e));return 1===t.length?t[0]:{compositeFilter:{op:yl(e.op),filters:t}}}(e):oi(54877,{filter:e})}function _l(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function bl(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class El{constructor(e,t,n,r,s=Hi.min(),i=Hi.min(),o=Wa.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new El(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new El(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new El(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new El(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Tl{constructor(e){this.yt=e}}function Sl(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Cl(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:nl(s=e.yt,(i=t).key),fields:i.data.value.mapValue.fields,updateTime:Qh(s,i.version.toTimestamp()),createTime:Qh(s,i.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:kl(t.version)};else{if(!t.isUnknownDocument())return oi(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:kl(t.version)}}var s,i;return r}function Cl(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function kl(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Al(e){const t=new Gi(e.seconds,e.nanoseconds);return Hi.fromTimestamp(t)}function Nl(e,t){const n=(t.baseMutations||[]).map(t=>hl(e.yt,t));for(let i=0;i<t.mutations.length-1;++i){const e=t.mutations[i];if(i+1<t.mutations.length&&void 0!==t.mutations[i+1].transform){const n=t.mutations[i+1];e.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}const r=t.mutations.map(t=>hl(e.yt,t)),s=Gi.fromMillis(t.localWriteTimeMs);return new Eh(t.batchId,s,n,r)}function Rl(e){const t=Al(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Al(e.lastLimboFreeSnapshotVersion):Hi.min();let r;return r=void 0!==e.query.documents?function(e){const t=e.documents.length;return ci(1===t,1966,{count:t}),Tu(Iu(il(e.documents[0])))}(e.query):Tu(fl(e.query)),new El(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,Wa.fromBase64String(e.resumeToken))}function Dl(e,t){const n=kl(t.snapshotVersion),r=kl(t.lastLimboFreeSnapshotVersion);let s;s=mu(t.target)?ll(e.yt,t.target):dl(e.yt,t.target).ft;const i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:fu(t.target),readTime:n,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function xl(e){const t=fl({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Cu(t,t.limit,"L"):t}function Pl(e,t){return new Sh(t.largestBatchId,hl(e.yt,t.overlayMutation))}function Ol(e,t){const n=t.path.lastSegment();return[e,Co(t.path.popLast()),n]}function Ll(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:kl(r.readTime),documentKey:Co(r.documentKey.path),largestBatchId:r.largestBatchId}}class Ml{getBundleMetadata(e,t){return Vl(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:Al(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return Vl(e).put({bundleId:(n=t).id,createTime:kl(Yh(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return Ul(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:xl(t.bundledQuery),readTime:Al(t.readTime)};var t})}saveNamedQuery(e,t){return Ul(e).put({name:(n=t).name,readTime:kl(Yh(n.readTime)),bundledQuery:n.bundledQuery});var n}}function Vl(e){return Ma(e,ca)}function Ul(e){return Ma(e,ua)}class Fl{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const n=t.uid||"";return new Fl(e,n)}getOverlay(e,t){return Bl(e).get(Ol(this.userId,t)).next(e=>e?Pl(this.serializer,e):null)}getOverlays(e,t){const n=Fu();return io.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){const r=[];return n.forEach((n,s)=>{const i=new Sh(t,s);r.push(this.St(e,i))}),io.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach(e=>r.add(Co(e.getCollectionPath())));const s=[];return r.forEach(t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);s.push(Bl(e).Z(ba,r))}),io.waitFor(s)}getOverlaysForCollection(e,t,n){const r=Fu(),s=Co(t),i=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Bl(e).J(ba,i).next(e=>{for(const t of e){const e=Pl(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){const s=Fu();let i;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Bl(e).ee({index:Ta,range:o},(e,t,n)=>{const o=Pl(this.serializer,t);s.size()<r||o.largestBatchId===i?(s.set(o.getKey(),o),i=o.largestBatchId):n.done()}).next(()=>s)}St(e,t){return Bl(e).put(function(e,t,n){const[r,s,i]=Ol(t,n.mutation.key);return{userId:t,collectionPath:s,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:ul(e.yt,n.mutation)}}(this.serializer,this.userId,t))}}function Bl(e){return Ma(e,Ia)}class jl{bt(e){return Ma(e,Ca)}getSessionToken(e){return this.bt(e).get("sessionToken").next(e=>{const t=e?.value;return t?Wa.fromUint8Array(t):Wa.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class ql{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Xa(e.integerValue));else if("doubleValue"in e){const n=Xa(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),To(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=Ja(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Ya(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?xc(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Rc(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):oi(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const r of Object.keys(n))this.Ot(r,t),this.Ct(n[r],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const r=fc,s=n[r].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(Xa(s)),this.Ot(r,t),this.Ct(n[r],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const r of n)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),Li.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}ql.Kt=new ql;const zl=255;function Kl(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}function $l(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=Kl(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}class Gl{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Ht()}Yt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{const e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Zt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{const e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Ht()}Xt(e){const t=this.en(e),n=$l(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}nn(e){const t=this.en(e),n=$l(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}rn(){this.sn(zl),this.sn(255)}_n(){this.an(zl),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Gt(e){const t=255&e;0===t?(this.sn(0),this.sn(255)):t===zl?(this.sn(zl),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;0===t?(this.an(0),this.an(255)):t===zl?(this.an(zl),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class Hl{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class Wl{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Ql{constructor(){this.cn=new Gl,this.ln=new Hl(this.cn),this.hn=new Wl(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return 0===e?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}class Jl{constructor(e,t,n,r){this.Tn=e,this.In=t,this.En=n,this.dn=r}An(){const e=this.dn.length,t=0===e||255===this.dn[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new Jl(this.Tn,this.In,this.En,n)}Rn(e,t,n){return{indexId:this.Tn,uid:e,arrayValue:Zl(this.En),directionalValue:Zl(this.dn),orderedDocumentKey:Zl(t),documentKey:n.path.toArray()}}Vn(e,t,n){const r=this.Rn(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function Xl(e,t){let n=e.Tn-t.Tn;return 0!==n?n:(n=Yl(e.En,t.En),0!==n?n:(n=Yl(e.dn,t.dn),0!==n?n:Li.comparator(e.In,t.In)))}function Yl(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}function Zl(e){return E()?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):e}function ed(e){return"string"!=typeof e?e:function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)}class td{constructor(e){this.mn=new za((e,t)=>Oi.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const e=t;e.isInequality()?this.mn=this.mn.add(e):this.gn.push(e)}}get pn(){return this.mn.size>1}yn(e){if(ci(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=Qi(e);if(void 0!==t&&!this.wn(t))return!1;const n=Ji(e);let r=new Set,s=0,i=0;for(;s<n.length&&this.wn(n[s]);++s)r=r.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.mn.size>0){const e=this.mn.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[s];if(!this.Sn(e,t)||!this.bn(this.fn[i++],t))return!1}++s}for(;s<n.length;++s){const e=n[s];if(i>=this.fn.length||!this.bn(this.fn[i++],e))return!1}return!0}Dn(){if(this.pn)return null;let e=new za(Oi.comparator);const t=[];for(const n of this.gn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new Xi(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Xi(n.field,0))}for(const n of this.fn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Xi(n.field,"asc"===n.dir?0:1)));return new Wi(Wi.UNKNOWN_ID,this.collectionId,t,Yi.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function nd(e){if(ci(e instanceof Hc||e instanceof Wc,20012),e instanceof Hc){if(e instanceof cu){const t=e.value.arrayValue?.values?.map(t=>Hc.create(e.field,"==",t))||[];return Wc.create(t,"or")}return e}const t=e.filters.map(e=>nd(e));return Wc.create(t,e.op)}function rd(e){if(0===e.getFilters().length)return[];const t=ad(nd(e));return ci(od(t),7391),sd(t)||id(t)?[t]:t.getFilters()}function sd(e){return e instanceof Hc}function id(e){return e instanceof Wc&&Xc(e)}function od(e){return sd(e)||id(e)||function(e){if(e instanceof Wc&&Jc(e)){for(const t of e.getFilters())if(!sd(t)&&!id(t))return!1;return!0}return!1}(e)}function ad(e){if(ci(e instanceof Hc||e instanceof Wc,34018),e instanceof Hc)return e;if(1===e.filters.length)return ad(e.filters[0]);const t=e.filters.map(e=>ad(e));let n=Wc.create(t,e.op);return n=hd(n),od(n)?n:(ci(n instanceof Wc,64498),ci(Qc(n),40251),ci(n.filters.length>1,57927),n.filters.reduce((e,t)=>cd(e,t)))}function cd(e,t){let n;return ci(e instanceof Hc||e instanceof Wc,38388),ci(t instanceof Hc||t instanceof Wc,25473),n=e instanceof Hc?t instanceof Hc?(r=e,s=t,Wc.create([r,s],"and")):ud(e,t):t instanceof Hc?ud(t,e):function(e,t){if(ci(e.filters.length>0&&t.filters.length>0,48005),Qc(e)&&Qc(t))return tu(e,t.getFilters());const n=Jc(e)?e:t,r=Jc(e)?t:e,s=n.filters.map(e=>cd(e,r));return Wc.create(s,"or")}(e,t),hd(n);var r,s}function ud(e,t){if(Qc(t))return tu(t,e.getFilters());{const n=t.filters.map(t=>cd(e,t));return Wc.create(n,"or")}}function hd(e){if(ci(e instanceof Hc||e instanceof Wc,11850),e instanceof Hc)return e;const t=e.getFilters();if(1===t.length)return hd(t[0]);if(Yc(e))return e;const n=t.map(e=>hd(e)),r=[];return n.forEach(t=>{t instanceof Hc?r.push(t):t instanceof Wc&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:Wc.create(r,e.op)}class ld{constructor(){this.Cn=new dd}addToCollectionParentIndex(e,t){return this.Cn.add(t),io.resolve()}getCollectionParents(e,t){return io.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return io.resolve()}deleteFieldIndex(e,t){return io.resolve()}deleteAllFieldIndexes(e){return io.resolve()}createTargetIndexes(e,t){return io.resolve()}getDocumentsMatchingTarget(e,t){return io.resolve(null)}getIndexType(e,t){return io.resolve(0)}getFieldIndexes(e,t){return io.resolve([])}getNextCollectionGroupToUpdate(e){return io.resolve(null)}getMinOffset(e,t){return io.resolve(eo.min())}getMinOffsetFromCollectionGroup(e,t){return io.resolve(eo.min())}updateCollectionGroup(e,t,n){return io.resolve()}updateIndexEntries(e,t){return io.resolve()}}class dd{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new za(xi.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new za(xi.comparator)).toArray()}}const fd="IndexedDbIndexManager",pd=new Uint8Array(0);class md{constructor(e,t){this.databaseId=t,this.vn=new dd,this.Fn=new Pu(e=>fu(e),(e,t)=>pu(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const s={collectionId:n,parent:Co(r)};return gd(e).put(s)}return io.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Ni(t),""],!1,!0);return gd(e).J(r).next(e=>{for(const r of e){if(r.collectionId!==t)break;n.push(No(r.parent))}return n})}addFieldIndex(e,t){const n=wd(e),r={indexId:(s=t).indexId,collectionGroup:s.collectionGroup,fields:s.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};var s;delete r.indexId;const i=n.add(r);if(t.indexState){const n=vd(e);return i.next(e=>{n.put(Ll(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=wd(e),r=vd(e),s=yd(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=wd(e),n=yd(e),r=vd(e);return t.Z().next(()=>n.Z()).next(()=>r.Z())}createTargetIndexes(e,t){return io.forEach(this.Mn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){const n=new td(t).Dn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){const n=yd(e);let r=!0;const s=new Map;return io.forEach(this.Mn(t),t=>this.xn(e,t).next(e=>{r&&(r=!!e),s.set(t,e)})).next(()=>{if(r){let e=Ku();const r=[];return io.forEach(s,(s,i)=>{var o;ni(fd,`Using index ${o=s,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${fu(t)}`);const a=function(e,t){const n=Qi(t);if(void 0===n)return null;for(const r of gu(e,n.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}(i,s),c=function(e,t){const n=new Map;for(const r of Ji(t))for(const t of gu(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(i,s),u=function(e,t){const n=[];let r=!0;for(const s of Ji(t)){const t=0===s.kind?yu(e,s.fieldPath,e.startAt):wu(e,s.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new jc(n,r)}(i,s),h=function(e,t){const n=[];let r=!0;for(const s of Ji(t)){const t=0===s.kind?wu(e,s.fieldPath,e.endAt):yu(e,s.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new jc(n,r)}(i,s),l=this.On(s,i,u),d=this.On(s,i,h),f=this.Nn(s,i,c),p=this.Bn(s.indexId,a,l,u.inclusive,d,h.inclusive,f);return io.forEach(p,s=>n.Y(s,t.limit).next(t=>{t.forEach(t=>{const n=Li.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return io.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(t=0===e.filters.length?[e]:rd(Wc.create(e.filters,"and")).map(t=>du(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,n,r,s,i,o){const a=(null!=t?t.length:1)*Math.max(n.length,s.length),c=a/(null!=t?t.length:1),u=[];for(let h=0;h<a;++h){const a=t?this.Ln(t[h/c]):pd,l=this.kn(e,a,n[h%c],r),d=this.qn(e,a,s[h%c],i),f=o.map(t=>this.kn(e,a,t,!0));u.push(...this.createRange(l,d,f))}return u}kn(e,t,n,r){const s=new Jl(e,Li.empty(),t,n);return r?s:s.An()}qn(e,t,n,r){const s=new Jl(e,Li.empty(),t,n);return r?s.An():s}xn(e,t){const n=new td(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(const r of e)n.yn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2;const r=this.Mn(t);return io.forEach(r,t=>this.xn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new za(Oi.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}Qn(e,t){const n=new Ql;for(const r of Ji(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const s=n.Pn(r.kind);ql.Kt.Dt(e,s)}return n.un()}Ln(e){const t=new Ql;return ql.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const n=new Ql;return ql.Kt.Dt(Tc(this.databaseId,t),n.Pn(function(e){const t=Ji(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.un()}Nn(e,t,n){if(null===n)return[];let r=[];r.push(new Ql);let s=0;for(const i of Ji(e)){const e=n[s++];for(const n of r)if(this.Un(t,i.fieldPath)&&Cc(e))r=this.Kn(r,i,e);else{const t=n.Pn(i.kind);ql.Kt.Dt(e,t)}}return this.Wn(r)}On(e,t,n){return this.Nn(e,t,n.position)}Wn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Kn(e,t,n){const r=[...e],s=[];for(const i of n.arrayValue.values||[])for(const e of r){const n=new Ql;n.seed(e.un()),ql.Kt.Dt(i,n.Pn(t.kind)),s.push(n)}return s}Un(e,t){return!!e.filters.find(e=>e instanceof Hc&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=wd(e),r=vd(e);return(t?n.J(la,IDBKeyRange.bound(t,t)):n.J()).next(e=>{const t=[];return io.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){const n=t?new Yi(t.sequenceNumber,new eo(Al(t.readTime),new Li(No(t.documentKey)),t.largestBatchId)):Yi.empty(),r=e.fields.map(([e,t])=>new Xi(Oi.fromServerFormat(e),t));return new Wi(e.indexId,e.collectionGroup,r,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Ei(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){const r=wd(e),s=vd(e);return this.Gn(e).next(e=>r.J(la,IDBKeyRange.bound(t,t)).next(t=>io.forEach(t,t=>s.put(Ll(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){const n=new Map;return io.forEach(t,(t,r)=>{const s=n.get(t.collectionGroup);return(s?io.resolve(s):this.getFieldIndexes(e,t.collectionGroup)).next(s=>(n.set(t.collectionGroup,s),io.forEach(s,n=>this.zn(e,t,n).next(t=>{const s=this.jn(r,n);return t.isEqual(s)?io.resolve():this.Jn(e,r,n,t,s)}))))})}Hn(e,t,n,r){return yd(e).put(r.Rn(this.uid,this.$n(n,t.key),t.key))}Yn(e,t,n,r){return yd(e).delete(r.Vn(this.uid,this.$n(n,t.key),t.key))}zn(e,t,n){const r=yd(e);let s=new za(Xl);return r.ee({index:wa,range:IDBKeyRange.only([n.indexId,this.uid,Zl(this.$n(n,t))])},(e,r)=>{s=s.add(new Jl(n.indexId,t,ed(r.arrayValue),ed(r.directionalValue)))}).next(()=>s)}jn(e,t){let n=new za(Xl);const r=this.Qn(t,e);if(null==r)return n;const s=Qi(t);if(null!=s){const i=e.data.field(s.fieldPath);if(Cc(i))for(const s of i.arrayValue.values||[])n=n.add(new Jl(t.indexId,e.key,this.Ln(s),r))}else n=n.add(new Jl(t.indexId,e.key,pd,r));return n}Jn(e,t,n,r,s){ni(fd,"Updating index entries for document '%s'",t.key);const i=[];return function(e,t,n,r,s){const i=e.getIterator(),o=t.getIterator();let a=$a(i),c=$a(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=$a(o)):t?(s(a),a=$a(i)):(a=$a(i),c=$a(o))}}(r,s,Xl,r=>{i.push(this.Hn(e,t,n,r))},r=>{i.push(this.Yn(e,t,n,r))}),io.waitFor(i)}Gn(e){let t=1;return vd(e).ee({index:pa,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>Xl(e,t)).filter((e,t,n)=>!t||0!==Xl(e,n[t-1]));const r=[];r.push(e);for(const i of n){const n=Xl(i,e),s=Xl(i,t);if(0===n)r[0]=e.An();else if(n>0&&s<0)r.push(i),r.push(i.An());else if(s>0)break}r.push(t);const s=[];for(let i=0;i<r.length;i+=2){if(this.Zn(r[i],r[i+1]))return[];const e=r[i].Vn(this.uid,pd,Li.empty()),t=r[i+1].Vn(this.uid,pd,Li.empty());s.push(IDBKeyRange.bound(e,t))}return s}Zn(e,t){return Xl(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Id)}getMinOffset(e,t){return io.mapArray(this.Mn(t),t=>this.xn(e,t).next(e=>e||oi(44426))).next(Id)}}function gd(e){return Ma(e,ia)}function yd(e){return Ma(e,ga)}function wd(e){return Ma(e,ha)}function vd(e){return Ma(e,da)}function Id(e){ci(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const s=e[r].indexState.offset;to(s,t)<0&&(t=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new eo(t.readTime,t.documentKey,n)}const _d={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},bd=41943040;class Ed{static withCacheSize(e){return new Ed(e,Ed.DEFAULT_COLLECTION_PERCENTILE,Ed.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function Td(e,t,n){const r=e.store(Oo),s=e.store(jo),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.ee({range:o},(e,t,n)=>(a++,n.delete()));i.push(c.next(()=>{ci(1===a,47070,{batchId:n.batchId})}));const u=[];for(const h of n.mutations){const e=Fo(t,h.key.path,n.batchId);i.push(s.delete(e)),u.push(h.key)}return io.waitFor(i).next(()=>u)}function Sd(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw oi(14731);t=e.noDocument}return JSON.stringify(t).length}Ed.DEFAULT_COLLECTION_PERCENTILE=10,Ed.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ed.DEFAULT=new Ed(bd,Ed.DEFAULT_COLLECTION_PERCENTILE,Ed.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ed.DISABLED=new Ed(-1,0,0);class Cd{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Xn={}}static wt(e,t,n,r){ci(""!==e.uid,64387);const s=e.isAuthenticated()?e.uid:"";return new Cd(s,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ad(e).ee({index:Mo,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){const s=Nd(e),i=Ad(e);return i.add({}).next(o=>{ci("number"==typeof o,49019);const a=new Eh(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map(t=>ul(e.yt,t)),s=n.mutations.map(t=>ul(e.yt,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:s}}(this.serializer,this.userId,a),u=[];let h=new za((e,t)=>Ei(e.canonicalString(),t.canonicalString()));for(const e of r){const t=Fo(this.userId,e.key.path,o);h=h.add(e.key.path.popLast()),u.push(i.put(c)),u.push(s.put(t,Bo))}return h.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Xn[o]=a.keys()}),io.waitFor(u).next(()=>a)})}lookupMutationBatch(e,t){return Ad(e).get(t).next(e=>e?(ci(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),Nl(this.serializer,e)):null)}er(e,t){return this.Xn[t]?io.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){const n=e.keys();return this.Xn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return Ad(e).ee({index:Mo,range:r},(e,t,r)=>{t.userId===this.userId&&(ci(t.batchId>=n,47524,{tr:n}),s=Nl(this.serializer,t)),r.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=bo;return Ad(e).ee({index:Mo,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,bo],[this.userId,Number.POSITIVE_INFINITY]);return Ad(e).J(Mo,t).next(e=>e.map(e=>Nl(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Uo(this.userId,t.path),r=IDBKeyRange.lowerBound(n),s=[];return Nd(e).ee({range:r},(n,r,i)=>{const[o,a,c]=n,u=No(a);if(o===this.userId&&t.path.isEqual(u))return Ad(e).get(c).next(e=>{if(!e)throw oi(61480,{nr:n,batchId:c});ci(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:c}),s.push(Nl(this.serializer,e))});i.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new za(Ei);const r=[];return t.forEach(t=>{const s=Uo(this.userId,t.path),i=IDBKeyRange.lowerBound(s),o=Nd(e).ee({range:i},(e,r,s)=>{const[i,o,a]=e,c=No(o);i===this.userId&&t.path.isEqual(c)?n=n.add(a):s.done()});r.push(o)}),io.waitFor(r).next(()=>this.rr(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,s=Uo(this.userId,n),i=IDBKeyRange.lowerBound(s);let o=new za(Ei);return Nd(e).ee({range:i},(e,t,s)=>{const[i,a,c]=e,u=No(a);i===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):s.done()}).next(()=>this.rr(e,o))}rr(e,t){const n=[],r=[];return t.forEach(t=>{r.push(Ad(e).get(t).next(e=>{if(null===e)throw oi(35274,{batchId:t});ci(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(Nl(this.serializer,e))}))}),io.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return Td(e.le,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),io.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return io.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return Nd(e).ee({range:n},(e,t,n)=>{if(e[0]===this.userId){const t=No(e[1]);r.push(t)}else n.done()}).next(()=>{ci(0===r.length,56720,{sr:r.map(e=>e.canonicalString())})})})}containsKey(e,t){return kd(e,this.userId,t)}_r(e){return Rd(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:bo,lastStreamToken:""})}}function kd(e,t,n){const r=Uo(t,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Nd(e).ee({range:i,X:!0},(e,n,r)=>{const[i,a,c]=e;i===t&&a===s&&(o=!0),r.done()}).next(()=>o)}function Ad(e){return Ma(e,Oo)}function Nd(e){return Ma(e,jo)}function Rd(e){return Ma(e,Po)}class Dd{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Dd(0)}static cr(){return new Dd(-1)}}class xd{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const n=new Dd(t.highestTargetId);return t.highestTargetId=n.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(e=>Hi.fromTimestamp(new Gi(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.lr(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.hr(e,r)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(n=>(n.targetCount+=1,this.Tr(t,n),this.hr(e,n))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Pd(e).delete(t.targetId)).next(()=>this.lr(e)).next(t=>(ci(t.targetCount>0,8065),t.targetCount-=1,this.hr(e,t)))}removeTargets(e,t,n){let r=0;const s=[];return Pd(e).ee((i,o)=>{const a=Rl(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,s.push(this.removeTargetData(e,a)))}).next(()=>io.waitFor(s)).next(()=>r)}forEachTarget(e,t){return Pd(e).ee((e,n)=>{const r=Rl(n);t(r)})}lr(e){return Od(e).get(ra).next(e=>(ci(null!==e,2888),e))}hr(e,t){return Od(e).put(ra,t)}Pr(e,t){return Pd(e).put(Dl(this.serializer,t))}Tr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.lr(e).next(e=>e.targetCount)}getTargetData(e,t){const n=fu(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Pd(e).ee({range:r,index:Xo},(e,n,r)=>{const i=Rl(n);pu(t,i.target)&&(s=i,r.done())}).next(()=>s)}addMatchingKeys(e,t,n){const r=[],s=Ld(e);return t.forEach(t=>{const i=Co(t.path);r.push(s.put({targetId:n,path:i})),r.push(this.referenceDelegate.addReference(e,n,t))}),io.waitFor(r)}removeMatchingKeys(e,t,n){const r=Ld(e);return io.forEach(t,t=>{const s=Co(t.path);return io.waitFor([r.delete([n,s]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){const n=Ld(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Ld(e);let s=Ku();return r.ee({range:n,X:!0},(e,t,n)=>{const r=No(e[1]),i=new Li(r);s=s.add(i)}).next(()=>s)}containsKey(e,t){const n=Co(t.path),r=IDBKeyRange.bound([n],[Ni(n)],!1,!0);let s=0;return Ld(e).ee({index:ta,X:!0,range:r},([e,t],n,r)=>{0!==e&&(s++,r.done())}).next(()=>s>0)}At(e,t){return Pd(e).get(t).next(e=>e?Rl(e):null)}}function Pd(e){return Ma(e,Jo)}function Od(e){return Ma(e,sa)}function Ld(e){return Ma(e,Zo)}const Md="LruGarbageCollector";function Vd([e,t],[n,r]){const s=Ei(e,n);return 0===s?Ei(t,r):s}class Ud{constructor(e){this.Ir=e,this.buffer=new za(Vd),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Vd(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Fd{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){ni(Md,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){fo(e)?ni(Md,"Ignoring IndexedDB error during garbage collection: ",e):await so(e)}await this.Vr(3e5)})}}class Bd{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return io.resolve(_o.ce);const n=new Ud(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(ni("LruGarbageCollector","Garbage collection skipped; disabled"),io.resolve(_d)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(ni("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),_d):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,s,i,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(ni("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,i=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(s=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(c=Date.now(),ti()<=z.DEBUG&&ni("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-u}ms\n\tDetermined least recently used ${r} in `+(o-i)+`ms\n\tRemoved ${s} targets in `+(a-o)+`ms\n\tRemoved ${e} documents in `+(c-a)+`ms\nTotal Duration: ${c-u}ms`),io.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:e})))}}function jd(e,t){return new Bd(e,t)}class qd{constructor(e,t){this.db=e,this.garbageCollector=jd(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(e,n)=>t(n))}addReference(e,t,n){return zd(e,n)}removeReference(e,t,n){return zd(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return zd(e,t)}br(e,t){return function(e,t){let n=!1;return Rd(e).te(r=>kd(e,r,t).next(e=>(e&&(n=!0),io.resolve(!e)))).next(()=>n)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Sr(e,(i,o)=>{if(o<=t){const t=this.br(e,i).next(t=>{if(!t)return s++,n.getEntry(e,i).next(()=>(n.removeEntry(i,Hi.min()),Ld(e).delete([0,Co(i.path)])))});r.push(t)}}).next(()=>io.waitFor(r)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return zd(e,t)}Sr(e,t){const n=Ld(e);let r,s=_o.ce;return n.ee({index:ta},([e,n],{path:i,sequenceNumber:o})=>{0===e?(s!==_o.ce&&t(new Li(No(r)),s),s=o,r=i):s=_o.ce}).next(()=>{s!==_o.ce&&t(new Li(No(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function zd(e,t){return Ld(e).put((n=t,r=e.currentSequenceNumber,{targetId:0,path:Co(n.path),sequenceNumber:r}));var n,r}class Kd{constructor(){this.changes=new Pu(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Bc.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?io.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class $d{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Qd(e).put(n)}removeEntry(e,t,n){return Qd(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Cl(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.Dr(e,n)))}getEntry(e,t){let n=Bc.newInvalidDocument(t);return Qd(e).ee({index:Ko,range:IDBKeyRange.only(Jd(t))},(e,r)=>{n=this.Cr(t,r)}).next(()=>n)}vr(e,t){let n={size:0,document:Bc.newInvalidDocument(t)};return Qd(e).ee({index:Ko,range:IDBKeyRange.only(Jd(t))},(e,r)=>{n={document:this.Cr(t,r),size:Sd(r)}}).next(()=>n)}getEntries(e,t){let n=Lu();return this.Fr(e,t,(e,t)=>{const r=this.Cr(e,t);n=n.insert(e,r)}).next(()=>n)}Mr(e,t){let n=Lu(),r=new Ba(Li.comparator);return this.Fr(e,t,(e,t)=>{const s=this.Cr(e,t);n=n.insert(e,s),r=r.insert(e,Sd(t))}).next(()=>({documents:n,Or:r}))}Fr(e,t,n){if(t.isEmpty())return io.resolve();let r=new za(Yd);t.forEach(e=>r=r.add(e));const s=IDBKeyRange.bound(Jd(r.first()),Jd(r.last())),i=r.getIterator();let o=i.getNext();return Qd(e).ee({index:Ko,range:s},(e,t,r)=>{const s=Li.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&Yd(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,t),o=i.hasNext()?i.getNext():null),o?r.j(Jd(o)):r.done()}).next(()=>{for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,s){const i=t.path,o=[i.popLast().toArray(),i.lastSegment(),Cl(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Qd(e).J(IDBKeyRange.bound(o,a,!0)).next(e=>{s?.incrementDocumentReadCount(e.length);let n=Lu();for(const s of e){const e=this.Cr(Li.fromSegments(s.prefixPath.concat(s.collectionGroup,s.documentId)),s);e.isFoundDocument()&&(Ru(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let s=Lu();const i=Xd(t,n),o=Xd(t,eo.max());return Qd(e).ee({index:Go,range:IDBKeyRange.bound(i,o,!0)},(e,t,n)=>{const i=this.Cr(Li.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);s=s.insert(i.key,i),s.size===r&&n.done()}).next(()=>s)}newChangeBuffer(e){return new Hd(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return Wd(e).get(Qo).next(e=>(ci(!!e,20021),e))}Dr(e,t){return Wd(e).put(Qo,t)}Cr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=function(e,t,n){const r=rl(e,t.name),s=Yh(t.updateTime),i=t.createTime?Yh(t.createTime):Hi.min(),o=new Uc({mapValue:{fields:t.fields}}),a=Bc.newFoundDocument(r,s,i,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=Li.fromSegments(t.noDocument.path),r=Al(t.noDocument.readTime);n=Bc.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return oi(56709);{const e=Li.fromSegments(t.unknownDocument.path),r=Al(t.unknownDocument.version);n=Bc.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new Gi(e[0],e[1]);return Hi.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(Hi.min()))return e}return Bc.newInvalidDocument(e)}}function Gd(e){return new $d(e)}class Hd extends Kd{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Pu(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){const t=[];let n=0,r=new za((e,t)=>Ei(e.canonicalString(),t.canonicalString()));return this.changes.forEach((s,i)=>{const o=this.Br.get(s);if(t.push(this.Nr.removeEntry(e,s,o.readTime)),i.isValidDocument()){const a=Sl(this.Nr.serializer,i);r=r.add(s.path.popLast());const c=Sd(a);n+=c-o.size,t.push(this.Nr.addEntry(e,s,a))}else if(n-=o.size,this.trackRemovals){const n=Sl(this.Nr.serializer,i.convertToNoDocument(Hi.min()));t.push(this.Nr.addEntry(e,s,n))}}),r.forEach(n=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Nr.updateMetadata(e,n)),io.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(e=>(this.Br.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:e,Or:t})=>(t.forEach((t,n)=>{this.Br.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function Wd(e){return Ma(e,Wo)}function Qd(e){return Ma(e,qo)}function Jd(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Xd(e,t){const n=t.documentKey.path.toArray();return[e,Cl(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Yd(e,t){const n=e.path.toArray(),r=t.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=Ei(n[i],r[i]),s)return s;return s=Ei(n.length,r.length),s||(s=Ei(n[n.length-2],r[r.length-2]),s||Ei(n[n.length-1],r[r.length-1]))}class Zd{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ef{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&fh(n.mutation,e,Ga.empty(),Gi.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Ku()).next(()=>t))}getLocalViewOfDocuments(e,t,n=Ku()){const r=Fu();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=Vu();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=Fu();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Ku()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let s=Lu();const i=ju(),o=ju();return t.forEach((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof yh)?s=s.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),fh(o.mutation,t,o.mutation.getFieldMask(),Gi.now())):i.set(t.key,Ga.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>o.set(e,new Zd(t,i.get(e)??null))),o))}recalculateAndSaveOverlays(e,t){const n=ju();let r=new Ba((e,t)=>e-t),s=Ku();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const s of e)s.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let o=n.get(e)||Ga.empty();o=s.applyToLocalView(i,o),n.set(e,o);const a=(r.get(s.batchId)||Ku()).add(e);r=r.insert(s.batchId,a)})}).next(()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Bu();c.forEach(e=>{if(!s.has(e)){const r=lh(t.get(e),n.get(e));null!==r&&u.set(e,r),s=s.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,a,u))}return io.waitFor(i)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return s=t,Li.isDocumentKey(s.path)&&null===s.collectionGroup&&0===s.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):bu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r);var s}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):io.resolve(Fu());let o=-1,a=s;return i.next(t=>io.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(t)?io.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,s)).next(()=>this.computeViews(e,a,t,Ku())).next(e=>({batchId:o,changes:Uu(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Li(t)).next(e=>{let t=Vu();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const s=t.collectionGroup;let i=Vu();return this.indexManager.getCollectionParents(e,s).next(o=>io.forEach(o,o=>{const a=(c=t,u=o.child(s),new vu(u,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,u;return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,r))).next(e=>{s.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Bc.newInvalidDocument(r)))});let n=Vu();return e.forEach((e,r)=>{const i=s.get(e);void 0!==i&&fh(i.mutation,r,Ga.empty(),Gi.now()),Ru(t,r)&&(n=n.insert(e,r))}),n})}}class tf{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return io.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:(n=t).id,version:n.version,createTime:Yh(n.createTime)}),io.resolve();var n}getNamedQuery(e,t){return io.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:(n=t).name,query:xl(n.bundledQuery),readTime:Yh(n.readTime)}),io.resolve();var n}}class nf{constructor(){this.overlays=new Ba(Li.comparator),this.qr=new Map}getOverlay(e,t){return io.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Fu();return io.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),io.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),io.resolve()}getOverlaysForCollection(e,t,n){const r=Fu(),s=t.length+1,i=new Li(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>n&&r.set(e.getKey(),e)}return io.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new Ba((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=Fu(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Fu(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return io.resolve(o)}St(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Sh(t,n));let s=this.qr.get(t);void 0===s&&(s=Ku(),this.qr.set(t,s)),this.qr.set(t,s.add(n.key))}}class rf{constructor(){this.sessionToken=Wa.EMPTY_BYTE_STRING}getSessionToken(e){return io.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,io.resolve()}}class sf{constructor(){this.Qr=new za(of.$r),this.Ur=new za(of.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new of(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new of(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new Li(new xi([])),n=new of(t,e),r=new of(t,e+1),s=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),s.push(e.key)}),s}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Li(new xi([])),n=new of(t,e),r=new of(t,e+1);let s=Ku();return this.Ur.forEachInRange([n,r],e=>{s=s.add(e.key)}),s}containsKey(e){const t=new of(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class of{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Li.comparator(e.key,t.key)||Ei(e.Yr,t.Yr)}static Kr(e,t){return Ei(e.Yr,t.Yr)||Li.comparator(e.key,t.key)}}class af{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new za(of.$r)}checkEmpty(e){return io.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Eh(s,t,n,r);this.mutationQueue.push(i);for(const o of r)this.Zr=this.Zr.add(new of(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return io.resolve(i)}lookupMutationBatch(e,t){return io.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ei(n),s=r<0?0:r;return io.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return io.resolve(0===this.mutationQueue.length?bo:this.tr-1)}getAllMutationBatches(e){return io.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new of(t,0),r=new of(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,r],e=>{const t=this.Xr(e.Yr);s.push(t)}),io.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new za(Ei);return t.forEach(e=>{const t=new of(e,0),r=new of(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),io.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;Li.isDocumentKey(s)||(s=s.child(""));const i=new of(new Li(s),0);let o=new za(Ei);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Yr)),!0)},i),io.resolve(this.ti(o))}ti(e){const t=[];return e.forEach(e=>{const n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){ci(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return io.forEach(t.mutations,r=>{const s=new of(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new of(t,0),r=this.Zr.firstAfterOrEqual(n);return io.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,io.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class cf{constructor(e){this.ri=e,this.docs=new Ba(Li.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return io.resolve(n?n.document.mutableCopy():Bc.newInvalidDocument(t))}getEntries(e,t){let n=Lu();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Bc.newInvalidDocument(e))}),io.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=Lu();const i=t.path,o=new Li(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||to(Zi(o),n)<=0||(r.has(o.key)||Ru(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return io.resolve(s)}getAllFromCollectionGroup(e,t,n,r){oi(9500)}ii(e,t){return io.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new uf(this)}getSize(e){return io.resolve(this.size)}}class uf extends Kd{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),io.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class hf{constructor(e){this.persistence=e,this.si=new Pu(e=>fu(e),pu),this.lastRemoteSnapshotVersion=Hi.min(),this.highestTargetId=0,this.oi=0,this._i=new sf,this.targetCount=0,this.ai=Dd.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),io.resolve()}getLastRemoteSnapshotVersion(e){return io.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return io.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),io.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),io.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Dd(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,io.resolve()}updateTargetData(e,t){return this.Pr(t),io.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,io.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.si.forEach((i,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(i),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),io.waitFor(s).next(()=>r)}getTargetCount(e){return io.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return io.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),io.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(t=>{s.push(r.markPotentiallyOrphaned(e,t))}),io.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),io.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return io.resolve(n)}containsKey(e,t){return io.resolve(this._i.containsKey(t))}}class lf{constructor(e,t){this.ui={},this.overlays={},this.ci=new _o(0),this.li=!1,this.li=!0,this.hi=new rf,this.referenceDelegate=e(this),this.Pi=new hf(this),this.indexManager=new ld,this.remoteDocumentCache=new cf(e=>this.referenceDelegate.Ti(e)),this.serializer=new Tl(t),this.Ii=new tf(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new nf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new af(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){ni("MemoryPersistence","Starting transaction:",e);const r=new df(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return io.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class df extends ro{constructor(e){super(),this.currentSequenceNumber=e}}class ff{constructor(e){this.persistence=e,this.Ri=new sf,this.Vi=null}static mi(e){return new ff(e)}get fi(){if(this.Vi)return this.Vi;throw oi(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),io.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),io.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),io.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return io.forEach(this.fi,n=>{const r=Li.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,Hi.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return io.or([()=>io.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class pf{constructor(e,t){this.persistence=e,this.pi=new Pu(e=>Co(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=jd(this,t)}static mi(e,t){return new pf(e,t)}Ei(){}di(e){return io.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return io.forEach(this.pi,(n,r)=>this.br(e,n,r).next(e=>e?io.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(n++,s.removeEntry(r,Hi.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),io.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),io.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),io.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),io.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ec(e.data.value)),t}br(e,t,n){return io.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return io.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class mf{constructor(e){this.serializer=e}k(e,t,n,r){const s=new ao("createOrUpgrade",t);var i;n<1&&r>=1&&(e.createObjectStore(Do),(i=e).createObjectStore(Po,{keyPath:"userId"}),i.createObjectStore(Oo,{keyPath:Lo,autoIncrement:!0}).createIndex(Mo,Vo,{unique:!0}),i.createObjectStore(jo),gf(e),function(e){e.createObjectStore(Ro)}(e));let o=io.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(Zo),e.deleteObjectStore(Jo),e.deleteObjectStore(sa)}(e),gf(e)),o=o.next(()=>function(e){const t=e.store(sa),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Hi.min().toTimestamp(),targetCount:0};return t.put(ra,n)}(s))),n<4&&r>=4&&(0!==n&&(o=o.next(()=>function(e,t){return t.store(Oo).J().next(n=>{e.deleteObjectStore(Oo),e.createObjectStore(Oo,{keyPath:Lo,autoIncrement:!0}).createIndex(Mo,Vo,{unique:!0});const r=t.store(Oo),s=n.map(e=>r.put(e));return io.waitFor(s)})}(e,s))),o=o.next(()=>{!function(e){e.createObjectStore(aa,{keyPath:"clientId"})}(e)})),n<5&&r>=5&&(o=o.next(()=>this.yi(s))),n<6&&r>=6&&(o=o.next(()=>(function(e){e.createObjectStore(Wo)}(e),this.wi(s)))),n<7&&r>=7&&(o=o.next(()=>this.Si(s))),n<8&&r>=8&&(o=o.next(()=>this.bi(e,s))),n<9&&r>=9&&(o=o.next(()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&r>=10&&(o=o.next(()=>this.Di(s))),n<11&&r>=11&&(o=o.next(()=>{!function(e){e.createObjectStore(ca,{keyPath:"bundleId"})}(e),function(e){e.createObjectStore(ua,{keyPath:"name"})}(e)})),n<12&&r>=12&&(o=o.next(()=>{!function(e){const t=e.createObjectStore(Ia,{keyPath:_a});t.createIndex(ba,Ea,{unique:!1}),t.createIndex(Ta,Sa,{unique:!1})}(e)})),n<13&&r>=13&&(o=o.next(()=>function(e){const t=e.createObjectStore(qo,{keyPath:zo});t.createIndex(Ko,$o),t.createIndex(Go,Ho)}(e)).next(()=>this.Ci(e,s)).next(()=>e.deleteObjectStore(Ro))),n<14&&r>=14&&(o=o.next(()=>this.Fi(e,s))),n<15&&r>=15&&(o=o.next(()=>function(e){e.createObjectStore(ha,{keyPath:"indexId",autoIncrement:!0}).createIndex(la,"collectionGroup",{unique:!1}),e.createObjectStore(da,{keyPath:fa}).createIndex(pa,ma,{unique:!1}),e.createObjectStore(ga,{keyPath:ya}).createIndex(wa,va,{unique:!1})}(e))),n<16&&r>=16&&(o=o.next(()=>{t.objectStore(da).clear()}).next(()=>{t.objectStore(ga).clear()})),n<17&&r>=17&&(o=o.next(()=>{!function(e){e.createObjectStore(Ca,{keyPath:"name"})}(e)})),n<18&&r>=18&&E()&&(o=o.next(()=>{t.objectStore(da).clear()}).next(()=>{t.objectStore(ga).clear()})),o}wi(e){let t=0;return e.store(Ro).ee((e,n)=>{t+=Sd(n)}).next(()=>{const n={byteSize:t};return e.store(Wo).put(Qo,n)})}yi(e){const t=e.store(Po),n=e.store(Oo);return t.J().next(t=>io.forEach(t,t=>{const r=IDBKeyRange.bound([t.userId,bo],[t.userId,t.lastAcknowledgedBatchId]);return n.J(Mo,r).next(n=>io.forEach(n,n=>{ci(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});const r=Nl(this.serializer,n);return Td(e,t.userId,r).next(()=>{})}))}))}Si(e){const t=e.store(Zo),n=e.store(Ro);return e.store(sa).get(ra).next(e=>{const r=[];return n.ee((n,s)=>{const i=new xi(n),o=[0,Co(i)];r.push(t.get(o).next(n=>{return n?io.resolve():(r=i,t.put({targetId:0,path:Co(r),sequenceNumber:e.highestListenSequenceNumber}));var r}))}).next(()=>io.waitFor(r))})}bi(e,t){e.createObjectStore(ia,{keyPath:oa});const n=t.store(ia),r=new dd,s=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Co(r)})}};return t.store(Ro).ee({X:!0},(e,t)=>{const n=new xi(e);return s(n.popLast())}).next(()=>t.store(jo).ee({X:!0},([e,t,n],r)=>{const i=No(t);return s(i.popLast())}))}Di(e){const t=e.store(Jo);return t.ee((e,n)=>{const r=Rl(n),s=Dl(this.serializer,r);return t.put(s)})}Ci(e,t){const n=t.store(Ro),r=[];return n.ee((e,n)=>{const s=t.store(qo),i=(a=n,a.document?new Li(xi.fromString(a.document.name).popFirst(5)):a.noDocument?Li.fromSegments(a.noDocument.path):a.unknownDocument?Li.fromSegments(a.unknownDocument.path):oi(36783)).path.toArray(),o={prefixPath:i.slice(0,i.length-2),collectionGroup:i[i.length-2],documentId:i[i.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};var a;r.push(s.put(o))}).next(()=>io.waitFor(r))}Fi(e,t){const n=t.store(Oo),r=Gd(this.serializer),s=new lf(ff.mi,this.serializer.yt);return n.J().next(e=>{const n=new Map;return e.forEach(e=>{let t=n.get(e.userId)??Ku();Nl(this.serializer,e).keys().forEach(e=>t=t.add(e)),n.set(e.userId,t)}),io.forEach(n,(e,n)=>{const i=new Ys(n),o=Fl.wt(this.serializer,i),a=s.getIndexManager(i),c=Cd.wt(i,this.serializer,a,s.referenceDelegate);return new ef(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new La(t,_o.ce),e).next()})})}}function gf(e){e.createObjectStore(Zo,{keyPath:ea}).createIndex(ta,na,{unique:!0}),e.createObjectStore(Jo,{keyPath:"targetId"}).createIndex(Xo,Yo,{unique:!0}),e.createObjectStore(sa)}const yf="IndexedDbPersistence",wf=18e5,vf=5e3,If="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class _f{constructor(e,t,n,r,s,i,o,a,c,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Mi=s,this.window=i,this.document=o,this.xi=c,this.Oi=u,this.Ni=h,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=e=>Promise.resolve(),!_f.v())throw new li(hi.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new qd(this,r),this.$i=t+"main",this.serializer=new Tl(a),this.Ui=new co(this.$i,this.Ni,new mf(this.serializer)),this.hi=new jl,this.Pi=new xd(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Gd(this.serializer),this.Ii=new Ml,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,!1===u&&ri(yf,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new li(hi.FAILED_PRECONDITION,If);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new _o(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ef(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(fo(e))return ni(yf,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ni(yf,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return bf(e).get(xo).next(e=>io.resolve(this.es(e)))}ts(e){return Ef(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,wf)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const t=Ma(e,aa);return t.J().next(e=>{const n=this.ss(e,wf),r=e.filter(e=>-1===n.indexOf(e));return io.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?io.resolve(!0):bf(e).get(xo).next(t=>{if(null!==t&&this.rs(t.leaseTimestampMs,vf)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new li(hi.FAILED_PRECONDITION,If);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ef(e).J().next(e=>void 0===this.ss(e,vf).find(e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&ni(yf,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Do,aa],e=>{const t=new La(e,_o.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(e=>this.rs(e.updateTimeMs,t)&&!this.us(e.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Ef(e).J().next(e=>this.ss(e,wf).map(e=>e.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Cd.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new md(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Fl.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,n){ni(yf,"Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",s=18===(i=this.Ni)?Oa:17===i?Pa:16===i?xa:15===i?Da:14===i?Ra:13===i?Na:12===i?Aa:11===i?ka:void oi(60245);var i;let o;return this.Ui.runTransaction(e,r,s,r=>(o=new La(r,this.ci?this.ci.next():_o.ce),"readwrite-primary"===t?this.Hi(o).next(e=>!!e||this.Yi(o)).next(t=>{if(!t)throw ri(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new li(hi.FAILED_PRECONDITION,no);return n(o)}).next(e=>this.Xi(o).next(()=>e)):this.Is(o).next(()=>n(o)))).then(e=>(o.raiseOnCommittedEvent(),e))}Is(e){return bf(e).get(xo).next(e=>{if(null!==e&&this.rs(e.leaseTimestampMs,vf)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new li(hi.FAILED_PRECONDITION,If)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return bf(e).put(xo,t)}static v(){return co.v()}Zi(e){const t=bf(e);return t.get(xo).next(e=>this.es(e)?(ni(yf,"Releasing primary lease."),t.delete(xo)):io.resolve())}rs(e,t){const n=Date.now();return!(e<n-t||e>n&&(ri(`Detected an update time that is in the future: ${e} > ${n}`),1))}Gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground="visible"===this.document.visibilityState)}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){"function"==typeof this.window?.addEventListener&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;b()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=null!==this.Ki?.getItem(this._s(e));return ni(yf,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return ri(yf,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){ri("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch(e){}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function bf(e){return Ma(e,Do)}function Ef(e){return Ma(e,aa)}class Tf{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=Ku(),r=Ku();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new Tf(e,t.fromCache,n,r)}}class Sf{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Cf{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=b()?8:uo(v())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){const s={result:null};return this.ys(e,t).next(e=>{s.result=e}).next(()=>{if(!s.result)return this.ws(e,t,r,n).next(e=>{s.result=e})}).next(()=>{if(s.result)return;const n=new Sf;return this.Ss(e,t,n).next(r=>{if(s.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>s.result)}bs(e,t,n,r){return n.documentReadCount<this.fs?(ti()<=z.DEBUG&&ni("QueryEngine","SDK will not create cache indexes for query:",Nu(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),io.resolve()):(ti()<=z.DEBUG&&ni("QueryEngine","Query:",Nu(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(ti()<=z.DEBUG&&ni("QueryEngine","The SDK decides to create cache indexes for query:",Nu(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Tu(t))):io.resolve())}ys(e,t){if(_u(t))return io.resolve(null);let n=Tu(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=Cu(t,null,"F"),n=Tu(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const s=Ku(...r);return this.ps.getDocuments(e,s).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const i=this.Ds(t,r);return this.Cs(t,i,s,n.readTime)?this.ys(e,Cu(t,null,"F")):this.vs(e,i,t,n)}))})))}ws(e,t,n,r){return _u(t)||r.isEqual(Hi.min())?io.resolve(null):this.ps.getDocuments(e,n).next(s=>{const i=this.Ds(t,s);return this.Cs(t,i,n,r)?io.resolve(null):(ti()<=z.DEBUG&&ni("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Nu(t)),this.vs(e,i,t,function(e){const t=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,r=Hi.fromTimestamp(1e9===n?new Gi(t+1,0):new Gi(t,n));return new eo(r,Li.empty(),-1)}(r)).next(e=>e))})}Ds(e,t){let n=new za(Du(e));return t.forEach((t,r)=>{Ru(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ss(e,t,n){return ti()<=z.DEBUG&&ni("QueryEngine","Using full collection scan to execute query:",Nu(t)),this.ps.getDocumentsMatchingQuery(e,t,eo.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const kf="LocalStore";class Af{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new Ba(Ei),this.xs=new Pu(e=>fu(e),pu),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ef(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function Nf(e,t,n,r){return new Af(e,t,n,r)}async function Rf(e,t){const n=ui(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(s=>(r=s,n.Bs(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const s=[],i=[];let o=Ku();for(const e of r){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({Ls:e,removedBatchIds:s,addedBatchIds:i}))})})}function Df(e){const t=ui(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function xf(e,t){const n=ui(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=bo),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}async function Pf(e,t,n){const r=ui(e),s=r.Ms.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,e=>r.persistence.referenceDelegate.removeTarget(e,s))}catch(o){if(!fo(o))throw o;ni(kf,`Failed to update sequence numbers for target ${t}: ${o}`)}r.Ms=r.Ms.remove(t),r.xs.delete(s.target)}function Of(e,t,n){const r=ui(e);let s=Hi.min(),i=Ku();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const r=ui(e),s=r.xs.get(n);return void 0!==s?io.resolve(r.Ms.get(s)):r.Pi.getTargetData(t,n)}(r,e,Tu(t)).next(t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>r.Fs.getDocumentsMatchingQuery(e,t,n?s:Hi.min(),n?i:Ku())).next(e=>(function(e,t,n){let r=e.Os.get(t)||Hi.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Os.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Qs:i})))}class Lf{constructor(){this.activeTargetIds=$u}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Mf{constructor(){this.Mo=new Lf,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Lf,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Vf{Oo(e){}shutdown(){}}const Uf="ConnectivityMonitor";class Ff{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){ni(Uf,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){ni(Uf,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Bf=null;function jf(){return null===Bf?Bf=268435456+Math.round(2147483648*Math.random()):Bf++,"0x"+Bf.toString(16)}const qf="RestConnection",zf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Kf{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===ac?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,s){const i=jf(),o=this.zo(e,t.toUriEncodedString());ni(qf,`Sending RPC '${e}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,r,s);const{host:c}=new URL(o),u=f(c);return this.Jo(e,o,a,n,u).then(t=>(ni(qf,`Received RPC '${e}' ${i}: `,t),t),t=>{throw si(qf,`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",n),t})}Ho(e,t,n,r,s,i){return this.Go(e,t,n,r,s)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Zs,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){const n=zf[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class $f{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Gf="WebChannelConnection";class Hf extends Kf{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,s){const i=jf();return new Promise((s,o)=>{const a=new js;a.setWithCredentials(!0),a.listenOnce(zs.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Ks.NO_ERROR:const t=a.getResponseJson();ni(Gf,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case Ks.TIMEOUT:ni(Gf,`RPC '${e}' ${i} timed out`),o(new li(hi.DEADLINE_EXCEEDED,"Request time out"));break;case Ks.HTTP_ERROR:const n=a.getStatus();if(ni(Gf,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=e?.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(hi).indexOf(t)>=0?t:hi.UNKNOWN}(t.status);o(new li(e,t.message))}else o(new li(hi.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new li(hi.UNAVAILABLE,"Connection failed."));break;default:oi(9055,{l_:e,streamId:i,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{ni(Gf,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(r);ni(Gf,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)})}T_(e,t,n){const r=jf(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Ws(),o=Hs(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=s.join("");ni(Gf,`Creating RPC '${e}' stream ${r}: ${u}`,a);const h=i.createWebChannel(u,a);this.I_(h);let l=!1,d=!1;const f=new $f({Yo:t=>{d?ni(Gf,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(l||(ni(Gf,`Opening RPC '${e}' stream ${r} transport.`),h.open(),l=!0),ni(Gf,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},Zo:()=>h.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return p(h,qs.EventType.OPEN,()=>{d||(ni(Gf,`RPC '${e}' stream ${r} transport opened.`),f.o_())}),p(h,qs.EventType.CLOSE,()=>{d||(d=!0,ni(Gf,`RPC '${e}' stream ${r} transport closed`),f.a_(),this.E_(h))}),p(h,qs.EventType.ERROR,t=>{d||(d=!0,si(Gf,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),f.a_(new li(hi.UNAVAILABLE,"The operation could not be completed")))}),p(h,qs.EventType.MESSAGE,t=>{if(!d){const n=t.data[0];ci(!!n,16349);const s=n,i=s?.error||s[0]?.error;if(i){ni(Gf,`RPC '${e}' stream ${r} received error:`,i);const t=i.status;let n=function(e){const t=kh[e];if(void 0!==t)return Nh(t)}(t),s=i.message;void 0===n&&(n=hi.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),d=!0,f.a_(new li(n,s)),h.close()}else ni(Gf,`RPC '${e}' stream ${r} received:`,n),f.u_(n)}}),p(o,Gs.STAT_EVENT,t=>{t.stat===$s.PROXY?ni(Gf,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===$s.NOPROXY&&ni(Gf,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function Wf(){return"undefined"!=typeof document?document:null}function Qf(e){return new Hh(e,!0)}class Jf{constructor(e,t,n=1e3,r=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&ni("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Xf="PersistentStream";class Yf{constructor(e,t,n,r,s,i,o,a){this.Mi=e,this.S_=n,this.b_=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Jf(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===hi.RESOURCE_EXHAUSTED?(ri(t.toString()),ri("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===hi.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{const e=new li(hi.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return ni(Xf,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(ni(Xf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Zf extends Yf{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:oi(39313,{state:r}),i=t.targetChange.targetIds||[],o=function(e,t){return e.useProto3Json?(ci(void 0===t||"string"==typeof t,58123),Wa.fromBase64String(t||"")):(ci(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Wa.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,c=a&&function(e){const t=void 0===e.code?hi.UNKNOWN:Nh(e.code);return new li(t,e.message||"")}(a);n=new Fh(s,i,o,c||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=rl(e,r.document.name),i=Yh(r.document.updateTime),o=r.document.createTime?Yh(r.document.createTime):Hi.min(),a=new Uc({mapValue:{fields:r.document.fields}}),c=Bc.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new Vh(u,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=rl(e,r.document),i=r.readTime?Yh(r.readTime):Hi.min(),o=Bc.newNoDocument(s,i),a=r.removedTargetIds||[];n=new Vh([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=rl(e,r.document),i=r.removedTargetIds||[];n=new Vh([],i,s,null)}else{if(!("filter"in t))return oi(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:s}=e,i=new Ch(r,s),o=e.targetId;n=new Uh(o,i)}}var r;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Hi.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Hi.min():t.readTime?Yh(t.readTime):Hi.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=ol(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=mu(r)?{documents:ll(e,r)}:{query:dl(e,r).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Jh(e,t.resumeToken);const r=Wh(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(Hi.min())>0){n.readTime=Qh(e,t.snapshotVersion.toTimestamp());const r=Wh(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return oi(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=ol(this.serializer),t.removeTarget=e,this.q_(t)}}class ep extends Yf{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ci(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ci(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){ci(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(ci(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?Yh(e.updateTime):Yh(t);return n.isEqual(Hi.min())&&(n=Yh(t)),new ah(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Yh(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=ol(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>ul(this.serializer,e))};this.q_(t)}}class tp{}class np extends tp{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new li(hi.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.connection.Go(e,el(t,n),r,s,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===hi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new li(hi.UNKNOWN,e.toString())})}Ho(e,t,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Ho(e,el(t,n),r,i,o,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===hi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new li(hi.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class rp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ri(t),this.aa=!1):ni("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const sp="RemoteStore";class ip{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{pp(this)&&(ni(sp,"Restarting streams for network reachability change."),await async function(e){const t=ui(e);t.Ea.add(4),await ap(t),t.Ra.set("Unknown"),t.Ea.delete(4),await op(t)}(this))})}),this.Ra=new rp(n,r)}}async function op(e){if(pp(e))for(const t of e.da)await t(!0)}async function ap(e){for(const t of e.da)await t(!1)}function cp(e,t){const n=ui(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),fp(n)?dp(n):xp(n).O_()&&hp(n,t))}function up(e,t){const n=ui(e),r=xp(n);n.Ia.delete(t),r.O_()&&lp(n,t),0===n.Ia.size&&(r.O_()?r.L_():pp(n)&&n.Ra.set("Unknown"))}function hp(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Hi.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}xp(e).Y_(t)}function lp(e,t){e.Va.Ue(t),xp(e).Z_(t)}function dp(e){e.Va=new jh({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),xp(e).start(),e.Ra.ua()}function fp(e){return pp(e)&&!xp(e).x_()&&e.Ia.size>0}function pp(e){return 0===ui(e).Ea.size}function mp(e){e.Va=void 0}async function gp(e){e.Ra.set("Online")}async function yp(e){e.Ia.forEach((t,n)=>{hp(e,t)})}async function wp(e,t){mp(e),fp(e)?(e.Ra.ha(t),dp(e)):e.Ra.set("Unknown")}async function vp(e,t,n){if(e.Ra.set("Online"),t instanceof Fh&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(r){ni(sp,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await Ip(e,r)}else if(t instanceof Vh?e.Va.Ze(t):t instanceof Uh?e.Va.st(t):e.Va.tt(t),!n.isEqual(Hi.min()))try{const t=await Df(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Va.Tt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.Ia.get(r);s&&e.Ia.set(r,s.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(Wa.EMPTY_BYTE_STRING,r.snapshotVersion)),lp(e,t);const s=new El(r.target,t,n,r.sequenceNumber);hp(e,s)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(s){ni(sp,"Failed to raise snapshot:",s),await Ip(e,s)}}async function Ip(e,t,n){if(!fo(t))throw t;e.Ea.add(1),await ap(e),e.Ra.set("Offline"),n||(n=()=>Df(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{ni(sp,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await op(e)})}function _p(e,t){return t().catch(n=>Ip(e,n,t))}async function bp(e){const t=ui(e),n=Pp(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:bo;for(;Ep(t);)try{const e=await xf(t.localStore,r);if(null===e){0===t.Ta.length&&n.L_();break}r=e.batchId,Tp(t,e)}catch(s){await Ip(t,s)}Sp(t)&&Cp(t)}function Ep(e){return pp(e)&&e.Ta.length<10}function Tp(e,t){e.Ta.push(t);const n=Pp(e);n.O_()&&n.X_&&n.ea(t.mutations)}function Sp(e){return pp(e)&&!Pp(e).x_()&&e.Ta.length>0}function Cp(e){Pp(e).start()}async function kp(e){Pp(e).ra()}async function Ap(e){const t=Pp(e);for(const n of e.Ta)t.ea(n.mutations)}async function Np(e,t,n){const r=e.Ta.shift(),s=Th.from(r,t,n);await _p(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await bp(e)}async function Rp(e,t){t&&Pp(e).X_&&await async function(e,t){if(function(e){switch(e){case hi.OK:return oi(64938);case hi.CANCELLED:case hi.UNKNOWN:case hi.DEADLINE_EXCEEDED:case hi.RESOURCE_EXHAUSTED:case hi.INTERNAL:case hi.UNAVAILABLE:case hi.UNAUTHENTICATED:return!1;case hi.INVALID_ARGUMENT:case hi.NOT_FOUND:case hi.ALREADY_EXISTS:case hi.PERMISSION_DENIED:case hi.FAILED_PRECONDITION:case hi.ABORTED:case hi.OUT_OF_RANGE:case hi.UNIMPLEMENTED:case hi.DATA_LOSS:return!0;default:return oi(15467,{code:e})}}(n=t.code)&&n!==hi.ABORTED){const n=e.Ta.shift();Pp(e).B_(),await _p(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await bp(e)}var n}(e,t),Sp(e)&&Cp(e)}async function Dp(e,t){const n=ui(e);n.asyncQueue.verifyOperationInProgress(),ni(sp,"RemoteStore received new credentials");const r=pp(n);n.Ea.add(3),await ap(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await op(n)}function xp(e){return e.ma||(e.ma=function(e,t,n){const r=ui(e);return r.sa(),new Zf(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:gp.bind(null,e),t_:yp.bind(null,e),r_:wp.bind(null,e),H_:vp.bind(null,e)}),e.da.push(async t=>{t?(e.ma.B_(),fp(e)?dp(e):e.Ra.set("Unknown")):(await e.ma.stop(),mp(e))})),e.ma}function Pp(e){return e.fa||(e.fa=function(e,t,n){const r=ui(e);return r.sa(),new ep(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:kp.bind(null,e),r_:Rp.bind(null,e),ta:Ap.bind(null,e),na:Np.bind(null,e)}),e.da.push(async t=>{t?(e.fa.B_(),await bp(e)):(await e.fa.stop(),e.Ta.length>0&&(ni(sp,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class Op{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new di,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,o=new Op(e,t,i,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new li(hi.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Lp(e,t){if(ri("AsyncQueue",`${t}: ${e}`),fo(e))return new li(hi.UNAVAILABLE,`${t}: ${e}`);throw e}class Mp{static emptySet(e){return new Mp(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Li.comparator(t.key,n.key):(e,t)=>Li.comparator(e.key,t.key),this.keyedMap=Vu(),this.sortedSet=new Ba(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Mp))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Mp;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Vp{constructor(){this.ga=new Ba(Li.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):oi(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class Up{constructor(e,t,n,r,s,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,s){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new Up(e,t,Mp.emptySet(t),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ku(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Fp{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class Bp{constructor(){this.queries=jp(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=ui(e),r=n.queries;n.queries=jp(),r.forEach((e,n)=>{for(const r of n.Sa)r.onError(t)})}(this,new li(hi.ABORTED,"Firestore shutting down"))}}function jp(){return new Pu(e=>Au(e),ku)}async function qp(e,t){const n=ui(e);let r=3;const s=t.query;let i=n.queries.get(s);i?!i.ba()&&t.Da()&&(r=2):(i=new Fp,r=t.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const e=Lp(o,`Initialization of query '${Nu(t.query)}' failed`);return void t.onError(e)}n.queries.set(s,i),i.Sa.push(t),t.va(n.onlineState),i.wa&&t.Fa(i.wa)&&Gp(n)}async function zp(e,t){const n=ui(e),r=t.query;let s=3;const i=n.queries.get(r);if(i){const e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?s=t.Da()?0:1:!i.ba()&&t.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Kp(e,t){const n=ui(e);let r=!1;for(const s of t){const e=s.query,t=n.queries.get(e);if(t){for(const e of t.Sa)e.Fa(s)&&(r=!0);t.wa=s}}r&&Gp(n)}function $p(e,t,n){const r=ui(e),s=r.queries.get(t);if(s)for(const i of s.Sa)i.onError(n);r.queries.delete(t)}function Gp(e){e.Ca.forEach(e=>{e.next()})}var Hp,Wp;(Wp=Hp||(Hp={})).Ma="default",Wp.Cache="cache";class Qp{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Up(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=Up.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Hp.Cache}}class Jp{constructor(e){this.key=e}}class Xp{constructor(e){this.key=e}}class Yp{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ku(),this.mutatedKeys=Ku(),this.eu=Du(e),this.tu=new Mp(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new Vp,r=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const u=r.get(e),h=Ru(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.su(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.eu(h,a)>0||c&&this.eu(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(e):s.delete(e)):(i=i.delete(e),s=s.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{tu:i,iu:n,Cs:o,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const i=e.iu.ya();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return oi(20277,{Rt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),r=r??!1;const o=t&&!r?this._u():[],a=0===this.Xa.size&&this.current&&!r?1:0,c=a!==this.Za;return this.Za=a,0!==i.length||c?{snapshot:new Up(this.query,e.tu,s,i,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Vp,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ku(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new Xp(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new Jp(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=Ku();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Up.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const Zp="SyncEngine";class em{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class tm{constructor(e){this.key=e,this.hu=!1}}class nm{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new Pu(e=>Au(e),ku),this.Iu=new Map,this.Eu=new Set,this.du=new Ba(Li.comparator),this.Au=new Map,this.Ru=new sf,this.Vu={},this.mu=new Map,this.fu=Dd.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function rm(e,t,n=!0){const r=Em(e);let s;const i=r.Tu.get(t);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await im(r,t,n,!0),s}async function sm(e,t){const n=Em(e);await im(n,t,!0,!1)}async function im(e,t,n,r){const s=await function(e,t){const n=ui(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.Pi.getTargetData(e,t).next(s=>s?(r=s,io.resolve(r)):n.Pi.allocateTargetId(e).next(s=>(r=new El(t,s,"TargetPurposeListen",e.currentSequenceNumber),n.Pi.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.Ms.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(t,e.targetId)),e})}(e.localStore,Tu(t)),i=s.targetId,o=e.sharedClientState.addLocalQueryTarget(i,n);let a;return r&&(a=await async function(e,t,n,r,s){e.pu=(t,n,r)=>async function(e,t,n,r){let s=t.view.ru(n);s.Cs&&(s=await Of(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,s)));const i=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(s,e.isPrimaryClient,i,o);return ym(e,t.targetId,a.au),a.snapshot}(e,t,n,r);const i=await Of(e.localStore,t,!0),o=new Yp(t,i.Qs),a=o.ru(i.documents),c=Mh.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,s),u=o.applyChanges(a,e.isPrimaryClient,c);ym(e,n,u.au);const h=new em(t,n,o);return e.Tu.set(t,h),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),u.snapshot}(e,t,i,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&cp(e.remoteStore,s),a}async function om(e,t,n){const r=ui(e),s=r.Tu.get(t),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(e=>!ku(e,t))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Pf(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&up(r.remoteStore,s.targetId),mm(r,s.targetId)}).catch(so)):(mm(r,s.targetId),await Pf(r.localStore,s.targetId,!0))}async function am(e,t){const n=ui(e),r=n.Tu.get(t),s=n.Iu.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),up(n.remoteStore,r.targetId))}async function cm(e,t){const n=ui(e);try{const e=await function(e,t){const n=ui(e),r=t.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const o=[];t.targetChanges.forEach((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Pi.removeMatchingKeys(e,i.removedDocuments,a).next(()=>n.Pi.addMatchingKeys(e,i.addedDocuments,a)));let u=c.withSequenceNumber(e.currentSequenceNumber);var h,l,d;null!==t.targetMismatches.get(a)?u=u.withResumeToken(Wa.EMPTY_BYTE_STRING,Hi.min()).withLastLimboFreeSnapshotVersion(Hi.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),l=u,d=i,(0===(h=c).resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-h.snapshotVersion.toMicroseconds()>=3e8||d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0)&&o.push(n.Pi.updateTargetData(e,u))});let a=Lu(),c=Ku();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(function(e,t,n){let r=Ku(),s=Ku();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=Lu();return n.forEach((n,i)=>{const o=e.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(Hi.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):ni(kf,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)}),{ks:r,qs:s}})}(e,i,t.documentUpdates).next(e=>{a=e.ks,c=e.qs})),!r.isEqual(Hi.min())){const t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return io.waitFor(o).next(()=>i.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,c)).next(()=>a)}).then(e=>(n.Ms=s,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Au.get(t);r&&(ci(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.hu=!0:e.modifiedDocuments.size>0?ci(r.hu,14607):e.removedDocuments.size>0&&(ci(r.hu,42227),r.hu=!1))}),await Im(n,e,t)}catch(r){await so(r)}}function um(e,t,n){const r=ui(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Tu.forEach((n,r)=>{const s=r.view.va(t);s.snapshot&&e.push(s.snapshot)}),function(e,t){const n=ui(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const s of n.Sa)s.va(t)&&(r=!0)}),r&&Gp(n)}(r.eventManager,t),e.length&&r.Pu.H_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function hm(e,t,n){const r=ui(e);r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.Au.get(t),i=s&&s.key;if(i){let e=new Ba(Li.comparator);e=e.insert(i,Bc.newNoDocument(i,Hi.min()));const n=Ku().add(i),s=new Lh(Hi.min(),new Map,new Ba(Ei),e,n);await cm(r,s),r.du=r.du.remove(i),r.Au.delete(t),vm(r)}else await Pf(r.localStore,t,!1).then(()=>mm(r,t,n)).catch(so)}async function lm(e,t){const n=ui(e),r=t.batch.batchId;try{const e=await function(e,t){const n=ui(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),s=n.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const s=n.batch,i=s.keys();let o=io.resolve();return i.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const i=n.docVersions.get(e);ci(null!==i,48541),t.version.compareTo(i)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(n,e,t,s).next(()=>s.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Ku();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);pm(n,r,null),fm(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Im(n,e)}catch(s){await so(s)}}async function dm(e,t,n){const r=ui(e);try{const e=await function(e,t){const n=ui(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(ci(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);pm(r,t,n),fm(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Im(r,e)}catch(s){await so(s)}}function fm(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function pm(e,t,n){const r=ui(e);let s=r.Vu[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.Vu[r.currentUser.toKey()]=s}}function mm(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Iu.get(t))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||gm(e,t)})}function gm(e,t){e.Eu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(up(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),vm(e))}function ym(e,t,n){for(const r of n)r instanceof Jp?(e.Ru.addReference(r.key,t),wm(e,r)):r instanceof Xp?(ni(Zp,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||gm(e,r.key)):oi(19791,{wu:r})}function wm(e,t){const n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(ni(Zp,"New document in limbo: "+n),e.Eu.add(r),vm(e))}function vm(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new Li(xi.fromString(t)),r=e.fu.next();e.Au.set(r,new tm(n)),e.du=e.du.insert(n,r),cp(e.remoteStore,new El(Tu(Iu(n.path)),r,"TargetPurposeLimboResolution",_o.ce))}}async function Im(e,t,n){const r=ui(e),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((e,a)=>{o.push(r.pu(a,t,n).then(e=>{if((e||n)&&r.isPrimaryClient){const t=e?!e.fromCache:n?.targetChanges.get(a.targetId)?.current;r.sharedClientState.updateQueryState(a.targetId,t?"current":"not-current")}if(e){s.push(e);const t=Tf.As(a.targetId,e);i.push(t)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(e,t){const n=ui(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>io.forEach(t,t=>io.forEach(t.Es,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>io.forEach(t.ds,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(r){if(!fo(r))throw r;ni(kf,"Failed to update sequence numbers: "+r)}for(const s of t){const e=s.targetId;if(!s.fromCache){const t=n.Ms.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(e,s)}}}(r.localStore,i))}async function _m(e,t){const n=ui(e);if(!n.currentUser.isEqual(t)){ni(Zp,"User change. New user:",t.toKey());const e=await Rf(n.localStore,t);n.currentUser=t,(r=n).mu.forEach(e=>{e.forEach(e=>{e.reject(new li(hi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.mu.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Im(n,e.Ls)}var r}function bm(e,t){const n=ui(e),r=n.Au.get(t);if(r&&r.hu)return Ku().add(r.key);{let e=Ku();const r=n.Iu.get(t);if(!r)return e;for(const t of r){const r=n.Tu.get(t);e=e.unionWith(r.view.nu)}return e}}function Em(e){const t=ui(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=cm.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=bm.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=hm.bind(null,t),t.Pu.H_=Kp.bind(null,t.eventManager),t.Pu.yu=$p.bind(null,t.eventManager),t}function Tm(e){const t=ui(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=lm.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=dm.bind(null,t),t}class Sm{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Qf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Nf(this.persistence,new Cf,e.initialUser,this.serializer)}Cu(e){return new lf(ff.mi,this.serializer)}Du(e){return new Mf}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Sm.provider={build:()=>new Sm};class Cm extends Sm{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ci(this.persistence.referenceDelegate instanceof pf,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Fd(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Ed.withCacheSize(this.cacheSizeBytes):Ed.DEFAULT;return new lf(e=>pf.mi(e,t),this.serializer)}}class km extends Sm{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Tm(this.xu.syncEngine),await bp(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return Nf(this.persistence,new Cf,e.initialUser,this.serializer)}Fu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Fd(n,e.asyncQueue,t)}Mu(e,t){const n=new Io(t,this.persistence);return new vo(e.asyncQueue,n)}Cu(e){const t=function(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ed.withCacheSize(this.cacheSizeBytes):Ed.DEFAULT;return new _f(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,"undefined"!=typeof window?window:null,Wf(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new Mf}}class Am{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>um(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=_m.bind(null,this.syncEngine),await async function(e,t){const n=ui(e);t?(n.Ea.delete(2),await op(n)):t||(n.Ea.add(2),await ap(n),n.Ra.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Bp}createDatastore(e){const t=Qf(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new Hf(r));var r;return function(e,t,n,r){return new np(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,s=e=>um(this.syncEngine,e,0),i=Ff.v()?new Ff:new Vf,new ip(t,n,r,s,i);var t,n,r,s,i}createSyncEngine(e,t){return function(e,t,n,r,s,i,o){const a=new nm(e,t,n,r,s,i);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){const t=ui(e);ni(sp,"RemoteStore shutting down."),t.Ea.add(5),await ap(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Am.provider={build:()=>new Am};class Nm{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ri("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const Rm="FirestoreClient";class Dm{constructor(e,t,n,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Ys.UNAUTHENTICATED,this.clientId=bi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,async e=>{ni(Rm,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(ni(Rm,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new di;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Lp(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function xm(e,t){e.asyncQueue.verifyOperationInProgress(),ni(Rm,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await Rf(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function Pm(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){ni(Rm,"Using user provided OfflineComponentProvider");try{await xm(e,e._uninitializedComponentsProvider._offline)}catch(t){const s=t;if(!("FirebaseError"===(n=s).name?n.code===hi.FAILED_PRECONDITION||n.code===hi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw s;si("Error using user provided cache. Falling back to memory cache: "+s),await xm(e,new Sm)}}else ni(Rm,"Using default OfflineComponentProvider"),await xm(e,new Cm(void 0));var n;return e._offlineComponents}(e);ni(Rm,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>Dp(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>Dp(t.remoteStore,n)),e._onlineComponents=t}async function Om(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(ni(Rm,"Using user provided OnlineComponentProvider"),await Pm(e,e._uninitializedComponentsProvider._online)):(ni(Rm,"Using default OnlineComponentProvider"),await Pm(e,new Am))),e._onlineComponents}async function Lm(e){const t=await Om(e),n=t.eventManager;return n.onListen=rm.bind(null,t.syncEngine),n.onUnlisten=om.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=sm.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=am.bind(null,t.syncEngine),n}function Mm(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Vm=new Map,Um="firestore.googleapis.com",Fm=!0;class Bm{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new li(hi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Um,this.ssl=Fm}else this.host=e.host,this.ssl=e.ssl??Fm;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=bd;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new li(hi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new li(hi.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Mm(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new li(hi.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new li(hi.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new li(hi.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class jm{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Bm({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new li(hi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new li(hi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Bm(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new pi;switch(e.type){case"firstParty":return new wi(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new li(hi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Vm.get(e);t&&(ni("ComponentProvider","Removing Datastore"),Vm.delete(e),t.terminate())}(this),Promise.resolve()}}class qm{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new qm(this.firestore,e,this._query)}}class zm{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Km(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new zm(this.firestore,e,this._key)}toJSON(){return{type:zm._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(zi(t,zm._jsonSchema))return new zm(e,n||null,new Li(xi.fromString(t.referencePath)))}}zm._jsonSchemaVersion="firestore/documentReference/1.0",zm._jsonSchema={type:qi("string",zm._jsonSchemaVersion),referencePath:qi("string")};class Km extends qm{constructor(e,t,n){super(e,t,Iu(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new zm(this.firestore,null,new Li(e))}withConverter(e){return new Km(this.firestore,e,this._path)}}function $m(e,t,...n){if(e=U(e),Mi("collection","path",t),e instanceof jm){const r=xi.fromString(t,...n);return Ui(r),new Km(e,null,r)}{if(!(e instanceof zm||e instanceof Km))throw new li(hi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(xi.fromString(t,...n));return Ui(r),new Km(e.firestore,null,r)}}function Gm(e,t,...n){if(e=U(e),1===arguments.length&&(t=bi.newId()),Mi("doc","path",t),e instanceof jm){const r=xi.fromString(t,...n);return Vi(r),new zm(e,null,new Li(r))}{if(!(e instanceof zm||e instanceof Km))throw new li(hi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(xi.fromString(t,...n));return Vi(r),new zm(e.firestore,e instanceof Km?e.converter:null,new Li(r))}}const Hm="AsyncQueue";class Wm{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Jf(this,"async_queue_retry"),this._c=()=>{const e=Wf();e&&ni(Hm,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=Wf();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Wf();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new di;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!fo(e))throw e;ni(Hm,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,ri("INTERNAL UNHANDLED ERROR: ",Qm(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=Op.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&oi(47125,{Pc:Qm(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Qm(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function Jm(e){return function(e){if("object"!=typeof e||null===e)return!1;const t=e;for(const n of["next","error","complete"])if(n in t&&"function"==typeof t[n])return!0;return!1}(e)}class Xm extends jm{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Wm,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Wm(e),this._firestoreClient=void 0,await e}}}function Ym(e,t){const n="object"==typeof e?e:rt(),r="string"==typeof e?e:ac,s=Xe(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const e=u("firestore");e&&function(e,t,n,r={}){e=ji(e,jm);const s=f(t),i=e._getSettings(),o={...i,emulatorOptions:e._getEmulatorOptions()},a=`${t}:${n}`;s&&(p(`https://${a}`),w("Firestore",!0)),i.host!==Um&&i.host!==a&&si("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:a,ssl:s,emulatorOptions:r};if(!R(c,o)&&(e._setSettings(c),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Ys.MOCK_USER;else{t=m(r.mockUserToken,e._app?.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new li(hi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ys(s)}e._authCredentials=new mi(new fi(t,n))}}(s,...e)}return s}function Zm(e){if(e._terminated)throw new li(hi.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||eg(e),e._firestoreClient}function eg(e){const t=e._freezeSettings(),n=(r=e._databaseId,s=e._app?.options.appId||"",i=e._persistenceKey,new oc(r,s,i,(o=t).host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,Mm(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator));var r,s,i,o;e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new Dm(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&function(e){const t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}function tg(e,t){si("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings();return function(e,t,n){if((e=ji(e,Xm))._firestoreClient||e._terminated)throw new li(hi.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new li(hi.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},eg(e)}(e,Am.provider,{build:e=>new km(e,n.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}class ng{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ng(Wa.fromBase64String(e))}catch(t){throw new li(hi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ng(Wa.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ng._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(zi(e,ng._jsonSchema))return ng.fromBase64String(e.bytes)}}ng._jsonSchemaVersion="firestore/bytes/1.0",ng._jsonSchema={type:qi("string",ng._jsonSchemaVersion),bytes:qi("string")};class rg{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new li(hi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Oi(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class sg{constructor(e){this._methodName=e}}class ig{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new li(hi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new li(hi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ei(this._lat,e._lat)||Ei(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ig._jsonSchemaVersion}}static fromJSON(e){if(zi(e,ig._jsonSchema))return new ig(e.latitude,e.longitude)}}ig._jsonSchemaVersion="firestore/geoPoint/1.0",ig._jsonSchema={type:qi("string",ig._jsonSchemaVersion),latitude:qi("number"),longitude:qi("number")};class og{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:og._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(zi(e,og._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new og(e.vectorValues);throw new li(hi.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}og._jsonSchemaVersion="firestore/vectorValue/1.0",og._jsonSchema={type:qi("string",og._jsonSchemaVersion),vectorValues:qi("object")};const ag=/^__.*__$/;class cg{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new yh(e,this.data,this.fieldMask,t,this.fieldTransforms):new gh(e,this.data,t,this.fieldTransforms)}}class ug{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new yh(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function hg(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw oi(40011,{Ac:e})}}class lg{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new lg({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Tg(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(hg(this.Ac)&&ag.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class dg{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Qf(e)}Cc(e,t,n,r=!1){return new lg({Ac:e,methodName:t,Dc:n,path:Oi.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fg(e){const t=e._freezeSettings(),n=Qf(e._databaseId);return new dg(e._databaseId,!!t.ignoreUndefinedProperties,n)}function pg(e,t,n,r,s,i={}){const o=e.Cc(i.merge||i.mergeFields?2:0,t,n,s);Ig("Data must be an object, but it was:",o,r);const a=wg(r,o);let c,u;if(i.merge)c=new Ga(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const s=_g(t,r,n);if(!o.contains(s))throw new li(hi.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Sg(e,s)||e.push(s)}c=new Ga(e),u=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,u=o.fieldTransforms;return new cg(new Uc(a),c,u)}class mg extends sg{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof mg}}class gg extends sg{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=function(e,t){return new lg({Ac:3,Dc:t.settings.Dc,methodName:e._methodName,fc:!0},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}(this,e),n=this.vc.map(e=>yg(e,t)),r=new Zu(n);return new oh(e.path,r)}isEqual(e){return e instanceof gg&&R(this.vc,e.vc)}}function yg(e,t){if(vg(e=U(e)))return Ig("Unsupported field value:",t,e),wg(e,t);if(e instanceof sg)return function(e,t){if(!hg(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const s of e){let e=yg(s,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=U(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return function(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!To(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?Hu(t):Gu(e,t)}(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Gi.fromDate(e);return{timestampValue:Qh(t.serializer,n)}}if(e instanceof Gi){const n=new Gi(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Qh(t.serializer,n)}}if(e instanceof ig)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof ng)return{bytesValue:Jh(t.serializer,e._byteString)};if(e instanceof zm){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Zh(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof og)return n=e,r=t,{mapValue:{fields:{[uc]:{stringValue:dc},[fc]:{arrayValue:{values:n.toArray().map(e=>{if("number"!=typeof e)throw r.Sc("VectorValues must only contain numeric values.");return Gu(r.serializer,e)})}}}}};var n,r;throw t.Sc(`Unsupported field value: ${Bi(e)}`)}(e,t)}function wg(e,t){const n={};return Fa(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ua(e,(e,r)=>{const s=yg(r,t.mc(e));null!=s&&(n[e]=s)}),{mapValue:{fields:n}}}function vg(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Gi||e instanceof ig||e instanceof ng||e instanceof zm||e instanceof sg||e instanceof og)}function Ig(e,t,n){if(!vg(n)||!Fi(n)){const r=Bi(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function _g(e,t,n){if((t=U(t))instanceof rg)return t._internalPath;if("string"==typeof t)return Eg(e,t);throw Tg("Field path arguments must be of type string or ",e,!1,void 0,n)}const bg=new RegExp("[~\\*/\\[\\]]");function Eg(e,t,n){if(t.search(bg)>=0)throw Tg(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new rg(...t.split("."))._internalPath}catch(r){throw Tg(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Tg(e,t,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new li(hi.INVALID_ARGUMENT,a+e+c)}function Sg(e,t){return e.some(e=>e.isEqual(t))}class Cg{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new zm(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new kg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ag("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class kg extends Cg{data(){return super.data()}}function Ag(e,t){return"string"==typeof t?Eg(e,t):t instanceof rg?t._internalPath:t._delegate._internalPath}function Ng(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new li(hi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Rg{}class Dg extends Rg{}function xg(e,t,...n){let r=[];t instanceof Rg&&r.push(t),r=r.concat(n),function(e){const t=e.filter(e=>e instanceof Lg).length,n=e.filter(e=>e instanceof Pg).length;if(t>1||t>0&&n>0)throw new li(hi.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)e=s._apply(e);return e}class Pg extends Dg{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Pg(e,t,n)}_apply(e){const t=this._parse(e);return Ug(e._query,t),new qm(e.firestore,e.converter,Su(e._query,t))}_parse(e){const t=fg(e.firestore),n=function(e,t,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new li(hi.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){Vg(o,i);const t=[];for(const n of o)t.push(Mg(r,e,n));a={arrayValue:{values:t}}}else a=Mg(r,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Vg(o,i),a=function(e,t,n,r=!1){return yg(n,e.Cc(r?4:3,t))}(n,"where",o,"in"===i||"not-in"===i);return Hc.create(s,i,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function Og(e,t,n){const r=t,s=Ag("where",e);return Pg._create(s,r,n)}class Lg extends Rg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Lg(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:Wc.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const s of r)Ug(n,s),n=Su(n,s)}(e._query,t),new qm(e.firestore,e.converter,Su(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Mg(e,t,n){if("string"==typeof(n=U(n))){if(""===n)throw new li(hi.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bu(t)&&-1!==n.indexOf("/"))throw new li(hi.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(xi.fromString(n));if(!Li.isDocumentKey(r))throw new li(hi.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Tc(e,new Li(r))}if(n instanceof zm)return Tc(e,n._key);throw new li(hi.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Bi(n)}.`)}function Vg(e,t){if(!Array.isArray(e)||0===e.length)throw new li(hi.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Ug(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new li(hi.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new li(hi.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class Fg{convertValue(e,t="none"){switch(mc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Xa(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ya(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw oi(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Ua(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){const t=e.fields?.[fc].arrayValue?.values?.map(e=>Xa(e.doubleValue));return new og(t)}convertGeoPoint(e){return new ig(Xa(e.latitude),Xa(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=sc(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ic(e));default:return null}}convertTimestamp(e){const t=Ja(e);return new Gi(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=xi.fromString(e);ci(bl(n),9688,{name:e});const r=new cc(n.get(1),n.get(3)),s=new Li(n.popFirst(5));return r.isEqual(t)||ri(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Bg(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class jg{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class qg extends Cg{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new zg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Ag("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new li(hi.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=qg._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}qg._jsonSchemaVersion="firestore/documentSnapshot/1.0",qg._jsonSchema={type:qi("string",qg._jsonSchemaVersion),bundleSource:qi("string","DocumentSnapshot"),bundleName:qi("string"),bundle:qi("string")};class zg extends qg{data(e={}){return super.data(e)}}class Kg{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new jg(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new zg(this._firestore,this._userDataWriter,n.key,n,new jg(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new li(hi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new zg(e._firestore,e._userDataWriter,n.doc.key,n.doc,new jg(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new zg(e._firestore,e._userDataWriter,t.doc.key,t.doc,new jg(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,i=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:$g(t.type),doc:r,oldIndex:s,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new li(hi.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Kg._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=bi.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function $g(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return oi(61501,{type:e})}}function Gg(e){e=ji(e,zm);const t=ji(e.firestore,Xm);return function(e,t,n={}){const r=new di;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,s){const i=new Nm({next:a=>{i.Nu(),t.enqueueAndForget(()=>zp(e,o));const c=a.docs.has(n);!c&&a.fromCache?s.reject(new li(hi.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?s.reject(new li(hi.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(a)},error:e=>s.reject(e)}),o=new Qp(Iu(n.path),i,{includeMetadataChanges:!0,qa:!0});return qp(e,o)}(await Lm(e),e.asyncQueue,t,n,r)),r.promise}(Zm(t),e._key).then(n=>ty(t,e,n))}Kg._jsonSchemaVersion="firestore/querySnapshot/1.0",Kg._jsonSchema={type:qi("string",Kg._jsonSchemaVersion),bundleSource:qi("string","QuerySnapshot"),bundleName:qi("string"),bundle:qi("string")};class Hg extends Fg{constructor(e){super(),this.firestore=e}convertBytes(e){return new ng(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new zm(this.firestore,null,t)}}function Wg(e){e=ji(e,qm);const t=ji(e.firestore,Xm),n=Zm(t),r=new Hg(t);return Ng(e._query),function(e,t,n={}){const r=new di;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,s){const i=new Nm({next:n=>{i.Nu(),t.enqueueAndForget(()=>zp(e,o)),n.fromCache&&"server"===r.source?s.reject(new li(hi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),o=new Qp(n,i,{includeMetadataChanges:!0,qa:!0});return qp(e,o)}(await Lm(e),e.asyncQueue,t,n,r)),r.promise}(n,e._query).then(n=>new Kg(t,r,e,n))}function Qg(e,t,n){e=ji(e,zm);const r=ji(e.firestore,Xm),s=Bg(e.converter,t,n);return ey(r,[pg(fg(r),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,ch.none())])}function Jg(e,t,n,...r){e=ji(e,zm);const s=ji(e.firestore,Xm),i=fg(s);let o;return o="string"==typeof(t=U(t))||t instanceof rg?function(e,t,n,r,s,i){const o=e.Cc(1,t,n),a=[_g(t,r,n)],c=[s];if(i.length%2!=0)throw new li(hi.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<i.length;d+=2)a.push(_g(t,i[d])),c.push(i[d+1]);const u=[],h=Uc.empty();for(let d=a.length-1;d>=0;--d)if(!Sg(u,a[d])){const e=a[d];let t=c[d];t=U(t);const n=o.yc(e);if(t instanceof mg)u.push(e);else{const r=yg(t,n);null!=r&&(u.push(e),h.set(e,r))}}const l=new Ga(u);return new ug(h,l,o.fieldTransforms)}(i,"updateDoc",e._key,t,n,r):function(e,t,n,r){const s=e.Cc(1,t,n);Ig("Data must be an object, but it was:",s,r);const i=[],o=Uc.empty();Ua(r,(e,r)=>{const a=Eg(t,e,n);r=U(r);const c=s.yc(a);if(r instanceof mg)i.push(a);else{const e=yg(r,c);null!=e&&(i.push(a),o.set(a,e))}});const a=new Ga(i);return new ug(o,a,s.fieldTransforms)}(i,"updateDoc",e._key,t),ey(s,[o.toMutation(e._key,ch.exists(!0))])}function Xg(e){return ey(ji(e.firestore,Xm),[new _h(e._key,ch.none())])}function Yg(e,t){const n=ji(e.firestore,Xm),r=Gm(e),s=Bg(e.converter,t);return ey(n,[pg(fg(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,ch.exists(!1))]).then(()=>r)}function Zg(e,...t){e=U(e);let n={includeMetadataChanges:!1,source:"default"},r=0;"object"!=typeof t[r]||Jm(t[r])||(n=t[r++]);const s={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(Jm(t[r])){const e=t[r];t[r]=e.next?.bind(e),t[r+1]=e.error?.bind(e),t[r+2]=e.complete?.bind(e)}let i,o,a;if(e instanceof zm)o=ji(e.firestore,Xm),a=Iu(e._key.path),i={next:n=>{t[r]&&t[r](ty(o,e,n))},error:t[r+1],complete:t[r+2]};else{const n=ji(e,qm);o=ji(n.firestore,Xm),a=n._query;const s=new Hg(o);i={next:e=>{t[r]&&t[r](new Kg(o,s,n,e))},error:t[r+1],complete:t[r+2]},Ng(e._query)}return function(e,t,n,r){const s=new Nm(r),i=new Qp(t,s,n);return e.asyncQueue.enqueueAndForget(async()=>qp(await Lm(e),i)),()=>{s.Nu(),e.asyncQueue.enqueueAndForget(async()=>zp(await Lm(e),i))}}(Zm(o),a,s,i)}function ey(e,t){return function(e,t){const n=new di;return e.asyncQueue.enqueueAndForget(async()=>async function(t,n,r){const s=Tm(t);try{const e=await function(e,t){const n=ui(e),r=Gi.now(),s=t.reduce((e,t)=>e.add(t.key),Ku());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=Lu(),c=Ku();return n.Ns.getEntries(e,s).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(s=>{i=s;const o=[];for(const e of t){const t=ph(e,i.get(e.key).overlayedDocument);null!=t&&o.push(new yh(e.key,t,Fc(t.value.mapValue),ch.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)}).next(t=>{o=t;const r=t.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:o.batchId,changes:Uu(i)}))}(s.localStore,n);s.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Vu[e.currentUser.toKey()];r||(r=new Ba(Ei)),r=r.insert(t,n),e.Vu[e.currentUser.toKey()]=r}(s,e.batchId,r),await Im(s,e.changes),await bp(s.remoteStore)}catch(e){const n=Lp(e,"Failed to persist write");r.reject(n)}}(await function(e){return Om(e).then(e=>e.syncEngine)}(e),t,n)),n.promise}(Zm(e),t)}function ty(e,t,n){const r=n.docs.get(t._key),s=new Hg(e);return new qg(e,s,t._key,r,new jg(n.hasPendingWrites,n.fromCache),t.converter)}function ny(...e){return new gg("arrayUnion",e)}!function(e,t=!0){Zs=tt,Je(new F("firestore",(e,{instanceIdentifier:n,options:r})=>{const s=e.getProvider("app").getImmediate(),i=new Xm(new gi(e.getProvider("auth-internal")),new Ii(s,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new li(hi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new cc(e.options.projectId,t)}(s,n),s);return r={useFetchStreams:t,...r},i._setSettings(r),i},"PUBLIC").setMultipleInstances(!0)),ot(Js,Xs,e),ot(Js,Xs,"esm2020")}();const ry="firebasestorage.googleapis.com",sy="storageBucket";class iy extends k{constructor(e,t,n=0){super(hy(e),`Firebase Storage: ${t} (${hy(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,iy.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return hy(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var oy,ay,cy,uy;function hy(e){return"storage/"+e}function ly(){return new iy(oy.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function dy(e){return new iy(oy.INVALID_ARGUMENT,e)}function fy(){return new iy(oy.APP_DELETED,"The Firebase app was deleted.")}function py(e,t){return new iy(oy.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function my(e){throw new iy(oy.INTERNAL_ERROR,"Internal error: "+e)}(ay=oy||(oy={})).UNKNOWN="unknown",ay.OBJECT_NOT_FOUND="object-not-found",ay.BUCKET_NOT_FOUND="bucket-not-found",ay.PROJECT_NOT_FOUND="project-not-found",ay.QUOTA_EXCEEDED="quota-exceeded",ay.UNAUTHENTICATED="unauthenticated",ay.UNAUTHORIZED="unauthorized",ay.UNAUTHORIZED_APP="unauthorized-app",ay.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",ay.INVALID_CHECKSUM="invalid-checksum",ay.CANCELED="canceled",ay.INVALID_EVENT_NAME="invalid-event-name",ay.INVALID_URL="invalid-url",ay.INVALID_DEFAULT_BUCKET="invalid-default-bucket",ay.NO_DEFAULT_BUCKET="no-default-bucket",ay.CANNOT_SLICE_BLOB="cannot-slice-blob",ay.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",ay.NO_DOWNLOAD_URL="no-download-url",ay.INVALID_ARGUMENT="invalid-argument",ay.INVALID_ARGUMENT_COUNT="invalid-argument-count",ay.APP_DELETED="app-deleted",ay.INVALID_ROOT_OPERATION="invalid-root-operation",ay.INVALID_FORMAT="invalid-format",ay.INTERNAL_ERROR="internal-error",ay.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class gy{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=gy.makeFromUrl(e,t)}catch(s){return new gy(e,"")}if(""===n.path)return n;throw r=e,new iy(oy.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)",s=new RegExp("^gs://"+r+"(/(.*))?$","i");function i(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:s,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp(`^https?://${t===ry?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:i}];for(let c=0;c<a.length;c++){const t=a[c],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let s=r[t.indices.path];s||(s=""),n=new gy(e,s),t.postModify(n);break}}if(null==n)throw function(e){return new iy(oy.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class yy{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function wy(e){return"string"==typeof e||e instanceof String}function vy(e){return Iy()&&e instanceof Blob}function Iy(){return"undefined"!=typeof Blob}function _y(e,t,n,r){if(r<t)throw dy(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw dy(`Invalid value for '${e}'. Expected ${n} or less.`)}function by(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function Ey(e){const t=encodeURIComponent;let n="?";for(const r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n=n.slice(0,-1),n}(uy=cy||(cy={}))[uy.NO_ERROR=0]="NO_ERROR",uy[uy.NETWORK_ERROR=1]="NETWORK_ERROR",uy[uy.ABORT=2]="ABORT";class Ty{constructor(e,t,n,r,s,i,o,a,c,u,h,l=!0,d=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=i,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.retry=l,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{const n=this.resolve_,r=this.reject_,s=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(s,s.getResponse());void 0===e?n():n(e)}catch(i){r(i)}else if(null!==s){const e=ly();e.serverResponse=s.getErrorText(),this.errorCallback_?r(this.errorCallback_(s,e)):r(e)}else t.canceled?r(this.appDelete_?fy():new iy(oy.CANCELED,"User canceled the upload/download.")):r(new iy(oy.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?e(0,new Sy(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,s=null,i=null,o=!1,a=0;function c(){return 2===a}let u=!1;function h(...e){u||(u=!0,t.apply(null,e))}function l(t){s=setTimeout(()=>{s=null,e(f,c())},t)}function d(){i&&clearTimeout(i)}function f(e,...t){if(u)return void d();if(e)return d(),void h.call(null,e,...t);if(c()||o)return d(),void h.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),l(n)}let p=!1;function m(e){p||(p=!0,d(),u||(null!==s?(e||(a=2),clearTimeout(s),l(0)):e||(a=1)))}return l(0),i=setTimeout(()=>{o=!0,m(!0)},n),m}((e,t)=>{if(t)return void e(!1,new Sy(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===cy.NO_ERROR,s=n.getStatus();if(!t||function(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),s=-1!==t.indexOf(e);return n||r||s}(s,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===cy.ABORT;return void e(!1,new Sy(!1,null,t))}const i=-1!==this.successCodes_.indexOf(s);e(!0,new Sy(i,n))})},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Sy{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function Cy(...e){const t="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(Iy())return new Blob(e);throw new iy(oy.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const ky="base64",Ay="base64url",Ny="data_url";class Ry{constructor(e,t){this.data=e,this.contentType=t||null}}function Dy(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):55296==(64512&r)?n<e.length-1&&56320==(64512&e.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function xy(e,t){switch(e){case ky:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw py(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case Ay:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw py(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=function(e){if("undefined"==typeof atob)throw new iy(oy.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(s){if(s.message.includes("polyfill"))throw s;throw py(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}class Py{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw py(Ny,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;var r,s;null!=n&&(this.base64=(s=";base64",(r=n).length>=7&&r.substring(r.length-7)===s),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class Oy{constructor(e,t){let n=0,r="";vy(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(vy(this.data_)){const i=(r=e,s=t,(n=this.data_).webkitSlice?n.webkitSlice(r,s):n.mozSlice?n.mozSlice(r,s):n.slice?n.slice(r,s):null);return null===i?null:new Oy(i)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new Oy(n,!0)}var n,r,s}static getBlob(...e){if(Iy()){const t=e.map(e=>e instanceof Oy?e.data_:e);return new Oy(Cy.apply(null,t))}{const t=e.map(e=>wy(e)?function(e,t){switch(e){case"raw":return new Ry(Dy(t));case ky:case Ay:return new Ry(xy(e,t));case Ny:return new Ry(function(e){const t=new Py(e);return t.base64?xy(ky,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(n){throw py(Ny,"Malformed data URL.")}return Dy(t)}(t.rest)}(t),new Py(t).contentType)}throw ly()}("raw",e).data:e.data_);let n=0;t.forEach(e=>{n+=e.byteLength});const r=new Uint8Array(n);let s=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)r[s++]=e[t]}),new Oy(r,!0)}}uploadData(){return this.data_}}function Ly(e){let t;try{t=JSON.parse(e)}catch(r){return null}return"object"!=typeof(n=t)||Array.isArray(n)?null:t;var n}function My(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Vy(e,t){return t}class Uy{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||Vy}}let Fy=null;function By(){if(Fy)return Fy;const e=[];e.push(new Uy("bucket")),e.push(new Uy("generation")),e.push(new Uy("metageneration")),e.push(new Uy("name","fullPath",!0));const t=new Uy("name");t.xform=function(e,t){return function(e){return!wy(e)||e.length<2?e:My(e)}(t)},e.push(t);const n=new Uy("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new Uy("timeCreated")),e.push(new Uy("updated")),e.push(new Uy("md5Hash",null,!0)),e.push(new Uy("cacheControl",null,!0)),e.push(new Uy("contentDisposition",null,!0)),e.push(new Uy("contentEncoding",null,!0)),e.push(new Uy("contentLanguage",null,!0)),e.push(new Uy("contentType",null,!0)),e.push(new Uy("metadata","customMetadata",!0)),Fy=e,Fy}function jy(e,t,n){const r=Ly(t);return null===r?null:function(e,t,n){const r={type:"file"},s=n.length;for(let i=0;i<s;i++){const e=n[i];r[e.local]=e.xform(r,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,s=new gy(n,r);return t._makeStorageReference(s)}})}(r,e),r}(e,r,n)}class qy{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function zy(e){if(!e)throw ly()}function Ky(e){return function(t,n){let r;var s,i;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new iy(oy.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new iy(oy.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=e.bucket,r=new iy(oy.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(s=e.path,r=new iy(oy.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}class $y{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=cy.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=cy.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=cy.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r,s){if(this.sent_)throw my("cannot .send() more than once");if(f(e)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==s)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return void 0!==r?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw my("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw my("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw my("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw my("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class Gy extends $y{initXhr(){this.xhr_.responseType="text"}}function Hy(){return new Gy}class Wy{constructor(e,t){this._service=e,this._location=t instanceof gy?t:gy.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Wy(e,t)}get root(){const e=new gy(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return My(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new gy(this._location.bucket,e);return new Wy(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new iy(oy.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Qy(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=by(t.fullServerUrl(),e.host,e._protocol),s=e.maxOperationRetryTime,i=new qy(r,"GET",function(e,t){return function(n,r){const s=jy(e,r,t);return zy(null!==s),function(e,t,n,r){const s=Ly(t);if(null===s)return null;if(!wy(s.downloadTokens))return null;const i=s.downloadTokens;if(0===i.length)return null;const o=encodeURIComponent;return i.split(",").map(t=>{const s=e.bucket,i=e.fullPath;return by("/b/"+o(s)+"/o/"+o(i),n,r)+Ey({alt:"media",token:t})})[0]}(s,r,e.host,e._protocol)}}(e,n),s);return i.errorHandler=function(e){const t=Ky(e);return function(n,r){let s=t(n,r);var i;return 404===n.getStatus()&&(i=e.path,s=new iy(oy.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),s.serverResponse=r.serverResponse,s}}(t),i}(e.storage,e._location,By());return e.storage.makeRequestWithTokens(t,Hy).then(e=>{if(null===e)throw new iy(oy.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function Jy(e,t){if(e instanceof Zy){const n=e;if(null==n._bucket)throw new iy(oy.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+sy+"' property when initializing the app?");const r=new Wy(n,n._bucket);return null!=t?Jy(r,t):r}return void 0!==t?function(e,t){const n=function(e,t){const n=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new gy(e._location.bucket,n);return new Wy(e.storage,r)}(e,t):e}function Xy(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof Zy)return new Wy(e,t);throw dy("To use ref(service, url), the first argument must be a Storage instance.")}return Jy(e,t)}function Yy(e,t){const n=t?.[sy];return null==n?null:gy.makeFromBucketSpec(n,e)}class Zy{constructor(e,t,n,r,s,i=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=s,this._isUsingEmulator=i,this._bucket=null,this._host=ry,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?gy.makeFromBucketSpec(r,this._host):Yy(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=gy.makeFromBucketSpec(this._url,e):this._bucket=Yy(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){_y("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){_y("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(Ye(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Wy(this,e)}_makeRequest(e,t,n,r,s=!0){if(this._deleted)return new yy(fy());{const i=function(e,t,n,r,s,i,o=!0,a=!1){const c=Ey(e.urlParams),u=e.url+c,h=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(h,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(h,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}(h,i),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(h,r),new Ty(u,e.method,h,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,s,o,a)}(e,this._appId,n,r,t,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(i),i.getPromise().then(()=>this._requests.delete(i),()=>this._requests.delete(i)),i}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const ew="@firebase/storage",tw="0.14.0",nw="storage";function rw(e,t,n){return function(e,t,n){e._throwIfRoot("uploadBytes");const r=function(e,t,n,r,s){const i=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const c=function(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return t&&t.type()||"application/octet-stream"}(0,t)),r}(t,r,s),u=function(e,t){const n={},r=t.length;for(let s=0;s<r;s++){const r=t[s];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}(c,n),h="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+u+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",l="\r\n--"+a+"--",d=Oy.getBlob(h,r,l);if(null===d)throw new iy(oy.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");const f={name:c.fullPath},p=by(i,e.host,e._protocol),m=e.maxUploadRetryTime,g=new qy(p,"POST",function(e,t){return function(n,r){const s=jy(e,r,t);return zy(null!==s),s}}(e,n),m);return g.urlParams=f,g.headers=o,g.body=d.uploadData(),g.errorHandler=Ky(t),g}(e.storage,e._location,By(),new Oy(t,!0),n);return e.storage.makeRequestWithTokens(r,Hy).then(t=>({metadata:t,ref:e}))}(e=U(e),t,n)}function sw(e){return Qy(e=U(e))}function iw(e,t){return Xy(e=U(e),t)}function ow(e=rt(),t){const n=Xe(e=U(e),nw).getImmediate({identifier:t}),r=u("storage");return r&&function(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`;const s=f(t);s&&(p(`https://${e.host}/b`),w("Storage",!0)),e._isUsingEmulator=!0,e._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"==typeof i?i:m(i,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}Je(new F(nw,function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return new Zy(n,r,s,t,tt)},"PUBLIC").setMultipleInstances(!0)),ot(ew,tw,""),ot(ew,tw,"esm2020");export{Xg as A,vr as B,F as C,Ir as D,A as E,k as F,ny as G,iw as H,rw as I,sw as J,st as K,Q as L,zn as M,dn as N,yr as O,Yg as P,it as Q,Jr as R,Yr as S,wr as T,Je as _,Xe as a,T as b,V as c,rt as d,R as e,C as f,U as g,ce as h,_ as i,nt as j,Ms as k,Ym as l,ow as m,tg as n,ae as o,$m as p,xg as q,ot as r,Zg as s,Wg as t,Jg as u,S as v,Og as w,Gm as x,Gg as y,Qg as z};
