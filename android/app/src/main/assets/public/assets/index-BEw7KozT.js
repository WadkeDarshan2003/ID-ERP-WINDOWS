(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();function EN(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var tx={exports:{}},Du={},nx={exports:{}},Ct={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ab;function US(){if(Ab)return Ct;Ab=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),w=Symbol.iterator;function E(V){return V===null||typeof V!="object"?null:(V=w&&V[w]||V["@@iterator"],typeof V=="function"?V:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},H=Object.assign,F={};function U(V,le,we){this.props=V,this.context=le,this.refs=F,this.updater=we||C}U.prototype.isReactComponent={},U.prototype.setState=function(V,le){if(typeof V!="object"&&typeof V!="function"&&V!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,V,le,"setState")},U.prototype.forceUpdate=function(V){this.updater.enqueueForceUpdate(this,V,"forceUpdate")};function ae(){}ae.prototype=U.prototype;function re(V,le,we){this.props=V,this.context=le,this.refs=F,this.updater=we||C}var J=re.prototype=new ae;J.constructor=re,H(J,U.prototype),J.isPureReactComponent=!0;var he=Array.isArray,j=Object.prototype.hasOwnProperty,ce={current:null},D={key:!0,ref:!0,__self:!0,__source:!0};function k(V,le,we){var fe,Ce={},ge=null,$e=null;if(le!=null)for(fe in le.ref!==void 0&&($e=le.ref),le.key!==void 0&&(ge=""+le.key),le)j.call(le,fe)&&!D.hasOwnProperty(fe)&&(Ce[fe]=le[fe]);var ht=arguments.length-2;if(ht===1)Ce.children=we;else if(1<ht){for(var ot=Array(ht),ct=0;ct<ht;ct++)ot[ct]=arguments[ct+2];Ce.children=ot}if(V&&V.defaultProps)for(fe in ht=V.defaultProps,ht)Ce[fe]===void 0&&(Ce[fe]=ht[fe]);return{$$typeof:n,type:V,key:ge,ref:$e,props:Ce,_owner:ce.current}}function O(V,le){return{$$typeof:n,type:V.type,key:le,ref:V.ref,props:V.props,_owner:V._owner}}function z(V){return typeof V=="object"&&V!==null&&V.$$typeof===n}function B(V){var le={"=":"=0",":":"=2"};return"$"+V.replace(/[=:]/g,function(we){return le[we]})}var K=/\/+/g;function M(V,le){return typeof V=="object"&&V!==null&&V.key!=null?B(""+V.key):le.toString(36)}function Ve(V,le,we,fe,Ce){var ge=typeof V;(ge==="undefined"||ge==="boolean")&&(V=null);var $e=!1;if(V===null)$e=!0;else switch(ge){case"string":case"number":$e=!0;break;case"object":switch(V.$$typeof){case n:case e:$e=!0}}if($e)return $e=V,Ce=Ce($e),V=fe===""?"."+M($e,0):fe,he(Ce)?(we="",V!=null&&(we=V.replace(K,"$&/")+"/"),Ve(Ce,le,we,"",function(ct){return ct})):Ce!=null&&(z(Ce)&&(Ce=O(Ce,we+(!Ce.key||$e&&$e.key===Ce.key?"":(""+Ce.key).replace(K,"$&/")+"/")+V)),le.push(Ce)),1;if($e=0,fe=fe===""?".":fe+":",he(V))for(var ht=0;ht<V.length;ht++){ge=V[ht];var ot=fe+M(ge,ht);$e+=Ve(ge,le,we,ot,Ce)}else if(ot=E(V),typeof ot=="function")for(V=ot.call(V),ht=0;!(ge=V.next()).done;)ge=ge.value,ot=fe+M(ge,ht++),$e+=Ve(ge,le,we,ot,Ce);else if(ge==="object")throw le=String(V),Error("Objects are not valid as a React child (found: "+(le==="[object Object]"?"object with keys {"+Object.keys(V).join(", ")+"}":le)+"). If you meant to render a collection of children, use an array instead.");return $e}function me(V,le,we){if(V==null)return V;var fe=[],Ce=0;return Ve(V,fe,"","",function(ge){return le.call(we,ge,Ce++)}),fe}function Te(V){if(V._status===-1){var le=V._result;le=le(),le.then(function(we){(V._status===0||V._status===-1)&&(V._status=1,V._result=we)},function(we){(V._status===0||V._status===-1)&&(V._status=2,V._result=we)}),V._status===-1&&(V._status=0,V._result=le)}if(V._status===1)return V._result.default;throw V._result}var Se={current:null},pe={transition:null},P={ReactCurrentDispatcher:Se,ReactCurrentBatchConfig:pe,ReactCurrentOwner:ce};function W(){throw Error("act(...) is not supported in production builds of React.")}return Ct.Children={map:me,forEach:function(V,le,we){me(V,function(){le.apply(this,arguments)},we)},count:function(V){var le=0;return me(V,function(){le++}),le},toArray:function(V){return me(V,function(le){return le})||[]},only:function(V){if(!z(V))throw Error("React.Children.only expected to receive a single React element child.");return V}},Ct.Component=U,Ct.Fragment=t,Ct.Profiler=i,Ct.PureComponent=re,Ct.StrictMode=r,Ct.Suspense=p,Ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,Ct.act=W,Ct.cloneElement=function(V,le,we){if(V==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+V+".");var fe=H({},V.props),Ce=V.key,ge=V.ref,$e=V._owner;if(le!=null){if(le.ref!==void 0&&(ge=le.ref,$e=ce.current),le.key!==void 0&&(Ce=""+le.key),V.type&&V.type.defaultProps)var ht=V.type.defaultProps;for(ot in le)j.call(le,ot)&&!D.hasOwnProperty(ot)&&(fe[ot]=le[ot]===void 0&&ht!==void 0?ht[ot]:le[ot])}var ot=arguments.length-2;if(ot===1)fe.children=we;else if(1<ot){ht=Array(ot);for(var ct=0;ct<ot;ct++)ht[ct]=arguments[ct+2];fe.children=ht}return{$$typeof:n,type:V.type,key:Ce,ref:ge,props:fe,_owner:$e}},Ct.createContext=function(V){return V={$$typeof:c,_currentValue:V,_currentValue2:V,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},V.Provider={$$typeof:l,_context:V},V.Consumer=V},Ct.createElement=k,Ct.createFactory=function(V){var le=k.bind(null,V);return le.type=V,le},Ct.createRef=function(){return{current:null}},Ct.forwardRef=function(V){return{$$typeof:u,render:V}},Ct.isValidElement=z,Ct.lazy=function(V){return{$$typeof:b,_payload:{_status:-1,_result:V},_init:Te}},Ct.memo=function(V,le){return{$$typeof:g,type:V,compare:le===void 0?null:le}},Ct.startTransition=function(V){var le=pe.transition;pe.transition={};try{V()}finally{pe.transition=le}},Ct.unstable_act=W,Ct.useCallback=function(V,le){return Se.current.useCallback(V,le)},Ct.useContext=function(V){return Se.current.useContext(V)},Ct.useDebugValue=function(){},Ct.useDeferredValue=function(V){return Se.current.useDeferredValue(V)},Ct.useEffect=function(V,le){return Se.current.useEffect(V,le)},Ct.useId=function(){return Se.current.useId()},Ct.useImperativeHandle=function(V,le,we){return Se.current.useImperativeHandle(V,le,we)},Ct.useInsertionEffect=function(V,le){return Se.current.useInsertionEffect(V,le)},Ct.useLayoutEffect=function(V,le){return Se.current.useLayoutEffect(V,le)},Ct.useMemo=function(V,le){return Se.current.useMemo(V,le)},Ct.useReducer=function(V,le,we){return Se.current.useReducer(V,le,we)},Ct.useRef=function(V){return Se.current.useRef(V)},Ct.useState=function(V){return Se.current.useState(V)},Ct.useSyncExternalStore=function(V,le,we){return Se.current.useSyncExternalStore(V,le,we)},Ct.useTransition=function(){return Se.current.useTransition()},Ct.version="18.3.1",Ct}var jb;function Vy(){return jb||(jb=1,nx.exports=US()),nx.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kb;function zS(){if(kb)return Du;kb=1;var n=Vy(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(u,p,g){var b,w={},E=null,C=null;g!==void 0&&(E=""+g),p.key!==void 0&&(E=""+p.key),p.ref!==void 0&&(C=p.ref);for(b in p)r.call(p,b)&&!l.hasOwnProperty(b)&&(w[b]=p[b]);if(u&&u.defaultProps)for(b in p=u.defaultProps,p)w[b]===void 0&&(w[b]=p[b]);return{$$typeof:e,type:u,key:E,ref:C,props:w,_owner:i.current}}return Du.Fragment=t,Du.jsx=c,Du.jsxs=c,Du}var Cb;function qS(){return Cb||(Cb=1,tx.exports=zS()),tx.exports}var a=qS(),q=Vy();const li=EN(q);var Zm={},rx={exports:{}},us={},sx={exports:{}},ix={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rb;function WS(){return Rb||(Rb=1,(function(n){function e(pe,P){var W=pe.length;pe.push(P);e:for(;0<W;){var V=W-1>>>1,le=pe[V];if(0<i(le,P))pe[V]=P,pe[W]=le,W=V;else break e}}function t(pe){return pe.length===0?null:pe[0]}function r(pe){if(pe.length===0)return null;var P=pe[0],W=pe.pop();if(W!==P){pe[0]=W;e:for(var V=0,le=pe.length,we=le>>>1;V<we;){var fe=2*(V+1)-1,Ce=pe[fe],ge=fe+1,$e=pe[ge];if(0>i(Ce,W))ge<le&&0>i($e,Ce)?(pe[V]=$e,pe[ge]=W,V=ge):(pe[V]=Ce,pe[fe]=W,V=fe);else if(ge<le&&0>i($e,W))pe[V]=$e,pe[ge]=W,V=ge;else break e}}return P}function i(pe,P){var W=pe.sortIndex-P.sortIndex;return W!==0?W:pe.id-P.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;n.unstable_now=function(){return l.now()}}else{var c=Date,u=c.now();n.unstable_now=function(){return c.now()-u}}var p=[],g=[],b=1,w=null,E=3,C=!1,H=!1,F=!1,U=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,re=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function J(pe){for(var P=t(g);P!==null;){if(P.callback===null)r(g);else if(P.startTime<=pe)r(g),P.sortIndex=P.expirationTime,e(p,P);else break;P=t(g)}}function he(pe){if(F=!1,J(pe),!H)if(t(p)!==null)H=!0,Te(j);else{var P=t(g);P!==null&&Se(he,P.startTime-pe)}}function j(pe,P){H=!1,F&&(F=!1,ae(k),k=-1),C=!0;var W=E;try{for(J(P),w=t(p);w!==null&&(!(w.expirationTime>P)||pe&&!B());){var V=w.callback;if(typeof V=="function"){w.callback=null,E=w.priorityLevel;var le=V(w.expirationTime<=P);P=n.unstable_now(),typeof le=="function"?w.callback=le:w===t(p)&&r(p),J(P)}else r(p);w=t(p)}if(w!==null)var we=!0;else{var fe=t(g);fe!==null&&Se(he,fe.startTime-P),we=!1}return we}finally{w=null,E=W,C=!1}}var ce=!1,D=null,k=-1,O=5,z=-1;function B(){return!(n.unstable_now()-z<O)}function K(){if(D!==null){var pe=n.unstable_now();z=pe;var P=!0;try{P=D(!0,pe)}finally{P?M():(ce=!1,D=null)}}else ce=!1}var M;if(typeof re=="function")M=function(){re(K)};else if(typeof MessageChannel<"u"){var Ve=new MessageChannel,me=Ve.port2;Ve.port1.onmessage=K,M=function(){me.postMessage(null)}}else M=function(){U(K,0)};function Te(pe){D=pe,ce||(ce=!0,M())}function Se(pe,P){k=U(function(){pe(n.unstable_now())},P)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(pe){pe.callback=null},n.unstable_continueExecution=function(){H||C||(H=!0,Te(j))},n.unstable_forceFrameRate=function(pe){0>pe||125<pe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<pe?Math.floor(1e3/pe):5},n.unstable_getCurrentPriorityLevel=function(){return E},n.unstable_getFirstCallbackNode=function(){return t(p)},n.unstable_next=function(pe){switch(E){case 1:case 2:case 3:var P=3;break;default:P=E}var W=E;E=P;try{return pe()}finally{E=W}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(pe,P){switch(pe){case 1:case 2:case 3:case 4:case 5:break;default:pe=3}var W=E;E=pe;try{return P()}finally{E=W}},n.unstable_scheduleCallback=function(pe,P,W){var V=n.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?V+W:V):W=V,pe){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=W+le,pe={id:b++,callback:P,priorityLevel:pe,startTime:W,expirationTime:le,sortIndex:-1},W>V?(pe.sortIndex=W,e(g,pe),t(p)===null&&pe===t(g)&&(F?(ae(k),k=-1):F=!0,Se(he,W-V))):(pe.sortIndex=le,e(p,pe),H||C||(H=!0,Te(j))),pe},n.unstable_shouldYield=B,n.unstable_wrapCallback=function(pe){var P=E;return function(){var W=E;E=P;try{return pe.apply(this,arguments)}finally{E=W}}}})(ix)),ix}var Db;function HS(){return Db||(Db=1,sx.exports=WS()),sx.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pb;function GS(){if(Pb)return us;Pb=1;var n=Vy(),e=HS();function t(s){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+s,d=1;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+s+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,i={};function l(s,o){c(s,o),c(s+"Capture",o)}function c(s,o){for(i[s]=o,s=0;s<o.length;s++)r.add(o[s])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),p=Object.prototype.hasOwnProperty,g=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,b={},w={};function E(s){return p.call(w,s)?!0:p.call(b,s)?!1:g.test(s)?w[s]=!0:(b[s]=!0,!1)}function C(s,o,d,f){if(d!==null&&d.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return f?!1:d!==null?!d.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function H(s,o,d,f){if(o===null||typeof o>"u"||C(s,o,d,f))return!0;if(f)return!1;if(d!==null)switch(d.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function F(s,o,d,f,x,v,T){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=f,this.attributeNamespace=x,this.mustUseProperty=d,this.propertyName=s,this.type=o,this.sanitizeURL=v,this.removeEmptyString=T}var U={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){U[s]=new F(s,0,!1,s,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var o=s[0];U[o]=new F(o,1,!1,s[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(s){U[s]=new F(s,2,!1,s.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){U[s]=new F(s,2,!1,s,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){U[s]=new F(s,3,!1,s.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(s){U[s]=new F(s,3,!0,s,null,!1,!1)}),["capture","download"].forEach(function(s){U[s]=new F(s,4,!1,s,null,!1,!1)}),["cols","rows","size","span"].forEach(function(s){U[s]=new F(s,6,!1,s,null,!1,!1)}),["rowSpan","start"].forEach(function(s){U[s]=new F(s,5,!1,s.toLowerCase(),null,!1,!1)});var ae=/[\-:]([a-z])/g;function re(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var o=s.replace(ae,re);U[o]=new F(o,1,!1,s,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var o=s.replace(ae,re);U[o]=new F(o,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(s){var o=s.replace(ae,re);U[o]=new F(o,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(s){U[s]=new F(s,1,!1,s.toLowerCase(),null,!1,!1)}),U.xlinkHref=new F("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(s){U[s]=new F(s,1,!1,s.toLowerCase(),null,!0,!0)});function J(s,o,d,f){var x=U.hasOwnProperty(o)?U[o]:null;(x!==null?x.type!==0:f||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(H(o,d,x,f)&&(d=null),f||x===null?E(o)&&(d===null?s.removeAttribute(o):s.setAttribute(o,""+d)):x.mustUseProperty?s[x.propertyName]=d===null?x.type===3?!1:"":d:(o=x.attributeName,f=x.attributeNamespace,d===null?s.removeAttribute(o):(x=x.type,d=x===3||x===4&&d===!0?"":""+d,f?s.setAttributeNS(f,o,d):s.setAttribute(o,d))))}var he=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,j=Symbol.for("react.element"),ce=Symbol.for("react.portal"),D=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),O=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),B=Symbol.for("react.context"),K=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),Ve=Symbol.for("react.suspense_list"),me=Symbol.for("react.memo"),Te=Symbol.for("react.lazy"),Se=Symbol.for("react.offscreen"),pe=Symbol.iterator;function P(s){return s===null||typeof s!="object"?null:(s=pe&&s[pe]||s["@@iterator"],typeof s=="function"?s:null)}var W=Object.assign,V;function le(s){if(V===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);V=o&&o[1]||""}return`
`+V+s}var we=!1;function fe(s,o){if(!s||we)return"";we=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(ue){var f=ue}Reflect.construct(s,[],o)}else{try{o.call()}catch(ue){f=ue}s.call(o.prototype)}else{try{throw Error()}catch(ue){f=ue}s()}}catch(ue){if(ue&&f&&typeof ue.stack=="string"){for(var x=ue.stack.split(`
`),v=f.stack.split(`
`),T=x.length-1,$=v.length-1;1<=T&&0<=$&&x[T]!==v[$];)$--;for(;1<=T&&0<=$;T--,$--)if(x[T]!==v[$]){if(T!==1||$!==1)do if(T--,$--,0>$||x[T]!==v[$]){var G=`
`+x[T].replace(" at new "," at ");return s.displayName&&G.includes("<anonymous>")&&(G=G.replace("<anonymous>",s.displayName)),G}while(1<=T&&0<=$);break}}}finally{we=!1,Error.prepareStackTrace=d}return(s=s?s.displayName||s.name:"")?le(s):""}function Ce(s){switch(s.tag){case 5:return le(s.type);case 16:return le("Lazy");case 13:return le("Suspense");case 19:return le("SuspenseList");case 0:case 2:case 15:return s=fe(s.type,!1),s;case 11:return s=fe(s.type.render,!1),s;case 1:return s=fe(s.type,!0),s;default:return""}}function ge(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case D:return"Fragment";case ce:return"Portal";case O:return"Profiler";case k:return"StrictMode";case M:return"Suspense";case Ve:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case B:return(s.displayName||"Context")+".Consumer";case z:return(s._context.displayName||"Context")+".Provider";case K:var o=s.render;return s=s.displayName,s||(s=o.displayName||o.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case me:return o=s.displayName||null,o!==null?o:ge(s.type)||"Memo";case Te:o=s._payload,s=s._init;try{return ge(s(o))}catch{}}return null}function $e(s){var o=s.type;switch(s.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=o.render,s=s.displayName||s.name||"",o.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ge(o);case 8:return o===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function ht(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function ot(s){var o=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function ct(s){var o=ot(s)?"checked":"value",d=Object.getOwnPropertyDescriptor(s.constructor.prototype,o),f=""+s[o];if(!s.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var x=d.get,v=d.set;return Object.defineProperty(s,o,{configurable:!0,get:function(){return x.call(this)},set:function(T){f=""+T,v.call(this,T)}}),Object.defineProperty(s,o,{enumerable:d.enumerable}),{getValue:function(){return f},setValue:function(T){f=""+T},stopTracking:function(){s._valueTracker=null,delete s[o]}}}}function On(s){s._valueTracker||(s._valueTracker=ct(s))}function nn(s){if(!s)return!1;var o=s._valueTracker;if(!o)return!0;var d=o.getValue(),f="";return s&&(f=ot(s)?s.checked?"true":"false":s.value),s=f,s!==d?(o.setValue(s),!0):!1}function Ie(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function Ye(s,o){var d=o.checked;return W({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??s._wrapperState.initialChecked})}function un(s,o){var d=o.defaultValue==null?"":o.defaultValue,f=o.checked!=null?o.checked:o.defaultChecked;d=ht(o.value!=null?o.value:d),s._wrapperState={initialChecked:f,initialValue:d,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function fn(s,o){o=o.checked,o!=null&&J(s,"checked",o,!1)}function it(s,o){fn(s,o);var d=ht(o.value),f=o.type;if(d!=null)f==="number"?(d===0&&s.value===""||s.value!=d)&&(s.value=""+d):s.value!==""+d&&(s.value=""+d);else if(f==="submit"||f==="reset"){s.removeAttribute("value");return}o.hasOwnProperty("value")?wt(s,o.type,d):o.hasOwnProperty("defaultValue")&&wt(s,o.type,ht(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(s.defaultChecked=!!o.defaultChecked)}function bt(s,o,d){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var f=o.type;if(!(f!=="submit"&&f!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+s._wrapperState.initialValue,d||o===s.value||(s.value=o),s.defaultValue=o}d=s.name,d!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,d!==""&&(s.name=d)}function wt(s,o,d){(o!=="number"||Ie(s.ownerDocument)!==s)&&(d==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+d&&(s.defaultValue=""+d))}var _t=Array.isArray;function Gt(s,o,d,f){if(s=s.options,o){o={};for(var x=0;x<d.length;x++)o["$"+d[x]]=!0;for(d=0;d<s.length;d++)x=o.hasOwnProperty("$"+s[d].value),s[d].selected!==x&&(s[d].selected=x),x&&f&&(s[d].defaultSelected=!0)}else{for(d=""+ht(d),o=null,x=0;x<s.length;x++){if(s[x].value===d){s[x].selected=!0,f&&(s[x].defaultSelected=!0);return}o!==null||s[x].disabled||(o=s[x])}o!==null&&(o.selected=!0)}}function cn(s,o){if(o.dangerouslySetInnerHTML!=null)throw Error(t(91));return W({},o,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function yr(s,o){var d=o.value;if(d==null){if(d=o.children,o=o.defaultValue,d!=null){if(o!=null)throw Error(t(92));if(_t(d)){if(1<d.length)throw Error(t(93));d=d[0]}o=d}o==null&&(o=""),d=o}s._wrapperState={initialValue:ht(d)}}function pi(s,o){var d=ht(o.value),f=ht(o.defaultValue);d!=null&&(d=""+d,d!==s.value&&(s.value=d),o.defaultValue==null&&s.defaultValue!==d&&(s.defaultValue=d)),f!=null&&(s.defaultValue=""+f)}function Fs(s){var o=s.textContent;o===s._wrapperState.initialValue&&o!==""&&o!==null&&(s.value=o)}function fi(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Bs(s,o){return s==null||s==="http://www.w3.org/1999/xhtml"?fi(o):s==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var Jr,ma=(function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,d,f,x){MSApp.execUnsafeLocalFunction(function(){return s(o,d,f,x)})}:s})(function(s,o){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=o;else{for(Jr=Jr||document.createElement("div"),Jr.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=Jr.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;o.firstChild;)s.appendChild(o.firstChild)}});function ar(s,o){if(o){var d=s.firstChild;if(d&&d===s.lastChild&&d.nodeType===3){d.nodeValue=o;return}}s.textContent=o}var gs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},gi=["Webkit","ms","Moz","O"];Object.keys(gs).forEach(function(s){gi.forEach(function(o){o=o+s.charAt(0).toUpperCase()+s.substring(1),gs[o]=gs[s]})});function ie(s,o,d){return o==null||typeof o=="boolean"||o===""?"":d||typeof o!="number"||o===0||gs.hasOwnProperty(s)&&gs[s]?(""+o).trim():o+"px"}function _e(s,o){s=s.style;for(var d in o)if(o.hasOwnProperty(d)){var f=d.indexOf("--")===0,x=ie(d,o[d],f);d==="float"&&(d="cssFloat"),f?s.setProperty(d,x):s[d]=x}}var Be=W({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function We(s,o){if(o){if(Be[s]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(t(137,s));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(t(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(t(61))}if(o.style!=null&&typeof o.style!="object")throw Error(t(62))}}function X(s,o){if(s.indexOf("-")===-1)return typeof o.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var He=null;function Vt(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var at=null,xt=null,Me=null;function ve(s){if(s=bo(s)){if(typeof at!="function")throw Error(t(280));var o=s.stateNode;o&&(o=El(o),at(s.stateNode,s.type,o))}}function Ze(s){xt?Me?Me.push(s):Me=[s]:xt=s}function ln(){if(xt){var s=xt,o=Me;if(Me=xt=null,ve(s),o)for(s=0;s<o.length;s++)ve(o[s])}}function En(s,o){return s(o)}function vr(){}var Ln=!1;function Pr(s,o,d){if(Ln)return s(o,d);Ln=!0;try{return En(s,o,d)}finally{Ln=!1,(xt!==null||Me!==null)&&(vr(),ln())}}function mt(s,o){var d=s.stateNode;if(d===null)return null;var f=El(d);if(f===null)return null;d=f[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break e;default:s=!1}if(s)return null;if(d&&typeof d!="function")throw Error(t(231,o,typeof d));return d}var Kt=!1;if(u)try{var $i={};Object.defineProperty($i,"passive",{get:function(){Kt=!0}}),window.addEventListener("test",$i,$i),window.removeEventListener("test",$i,$i)}catch{Kt=!1}function il(s,o,d,f,x,v,T,$,G){var ue=Array.prototype.slice.call(arguments,3);try{o.apply(d,ue)}catch(Ne){this.onError(Ne)}}var xs=!1,Us=null,xi=!1,Hn=null,ys={onError:function(s){xs=!0,Us=s}};function vs(s,o,d,f,x,v,T,$,G){xs=!1,Us=null,il.apply(ys,arguments)}function eo(s,o,d,f,x,v,T,$,G){if(vs.apply(this,arguments),xs){if(xs){var ue=Us;xs=!1,Us=null}else throw Error(t(198));xi||(xi=!0,Hn=ue)}}function bs(s){var o=s,d=s;if(s.alternate)for(;o.return;)o=o.return;else{s=o;do o=s,(o.flags&4098)!==0&&(d=o.return),s=o.return;while(s)}return o.tag===3?d:null}function yi(s){if(s.tag===13){var o=s.memoizedState;if(o===null&&(s=s.alternate,s!==null&&(o=s.memoizedState)),o!==null)return o.dehydrated}return null}function Tc(s){if(bs(s)!==s)throw Error(t(188))}function to(s){var o=s.alternate;if(!o){if(o=bs(s),o===null)throw Error(t(188));return o!==s?null:s}for(var d=s,f=o;;){var x=d.return;if(x===null)break;var v=x.alternate;if(v===null){if(f=x.return,f!==null){d=f;continue}break}if(x.child===v.child){for(v=x.child;v;){if(v===d)return Tc(x),s;if(v===f)return Tc(x),o;v=v.sibling}throw Error(t(188))}if(d.return!==f.return)d=x,f=v;else{for(var T=!1,$=x.child;$;){if($===d){T=!0,d=x,f=v;break}if($===f){T=!0,f=x,d=v;break}$=$.sibling}if(!T){for($=v.child;$;){if($===d){T=!0,d=v,f=x;break}if($===f){T=!0,f=v,d=x;break}$=$.sibling}if(!T)throw Error(t(189))}}if(d.alternate!==f)throw Error(t(190))}if(d.tag!==3)throw Error(t(188));return d.stateNode.current===d?s:o}function Sc(s){return s=to(s),s!==null?zs(s):null}function zs(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var o=zs(s);if(o!==null)return o;s=s.sibling}return null}var no=e.unstable_scheduleCallback,pa=e.unstable_cancelCallback,Fi=e.unstable_shouldYield,qs=e.unstable_requestPaint,qt=e.unstable_now,Ac=e.unstable_getCurrentPriorityLevel,ro=e.unstable_ImmediatePriority,Bi=e.unstable_UserBlockingPriority,or=e.unstable_NormalPriority,Ui=e.unstable_LowPriority,so=e.unstable_IdlePriority,vi=null,Or=null;function io(s){if(Or&&typeof Or.onCommitFiberRoot=="function")try{Or.onCommitFiberRoot(vi,s,void 0,(s.current.flags&128)===128)}catch{}}var br=Math.clz32?Math.clz32:bi,Xr=Math.log,Zr=Math.LN2;function bi(s){return s>>>=0,s===0?32:31-(Xr(s)/Zr|0)|0}var wr=64,Ws=4194304;function $t(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function ws(s,o){var d=s.pendingLanes;if(d===0)return 0;var f=0,x=s.suspendedLanes,v=s.pingedLanes,T=d&268435455;if(T!==0){var $=T&~x;$!==0?f=$t($):(v&=T,v!==0&&(f=$t(v)))}else T=d&~x,T!==0?f=$t(T):v!==0&&(f=$t(v));if(f===0)return 0;if(o!==0&&o!==f&&(o&x)===0&&(x=f&-f,v=o&-o,x>=v||x===16&&(v&4194240)!==0))return o;if((f&4)!==0&&(f|=d&16),o=s.entangledLanes,o!==0)for(s=s.entanglements,o&=f;0<o;)d=31-br(o),x=1<<d,f|=s[d],o&=~x;return f}function Hs(s,o){switch(s){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wi(s,o){for(var d=s.suspendedLanes,f=s.pingedLanes,x=s.expirationTimes,v=s.pendingLanes;0<v;){var T=31-br(v),$=1<<T,G=x[T];G===-1?(($&d)===0||($&f)!==0)&&(x[T]=Hs($,o)):G<=o&&(s.expiredLanes|=$),v&=~$}}function al(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function fa(){var s=wr;return wr<<=1,(wr&4194240)===0&&(wr=64),s}function Ot(s){for(var o=[],d=0;31>d;d++)o.push(s);return o}function zi(s,o,d){s.pendingLanes|=o,o!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,o=31-br(o),s[o]=d}function _s(s,o){var d=s.pendingLanes&~o;s.pendingLanes=o,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=o,s.mutableReadLanes&=o,s.entangledLanes&=o,o=s.entanglements;var f=s.eventTimes;for(s=s.expirationTimes;0<d;){var x=31-br(d),v=1<<x;o[x]=0,f[x]=-1,s[x]=-1,d&=~v}}function ao(s,o){var d=s.entangledLanes|=o;for(s=s.entanglements;d;){var f=31-br(d),x=1<<f;x&o|s[f]&o&&(s[f]|=o),d&=~x}}var ft=0;function es(s){return s&=-s,1<s?4<s?(s&268435455)!==0?16:536870912:4:1}var oo,ga,ol,ll,xa,er=!1,_i=[],Mr=null,Vr=null,rn=null,ya=new Map,_r=new Map,Lr=[],qi="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Wi(s,o){switch(s){case"focusin":case"focusout":Mr=null;break;case"dragenter":case"dragleave":Vr=null;break;case"mouseover":case"mouseout":rn=null;break;case"pointerover":case"pointerout":ya.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":_r.delete(o.pointerId)}}function $r(s,o,d,f,x,v){return s===null||s.nativeEvent!==v?(s={blockedOn:o,domEventName:d,eventSystemFlags:f,nativeEvent:v,targetContainers:[x]},o!==null&&(o=bo(o),o!==null&&ga(o)),s):(s.eventSystemFlags|=f,o=s.targetContainers,x!==null&&o.indexOf(x)===-1&&o.push(x),s)}function jc(s,o,d,f,x){switch(o){case"focusin":return Mr=$r(Mr,s,o,d,f,x),!0;case"dragenter":return Vr=$r(Vr,s,o,d,f,x),!0;case"mouseover":return rn=$r(rn,s,o,d,f,x),!0;case"pointerover":var v=x.pointerId;return ya.set(v,$r(ya.get(v)||null,s,o,d,f,x)),!0;case"gotpointercapture":return v=x.pointerId,_r.set(v,$r(_r.get(v)||null,s,o,d,f,x)),!0}return!1}function Gs(s){var o=Gi(s.target);if(o!==null){var d=bs(o);if(d!==null){if(o=d.tag,o===13){if(o=yi(d),o!==null){s.blockedOn=o,xa(s.priority,function(){ol(d)});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){s.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Qt(s){if(s.blockedOn!==null)return!1;for(var o=s.targetContainers;0<o.length;){var d=dl(s.domEventName,s.eventSystemFlags,o[0],s.nativeEvent);if(d===null){d=s.nativeEvent;var f=new d.constructor(d.type,d);He=f,d.target.dispatchEvent(f),He=null}else return o=bo(d),o!==null&&ga(o),s.blockedOn=d,!1;o.shift()}return!0}function kt(s,o,d){Qt(s)&&d.delete(o)}function Nt(){er=!1,Mr!==null&&Qt(Mr)&&(Mr=null),Vr!==null&&Qt(Vr)&&(Vr=null),rn!==null&&Qt(rn)&&(rn=null),ya.forEach(kt),_r.forEach(kt)}function Ns(s,o){s.blockedOn===o&&(s.blockedOn=null,er||(er=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Nt)))}function Is(s){function o(x){return Ns(x,s)}if(0<_i.length){Ns(_i[0],s);for(var d=1;d<_i.length;d++){var f=_i[d];f.blockedOn===s&&(f.blockedOn=null)}}for(Mr!==null&&Ns(Mr,s),Vr!==null&&Ns(Vr,s),rn!==null&&Ns(rn,s),ya.forEach(o),_r.forEach(o),d=0;d<Lr.length;d++)f=Lr[d],f.blockedOn===s&&(f.blockedOn=null);for(;0<Lr.length&&(d=Lr[0],d.blockedOn===null);)Gs(d),d.blockedOn===null&&Lr.shift()}var gn=he.ReactCurrentBatchConfig,Mt=!0;function Es(s,o,d,f){var x=ft,v=gn.transition;gn.transition=null;try{ft=1,cl(s,o,d,f)}finally{ft=x,gn.transition=v}}function Ft(s,o,d,f){var x=ft,v=gn.transition;gn.transition=null;try{ft=4,cl(s,o,d,f)}finally{ft=x,gn.transition=v}}function cl(s,o,d,f){if(Mt){var x=dl(s,o,d,f);if(x===null)Uc(s,o,f,Ts,d),Wi(s,f);else if(jc(x,s,o,d,f))f.stopPropagation();else if(Wi(s,f),o&4&&-1<qi.indexOf(s)){for(;x!==null;){var v=bo(x);if(v!==null&&oo(v),v=dl(s,o,d,f),v===null&&Uc(s,o,f,Ts,d),v===x)break;x=v}x!==null&&f.stopPropagation()}else Uc(s,o,f,null,d)}}var Ts=null;function dl(s,o,d,f){if(Ts=null,s=Vt(f),s=Gi(s),s!==null)if(o=bs(s),o===null)s=null;else if(d=o.tag,d===13){if(s=yi(o),s!==null)return s;s=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;s=null}else o!==s&&(s=null);return Ts=s,null}function ul(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ac()){case ro:return 1;case Bi:return 4;case or:case Ui:return 16;case so:return 536870912;default:return 16}default:return 16}}var ts=null,hl=null,Tn=null;function hn(){if(Tn)return Tn;var s,o=hl,d=o.length,f,x="value"in ts?ts.value:ts.textContent,v=x.length;for(s=0;s<d&&o[s]===x[s];s++);var T=d-s;for(f=1;f<=T&&o[d-f]===x[v-f];f++);return Tn=x.slice(s,1<f?1-f:void 0)}function va(s){var o=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&o===13&&(s=13)):s=o,s===10&&(s=13),32<=s||s===13?s:0}function Ks(){return!0}function ml(){return!1}function Gn(s){function o(d,f,x,v,T){this._reactName=d,this._targetInst=x,this.type=f,this.nativeEvent=v,this.target=T,this.currentTarget=null;for(var $ in s)s.hasOwnProperty($)&&(d=s[$],this[$]=d?d(v):v[$]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Ks:ml,this.isPropagationStopped=ml,this}return W(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Ks)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Ks)},persist:function(){},isPersistent:Ks}),o}var Qs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ba=Gn(Qs),Ni=W({},Qs,{view:0,detail:0}),ns=Gn(Ni),Ss,tr,Yt,Fr=W({},Ni,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gt,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Yt&&(Yt&&s.type==="mousemove"?(Ss=s.screenX-Yt.screenX,tr=s.screenY-Yt.screenY):tr=Ss=0,Yt=s),Ss)},movementY:function(s){return"movementY"in s?s.movementY:tr}}),wa=Gn(Fr),kc=W({},Fr,{dataTransfer:0}),pl=Gn(kc),At=W({},Ni,{relatedTarget:0}),xn=Gn(At),Cc=W({},Qs,{animationName:0,elapsedTime:0,pseudoElement:0}),fl=Gn(Cc),Ii=W({},Qs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),m=Gn(Ii),y=W({},Qs,{data:0}),I=Gn(y),R={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ee={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},de={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Re(s){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(s):(s=de[s])?!!o[s]:!1}function gt(){return Re}var wn=W({},Ni,{key:function(s){if(s.key){var o=R[s.key]||s.key;if(o!=="Unidentified")return o}return s.type==="keypress"?(s=va(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?ee[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gt,charCode:function(s){return s.type==="keypress"?va(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?va(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Ut=Gn(wn),yn=W({},Fr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Br=Gn(yn),rs=W({},Ni,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gt}),Kn=Gn(rs),Mn=W({},Qs,{propertyName:0,elapsedTime:0,pseudoElement:0}),lo=Gn(Mn),gl=W({},Fr,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),eg=Gn(gl),tg=[9,13,27,32],Hd=u&&"CompositionEvent"in window,co=null;u&&"documentMode"in document&&(co=document.documentMode);var rm=u&&"TextEvent"in window&&!co,Gd=u&&(!Hd||co&&8<co&&11>=co),sm=" ",Rc=!1;function im(s,o){switch(s){case"keyup":return tg.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function am(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var uo=!1;function om(s,o){switch(s){case"compositionend":return am(o);case"keypress":return o.which!==32?null:(Rc=!0,sm);case"textInput":return s=o.data,s===sm&&Rc?null:s;default:return null}}function ss(s,o){if(uo)return s==="compositionend"||!Hd&&im(s,o)?(s=hn(),Tn=hl=ts=null,uo=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Gd&&o.locale!=="ko"?null:o.data;default:return null}}var ng={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ys(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o==="input"?!!ng[s.type]:o==="textarea"}function Js(s,o,d,f){Ze(f),o=_l(o,"onChange"),0<o.length&&(d=new ba("onChange","change",null,d,f),s.push({event:d,listeners:o}))}var ho=null,lr=null;function lm(s){cu(s,0)}function Ei(s){var o=Ta(s);if(nn(o))return s}function Hi(s,o){if(s==="change")return o}var mo=!1;if(u){var Dc;if(u){var xl="oninput"in document;if(!xl){var Kd=document.createElement("div");Kd.setAttribute("oninput","return;"),xl=typeof Kd.oninput=="function"}Dc=xl}else Dc=!1;mo=Dc&&(!document.documentMode||9<document.documentMode)}function Pc(){ho&&(ho.detachEvent("onpropertychange",Qd),lr=ho=null)}function Qd(s){if(s.propertyName==="value"&&Ei(lr)){var o=[];Js(o,lr,s,Vt(s)),Pr(lm,o)}}function yl(s,o,d){s==="focusin"?(Pc(),ho=o,lr=d,ho.attachEvent("onpropertychange",Qd)):s==="focusout"&&Pc()}function rg(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Ei(lr)}function Tt(s,o){if(s==="click")return Ei(o)}function sg(s,o){if(s==="input"||s==="change")return Ei(o)}function cm(s,o){return s===o&&(s!==0||1/s===1/o)||s!==s&&o!==o}var is=typeof Object.is=="function"?Object.is:cm;function po(s,o){if(is(s,o))return!0;if(typeof s!="object"||s===null||typeof o!="object"||o===null)return!1;var d=Object.keys(s),f=Object.keys(o);if(d.length!==f.length)return!1;for(f=0;f<d.length;f++){var x=d[f];if(!p.call(o,x)||!is(s[x],o[x]))return!1}return!0}function Yd(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Jd(s,o){var d=Yd(s);s=0;for(var f;d;){if(d.nodeType===3){if(f=s+d.textContent.length,s<=o&&f>=o)return{node:d,offset:o-s};s=f}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Yd(d)}}function Xd(s,o){return s&&o?s===o?!0:s&&s.nodeType===3?!1:o&&o.nodeType===3?Xd(s,o.parentNode):"contains"in s?s.contains(o):s.compareDocumentPosition?!!(s.compareDocumentPosition(o)&16):!1:!1}function Zd(){for(var s=window,o=Ie();o instanceof s.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)s=o.contentWindow;else break;o=Ie(s.document)}return o}function Oc(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o&&(o==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||o==="textarea"||s.contentEditable==="true")}function dm(s){var o=Zd(),d=s.focusedElem,f=s.selectionRange;if(o!==d&&d&&d.ownerDocument&&Xd(d.ownerDocument.documentElement,d)){if(f!==null&&Oc(d)){if(o=f.start,s=f.end,s===void 0&&(s=o),"selectionStart"in d)d.selectionStart=o,d.selectionEnd=Math.min(s,d.value.length);else if(s=(o=d.ownerDocument||document)&&o.defaultView||window,s.getSelection){s=s.getSelection();var x=d.textContent.length,v=Math.min(f.start,x);f=f.end===void 0?v:Math.min(f.end,x),!s.extend&&v>f&&(x=f,f=v,v=x),x=Jd(d,v);var T=Jd(d,f);x&&T&&(s.rangeCount!==1||s.anchorNode!==x.node||s.anchorOffset!==x.offset||s.focusNode!==T.node||s.focusOffset!==T.offset)&&(o=o.createRange(),o.setStart(x.node,x.offset),s.removeAllRanges(),v>f?(s.addRange(o),s.extend(T.node,T.offset)):(o.setEnd(T.node,T.offset),s.addRange(o)))}}for(o=[],s=d;s=s.parentNode;)s.nodeType===1&&o.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<o.length;d++)s=o[d],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var um=u&&"documentMode"in document&&11>=document.documentMode,_a=null,Mc=null,fo=null,Vc=!1;function eu(s,o,d){var f=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Vc||_a==null||_a!==Ie(f)||(f=_a,"selectionStart"in f&&Oc(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),fo&&po(fo,f)||(fo=f,f=_l(Mc,"onSelect"),0<f.length&&(o=new ba("onSelect","select",null,o,d),s.push({event:o,listeners:f}),o.target=_a)))}function vl(s,o){var d={};return d[s.toLowerCase()]=o.toLowerCase(),d["Webkit"+s]="webkit"+o,d["Moz"+s]="moz"+o,d}var Na={animationend:vl("Animation","AnimationEnd"),animationiteration:vl("Animation","AnimationIteration"),animationstart:vl("Animation","AnimationStart"),transitionend:vl("Transition","TransitionEnd")},Lc={},tu={};u&&(tu=document.createElement("div").style,"AnimationEvent"in window||(delete Na.animationend.animation,delete Na.animationiteration.animation,delete Na.animationstart.animation),"TransitionEvent"in window||delete Na.transitionend.transition);function bl(s){if(Lc[s])return Lc[s];if(!Na[s])return s;var o=Na[s],d;for(d in o)if(o.hasOwnProperty(d)&&d in tu)return Lc[s]=o[d];return s}var nu=bl("animationend"),ru=bl("animationiteration"),su=bl("animationstart"),iu=bl("transitionend"),au=new Map,ou="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ti(s,o){au.set(s,o),l(o,[s])}for(var $c=0;$c<ou.length;$c++){var Fc=ou[$c],hm=Fc.toLowerCase(),mm=Fc[0].toUpperCase()+Fc.slice(1);Ti(hm,"on"+mm)}Ti(nu,"onAnimationEnd"),Ti(ru,"onAnimationIteration"),Ti(su,"onAnimationStart"),Ti("dblclick","onDoubleClick"),Ti("focusin","onFocus"),Ti("focusout","onBlur"),Ti(iu,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var go="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pm=new Set("cancel close invalid load scroll toggle".split(" ").concat(go));function lu(s,o,d){var f=s.type||"unknown-event";s.currentTarget=d,eo(f,o,void 0,s),s.currentTarget=null}function cu(s,o){o=(o&4)!==0;for(var d=0;d<s.length;d++){var f=s[d],x=f.event;f=f.listeners;e:{var v=void 0;if(o)for(var T=f.length-1;0<=T;T--){var $=f[T],G=$.instance,ue=$.currentTarget;if($=$.listener,G!==v&&x.isPropagationStopped())break e;lu(x,$,ue),v=G}else for(T=0;T<f.length;T++){if($=f[T],G=$.instance,ue=$.currentTarget,$=$.listener,G!==v&&x.isPropagationStopped())break e;lu(x,$,ue),v=G}}}if(xi)throw s=Hn,xi=!1,Hn=null,s}function sn(s,o){var d=o[Kc];d===void 0&&(d=o[Kc]=new Set);var f=s+"__bubble";d.has(f)||(du(o,s,2,!1),d.add(f))}function Bc(s,o,d){var f=0;o&&(f|=4),du(d,s,f,o)}var wl="_reactListening"+Math.random().toString(36).slice(2);function xo(s){if(!s[wl]){s[wl]=!0,r.forEach(function(d){d!=="selectionchange"&&(pm.has(d)||Bc(d,!1,s),Bc(d,!0,s))});var o=s.nodeType===9?s:s.ownerDocument;o===null||o[wl]||(o[wl]=!0,Bc("selectionchange",!1,o))}}function du(s,o,d,f){switch(ul(o)){case 1:var x=Es;break;case 4:x=Ft;break;default:x=cl}d=x.bind(null,o,d,s),x=void 0,!Kt||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(x=!0),f?x!==void 0?s.addEventListener(o,d,{capture:!0,passive:x}):s.addEventListener(o,d,!0):x!==void 0?s.addEventListener(o,d,{passive:x}):s.addEventListener(o,d,!1)}function Uc(s,o,d,f,x){var v=f;if((o&1)===0&&(o&2)===0&&f!==null)e:for(;;){if(f===null)return;var T=f.tag;if(T===3||T===4){var $=f.stateNode.containerInfo;if($===x||$.nodeType===8&&$.parentNode===x)break;if(T===4)for(T=f.return;T!==null;){var G=T.tag;if((G===3||G===4)&&(G=T.stateNode.containerInfo,G===x||G.nodeType===8&&G.parentNode===x))return;T=T.return}for(;$!==null;){if(T=Gi($),T===null)return;if(G=T.tag,G===5||G===6){f=v=T;continue e}$=$.parentNode}}f=f.return}Pr(function(){var ue=v,Ne=Vt(d),Ee=[];e:{var be=au.get(s);if(be!==void 0){var Le=ba,Ke=s;switch(s){case"keypress":if(va(d)===0)break e;case"keydown":case"keyup":Le=Ut;break;case"focusin":Ke="focus",Le=xn;break;case"focusout":Ke="blur",Le=xn;break;case"beforeblur":case"afterblur":Le=xn;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Le=wa;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Le=pl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Le=Kn;break;case nu:case ru:case su:Le=fl;break;case iu:Le=lo;break;case"scroll":Le=ns;break;case"wheel":Le=eg;break;case"copy":case"cut":case"paste":Le=m;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Le=Br}var Xe=(o&4)!==0,Vn=!Xe&&s==="scroll",ne=Xe?be!==null?be+"Capture":null:be;Xe=[];for(var Q=ue,se;Q!==null;){se=Q;var ke=se.stateNode;if(se.tag===5&&ke!==null&&(se=ke,ne!==null&&(ke=mt(Q,ne),ke!=null&&Xe.push(yo(Q,ke,se)))),Vn)break;Q=Q.return}0<Xe.length&&(be=new Le(be,Ke,null,d,Ne),Ee.push({event:be,listeners:Xe}))}}if((o&7)===0){e:{if(be=s==="mouseover"||s==="pointerover",Le=s==="mouseout"||s==="pointerout",be&&d!==He&&(Ke=d.relatedTarget||d.fromElement)&&(Gi(Ke)||Ke[Xs]))break e;if((Le||be)&&(be=Ne.window===Ne?Ne:(be=Ne.ownerDocument)?be.defaultView||be.parentWindow:window,Le?(Ke=d.relatedTarget||d.toElement,Le=ue,Ke=Ke?Gi(Ke):null,Ke!==null&&(Vn=bs(Ke),Ke!==Vn||Ke.tag!==5&&Ke.tag!==6)&&(Ke=null)):(Le=null,Ke=ue),Le!==Ke)){if(Xe=wa,ke="onMouseLeave",ne="onMouseEnter",Q="mouse",(s==="pointerout"||s==="pointerover")&&(Xe=Br,ke="onPointerLeave",ne="onPointerEnter",Q="pointer"),Vn=Le==null?be:Ta(Le),se=Ke==null?be:Ta(Ke),be=new Xe(ke,Q+"leave",Le,d,Ne),be.target=Vn,be.relatedTarget=se,ke=null,Gi(Ne)===ue&&(Xe=new Xe(ne,Q+"enter",Ke,d,Ne),Xe.target=se,Xe.relatedTarget=Vn,ke=Xe),Vn=ke,Le&&Ke)t:{for(Xe=Le,ne=Ke,Q=0,se=Xe;se;se=Ia(se))Q++;for(se=0,ke=ne;ke;ke=Ia(ke))se++;for(;0<Q-se;)Xe=Ia(Xe),Q--;for(;0<se-Q;)ne=Ia(ne),se--;for(;Q--;){if(Xe===ne||ne!==null&&Xe===ne.alternate)break t;Xe=Ia(Xe),ne=Ia(ne)}Xe=null}else Xe=null;Le!==null&&uu(Ee,be,Le,Xe,!1),Ke!==null&&Vn!==null&&uu(Ee,Vn,Ke,Xe,!0)}}e:{if(be=ue?Ta(ue):window,Le=be.nodeName&&be.nodeName.toLowerCase(),Le==="select"||Le==="input"&&be.type==="file")var nt=Hi;else if(Ys(be))if(mo)nt=sg;else{nt=rg;var dt=yl}else(Le=be.nodeName)&&Le.toLowerCase()==="input"&&(be.type==="checkbox"||be.type==="radio")&&(nt=Tt);if(nt&&(nt=nt(s,ue))){Js(Ee,nt,d,Ne);break e}dt&&dt(s,be,ue),s==="focusout"&&(dt=be._wrapperState)&&dt.controlled&&be.type==="number"&&wt(be,"number",be.value)}switch(dt=ue?Ta(ue):window,s){case"focusin":(Ys(dt)||dt.contentEditable==="true")&&(_a=dt,Mc=ue,fo=null);break;case"focusout":fo=Mc=_a=null;break;case"mousedown":Vc=!0;break;case"contextmenu":case"mouseup":case"dragend":Vc=!1,eu(Ee,d,Ne);break;case"selectionchange":if(um)break;case"keydown":case"keyup":eu(Ee,d,Ne)}var ut;if(Hd)e:{switch(s){case"compositionstart":var pt="onCompositionStart";break e;case"compositionend":pt="onCompositionEnd";break e;case"compositionupdate":pt="onCompositionUpdate";break e}pt=void 0}else uo?im(s,d)&&(pt="onCompositionEnd"):s==="keydown"&&d.keyCode===229&&(pt="onCompositionStart");pt&&(Gd&&d.locale!=="ko"&&(uo||pt!=="onCompositionStart"?pt==="onCompositionEnd"&&uo&&(ut=hn()):(ts=Ne,hl="value"in ts?ts.value:ts.textContent,uo=!0)),dt=_l(ue,pt),0<dt.length&&(pt=new I(pt,s,null,d,Ne),Ee.push({event:pt,listeners:dt}),ut?pt.data=ut:(ut=am(d),ut!==null&&(pt.data=ut)))),(ut=rm?om(s,d):ss(s,d))&&(ue=_l(ue,"onBeforeInput"),0<ue.length&&(Ne=new I("onBeforeInput","beforeinput",null,d,Ne),Ee.push({event:Ne,listeners:ue}),Ne.data=ut))}cu(Ee,o)})}function yo(s,o,d){return{instance:s,listener:o,currentTarget:d}}function _l(s,o){for(var d=o+"Capture",f=[];s!==null;){var x=s,v=x.stateNode;x.tag===5&&v!==null&&(x=v,v=mt(s,d),v!=null&&f.unshift(yo(s,v,x)),v=mt(s,o),v!=null&&f.push(yo(s,v,x))),s=s.return}return f}function Ia(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function uu(s,o,d,f,x){for(var v=o._reactName,T=[];d!==null&&d!==f;){var $=d,G=$.alternate,ue=$.stateNode;if(G!==null&&G===f)break;$.tag===5&&ue!==null&&($=ue,x?(G=mt(d,v),G!=null&&T.unshift(yo(d,G,$))):x||(G=mt(d,v),G!=null&&T.push(yo(d,G,$)))),d=d.return}T.length!==0&&s.push({event:o,listeners:T})}var fm=/\r\n?/g,gm=/\u0000|\uFFFD/g;function hu(s){return(typeof s=="string"?s:""+s).replace(fm,`
`).replace(gm,"")}function Nl(s,o,d){if(o=hu(o),hu(s)!==o&&d)throw Error(t(425))}function Il(){}var zc=null,qc=null;function Wc(s,o){return s==="textarea"||s==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Hc=typeof setTimeout=="function"?setTimeout:void 0,xm=typeof clearTimeout=="function"?clearTimeout:void 0,mu=typeof Promise=="function"?Promise:void 0,ym=typeof queueMicrotask=="function"?queueMicrotask:typeof mu<"u"?function(s){return mu.resolve(null).then(s).catch(vm)}:Hc;function vm(s){setTimeout(function(){throw s})}function Gc(s,o){var d=o,f=0;do{var x=d.nextSibling;if(s.removeChild(d),x&&x.nodeType===8)if(d=x.data,d==="/$"){if(f===0){s.removeChild(x),Is(o);return}f--}else d!=="$"&&d!=="$?"&&d!=="$!"||f++;d=x}while(d);Is(o)}function Si(s){for(;s!=null;s=s.nextSibling){var o=s.nodeType;if(o===1||o===3)break;if(o===8){if(o=s.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return s}function pu(s){s=s.previousSibling;for(var o=0;s;){if(s.nodeType===8){var d=s.data;if(d==="$"||d==="$!"||d==="$?"){if(o===0)return s;o--}else d==="/$"&&o++}s=s.previousSibling}return null}var Ea=Math.random().toString(36).slice(2),As="__reactFiber$"+Ea,vo="__reactProps$"+Ea,Xs="__reactContainer$"+Ea,Kc="__reactEvents$"+Ea,bm="__reactListeners$"+Ea,wm="__reactHandles$"+Ea;function Gi(s){var o=s[As];if(o)return o;for(var d=s.parentNode;d;){if(o=d[Xs]||d[As]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(s=pu(s);s!==null;){if(d=s[As])return d;s=pu(s)}return o}s=d,d=s.parentNode}return null}function bo(s){return s=s[As]||s[Xs],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function Ta(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(t(33))}function El(s){return s[vo]||null}var Qc=[],Sa=-1;function Ai(s){return{current:s}}function an(s){0>Sa||(s.current=Qc[Sa],Qc[Sa]=null,Sa--)}function Jt(s,o){Sa++,Qc[Sa]=s.current,s.current=o}var ji={},Qn=Ai(ji),cr=Ai(!1),Ki=ji;function Aa(s,o){var d=s.type.contextTypes;if(!d)return ji;var f=s.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===o)return f.__reactInternalMemoizedMaskedChildContext;var x={},v;for(v in d)x[v]=o[v];return f&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=o,s.__reactInternalMemoizedMaskedChildContext=x),x}function dr(s){return s=s.childContextTypes,s!=null}function Tl(){an(cr),an(Qn)}function fu(s,o,d){if(Qn.current!==ji)throw Error(t(168));Jt(Qn,o),Jt(cr,d)}function gu(s,o,d){var f=s.stateNode;if(o=o.childContextTypes,typeof f.getChildContext!="function")return d;f=f.getChildContext();for(var x in f)if(!(x in o))throw Error(t(108,$e(s)||"Unknown",x));return W({},d,f)}function Sl(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||ji,Ki=Qn.current,Jt(Qn,s),Jt(cr,cr.current),!0}function xu(s,o,d){var f=s.stateNode;if(!f)throw Error(t(169));d?(s=gu(s,o,Ki),f.__reactInternalMemoizedMergedChildContext=s,an(cr),an(Qn),Jt(Qn,s)):an(cr),Jt(cr,d)}var Zs=null,Al=!1,Yc=!1;function yu(s){Zs===null?Zs=[s]:Zs.push(s)}function _m(s){Al=!0,yu(s)}function ki(){if(!Yc&&Zs!==null){Yc=!0;var s=0,o=ft;try{var d=Zs;for(ft=1;s<d.length;s++){var f=d[s];do f=f(!0);while(f!==null)}Zs=null,Al=!1}catch(x){throw Zs!==null&&(Zs=Zs.slice(s+1)),no(ro,ki),x}finally{ft=o,Yc=!1}}return null}var ja=[],ka=0,h=null,_=0,N=[],S=0,A=null,oe=1,Y="";function Z(s,o){ja[ka++]=_,ja[ka++]=h,h=s,_=o}function De(s,o,d){N[S++]=oe,N[S++]=Y,N[S++]=A,A=s;var f=oe;s=Y;var x=32-br(f)-1;f&=~(1<<x),d+=1;var v=32-br(o)+x;if(30<v){var T=x-x%5;v=(f&(1<<T)-1).toString(32),f>>=T,x-=T,oe=1<<32-br(o)+x|d<<x|f,Y=v+s}else oe=1<<v|d<<x|f,Y=s}function Je(s){s.return!==null&&(Z(s,1),De(s,1,0))}function je(s){for(;s===h;)h=ja[--ka],ja[ka]=null,_=ja[--ka],ja[ka]=null;for(;s===A;)A=N[--S],N[S]=null,Y=N[--S],N[S]=null,oe=N[--S],N[S]=null}var Fe=null,et=null,tt=!1,St=null;function ur(s,o){var d=ri(5,null,null,0);d.elementType="DELETED",d.stateNode=o,d.return=s,o=s.deletions,o===null?(s.deletions=[d],s.flags|=16):o.push(d)}function Ge(s,o){switch(s.tag){case 5:var d=s.type;return o=o.nodeType!==1||d.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(s.stateNode=o,Fe=s,et=Si(o.firstChild),!0):!1;case 6:return o=s.pendingProps===""||o.nodeType!==3?null:o,o!==null?(s.stateNode=o,Fe=s,et=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(d=A!==null?{id:oe,overflow:Y}:null,s.memoizedState={dehydrated:o,treeContext:d,retryLane:1073741824},d=ri(18,null,null,0),d.stateNode=o,d.return=s,s.child=d,Fe=s,et=null,!0):!1;default:return!1}}function $n(s){return(s.mode&1)!==0&&(s.flags&128)===0}function Ur(s){if(tt){var o=et;if(o){var d=o;if(!Ge(s,o)){if($n(s))throw Error(t(418));o=Si(d.nextSibling);var f=Fe;o&&Ge(s,o)?ur(f,d):(s.flags=s.flags&-4097|2,tt=!1,Fe=s)}}else{if($n(s))throw Error(t(418));s.flags=s.flags&-4097|2,tt=!1,Fe=s}}}function as(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;Fe=s}function Et(s){if(s!==Fe)return!1;if(!tt)return as(s),tt=!0,!1;var o;if((o=s.tag!==3)&&!(o=s.tag!==5)&&(o=s.type,o=o!=="head"&&o!=="body"&&!Wc(s.type,s.memoizedProps)),o&&(o=et)){if($n(s))throw on(),Error(t(418));for(;o;)ur(s,o),o=Si(o.nextSibling)}if(as(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(t(317));e:{for(s=s.nextSibling,o=0;s;){if(s.nodeType===8){var d=s.data;if(d==="/$"){if(o===0){et=Si(s.nextSibling);break e}o--}else d!=="$"&&d!=="$!"&&d!=="$?"||o++}s=s.nextSibling}et=null}}else et=Fe?Si(s.stateNode.nextSibling):null;return!0}function on(){for(var s=et;s;)s=Si(s.nextSibling)}function Xt(){et=Fe=null,tt=!1}function Fn(s){St===null?St=[s]:St.push(s)}var hr=he.ReactCurrentBatchConfig;function mr(s,o,d){if(s=d.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(t(309));var f=d.stateNode}if(!f)throw Error(t(147,s));var x=f,v=""+s;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===v?o.ref:(o=function(T){var $=x.refs;T===null?delete $[v]:$[v]=T},o._stringRef=v,o)}if(typeof s!="string")throw Error(t(284));if(!d._owner)throw Error(t(290,s))}return s}function Sn(s,o){throw s=Object.prototype.toString.call(o),Error(t(31,s==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":s))}function os(s){var o=s._init;return o(s._payload)}function jl(s){function o(ne,Q){if(s){var se=ne.deletions;se===null?(ne.deletions=[Q],ne.flags|=16):se.push(Q)}}function d(ne,Q){if(!s)return null;for(;Q!==null;)o(ne,Q),Q=Q.sibling;return null}function f(ne,Q){for(ne=new Map;Q!==null;)Q.key!==null?ne.set(Q.key,Q):ne.set(Q.index,Q),Q=Q.sibling;return ne}function x(ne,Q){return ne=Ao(ne,Q),ne.index=0,ne.sibling=null,ne}function v(ne,Q,se){return ne.index=se,s?(se=ne.alternate,se!==null?(se=se.index,se<Q?(ne.flags|=2,Q):se):(ne.flags|=2,Q)):(ne.flags|=1048576,Q)}function T(ne){return s&&ne.alternate===null&&(ne.flags|=2),ne}function $(ne,Q,se,ke){return Q===null||Q.tag!==6?(Q=Qg(se,ne.mode,ke),Q.return=ne,Q):(Q=x(Q,se),Q.return=ne,Q)}function G(ne,Q,se,ke){var nt=se.type;return nt===D?Ne(ne,Q,se.props.children,ke,se.key):Q!==null&&(Q.elementType===nt||typeof nt=="object"&&nt!==null&&nt.$$typeof===Te&&os(nt)===Q.type)?(ke=x(Q,se.props),ke.ref=mr(ne,Q,se),ke.return=ne,ke):(ke=Wm(se.type,se.key,se.props,null,ne.mode,ke),ke.ref=mr(ne,Q,se),ke.return=ne,ke)}function ue(ne,Q,se,ke){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==se.containerInfo||Q.stateNode.implementation!==se.implementation?(Q=Yg(se,ne.mode,ke),Q.return=ne,Q):(Q=x(Q,se.children||[]),Q.return=ne,Q)}function Ne(ne,Q,se,ke,nt){return Q===null||Q.tag!==7?(Q=Ll(se,ne.mode,ke,nt),Q.return=ne,Q):(Q=x(Q,se),Q.return=ne,Q)}function Ee(ne,Q,se){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Q=Qg(""+Q,ne.mode,se),Q.return=ne,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case j:return se=Wm(Q.type,Q.key,Q.props,null,ne.mode,se),se.ref=mr(ne,null,Q),se.return=ne,se;case ce:return Q=Yg(Q,ne.mode,se),Q.return=ne,Q;case Te:var ke=Q._init;return Ee(ne,ke(Q._payload),se)}if(_t(Q)||P(Q))return Q=Ll(Q,ne.mode,se,null),Q.return=ne,Q;Sn(ne,Q)}return null}function be(ne,Q,se,ke){var nt=Q!==null?Q.key:null;if(typeof se=="string"&&se!==""||typeof se=="number")return nt!==null?null:$(ne,Q,""+se,ke);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case j:return se.key===nt?G(ne,Q,se,ke):null;case ce:return se.key===nt?ue(ne,Q,se,ke):null;case Te:return nt=se._init,be(ne,Q,nt(se._payload),ke)}if(_t(se)||P(se))return nt!==null?null:Ne(ne,Q,se,ke,null);Sn(ne,se)}return null}function Le(ne,Q,se,ke,nt){if(typeof ke=="string"&&ke!==""||typeof ke=="number")return ne=ne.get(se)||null,$(Q,ne,""+ke,nt);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case j:return ne=ne.get(ke.key===null?se:ke.key)||null,G(Q,ne,ke,nt);case ce:return ne=ne.get(ke.key===null?se:ke.key)||null,ue(Q,ne,ke,nt);case Te:var dt=ke._init;return Le(ne,Q,se,dt(ke._payload),nt)}if(_t(ke)||P(ke))return ne=ne.get(se)||null,Ne(Q,ne,ke,nt,null);Sn(Q,ke)}return null}function Ke(ne,Q,se,ke){for(var nt=null,dt=null,ut=Q,pt=Q=0,sr=null;ut!==null&&pt<se.length;pt++){ut.index>pt?(sr=ut,ut=null):sr=ut.sibling;var zt=be(ne,ut,se[pt],ke);if(zt===null){ut===null&&(ut=sr);break}s&&ut&&zt.alternate===null&&o(ne,ut),Q=v(zt,Q,pt),dt===null?nt=zt:dt.sibling=zt,dt=zt,ut=sr}if(pt===se.length)return d(ne,ut),tt&&Z(ne,pt),nt;if(ut===null){for(;pt<se.length;pt++)ut=Ee(ne,se[pt],ke),ut!==null&&(Q=v(ut,Q,pt),dt===null?nt=ut:dt.sibling=ut,dt=ut);return tt&&Z(ne,pt),nt}for(ut=f(ne,ut);pt<se.length;pt++)sr=Le(ut,ne,pt,se[pt],ke),sr!==null&&(s&&sr.alternate!==null&&ut.delete(sr.key===null?pt:sr.key),Q=v(sr,Q,pt),dt===null?nt=sr:dt.sibling=sr,dt=sr);return s&&ut.forEach(function(jo){return o(ne,jo)}),tt&&Z(ne,pt),nt}function Xe(ne,Q,se,ke){var nt=P(se);if(typeof nt!="function")throw Error(t(150));if(se=nt.call(se),se==null)throw Error(t(151));for(var dt=nt=null,ut=Q,pt=Q=0,sr=null,zt=se.next();ut!==null&&!zt.done;pt++,zt=se.next()){ut.index>pt?(sr=ut,ut=null):sr=ut.sibling;var jo=be(ne,ut,zt.value,ke);if(jo===null){ut===null&&(ut=sr);break}s&&ut&&jo.alternate===null&&o(ne,ut),Q=v(jo,Q,pt),dt===null?nt=jo:dt.sibling=jo,dt=jo,ut=sr}if(zt.done)return d(ne,ut),tt&&Z(ne,pt),nt;if(ut===null){for(;!zt.done;pt++,zt=se.next())zt=Ee(ne,zt.value,ke),zt!==null&&(Q=v(zt,Q,pt),dt===null?nt=zt:dt.sibling=zt,dt=zt);return tt&&Z(ne,pt),nt}for(ut=f(ne,ut);!zt.done;pt++,zt=se.next())zt=Le(ut,ne,pt,zt.value,ke),zt!==null&&(s&&zt.alternate!==null&&ut.delete(zt.key===null?pt:zt.key),Q=v(zt,Q,pt),dt===null?nt=zt:dt.sibling=zt,dt=zt);return s&&ut.forEach(function(BS){return o(ne,BS)}),tt&&Z(ne,pt),nt}function Vn(ne,Q,se,ke){if(typeof se=="object"&&se!==null&&se.type===D&&se.key===null&&(se=se.props.children),typeof se=="object"&&se!==null){switch(se.$$typeof){case j:e:{for(var nt=se.key,dt=Q;dt!==null;){if(dt.key===nt){if(nt=se.type,nt===D){if(dt.tag===7){d(ne,dt.sibling),Q=x(dt,se.props.children),Q.return=ne,ne=Q;break e}}else if(dt.elementType===nt||typeof nt=="object"&&nt!==null&&nt.$$typeof===Te&&os(nt)===dt.type){d(ne,dt.sibling),Q=x(dt,se.props),Q.ref=mr(ne,dt,se),Q.return=ne,ne=Q;break e}d(ne,dt);break}else o(ne,dt);dt=dt.sibling}se.type===D?(Q=Ll(se.props.children,ne.mode,ke,se.key),Q.return=ne,ne=Q):(ke=Wm(se.type,se.key,se.props,null,ne.mode,ke),ke.ref=mr(ne,Q,se),ke.return=ne,ne=ke)}return T(ne);case ce:e:{for(dt=se.key;Q!==null;){if(Q.key===dt)if(Q.tag===4&&Q.stateNode.containerInfo===se.containerInfo&&Q.stateNode.implementation===se.implementation){d(ne,Q.sibling),Q=x(Q,se.children||[]),Q.return=ne,ne=Q;break e}else{d(ne,Q);break}else o(ne,Q);Q=Q.sibling}Q=Yg(se,ne.mode,ke),Q.return=ne,ne=Q}return T(ne);case Te:return dt=se._init,Vn(ne,Q,dt(se._payload),ke)}if(_t(se))return Ke(ne,Q,se,ke);if(P(se))return Xe(ne,Q,se,ke);Sn(ne,se)}return typeof se=="string"&&se!==""||typeof se=="number"?(se=""+se,Q!==null&&Q.tag===6?(d(ne,Q.sibling),Q=x(Q,se),Q.return=ne,ne=Q):(d(ne,Q),Q=Qg(se,ne.mode,ke),Q.return=ne,ne=Q),T(ne)):d(ne,Q)}return Vn}var Ca=jl(!0),vu=jl(!1),kl=Ai(null),Nm=null,Jc=null,ig=null;function ag(){ig=Jc=Nm=null}function og(s){var o=kl.current;an(kl),s._currentValue=o}function lg(s,o,d){for(;s!==null;){var f=s.alternate;if((s.childLanes&o)!==o?(s.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),s===d)break;s=s.return}}function Xc(s,o){Nm=s,ig=Jc=null,s=s.dependencies,s!==null&&s.firstContext!==null&&((s.lanes&o)!==0&&(ls=!0),s.firstContext=null)}function ei(s){var o=s._currentValue;if(ig!==s)if(s={context:s,memoizedValue:o,next:null},Jc===null){if(Nm===null)throw Error(t(308));Jc=s,Nm.dependencies={lanes:0,firstContext:s}}else Jc=Jc.next=s;return o}var Cl=null;function cg(s){Cl===null?Cl=[s]:Cl.push(s)}function lv(s,o,d,f){var x=o.interleaved;return x===null?(d.next=d,cg(o)):(d.next=x.next,x.next=d),o.interleaved=d,Ra(s,f)}function Ra(s,o){s.lanes|=o;var d=s.alternate;for(d!==null&&(d.lanes|=o),d=s,s=s.return;s!==null;)s.childLanes|=o,d=s.alternate,d!==null&&(d.childLanes|=o),d=s,s=s.return;return d.tag===3?d.stateNode:null}var wo=!1;function dg(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function cv(s,o){s=s.updateQueue,o.updateQueue===s&&(o.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function Da(s,o){return{eventTime:s,lane:o,tag:0,payload:null,callback:null,next:null}}function _o(s,o,d){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(Bt&2)!==0){var x=f.pending;return x===null?o.next=o:(o.next=x.next,x.next=o),f.pending=o,Ra(s,d)}return x=f.interleaved,x===null?(o.next=o,cg(f)):(o.next=x.next,x.next=o),f.interleaved=o,Ra(s,d)}function Im(s,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194240)!==0)){var f=o.lanes;f&=s.pendingLanes,d|=f,o.lanes=d,ao(s,d)}}function dv(s,o){var d=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,d===f)){var x=null,v=null;if(d=d.firstBaseUpdate,d!==null){do{var T={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};v===null?x=v=T:v=v.next=T,d=d.next}while(d!==null);v===null?x=v=o:v=v.next=o}else x=v=o;d={baseState:f.baseState,firstBaseUpdate:x,lastBaseUpdate:v,shared:f.shared,effects:f.effects},s.updateQueue=d;return}s=d.lastBaseUpdate,s===null?d.firstBaseUpdate=o:s.next=o,d.lastBaseUpdate=o}function Em(s,o,d,f){var x=s.updateQueue;wo=!1;var v=x.firstBaseUpdate,T=x.lastBaseUpdate,$=x.shared.pending;if($!==null){x.shared.pending=null;var G=$,ue=G.next;G.next=null,T===null?v=ue:T.next=ue,T=G;var Ne=s.alternate;Ne!==null&&(Ne=Ne.updateQueue,$=Ne.lastBaseUpdate,$!==T&&($===null?Ne.firstBaseUpdate=ue:$.next=ue,Ne.lastBaseUpdate=G))}if(v!==null){var Ee=x.baseState;T=0,Ne=ue=G=null,$=v;do{var be=$.lane,Le=$.eventTime;if((f&be)===be){Ne!==null&&(Ne=Ne.next={eventTime:Le,lane:0,tag:$.tag,payload:$.payload,callback:$.callback,next:null});e:{var Ke=s,Xe=$;switch(be=o,Le=d,Xe.tag){case 1:if(Ke=Xe.payload,typeof Ke=="function"){Ee=Ke.call(Le,Ee,be);break e}Ee=Ke;break e;case 3:Ke.flags=Ke.flags&-65537|128;case 0:if(Ke=Xe.payload,be=typeof Ke=="function"?Ke.call(Le,Ee,be):Ke,be==null)break e;Ee=W({},Ee,be);break e;case 2:wo=!0}}$.callback!==null&&$.lane!==0&&(s.flags|=64,be=x.effects,be===null?x.effects=[$]:be.push($))}else Le={eventTime:Le,lane:be,tag:$.tag,payload:$.payload,callback:$.callback,next:null},Ne===null?(ue=Ne=Le,G=Ee):Ne=Ne.next=Le,T|=be;if($=$.next,$===null){if($=x.shared.pending,$===null)break;be=$,$=be.next,be.next=null,x.lastBaseUpdate=be,x.shared.pending=null}}while(!0);if(Ne===null&&(G=Ee),x.baseState=G,x.firstBaseUpdate=ue,x.lastBaseUpdate=Ne,o=x.shared.interleaved,o!==null){x=o;do T|=x.lane,x=x.next;while(x!==o)}else v===null&&(x.shared.lanes=0);Pl|=T,s.lanes=T,s.memoizedState=Ee}}function uv(s,o,d){if(s=o.effects,o.effects=null,s!==null)for(o=0;o<s.length;o++){var f=s[o],x=f.callback;if(x!==null){if(f.callback=null,f=d,typeof x!="function")throw Error(t(191,x));x.call(f)}}}var bu={},Qi=Ai(bu),wu=Ai(bu),_u=Ai(bu);function Rl(s){if(s===bu)throw Error(t(174));return s}function ug(s,o){switch(Jt(_u,o),Jt(wu,s),Jt(Qi,bu),s=o.nodeType,s){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Bs(null,"");break;default:s=s===8?o.parentNode:o,o=s.namespaceURI||null,s=s.tagName,o=Bs(o,s)}an(Qi),Jt(Qi,o)}function Zc(){an(Qi),an(wu),an(_u)}function hv(s){Rl(_u.current);var o=Rl(Qi.current),d=Bs(o,s.type);o!==d&&(Jt(wu,s),Jt(Qi,d))}function hg(s){wu.current===s&&(an(Qi),an(wu))}var _n=Ai(0);function Tm(s){for(var o=s;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var mg=[];function pg(){for(var s=0;s<mg.length;s++)mg[s]._workInProgressVersionPrimary=null;mg.length=0}var Sm=he.ReactCurrentDispatcher,fg=he.ReactCurrentBatchConfig,Dl=0,Nn=null,Yn=null,nr=null,Am=!1,Nu=!1,Iu=0,cS=0;function Nr(){throw Error(t(321))}function gg(s,o){if(o===null)return!1;for(var d=0;d<o.length&&d<s.length;d++)if(!is(s[d],o[d]))return!1;return!0}function xg(s,o,d,f,x,v){if(Dl=v,Nn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Sm.current=s===null||s.memoizedState===null?mS:pS,s=d(f,x),Nu){v=0;do{if(Nu=!1,Iu=0,25<=v)throw Error(t(301));v+=1,nr=Yn=null,o.updateQueue=null,Sm.current=fS,s=d(f,x)}while(Nu)}if(Sm.current=Cm,o=Yn!==null&&Yn.next!==null,Dl=0,nr=Yn=Nn=null,Am=!1,o)throw Error(t(300));return s}function yg(){var s=Iu!==0;return Iu=0,s}function Yi(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nr===null?Nn.memoizedState=nr=s:nr=nr.next=s,nr}function ti(){if(Yn===null){var s=Nn.alternate;s=s!==null?s.memoizedState:null}else s=Yn.next;var o=nr===null?Nn.memoizedState:nr.next;if(o!==null)nr=o,Yn=s;else{if(s===null)throw Error(t(310));Yn=s,s={memoizedState:Yn.memoizedState,baseState:Yn.baseState,baseQueue:Yn.baseQueue,queue:Yn.queue,next:null},nr===null?Nn.memoizedState=nr=s:nr=nr.next=s}return nr}function Eu(s,o){return typeof o=="function"?o(s):o}function vg(s){var o=ti(),d=o.queue;if(d===null)throw Error(t(311));d.lastRenderedReducer=s;var f=Yn,x=f.baseQueue,v=d.pending;if(v!==null){if(x!==null){var T=x.next;x.next=v.next,v.next=T}f.baseQueue=x=v,d.pending=null}if(x!==null){v=x.next,f=f.baseState;var $=T=null,G=null,ue=v;do{var Ne=ue.lane;if((Dl&Ne)===Ne)G!==null&&(G=G.next={lane:0,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),f=ue.hasEagerState?ue.eagerState:s(f,ue.action);else{var Ee={lane:Ne,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null};G===null?($=G=Ee,T=f):G=G.next=Ee,Nn.lanes|=Ne,Pl|=Ne}ue=ue.next}while(ue!==null&&ue!==v);G===null?T=f:G.next=$,is(f,o.memoizedState)||(ls=!0),o.memoizedState=f,o.baseState=T,o.baseQueue=G,d.lastRenderedState=f}if(s=d.interleaved,s!==null){x=s;do v=x.lane,Nn.lanes|=v,Pl|=v,x=x.next;while(x!==s)}else x===null&&(d.lanes=0);return[o.memoizedState,d.dispatch]}function bg(s){var o=ti(),d=o.queue;if(d===null)throw Error(t(311));d.lastRenderedReducer=s;var f=d.dispatch,x=d.pending,v=o.memoizedState;if(x!==null){d.pending=null;var T=x=x.next;do v=s(v,T.action),T=T.next;while(T!==x);is(v,o.memoizedState)||(ls=!0),o.memoizedState=v,o.baseQueue===null&&(o.baseState=v),d.lastRenderedState=v}return[v,f]}function mv(){}function pv(s,o){var d=Nn,f=ti(),x=o(),v=!is(f.memoizedState,x);if(v&&(f.memoizedState=x,ls=!0),f=f.queue,wg(xv.bind(null,d,f,s),[s]),f.getSnapshot!==o||v||nr!==null&&nr.memoizedState.tag&1){if(d.flags|=2048,Tu(9,gv.bind(null,d,f,x,o),void 0,null),rr===null)throw Error(t(349));(Dl&30)!==0||fv(d,o,x)}return x}function fv(s,o,d){s.flags|=16384,s={getSnapshot:o,value:d},o=Nn.updateQueue,o===null?(o={lastEffect:null,stores:null},Nn.updateQueue=o,o.stores=[s]):(d=o.stores,d===null?o.stores=[s]:d.push(s))}function gv(s,o,d,f){o.value=d,o.getSnapshot=f,yv(o)&&vv(s)}function xv(s,o,d){return d(function(){yv(o)&&vv(s)})}function yv(s){var o=s.getSnapshot;s=s.value;try{var d=o();return!is(s,d)}catch{return!0}}function vv(s){var o=Ra(s,1);o!==null&&Pi(o,s,1,-1)}function bv(s){var o=Yi();return typeof s=="function"&&(s=s()),o.memoizedState=o.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Eu,lastRenderedState:s},o.queue=s,s=s.dispatch=hS.bind(null,Nn,s),[o.memoizedState,s]}function Tu(s,o,d,f){return s={tag:s,create:o,destroy:d,deps:f,next:null},o=Nn.updateQueue,o===null?(o={lastEffect:null,stores:null},Nn.updateQueue=o,o.lastEffect=s.next=s):(d=o.lastEffect,d===null?o.lastEffect=s.next=s:(f=d.next,d.next=s,s.next=f,o.lastEffect=s)),s}function wv(){return ti().memoizedState}function jm(s,o,d,f){var x=Yi();Nn.flags|=s,x.memoizedState=Tu(1|o,d,void 0,f===void 0?null:f)}function km(s,o,d,f){var x=ti();f=f===void 0?null:f;var v=void 0;if(Yn!==null){var T=Yn.memoizedState;if(v=T.destroy,f!==null&&gg(f,T.deps)){x.memoizedState=Tu(o,d,v,f);return}}Nn.flags|=s,x.memoizedState=Tu(1|o,d,v,f)}function _v(s,o){return jm(8390656,8,s,o)}function wg(s,o){return km(2048,8,s,o)}function Nv(s,o){return km(4,2,s,o)}function Iv(s,o){return km(4,4,s,o)}function Ev(s,o){if(typeof o=="function")return s=s(),o(s),function(){o(null)};if(o!=null)return s=s(),o.current=s,function(){o.current=null}}function Tv(s,o,d){return d=d!=null?d.concat([s]):null,km(4,4,Ev.bind(null,o,s),d)}function _g(){}function Sv(s,o){var d=ti();o=o===void 0?null:o;var f=d.memoizedState;return f!==null&&o!==null&&gg(o,f[1])?f[0]:(d.memoizedState=[s,o],s)}function Av(s,o){var d=ti();o=o===void 0?null:o;var f=d.memoizedState;return f!==null&&o!==null&&gg(o,f[1])?f[0]:(s=s(),d.memoizedState=[s,o],s)}function jv(s,o,d){return(Dl&21)===0?(s.baseState&&(s.baseState=!1,ls=!0),s.memoizedState=d):(is(d,o)||(d=fa(),Nn.lanes|=d,Pl|=d,s.baseState=!0),o)}function dS(s,o){var d=ft;ft=d!==0&&4>d?d:4,s(!0);var f=fg.transition;fg.transition={};try{s(!1),o()}finally{ft=d,fg.transition=f}}function kv(){return ti().memoizedState}function uS(s,o,d){var f=To(s);if(d={lane:f,action:d,hasEagerState:!1,eagerState:null,next:null},Cv(s))Rv(o,d);else if(d=lv(s,o,d,f),d!==null){var x=qr();Pi(d,s,f,x),Dv(d,o,f)}}function hS(s,o,d){var f=To(s),x={lane:f,action:d,hasEagerState:!1,eagerState:null,next:null};if(Cv(s))Rv(o,x);else{var v=s.alternate;if(s.lanes===0&&(v===null||v.lanes===0)&&(v=o.lastRenderedReducer,v!==null))try{var T=o.lastRenderedState,$=v(T,d);if(x.hasEagerState=!0,x.eagerState=$,is($,T)){var G=o.interleaved;G===null?(x.next=x,cg(o)):(x.next=G.next,G.next=x),o.interleaved=x;return}}catch{}finally{}d=lv(s,o,x,f),d!==null&&(x=qr(),Pi(d,s,f,x),Dv(d,o,f))}}function Cv(s){var o=s.alternate;return s===Nn||o!==null&&o===Nn}function Rv(s,o){Nu=Am=!0;var d=s.pending;d===null?o.next=o:(o.next=d.next,d.next=o),s.pending=o}function Dv(s,o,d){if((d&4194240)!==0){var f=o.lanes;f&=s.pendingLanes,d|=f,o.lanes=d,ao(s,d)}}var Cm={readContext:ei,useCallback:Nr,useContext:Nr,useEffect:Nr,useImperativeHandle:Nr,useInsertionEffect:Nr,useLayoutEffect:Nr,useMemo:Nr,useReducer:Nr,useRef:Nr,useState:Nr,useDebugValue:Nr,useDeferredValue:Nr,useTransition:Nr,useMutableSource:Nr,useSyncExternalStore:Nr,useId:Nr,unstable_isNewReconciler:!1},mS={readContext:ei,useCallback:function(s,o){return Yi().memoizedState=[s,o===void 0?null:o],s},useContext:ei,useEffect:_v,useImperativeHandle:function(s,o,d){return d=d!=null?d.concat([s]):null,jm(4194308,4,Ev.bind(null,o,s),d)},useLayoutEffect:function(s,o){return jm(4194308,4,s,o)},useInsertionEffect:function(s,o){return jm(4,2,s,o)},useMemo:function(s,o){var d=Yi();return o=o===void 0?null:o,s=s(),d.memoizedState=[s,o],s},useReducer:function(s,o,d){var f=Yi();return o=d!==void 0?d(o):o,f.memoizedState=f.baseState=o,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:o},f.queue=s,s=s.dispatch=uS.bind(null,Nn,s),[f.memoizedState,s]},useRef:function(s){var o=Yi();return s={current:s},o.memoizedState=s},useState:bv,useDebugValue:_g,useDeferredValue:function(s){return Yi().memoizedState=s},useTransition:function(){var s=bv(!1),o=s[0];return s=dS.bind(null,s[1]),Yi().memoizedState=s,[o,s]},useMutableSource:function(){},useSyncExternalStore:function(s,o,d){var f=Nn,x=Yi();if(tt){if(d===void 0)throw Error(t(407));d=d()}else{if(d=o(),rr===null)throw Error(t(349));(Dl&30)!==0||fv(f,o,d)}x.memoizedState=d;var v={value:d,getSnapshot:o};return x.queue=v,_v(xv.bind(null,f,v,s),[s]),f.flags|=2048,Tu(9,gv.bind(null,f,v,d,o),void 0,null),d},useId:function(){var s=Yi(),o=rr.identifierPrefix;if(tt){var d=Y,f=oe;d=(f&~(1<<32-br(f)-1)).toString(32)+d,o=":"+o+"R"+d,d=Iu++,0<d&&(o+="H"+d.toString(32)),o+=":"}else d=cS++,o=":"+o+"r"+d.toString(32)+":";return s.memoizedState=o},unstable_isNewReconciler:!1},pS={readContext:ei,useCallback:Sv,useContext:ei,useEffect:wg,useImperativeHandle:Tv,useInsertionEffect:Nv,useLayoutEffect:Iv,useMemo:Av,useReducer:vg,useRef:wv,useState:function(){return vg(Eu)},useDebugValue:_g,useDeferredValue:function(s){var o=ti();return jv(o,Yn.memoizedState,s)},useTransition:function(){var s=vg(Eu)[0],o=ti().memoizedState;return[s,o]},useMutableSource:mv,useSyncExternalStore:pv,useId:kv,unstable_isNewReconciler:!1},fS={readContext:ei,useCallback:Sv,useContext:ei,useEffect:wg,useImperativeHandle:Tv,useInsertionEffect:Nv,useLayoutEffect:Iv,useMemo:Av,useReducer:bg,useRef:wv,useState:function(){return bg(Eu)},useDebugValue:_g,useDeferredValue:function(s){var o=ti();return Yn===null?o.memoizedState=s:jv(o,Yn.memoizedState,s)},useTransition:function(){var s=bg(Eu)[0],o=ti().memoizedState;return[s,o]},useMutableSource:mv,useSyncExternalStore:pv,useId:kv,unstable_isNewReconciler:!1};function Ci(s,o){if(s&&s.defaultProps){o=W({},o),s=s.defaultProps;for(var d in s)o[d]===void 0&&(o[d]=s[d]);return o}return o}function Ng(s,o,d,f){o=s.memoizedState,d=d(f,o),d=d==null?o:W({},o,d),s.memoizedState=d,s.lanes===0&&(s.updateQueue.baseState=d)}var Rm={isMounted:function(s){return(s=s._reactInternals)?bs(s)===s:!1},enqueueSetState:function(s,o,d){s=s._reactInternals;var f=qr(),x=To(s),v=Da(f,x);v.payload=o,d!=null&&(v.callback=d),o=_o(s,v,x),o!==null&&(Pi(o,s,x,f),Im(o,s,x))},enqueueReplaceState:function(s,o,d){s=s._reactInternals;var f=qr(),x=To(s),v=Da(f,x);v.tag=1,v.payload=o,d!=null&&(v.callback=d),o=_o(s,v,x),o!==null&&(Pi(o,s,x,f),Im(o,s,x))},enqueueForceUpdate:function(s,o){s=s._reactInternals;var d=qr(),f=To(s),x=Da(d,f);x.tag=2,o!=null&&(x.callback=o),o=_o(s,x,f),o!==null&&(Pi(o,s,f,d),Im(o,s,f))}};function Pv(s,o,d,f,x,v,T){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,v,T):o.prototype&&o.prototype.isPureReactComponent?!po(d,f)||!po(x,v):!0}function Ov(s,o,d){var f=!1,x=ji,v=o.contextType;return typeof v=="object"&&v!==null?v=ei(v):(x=dr(o)?Ki:Qn.current,f=o.contextTypes,v=(f=f!=null)?Aa(s,x):ji),o=new o(d,v),s.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Rm,s.stateNode=o,o._reactInternals=s,f&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=x,s.__reactInternalMemoizedMaskedChildContext=v),o}function Mv(s,o,d,f){s=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,f),o.state!==s&&Rm.enqueueReplaceState(o,o.state,null)}function Ig(s,o,d,f){var x=s.stateNode;x.props=d,x.state=s.memoizedState,x.refs={},dg(s);var v=o.contextType;typeof v=="object"&&v!==null?x.context=ei(v):(v=dr(o)?Ki:Qn.current,x.context=Aa(s,v)),x.state=s.memoizedState,v=o.getDerivedStateFromProps,typeof v=="function"&&(Ng(s,o,v,d),x.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(o=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),o!==x.state&&Rm.enqueueReplaceState(x,x.state,null),Em(s,d,x,f),x.state=s.memoizedState),typeof x.componentDidMount=="function"&&(s.flags|=4194308)}function ed(s,o){try{var d="",f=o;do d+=Ce(f),f=f.return;while(f);var x=d}catch(v){x=`
Error generating stack: `+v.message+`
`+v.stack}return{value:s,source:o,stack:x,digest:null}}function Eg(s,o,d){return{value:s,source:null,stack:d??null,digest:o??null}}function Tg(s,o){try{console.error(o.value)}catch(d){setTimeout(function(){throw d})}}var gS=typeof WeakMap=="function"?WeakMap:Map;function Vv(s,o,d){d=Da(-1,d),d.tag=3,d.payload={element:null};var f=o.value;return d.callback=function(){$m||($m=!0,Bg=f),Tg(s,o)},d}function Lv(s,o,d){d=Da(-1,d),d.tag=3;var f=s.type.getDerivedStateFromError;if(typeof f=="function"){var x=o.value;d.payload=function(){return f(x)},d.callback=function(){Tg(s,o)}}var v=s.stateNode;return v!==null&&typeof v.componentDidCatch=="function"&&(d.callback=function(){Tg(s,o),typeof f!="function"&&(Io===null?Io=new Set([this]):Io.add(this));var T=o.stack;this.componentDidCatch(o.value,{componentStack:T!==null?T:""})}),d}function $v(s,o,d){var f=s.pingCache;if(f===null){f=s.pingCache=new gS;var x=new Set;f.set(o,x)}else x=f.get(o),x===void 0&&(x=new Set,f.set(o,x));x.has(d)||(x.add(d),s=kS.bind(null,s,o,d),o.then(s,s))}function Fv(s){do{var o;if((o=s.tag===13)&&(o=s.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return s;s=s.return}while(s!==null);return null}function Bv(s,o,d,f,x){return(s.mode&1)===0?(s===o?s.flags|=65536:(s.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(o=Da(-1,1),o.tag=2,_o(d,o,1))),d.lanes|=1),s):(s.flags|=65536,s.lanes=x,s)}var xS=he.ReactCurrentOwner,ls=!1;function zr(s,o,d,f){o.child=s===null?vu(o,null,d,f):Ca(o,s.child,d,f)}function Uv(s,o,d,f,x){d=d.render;var v=o.ref;return Xc(o,x),f=xg(s,o,d,f,v,x),d=yg(),s!==null&&!ls?(o.updateQueue=s.updateQueue,o.flags&=-2053,s.lanes&=~x,Pa(s,o,x)):(tt&&d&&Je(o),o.flags|=1,zr(s,o,f,x),o.child)}function zv(s,o,d,f,x){if(s===null){var v=d.type;return typeof v=="function"&&!Kg(v)&&v.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(o.tag=15,o.type=v,qv(s,o,v,f,x)):(s=Wm(d.type,null,f,o,o.mode,x),s.ref=o.ref,s.return=o,o.child=s)}if(v=s.child,(s.lanes&x)===0){var T=v.memoizedProps;if(d=d.compare,d=d!==null?d:po,d(T,f)&&s.ref===o.ref)return Pa(s,o,x)}return o.flags|=1,s=Ao(v,f),s.ref=o.ref,s.return=o,o.child=s}function qv(s,o,d,f,x){if(s!==null){var v=s.memoizedProps;if(po(v,f)&&s.ref===o.ref)if(ls=!1,o.pendingProps=f=v,(s.lanes&x)!==0)(s.flags&131072)!==0&&(ls=!0);else return o.lanes=s.lanes,Pa(s,o,x)}return Sg(s,o,d,f,x)}function Wv(s,o,d){var f=o.pendingProps,x=f.children,v=s!==null?s.memoizedState:null;if(f.mode==="hidden")if((o.mode&1)===0)o.memoizedState={baseLanes:0,cachePool:null,transitions:null},Jt(nd,js),js|=d;else{if((d&1073741824)===0)return s=v!==null?v.baseLanes|d:d,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:s,cachePool:null,transitions:null},o.updateQueue=null,Jt(nd,js),js|=s,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=v!==null?v.baseLanes:d,Jt(nd,js),js|=f}else v!==null?(f=v.baseLanes|d,o.memoizedState=null):f=d,Jt(nd,js),js|=f;return zr(s,o,x,d),o.child}function Hv(s,o){var d=o.ref;(s===null&&d!==null||s!==null&&s.ref!==d)&&(o.flags|=512,o.flags|=2097152)}function Sg(s,o,d,f,x){var v=dr(d)?Ki:Qn.current;return v=Aa(o,v),Xc(o,x),d=xg(s,o,d,f,v,x),f=yg(),s!==null&&!ls?(o.updateQueue=s.updateQueue,o.flags&=-2053,s.lanes&=~x,Pa(s,o,x)):(tt&&f&&Je(o),o.flags|=1,zr(s,o,d,x),o.child)}function Gv(s,o,d,f,x){if(dr(d)){var v=!0;Sl(o)}else v=!1;if(Xc(o,x),o.stateNode===null)Pm(s,o),Ov(o,d,f),Ig(o,d,f,x),f=!0;else if(s===null){var T=o.stateNode,$=o.memoizedProps;T.props=$;var G=T.context,ue=d.contextType;typeof ue=="object"&&ue!==null?ue=ei(ue):(ue=dr(d)?Ki:Qn.current,ue=Aa(o,ue));var Ne=d.getDerivedStateFromProps,Ee=typeof Ne=="function"||typeof T.getSnapshotBeforeUpdate=="function";Ee||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||($!==f||G!==ue)&&Mv(o,T,f,ue),wo=!1;var be=o.memoizedState;T.state=be,Em(o,f,T,x),G=o.memoizedState,$!==f||be!==G||cr.current||wo?(typeof Ne=="function"&&(Ng(o,d,Ne,f),G=o.memoizedState),($=wo||Pv(o,d,$,f,be,G,ue))?(Ee||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(o.flags|=4194308)):(typeof T.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=G),T.props=f,T.state=G,T.context=ue,f=$):(typeof T.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{T=o.stateNode,cv(s,o),$=o.memoizedProps,ue=o.type===o.elementType?$:Ci(o.type,$),T.props=ue,Ee=o.pendingProps,be=T.context,G=d.contextType,typeof G=="object"&&G!==null?G=ei(G):(G=dr(d)?Ki:Qn.current,G=Aa(o,G));var Le=d.getDerivedStateFromProps;(Ne=typeof Le=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||($!==Ee||be!==G)&&Mv(o,T,f,G),wo=!1,be=o.memoizedState,T.state=be,Em(o,f,T,x);var Ke=o.memoizedState;$!==Ee||be!==Ke||cr.current||wo?(typeof Le=="function"&&(Ng(o,d,Le,f),Ke=o.memoizedState),(ue=wo||Pv(o,d,ue,f,be,Ke,G)||!1)?(Ne||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(f,Ke,G),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(f,Ke,G)),typeof T.componentDidUpdate=="function"&&(o.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof T.componentDidUpdate!="function"||$===s.memoizedProps&&be===s.memoizedState||(o.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||$===s.memoizedProps&&be===s.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=Ke),T.props=f,T.state=Ke,T.context=G,f=ue):(typeof T.componentDidUpdate!="function"||$===s.memoizedProps&&be===s.memoizedState||(o.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||$===s.memoizedProps&&be===s.memoizedState||(o.flags|=1024),f=!1)}return Ag(s,o,d,f,v,x)}function Ag(s,o,d,f,x,v){Hv(s,o);var T=(o.flags&128)!==0;if(!f&&!T)return x&&xu(o,d,!1),Pa(s,o,v);f=o.stateNode,xS.current=o;var $=T&&typeof d.getDerivedStateFromError!="function"?null:f.render();return o.flags|=1,s!==null&&T?(o.child=Ca(o,s.child,null,v),o.child=Ca(o,null,$,v)):zr(s,o,$,v),o.memoizedState=f.state,x&&xu(o,d,!0),o.child}function Kv(s){var o=s.stateNode;o.pendingContext?fu(s,o.pendingContext,o.pendingContext!==o.context):o.context&&fu(s,o.context,!1),ug(s,o.containerInfo)}function Qv(s,o,d,f,x){return Xt(),Fn(x),o.flags|=256,zr(s,o,d,f),o.child}var jg={dehydrated:null,treeContext:null,retryLane:0};function kg(s){return{baseLanes:s,cachePool:null,transitions:null}}function Yv(s,o,d){var f=o.pendingProps,x=_n.current,v=!1,T=(o.flags&128)!==0,$;if(($=T)||($=s!==null&&s.memoizedState===null?!1:(x&2)!==0),$?(v=!0,o.flags&=-129):(s===null||s.memoizedState!==null)&&(x|=1),Jt(_n,x&1),s===null)return Ur(o),s=o.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?((o.mode&1)===0?o.lanes=1:s.data==="$!"?o.lanes=8:o.lanes=1073741824,null):(T=f.children,s=f.fallback,v?(f=o.mode,v=o.child,T={mode:"hidden",children:T},(f&1)===0&&v!==null?(v.childLanes=0,v.pendingProps=T):v=Hm(T,f,0,null),s=Ll(s,f,d,null),v.return=o,s.return=o,v.sibling=s,o.child=v,o.child.memoizedState=kg(d),o.memoizedState=jg,s):Cg(o,T));if(x=s.memoizedState,x!==null&&($=x.dehydrated,$!==null))return yS(s,o,T,f,$,x,d);if(v){v=f.fallback,T=o.mode,x=s.child,$=x.sibling;var G={mode:"hidden",children:f.children};return(T&1)===0&&o.child!==x?(f=o.child,f.childLanes=0,f.pendingProps=G,o.deletions=null):(f=Ao(x,G),f.subtreeFlags=x.subtreeFlags&14680064),$!==null?v=Ao($,v):(v=Ll(v,T,d,null),v.flags|=2),v.return=o,f.return=o,f.sibling=v,o.child=f,f=v,v=o.child,T=s.child.memoizedState,T=T===null?kg(d):{baseLanes:T.baseLanes|d,cachePool:null,transitions:T.transitions},v.memoizedState=T,v.childLanes=s.childLanes&~d,o.memoizedState=jg,f}return v=s.child,s=v.sibling,f=Ao(v,{mode:"visible",children:f.children}),(o.mode&1)===0&&(f.lanes=d),f.return=o,f.sibling=null,s!==null&&(d=o.deletions,d===null?(o.deletions=[s],o.flags|=16):d.push(s)),o.child=f,o.memoizedState=null,f}function Cg(s,o){return o=Hm({mode:"visible",children:o},s.mode,0,null),o.return=s,s.child=o}function Dm(s,o,d,f){return f!==null&&Fn(f),Ca(o,s.child,null,d),s=Cg(o,o.pendingProps.children),s.flags|=2,o.memoizedState=null,s}function yS(s,o,d,f,x,v,T){if(d)return o.flags&256?(o.flags&=-257,f=Eg(Error(t(422))),Dm(s,o,T,f)):o.memoizedState!==null?(o.child=s.child,o.flags|=128,null):(v=f.fallback,x=o.mode,f=Hm({mode:"visible",children:f.children},x,0,null),v=Ll(v,x,T,null),v.flags|=2,f.return=o,v.return=o,f.sibling=v,o.child=f,(o.mode&1)!==0&&Ca(o,s.child,null,T),o.child.memoizedState=kg(T),o.memoizedState=jg,v);if((o.mode&1)===0)return Dm(s,o,T,null);if(x.data==="$!"){if(f=x.nextSibling&&x.nextSibling.dataset,f)var $=f.dgst;return f=$,v=Error(t(419)),f=Eg(v,f,void 0),Dm(s,o,T,f)}if($=(T&s.childLanes)!==0,ls||$){if(f=rr,f!==null){switch(T&-T){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=(x&(f.suspendedLanes|T))!==0?0:x,x!==0&&x!==v.retryLane&&(v.retryLane=x,Ra(s,x),Pi(f,s,x,-1))}return Gg(),f=Eg(Error(t(421))),Dm(s,o,T,f)}return x.data==="$?"?(o.flags|=128,o.child=s.child,o=CS.bind(null,s),x._reactRetry=o,null):(s=v.treeContext,et=Si(x.nextSibling),Fe=o,tt=!0,St=null,s!==null&&(N[S++]=oe,N[S++]=Y,N[S++]=A,oe=s.id,Y=s.overflow,A=o),o=Cg(o,f.children),o.flags|=4096,o)}function Jv(s,o,d){s.lanes|=o;var f=s.alternate;f!==null&&(f.lanes|=o),lg(s.return,o,d)}function Rg(s,o,d,f,x){var v=s.memoizedState;v===null?s.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:d,tailMode:x}:(v.isBackwards=o,v.rendering=null,v.renderingStartTime=0,v.last=f,v.tail=d,v.tailMode=x)}function Xv(s,o,d){var f=o.pendingProps,x=f.revealOrder,v=f.tail;if(zr(s,o,f.children,d),f=_n.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=o.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Jv(s,d,o);else if(s.tag===19)Jv(s,d,o);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===o)break e;for(;s.sibling===null;){if(s.return===null||s.return===o)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}f&=1}if(Jt(_n,f),(o.mode&1)===0)o.memoizedState=null;else switch(x){case"forwards":for(d=o.child,x=null;d!==null;)s=d.alternate,s!==null&&Tm(s)===null&&(x=d),d=d.sibling;d=x,d===null?(x=o.child,o.child=null):(x=d.sibling,d.sibling=null),Rg(o,!1,x,d,v);break;case"backwards":for(d=null,x=o.child,o.child=null;x!==null;){if(s=x.alternate,s!==null&&Tm(s)===null){o.child=x;break}s=x.sibling,x.sibling=d,d=x,x=s}Rg(o,!0,d,null,v);break;case"together":Rg(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Pm(s,o){(o.mode&1)===0&&s!==null&&(s.alternate=null,o.alternate=null,o.flags|=2)}function Pa(s,o,d){if(s!==null&&(o.dependencies=s.dependencies),Pl|=o.lanes,(d&o.childLanes)===0)return null;if(s!==null&&o.child!==s.child)throw Error(t(153));if(o.child!==null){for(s=o.child,d=Ao(s,s.pendingProps),o.child=d,d.return=o;s.sibling!==null;)s=s.sibling,d=d.sibling=Ao(s,s.pendingProps),d.return=o;d.sibling=null}return o.child}function vS(s,o,d){switch(o.tag){case 3:Kv(o),Xt();break;case 5:hv(o);break;case 1:dr(o.type)&&Sl(o);break;case 4:ug(o,o.stateNode.containerInfo);break;case 10:var f=o.type._context,x=o.memoizedProps.value;Jt(kl,f._currentValue),f._currentValue=x;break;case 13:if(f=o.memoizedState,f!==null)return f.dehydrated!==null?(Jt(_n,_n.current&1),o.flags|=128,null):(d&o.child.childLanes)!==0?Yv(s,o,d):(Jt(_n,_n.current&1),s=Pa(s,o,d),s!==null?s.sibling:null);Jt(_n,_n.current&1);break;case 19:if(f=(d&o.childLanes)!==0,(s.flags&128)!==0){if(f)return Xv(s,o,d);o.flags|=128}if(x=o.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),Jt(_n,_n.current),f)break;return null;case 22:case 23:return o.lanes=0,Wv(s,o,d)}return Pa(s,o,d)}var Zv,Dg,eb,tb;Zv=function(s,o){for(var d=o.child;d!==null;){if(d.tag===5||d.tag===6)s.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===o)break;for(;d.sibling===null;){if(d.return===null||d.return===o)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},Dg=function(){},eb=function(s,o,d,f){var x=s.memoizedProps;if(x!==f){s=o.stateNode,Rl(Qi.current);var v=null;switch(d){case"input":x=Ye(s,x),f=Ye(s,f),v=[];break;case"select":x=W({},x,{value:void 0}),f=W({},f,{value:void 0}),v=[];break;case"textarea":x=cn(s,x),f=cn(s,f),v=[];break;default:typeof x.onClick!="function"&&typeof f.onClick=="function"&&(s.onclick=Il)}We(d,f);var T;d=null;for(ue in x)if(!f.hasOwnProperty(ue)&&x.hasOwnProperty(ue)&&x[ue]!=null)if(ue==="style"){var $=x[ue];for(T in $)$.hasOwnProperty(T)&&(d||(d={}),d[T]="")}else ue!=="dangerouslySetInnerHTML"&&ue!=="children"&&ue!=="suppressContentEditableWarning"&&ue!=="suppressHydrationWarning"&&ue!=="autoFocus"&&(i.hasOwnProperty(ue)?v||(v=[]):(v=v||[]).push(ue,null));for(ue in f){var G=f[ue];if($=x!=null?x[ue]:void 0,f.hasOwnProperty(ue)&&G!==$&&(G!=null||$!=null))if(ue==="style")if($){for(T in $)!$.hasOwnProperty(T)||G&&G.hasOwnProperty(T)||(d||(d={}),d[T]="");for(T in G)G.hasOwnProperty(T)&&$[T]!==G[T]&&(d||(d={}),d[T]=G[T])}else d||(v||(v=[]),v.push(ue,d)),d=G;else ue==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,$=$?$.__html:void 0,G!=null&&$!==G&&(v=v||[]).push(ue,G)):ue==="children"?typeof G!="string"&&typeof G!="number"||(v=v||[]).push(ue,""+G):ue!=="suppressContentEditableWarning"&&ue!=="suppressHydrationWarning"&&(i.hasOwnProperty(ue)?(G!=null&&ue==="onScroll"&&sn("scroll",s),v||$===G||(v=[])):(v=v||[]).push(ue,G))}d&&(v=v||[]).push("style",d);var ue=v;(o.updateQueue=ue)&&(o.flags|=4)}},tb=function(s,o,d,f){d!==f&&(o.flags|=4)};function Su(s,o){if(!tt)switch(s.tailMode){case"hidden":o=s.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?s.tail=null:d.sibling=null;break;case"collapsed":d=s.tail;for(var f=null;d!==null;)d.alternate!==null&&(f=d),d=d.sibling;f===null?o||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function Ir(s){var o=s.alternate!==null&&s.alternate.child===s.child,d=0,f=0;if(o)for(var x=s.child;x!==null;)d|=x.lanes|x.childLanes,f|=x.subtreeFlags&14680064,f|=x.flags&14680064,x.return=s,x=x.sibling;else for(x=s.child;x!==null;)d|=x.lanes|x.childLanes,f|=x.subtreeFlags,f|=x.flags,x.return=s,x=x.sibling;return s.subtreeFlags|=f,s.childLanes=d,o}function bS(s,o,d){var f=o.pendingProps;switch(je(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ir(o),null;case 1:return dr(o.type)&&Tl(),Ir(o),null;case 3:return f=o.stateNode,Zc(),an(cr),an(Qn),pg(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(s===null||s.child===null)&&(Et(o)?o.flags|=4:s===null||s.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,St!==null&&(qg(St),St=null))),Dg(s,o),Ir(o),null;case 5:hg(o);var x=Rl(_u.current);if(d=o.type,s!==null&&o.stateNode!=null)eb(s,o,d,f,x),s.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!f){if(o.stateNode===null)throw Error(t(166));return Ir(o),null}if(s=Rl(Qi.current),Et(o)){f=o.stateNode,d=o.type;var v=o.memoizedProps;switch(f[As]=o,f[vo]=v,s=(o.mode&1)!==0,d){case"dialog":sn("cancel",f),sn("close",f);break;case"iframe":case"object":case"embed":sn("load",f);break;case"video":case"audio":for(x=0;x<go.length;x++)sn(go[x],f);break;case"source":sn("error",f);break;case"img":case"image":case"link":sn("error",f),sn("load",f);break;case"details":sn("toggle",f);break;case"input":un(f,v),sn("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!v.multiple},sn("invalid",f);break;case"textarea":yr(f,v),sn("invalid",f)}We(d,v),x=null;for(var T in v)if(v.hasOwnProperty(T)){var $=v[T];T==="children"?typeof $=="string"?f.textContent!==$&&(v.suppressHydrationWarning!==!0&&Nl(f.textContent,$,s),x=["children",$]):typeof $=="number"&&f.textContent!==""+$&&(v.suppressHydrationWarning!==!0&&Nl(f.textContent,$,s),x=["children",""+$]):i.hasOwnProperty(T)&&$!=null&&T==="onScroll"&&sn("scroll",f)}switch(d){case"input":On(f),bt(f,v,!0);break;case"textarea":On(f),Fs(f);break;case"select":case"option":break;default:typeof v.onClick=="function"&&(f.onclick=Il)}f=x,o.updateQueue=f,f!==null&&(o.flags|=4)}else{T=x.nodeType===9?x:x.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=fi(d)),s==="http://www.w3.org/1999/xhtml"?d==="script"?(s=T.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof f.is=="string"?s=T.createElement(d,{is:f.is}):(s=T.createElement(d),d==="select"&&(T=s,f.multiple?T.multiple=!0:f.size&&(T.size=f.size))):s=T.createElementNS(s,d),s[As]=o,s[vo]=f,Zv(s,o,!1,!1),o.stateNode=s;e:{switch(T=X(d,f),d){case"dialog":sn("cancel",s),sn("close",s),x=f;break;case"iframe":case"object":case"embed":sn("load",s),x=f;break;case"video":case"audio":for(x=0;x<go.length;x++)sn(go[x],s);x=f;break;case"source":sn("error",s),x=f;break;case"img":case"image":case"link":sn("error",s),sn("load",s),x=f;break;case"details":sn("toggle",s),x=f;break;case"input":un(s,f),x=Ye(s,f),sn("invalid",s);break;case"option":x=f;break;case"select":s._wrapperState={wasMultiple:!!f.multiple},x=W({},f,{value:void 0}),sn("invalid",s);break;case"textarea":yr(s,f),x=cn(s,f),sn("invalid",s);break;default:x=f}We(d,x),$=x;for(v in $)if($.hasOwnProperty(v)){var G=$[v];v==="style"?_e(s,G):v==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,G!=null&&ma(s,G)):v==="children"?typeof G=="string"?(d!=="textarea"||G!=="")&&ar(s,G):typeof G=="number"&&ar(s,""+G):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(i.hasOwnProperty(v)?G!=null&&v==="onScroll"&&sn("scroll",s):G!=null&&J(s,v,G,T))}switch(d){case"input":On(s),bt(s,f,!1);break;case"textarea":On(s),Fs(s);break;case"option":f.value!=null&&s.setAttribute("value",""+ht(f.value));break;case"select":s.multiple=!!f.multiple,v=f.value,v!=null?Gt(s,!!f.multiple,v,!1):f.defaultValue!=null&&Gt(s,!!f.multiple,f.defaultValue,!0);break;default:typeof x.onClick=="function"&&(s.onclick=Il)}switch(d){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return Ir(o),null;case 6:if(s&&o.stateNode!=null)tb(s,o,s.memoizedProps,f);else{if(typeof f!="string"&&o.stateNode===null)throw Error(t(166));if(d=Rl(_u.current),Rl(Qi.current),Et(o)){if(f=o.stateNode,d=o.memoizedProps,f[As]=o,(v=f.nodeValue!==d)&&(s=Fe,s!==null))switch(s.tag){case 3:Nl(f.nodeValue,d,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&Nl(f.nodeValue,d,(s.mode&1)!==0)}v&&(o.flags|=4)}else f=(d.nodeType===9?d:d.ownerDocument).createTextNode(f),f[As]=o,o.stateNode=f}return Ir(o),null;case 13:if(an(_n),f=o.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(tt&&et!==null&&(o.mode&1)!==0&&(o.flags&128)===0)on(),Xt(),o.flags|=98560,v=!1;else if(v=Et(o),f!==null&&f.dehydrated!==null){if(s===null){if(!v)throw Error(t(318));if(v=o.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(t(317));v[As]=o}else Xt(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Ir(o),v=!1}else St!==null&&(qg(St),St=null),v=!0;if(!v)return o.flags&65536?o:null}return(o.flags&128)!==0?(o.lanes=d,o):(f=f!==null,f!==(s!==null&&s.memoizedState!==null)&&f&&(o.child.flags|=8192,(o.mode&1)!==0&&(s===null||(_n.current&1)!==0?Jn===0&&(Jn=3):Gg())),o.updateQueue!==null&&(o.flags|=4),Ir(o),null);case 4:return Zc(),Dg(s,o),s===null&&xo(o.stateNode.containerInfo),Ir(o),null;case 10:return og(o.type._context),Ir(o),null;case 17:return dr(o.type)&&Tl(),Ir(o),null;case 19:if(an(_n),v=o.memoizedState,v===null)return Ir(o),null;if(f=(o.flags&128)!==0,T=v.rendering,T===null)if(f)Su(v,!1);else{if(Jn!==0||s!==null&&(s.flags&128)!==0)for(s=o.child;s!==null;){if(T=Tm(s),T!==null){for(o.flags|=128,Su(v,!1),f=T.updateQueue,f!==null&&(o.updateQueue=f,o.flags|=4),o.subtreeFlags=0,f=d,d=o.child;d!==null;)v=d,s=f,v.flags&=14680066,T=v.alternate,T===null?(v.childLanes=0,v.lanes=s,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=T.childLanes,v.lanes=T.lanes,v.child=T.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=T.memoizedProps,v.memoizedState=T.memoizedState,v.updateQueue=T.updateQueue,v.type=T.type,s=T.dependencies,v.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),d=d.sibling;return Jt(_n,_n.current&1|2),o.child}s=s.sibling}v.tail!==null&&qt()>rd&&(o.flags|=128,f=!0,Su(v,!1),o.lanes=4194304)}else{if(!f)if(s=Tm(T),s!==null){if(o.flags|=128,f=!0,d=s.updateQueue,d!==null&&(o.updateQueue=d,o.flags|=4),Su(v,!0),v.tail===null&&v.tailMode==="hidden"&&!T.alternate&&!tt)return Ir(o),null}else 2*qt()-v.renderingStartTime>rd&&d!==1073741824&&(o.flags|=128,f=!0,Su(v,!1),o.lanes=4194304);v.isBackwards?(T.sibling=o.child,o.child=T):(d=v.last,d!==null?d.sibling=T:o.child=T,v.last=T)}return v.tail!==null?(o=v.tail,v.rendering=o,v.tail=o.sibling,v.renderingStartTime=qt(),o.sibling=null,d=_n.current,Jt(_n,f?d&1|2:d&1),o):(Ir(o),null);case 22:case 23:return Hg(),f=o.memoizedState!==null,s!==null&&s.memoizedState!==null!==f&&(o.flags|=8192),f&&(o.mode&1)!==0?(js&1073741824)!==0&&(Ir(o),o.subtreeFlags&6&&(o.flags|=8192)):Ir(o),null;case 24:return null;case 25:return null}throw Error(t(156,o.tag))}function wS(s,o){switch(je(o),o.tag){case 1:return dr(o.type)&&Tl(),s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 3:return Zc(),an(cr),an(Qn),pg(),s=o.flags,(s&65536)!==0&&(s&128)===0?(o.flags=s&-65537|128,o):null;case 5:return hg(o),null;case 13:if(an(_n),s=o.memoizedState,s!==null&&s.dehydrated!==null){if(o.alternate===null)throw Error(t(340));Xt()}return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 19:return an(_n),null;case 4:return Zc(),null;case 10:return og(o.type._context),null;case 22:case 23:return Hg(),null;case 24:return null;default:return null}}var Om=!1,Er=!1,_S=typeof WeakSet=="function"?WeakSet:Set,qe=null;function td(s,o){var d=s.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(f){An(s,o,f)}else d.current=null}function Pg(s,o,d){try{d()}catch(f){An(s,o,f)}}var nb=!1;function NS(s,o){if(zc=Mt,s=Zd(),Oc(s)){if("selectionStart"in s)var d={start:s.selectionStart,end:s.selectionEnd};else e:{d=(d=s.ownerDocument)&&d.defaultView||window;var f=d.getSelection&&d.getSelection();if(f&&f.rangeCount!==0){d=f.anchorNode;var x=f.anchorOffset,v=f.focusNode;f=f.focusOffset;try{d.nodeType,v.nodeType}catch{d=null;break e}var T=0,$=-1,G=-1,ue=0,Ne=0,Ee=s,be=null;t:for(;;){for(var Le;Ee!==d||x!==0&&Ee.nodeType!==3||($=T+x),Ee!==v||f!==0&&Ee.nodeType!==3||(G=T+f),Ee.nodeType===3&&(T+=Ee.nodeValue.length),(Le=Ee.firstChild)!==null;)be=Ee,Ee=Le;for(;;){if(Ee===s)break t;if(be===d&&++ue===x&&($=T),be===v&&++Ne===f&&(G=T),(Le=Ee.nextSibling)!==null)break;Ee=be,be=Ee.parentNode}Ee=Le}d=$===-1||G===-1?null:{start:$,end:G}}else d=null}d=d||{start:0,end:0}}else d=null;for(qc={focusedElem:s,selectionRange:d},Mt=!1,qe=o;qe!==null;)if(o=qe,s=o.child,(o.subtreeFlags&1028)!==0&&s!==null)s.return=o,qe=s;else for(;qe!==null;){o=qe;try{var Ke=o.alternate;if((o.flags&1024)!==0)switch(o.tag){case 0:case 11:case 15:break;case 1:if(Ke!==null){var Xe=Ke.memoizedProps,Vn=Ke.memoizedState,ne=o.stateNode,Q=ne.getSnapshotBeforeUpdate(o.elementType===o.type?Xe:Ci(o.type,Xe),Vn);ne.__reactInternalSnapshotBeforeUpdate=Q}break;case 3:var se=o.stateNode.containerInfo;se.nodeType===1?se.textContent="":se.nodeType===9&&se.documentElement&&se.removeChild(se.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(ke){An(o,o.return,ke)}if(s=o.sibling,s!==null){s.return=o.return,qe=s;break}qe=o.return}return Ke=nb,nb=!1,Ke}function Au(s,o,d){var f=o.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var x=f=f.next;do{if((x.tag&s)===s){var v=x.destroy;x.destroy=void 0,v!==void 0&&Pg(o,d,v)}x=x.next}while(x!==f)}}function Mm(s,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var d=o=o.next;do{if((d.tag&s)===s){var f=d.create;d.destroy=f()}d=d.next}while(d!==o)}}function Og(s){var o=s.ref;if(o!==null){var d=s.stateNode;switch(s.tag){case 5:s=d;break;default:s=d}typeof o=="function"?o(s):o.current=s}}function rb(s){var o=s.alternate;o!==null&&(s.alternate=null,rb(o)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(o=s.stateNode,o!==null&&(delete o[As],delete o[vo],delete o[Kc],delete o[bm],delete o[wm])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function sb(s){return s.tag===5||s.tag===3||s.tag===4}function ib(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||sb(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Mg(s,o,d){var f=s.tag;if(f===5||f===6)s=s.stateNode,o?d.nodeType===8?d.parentNode.insertBefore(s,o):d.insertBefore(s,o):(d.nodeType===8?(o=d.parentNode,o.insertBefore(s,d)):(o=d,o.appendChild(s)),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=Il));else if(f!==4&&(s=s.child,s!==null))for(Mg(s,o,d),s=s.sibling;s!==null;)Mg(s,o,d),s=s.sibling}function Vg(s,o,d){var f=s.tag;if(f===5||f===6)s=s.stateNode,o?d.insertBefore(s,o):d.appendChild(s);else if(f!==4&&(s=s.child,s!==null))for(Vg(s,o,d),s=s.sibling;s!==null;)Vg(s,o,d),s=s.sibling}var pr=null,Ri=!1;function No(s,o,d){for(d=d.child;d!==null;)ab(s,o,d),d=d.sibling}function ab(s,o,d){if(Or&&typeof Or.onCommitFiberUnmount=="function")try{Or.onCommitFiberUnmount(vi,d)}catch{}switch(d.tag){case 5:Er||td(d,o);case 6:var f=pr,x=Ri;pr=null,No(s,o,d),pr=f,Ri=x,pr!==null&&(Ri?(s=pr,d=d.stateNode,s.nodeType===8?s.parentNode.removeChild(d):s.removeChild(d)):pr.removeChild(d.stateNode));break;case 18:pr!==null&&(Ri?(s=pr,d=d.stateNode,s.nodeType===8?Gc(s.parentNode,d):s.nodeType===1&&Gc(s,d),Is(s)):Gc(pr,d.stateNode));break;case 4:f=pr,x=Ri,pr=d.stateNode.containerInfo,Ri=!0,No(s,o,d),pr=f,Ri=x;break;case 0:case 11:case 14:case 15:if(!Er&&(f=d.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){x=f=f.next;do{var v=x,T=v.destroy;v=v.tag,T!==void 0&&((v&2)!==0||(v&4)!==0)&&Pg(d,o,T),x=x.next}while(x!==f)}No(s,o,d);break;case 1:if(!Er&&(td(d,o),f=d.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=d.memoizedProps,f.state=d.memoizedState,f.componentWillUnmount()}catch($){An(d,o,$)}No(s,o,d);break;case 21:No(s,o,d);break;case 22:d.mode&1?(Er=(f=Er)||d.memoizedState!==null,No(s,o,d),Er=f):No(s,o,d);break;default:No(s,o,d)}}function ob(s){var o=s.updateQueue;if(o!==null){s.updateQueue=null;var d=s.stateNode;d===null&&(d=s.stateNode=new _S),o.forEach(function(f){var x=RS.bind(null,s,f);d.has(f)||(d.add(f),f.then(x,x))})}}function Di(s,o){var d=o.deletions;if(d!==null)for(var f=0;f<d.length;f++){var x=d[f];try{var v=s,T=o,$=T;e:for(;$!==null;){switch($.tag){case 5:pr=$.stateNode,Ri=!1;break e;case 3:pr=$.stateNode.containerInfo,Ri=!0;break e;case 4:pr=$.stateNode.containerInfo,Ri=!0;break e}$=$.return}if(pr===null)throw Error(t(160));ab(v,T,x),pr=null,Ri=!1;var G=x.alternate;G!==null&&(G.return=null),x.return=null}catch(ue){An(x,o,ue)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)lb(o,s),o=o.sibling}function lb(s,o){var d=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(Di(o,s),Ji(s),f&4){try{Au(3,s,s.return),Mm(3,s)}catch(Xe){An(s,s.return,Xe)}try{Au(5,s,s.return)}catch(Xe){An(s,s.return,Xe)}}break;case 1:Di(o,s),Ji(s),f&512&&d!==null&&td(d,d.return);break;case 5:if(Di(o,s),Ji(s),f&512&&d!==null&&td(d,d.return),s.flags&32){var x=s.stateNode;try{ar(x,"")}catch(Xe){An(s,s.return,Xe)}}if(f&4&&(x=s.stateNode,x!=null)){var v=s.memoizedProps,T=d!==null?d.memoizedProps:v,$=s.type,G=s.updateQueue;if(s.updateQueue=null,G!==null)try{$==="input"&&v.type==="radio"&&v.name!=null&&fn(x,v),X($,T);var ue=X($,v);for(T=0;T<G.length;T+=2){var Ne=G[T],Ee=G[T+1];Ne==="style"?_e(x,Ee):Ne==="dangerouslySetInnerHTML"?ma(x,Ee):Ne==="children"?ar(x,Ee):J(x,Ne,Ee,ue)}switch($){case"input":it(x,v);break;case"textarea":pi(x,v);break;case"select":var be=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!v.multiple;var Le=v.value;Le!=null?Gt(x,!!v.multiple,Le,!1):be!==!!v.multiple&&(v.defaultValue!=null?Gt(x,!!v.multiple,v.defaultValue,!0):Gt(x,!!v.multiple,v.multiple?[]:"",!1))}x[vo]=v}catch(Xe){An(s,s.return,Xe)}}break;case 6:if(Di(o,s),Ji(s),f&4){if(s.stateNode===null)throw Error(t(162));x=s.stateNode,v=s.memoizedProps;try{x.nodeValue=v}catch(Xe){An(s,s.return,Xe)}}break;case 3:if(Di(o,s),Ji(s),f&4&&d!==null&&d.memoizedState.isDehydrated)try{Is(o.containerInfo)}catch(Xe){An(s,s.return,Xe)}break;case 4:Di(o,s),Ji(s);break;case 13:Di(o,s),Ji(s),x=s.child,x.flags&8192&&(v=x.memoizedState!==null,x.stateNode.isHidden=v,!v||x.alternate!==null&&x.alternate.memoizedState!==null||(Fg=qt())),f&4&&ob(s);break;case 22:if(Ne=d!==null&&d.memoizedState!==null,s.mode&1?(Er=(ue=Er)||Ne,Di(o,s),Er=ue):Di(o,s),Ji(s),f&8192){if(ue=s.memoizedState!==null,(s.stateNode.isHidden=ue)&&!Ne&&(s.mode&1)!==0)for(qe=s,Ne=s.child;Ne!==null;){for(Ee=qe=Ne;qe!==null;){switch(be=qe,Le=be.child,be.tag){case 0:case 11:case 14:case 15:Au(4,be,be.return);break;case 1:td(be,be.return);var Ke=be.stateNode;if(typeof Ke.componentWillUnmount=="function"){f=be,d=be.return;try{o=f,Ke.props=o.memoizedProps,Ke.state=o.memoizedState,Ke.componentWillUnmount()}catch(Xe){An(f,d,Xe)}}break;case 5:td(be,be.return);break;case 22:if(be.memoizedState!==null){ub(Ee);continue}}Le!==null?(Le.return=be,qe=Le):ub(Ee)}Ne=Ne.sibling}e:for(Ne=null,Ee=s;;){if(Ee.tag===5){if(Ne===null){Ne=Ee;try{x=Ee.stateNode,ue?(v=x.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none"):($=Ee.stateNode,G=Ee.memoizedProps.style,T=G!=null&&G.hasOwnProperty("display")?G.display:null,$.style.display=ie("display",T))}catch(Xe){An(s,s.return,Xe)}}}else if(Ee.tag===6){if(Ne===null)try{Ee.stateNode.nodeValue=ue?"":Ee.memoizedProps}catch(Xe){An(s,s.return,Xe)}}else if((Ee.tag!==22&&Ee.tag!==23||Ee.memoizedState===null||Ee===s)&&Ee.child!==null){Ee.child.return=Ee,Ee=Ee.child;continue}if(Ee===s)break e;for(;Ee.sibling===null;){if(Ee.return===null||Ee.return===s)break e;Ne===Ee&&(Ne=null),Ee=Ee.return}Ne===Ee&&(Ne=null),Ee.sibling.return=Ee.return,Ee=Ee.sibling}}break;case 19:Di(o,s),Ji(s),f&4&&ob(s);break;case 21:break;default:Di(o,s),Ji(s)}}function Ji(s){var o=s.flags;if(o&2){try{e:{for(var d=s.return;d!==null;){if(sb(d)){var f=d;break e}d=d.return}throw Error(t(160))}switch(f.tag){case 5:var x=f.stateNode;f.flags&32&&(ar(x,""),f.flags&=-33);var v=ib(s);Vg(s,v,x);break;case 3:case 4:var T=f.stateNode.containerInfo,$=ib(s);Mg(s,$,T);break;default:throw Error(t(161))}}catch(G){An(s,s.return,G)}s.flags&=-3}o&4096&&(s.flags&=-4097)}function IS(s,o,d){qe=s,cb(s)}function cb(s,o,d){for(var f=(s.mode&1)!==0;qe!==null;){var x=qe,v=x.child;if(x.tag===22&&f){var T=x.memoizedState!==null||Om;if(!T){var $=x.alternate,G=$!==null&&$.memoizedState!==null||Er;$=Om;var ue=Er;if(Om=T,(Er=G)&&!ue)for(qe=x;qe!==null;)T=qe,G=T.child,T.tag===22&&T.memoizedState!==null?hb(x):G!==null?(G.return=T,qe=G):hb(x);for(;v!==null;)qe=v,cb(v),v=v.sibling;qe=x,Om=$,Er=ue}db(s)}else(x.subtreeFlags&8772)!==0&&v!==null?(v.return=x,qe=v):db(s)}}function db(s){for(;qe!==null;){var o=qe;if((o.flags&8772)!==0){var d=o.alternate;try{if((o.flags&8772)!==0)switch(o.tag){case 0:case 11:case 15:Er||Mm(5,o);break;case 1:var f=o.stateNode;if(o.flags&4&&!Er)if(d===null)f.componentDidMount();else{var x=o.elementType===o.type?d.memoizedProps:Ci(o.type,d.memoizedProps);f.componentDidUpdate(x,d.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var v=o.updateQueue;v!==null&&uv(o,v,f);break;case 3:var T=o.updateQueue;if(T!==null){if(d=null,o.child!==null)switch(o.child.tag){case 5:d=o.child.stateNode;break;case 1:d=o.child.stateNode}uv(o,T,d)}break;case 5:var $=o.stateNode;if(d===null&&o.flags&4){d=$;var G=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":G.autoFocus&&d.focus();break;case"img":G.src&&(d.src=G.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var ue=o.alternate;if(ue!==null){var Ne=ue.memoizedState;if(Ne!==null){var Ee=Ne.dehydrated;Ee!==null&&Is(Ee)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Er||o.flags&512&&Og(o)}catch(be){An(o,o.return,be)}}if(o===s){qe=null;break}if(d=o.sibling,d!==null){d.return=o.return,qe=d;break}qe=o.return}}function ub(s){for(;qe!==null;){var o=qe;if(o===s){qe=null;break}var d=o.sibling;if(d!==null){d.return=o.return,qe=d;break}qe=o.return}}function hb(s){for(;qe!==null;){var o=qe;try{switch(o.tag){case 0:case 11:case 15:var d=o.return;try{Mm(4,o)}catch(G){An(o,d,G)}break;case 1:var f=o.stateNode;if(typeof f.componentDidMount=="function"){var x=o.return;try{f.componentDidMount()}catch(G){An(o,x,G)}}var v=o.return;try{Og(o)}catch(G){An(o,v,G)}break;case 5:var T=o.return;try{Og(o)}catch(G){An(o,T,G)}}}catch(G){An(o,o.return,G)}if(o===s){qe=null;break}var $=o.sibling;if($!==null){$.return=o.return,qe=$;break}qe=o.return}}var ES=Math.ceil,Vm=he.ReactCurrentDispatcher,Lg=he.ReactCurrentOwner,ni=he.ReactCurrentBatchConfig,Bt=0,rr=null,Bn=null,fr=0,js=0,nd=Ai(0),Jn=0,ju=null,Pl=0,Lm=0,$g=0,ku=null,cs=null,Fg=0,rd=1/0,Oa=null,$m=!1,Bg=null,Io=null,Fm=!1,Eo=null,Bm=0,Cu=0,Ug=null,Um=-1,zm=0;function qr(){return(Bt&6)!==0?qt():Um!==-1?Um:Um=qt()}function To(s){return(s.mode&1)===0?1:(Bt&2)!==0&&fr!==0?fr&-fr:hr.transition!==null?(zm===0&&(zm=fa()),zm):(s=ft,s!==0||(s=window.event,s=s===void 0?16:ul(s.type)),s)}function Pi(s,o,d,f){if(50<Cu)throw Cu=0,Ug=null,Error(t(185));zi(s,d,f),((Bt&2)===0||s!==rr)&&(s===rr&&((Bt&2)===0&&(Lm|=d),Jn===4&&So(s,fr)),ds(s,f),d===1&&Bt===0&&(o.mode&1)===0&&(rd=qt()+500,Al&&ki()))}function ds(s,o){var d=s.callbackNode;wi(s,o);var f=ws(s,s===rr?fr:0);if(f===0)d!==null&&pa(d),s.callbackNode=null,s.callbackPriority=0;else if(o=f&-f,s.callbackPriority!==o){if(d!=null&&pa(d),o===1)s.tag===0?_m(pb.bind(null,s)):yu(pb.bind(null,s)),ym(function(){(Bt&6)===0&&ki()}),d=null;else{switch(es(f)){case 1:d=ro;break;case 4:d=Bi;break;case 16:d=or;break;case 536870912:d=so;break;default:d=or}d=_b(d,mb.bind(null,s))}s.callbackPriority=o,s.callbackNode=d}}function mb(s,o){if(Um=-1,zm=0,(Bt&6)!==0)throw Error(t(327));var d=s.callbackNode;if(sd()&&s.callbackNode!==d)return null;var f=ws(s,s===rr?fr:0);if(f===0)return null;if((f&30)!==0||(f&s.expiredLanes)!==0||o)o=qm(s,f);else{o=f;var x=Bt;Bt|=2;var v=gb();(rr!==s||fr!==o)&&(Oa=null,rd=qt()+500,Ml(s,o));do try{AS();break}catch($){fb(s,$)}while(!0);ag(),Vm.current=v,Bt=x,Bn!==null?o=0:(rr=null,fr=0,o=Jn)}if(o!==0){if(o===2&&(x=al(s),x!==0&&(f=x,o=zg(s,x))),o===1)throw d=ju,Ml(s,0),So(s,f),ds(s,qt()),d;if(o===6)So(s,f);else{if(x=s.current.alternate,(f&30)===0&&!TS(x)&&(o=qm(s,f),o===2&&(v=al(s),v!==0&&(f=v,o=zg(s,v))),o===1))throw d=ju,Ml(s,0),So(s,f),ds(s,qt()),d;switch(s.finishedWork=x,s.finishedLanes=f,o){case 0:case 1:throw Error(t(345));case 2:Vl(s,cs,Oa);break;case 3:if(So(s,f),(f&130023424)===f&&(o=Fg+500-qt(),10<o)){if(ws(s,0)!==0)break;if(x=s.suspendedLanes,(x&f)!==f){qr(),s.pingedLanes|=s.suspendedLanes&x;break}s.timeoutHandle=Hc(Vl.bind(null,s,cs,Oa),o);break}Vl(s,cs,Oa);break;case 4:if(So(s,f),(f&4194240)===f)break;for(o=s.eventTimes,x=-1;0<f;){var T=31-br(f);v=1<<T,T=o[T],T>x&&(x=T),f&=~v}if(f=x,f=qt()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*ES(f/1960))-f,10<f){s.timeoutHandle=Hc(Vl.bind(null,s,cs,Oa),f);break}Vl(s,cs,Oa);break;case 5:Vl(s,cs,Oa);break;default:throw Error(t(329))}}}return ds(s,qt()),s.callbackNode===d?mb.bind(null,s):null}function zg(s,o){var d=ku;return s.current.memoizedState.isDehydrated&&(Ml(s,o).flags|=256),s=qm(s,o),s!==2&&(o=cs,cs=d,o!==null&&qg(o)),s}function qg(s){cs===null?cs=s:cs.push.apply(cs,s)}function TS(s){for(var o=s;;){if(o.flags&16384){var d=o.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var f=0;f<d.length;f++){var x=d[f],v=x.getSnapshot;x=x.value;try{if(!is(v(),x))return!1}catch{return!1}}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function So(s,o){for(o&=~$g,o&=~Lm,s.suspendedLanes|=o,s.pingedLanes&=~o,s=s.expirationTimes;0<o;){var d=31-br(o),f=1<<d;s[d]=-1,o&=~f}}function pb(s){if((Bt&6)!==0)throw Error(t(327));sd();var o=ws(s,0);if((o&1)===0)return ds(s,qt()),null;var d=qm(s,o);if(s.tag!==0&&d===2){var f=al(s);f!==0&&(o=f,d=zg(s,f))}if(d===1)throw d=ju,Ml(s,0),So(s,o),ds(s,qt()),d;if(d===6)throw Error(t(345));return s.finishedWork=s.current.alternate,s.finishedLanes=o,Vl(s,cs,Oa),ds(s,qt()),null}function Wg(s,o){var d=Bt;Bt|=1;try{return s(o)}finally{Bt=d,Bt===0&&(rd=qt()+500,Al&&ki())}}function Ol(s){Eo!==null&&Eo.tag===0&&(Bt&6)===0&&sd();var o=Bt;Bt|=1;var d=ni.transition,f=ft;try{if(ni.transition=null,ft=1,s)return s()}finally{ft=f,ni.transition=d,Bt=o,(Bt&6)===0&&ki()}}function Hg(){js=nd.current,an(nd)}function Ml(s,o){s.finishedWork=null,s.finishedLanes=0;var d=s.timeoutHandle;if(d!==-1&&(s.timeoutHandle=-1,xm(d)),Bn!==null)for(d=Bn.return;d!==null;){var f=d;switch(je(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&Tl();break;case 3:Zc(),an(cr),an(Qn),pg();break;case 5:hg(f);break;case 4:Zc();break;case 13:an(_n);break;case 19:an(_n);break;case 10:og(f.type._context);break;case 22:case 23:Hg()}d=d.return}if(rr=s,Bn=s=Ao(s.current,null),fr=js=o,Jn=0,ju=null,$g=Lm=Pl=0,cs=ku=null,Cl!==null){for(o=0;o<Cl.length;o++)if(d=Cl[o],f=d.interleaved,f!==null){d.interleaved=null;var x=f.next,v=d.pending;if(v!==null){var T=v.next;v.next=x,f.next=T}d.pending=f}Cl=null}return s}function fb(s,o){do{var d=Bn;try{if(ag(),Sm.current=Cm,Am){for(var f=Nn.memoizedState;f!==null;){var x=f.queue;x!==null&&(x.pending=null),f=f.next}Am=!1}if(Dl=0,nr=Yn=Nn=null,Nu=!1,Iu=0,Lg.current=null,d===null||d.return===null){Jn=1,ju=o,Bn=null;break}e:{var v=s,T=d.return,$=d,G=o;if(o=fr,$.flags|=32768,G!==null&&typeof G=="object"&&typeof G.then=="function"){var ue=G,Ne=$,Ee=Ne.tag;if((Ne.mode&1)===0&&(Ee===0||Ee===11||Ee===15)){var be=Ne.alternate;be?(Ne.updateQueue=be.updateQueue,Ne.memoizedState=be.memoizedState,Ne.lanes=be.lanes):(Ne.updateQueue=null,Ne.memoizedState=null)}var Le=Fv(T);if(Le!==null){Le.flags&=-257,Bv(Le,T,$,v,o),Le.mode&1&&$v(v,ue,o),o=Le,G=ue;var Ke=o.updateQueue;if(Ke===null){var Xe=new Set;Xe.add(G),o.updateQueue=Xe}else Ke.add(G);break e}else{if((o&1)===0){$v(v,ue,o),Gg();break e}G=Error(t(426))}}else if(tt&&$.mode&1){var Vn=Fv(T);if(Vn!==null){(Vn.flags&65536)===0&&(Vn.flags|=256),Bv(Vn,T,$,v,o),Fn(ed(G,$));break e}}v=G=ed(G,$),Jn!==4&&(Jn=2),ku===null?ku=[v]:ku.push(v),v=T;do{switch(v.tag){case 3:v.flags|=65536,o&=-o,v.lanes|=o;var ne=Vv(v,G,o);dv(v,ne);break e;case 1:$=G;var Q=v.type,se=v.stateNode;if((v.flags&128)===0&&(typeof Q.getDerivedStateFromError=="function"||se!==null&&typeof se.componentDidCatch=="function"&&(Io===null||!Io.has(se)))){v.flags|=65536,o&=-o,v.lanes|=o;var ke=Lv(v,$,o);dv(v,ke);break e}}v=v.return}while(v!==null)}yb(d)}catch(nt){o=nt,Bn===d&&d!==null&&(Bn=d=d.return);continue}break}while(!0)}function gb(){var s=Vm.current;return Vm.current=Cm,s===null?Cm:s}function Gg(){(Jn===0||Jn===3||Jn===2)&&(Jn=4),rr===null||(Pl&268435455)===0&&(Lm&268435455)===0||So(rr,fr)}function qm(s,o){var d=Bt;Bt|=2;var f=gb();(rr!==s||fr!==o)&&(Oa=null,Ml(s,o));do try{SS();break}catch(x){fb(s,x)}while(!0);if(ag(),Bt=d,Vm.current=f,Bn!==null)throw Error(t(261));return rr=null,fr=0,Jn}function SS(){for(;Bn!==null;)xb(Bn)}function AS(){for(;Bn!==null&&!Fi();)xb(Bn)}function xb(s){var o=wb(s.alternate,s,js);s.memoizedProps=s.pendingProps,o===null?yb(s):Bn=o,Lg.current=null}function yb(s){var o=s;do{var d=o.alternate;if(s=o.return,(o.flags&32768)===0){if(d=bS(d,o,js),d!==null){Bn=d;return}}else{if(d=wS(d,o),d!==null){d.flags&=32767,Bn=d;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{Jn=6,Bn=null;return}}if(o=o.sibling,o!==null){Bn=o;return}Bn=o=s}while(o!==null);Jn===0&&(Jn=5)}function Vl(s,o,d){var f=ft,x=ni.transition;try{ni.transition=null,ft=1,jS(s,o,d,f)}finally{ni.transition=x,ft=f}return null}function jS(s,o,d,f){do sd();while(Eo!==null);if((Bt&6)!==0)throw Error(t(327));d=s.finishedWork;var x=s.finishedLanes;if(d===null)return null;if(s.finishedWork=null,s.finishedLanes=0,d===s.current)throw Error(t(177));s.callbackNode=null,s.callbackPriority=0;var v=d.lanes|d.childLanes;if(_s(s,v),s===rr&&(Bn=rr=null,fr=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||Fm||(Fm=!0,_b(or,function(){return sd(),null})),v=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||v){v=ni.transition,ni.transition=null;var T=ft;ft=1;var $=Bt;Bt|=4,Lg.current=null,NS(s,d),lb(d,s),dm(qc),Mt=!!zc,qc=zc=null,s.current=d,IS(d),qs(),Bt=$,ft=T,ni.transition=v}else s.current=d;if(Fm&&(Fm=!1,Eo=s,Bm=x),v=s.pendingLanes,v===0&&(Io=null),io(d.stateNode),ds(s,qt()),o!==null)for(f=s.onRecoverableError,d=0;d<o.length;d++)x=o[d],f(x.value,{componentStack:x.stack,digest:x.digest});if($m)throw $m=!1,s=Bg,Bg=null,s;return(Bm&1)!==0&&s.tag!==0&&sd(),v=s.pendingLanes,(v&1)!==0?s===Ug?Cu++:(Cu=0,Ug=s):Cu=0,ki(),null}function sd(){if(Eo!==null){var s=es(Bm),o=ni.transition,d=ft;try{if(ni.transition=null,ft=16>s?16:s,Eo===null)var f=!1;else{if(s=Eo,Eo=null,Bm=0,(Bt&6)!==0)throw Error(t(331));var x=Bt;for(Bt|=4,qe=s.current;qe!==null;){var v=qe,T=v.child;if((qe.flags&16)!==0){var $=v.deletions;if($!==null){for(var G=0;G<$.length;G++){var ue=$[G];for(qe=ue;qe!==null;){var Ne=qe;switch(Ne.tag){case 0:case 11:case 15:Au(8,Ne,v)}var Ee=Ne.child;if(Ee!==null)Ee.return=Ne,qe=Ee;else for(;qe!==null;){Ne=qe;var be=Ne.sibling,Le=Ne.return;if(rb(Ne),Ne===ue){qe=null;break}if(be!==null){be.return=Le,qe=be;break}qe=Le}}}var Ke=v.alternate;if(Ke!==null){var Xe=Ke.child;if(Xe!==null){Ke.child=null;do{var Vn=Xe.sibling;Xe.sibling=null,Xe=Vn}while(Xe!==null)}}qe=v}}if((v.subtreeFlags&2064)!==0&&T!==null)T.return=v,qe=T;else e:for(;qe!==null;){if(v=qe,(v.flags&2048)!==0)switch(v.tag){case 0:case 11:case 15:Au(9,v,v.return)}var ne=v.sibling;if(ne!==null){ne.return=v.return,qe=ne;break e}qe=v.return}}var Q=s.current;for(qe=Q;qe!==null;){T=qe;var se=T.child;if((T.subtreeFlags&2064)!==0&&se!==null)se.return=T,qe=se;else e:for(T=Q;qe!==null;){if($=qe,($.flags&2048)!==0)try{switch($.tag){case 0:case 11:case 15:Mm(9,$)}}catch(nt){An($,$.return,nt)}if($===T){qe=null;break e}var ke=$.sibling;if(ke!==null){ke.return=$.return,qe=ke;break e}qe=$.return}}if(Bt=x,ki(),Or&&typeof Or.onPostCommitFiberRoot=="function")try{Or.onPostCommitFiberRoot(vi,s)}catch{}f=!0}return f}finally{ft=d,ni.transition=o}}return!1}function vb(s,o,d){o=ed(d,o),o=Vv(s,o,1),s=_o(s,o,1),o=qr(),s!==null&&(zi(s,1,o),ds(s,o))}function An(s,o,d){if(s.tag===3)vb(s,s,d);else for(;o!==null;){if(o.tag===3){vb(o,s,d);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Io===null||!Io.has(f))){s=ed(d,s),s=Lv(o,s,1),o=_o(o,s,1),s=qr(),o!==null&&(zi(o,1,s),ds(o,s));break}}o=o.return}}function kS(s,o,d){var f=s.pingCache;f!==null&&f.delete(o),o=qr(),s.pingedLanes|=s.suspendedLanes&d,rr===s&&(fr&d)===d&&(Jn===4||Jn===3&&(fr&130023424)===fr&&500>qt()-Fg?Ml(s,0):$g|=d),ds(s,o)}function bb(s,o){o===0&&((s.mode&1)===0?o=1:(o=Ws,Ws<<=1,(Ws&130023424)===0&&(Ws=4194304)));var d=qr();s=Ra(s,o),s!==null&&(zi(s,o,d),ds(s,d))}function CS(s){var o=s.memoizedState,d=0;o!==null&&(d=o.retryLane),bb(s,d)}function RS(s,o){var d=0;switch(s.tag){case 13:var f=s.stateNode,x=s.memoizedState;x!==null&&(d=x.retryLane);break;case 19:f=s.stateNode;break;default:throw Error(t(314))}f!==null&&f.delete(o),bb(s,d)}var wb;wb=function(s,o,d){if(s!==null)if(s.memoizedProps!==o.pendingProps||cr.current)ls=!0;else{if((s.lanes&d)===0&&(o.flags&128)===0)return ls=!1,vS(s,o,d);ls=(s.flags&131072)!==0}else ls=!1,tt&&(o.flags&1048576)!==0&&De(o,_,o.index);switch(o.lanes=0,o.tag){case 2:var f=o.type;Pm(s,o),s=o.pendingProps;var x=Aa(o,Qn.current);Xc(o,d),x=xg(null,o,f,s,x,d);var v=yg();return o.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,dr(f)?(v=!0,Sl(o)):v=!1,o.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,dg(o),x.updater=Rm,o.stateNode=x,x._reactInternals=o,Ig(o,f,s,d),o=Ag(null,o,f,!0,v,d)):(o.tag=0,tt&&v&&Je(o),zr(null,o,x,d),o=o.child),o;case 16:f=o.elementType;e:{switch(Pm(s,o),s=o.pendingProps,x=f._init,f=x(f._payload),o.type=f,x=o.tag=PS(f),s=Ci(f,s),x){case 0:o=Sg(null,o,f,s,d);break e;case 1:o=Gv(null,o,f,s,d);break e;case 11:o=Uv(null,o,f,s,d);break e;case 14:o=zv(null,o,f,Ci(f.type,s),d);break e}throw Error(t(306,f,""))}return o;case 0:return f=o.type,x=o.pendingProps,x=o.elementType===f?x:Ci(f,x),Sg(s,o,f,x,d);case 1:return f=o.type,x=o.pendingProps,x=o.elementType===f?x:Ci(f,x),Gv(s,o,f,x,d);case 3:e:{if(Kv(o),s===null)throw Error(t(387));f=o.pendingProps,v=o.memoizedState,x=v.element,cv(s,o),Em(o,f,null,d);var T=o.memoizedState;if(f=T.element,v.isDehydrated)if(v={element:f,isDehydrated:!1,cache:T.cache,pendingSuspenseBoundaries:T.pendingSuspenseBoundaries,transitions:T.transitions},o.updateQueue.baseState=v,o.memoizedState=v,o.flags&256){x=ed(Error(t(423)),o),o=Qv(s,o,f,d,x);break e}else if(f!==x){x=ed(Error(t(424)),o),o=Qv(s,o,f,d,x);break e}else for(et=Si(o.stateNode.containerInfo.firstChild),Fe=o,tt=!0,St=null,d=vu(o,null,f,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Xt(),f===x){o=Pa(s,o,d);break e}zr(s,o,f,d)}o=o.child}return o;case 5:return hv(o),s===null&&Ur(o),f=o.type,x=o.pendingProps,v=s!==null?s.memoizedProps:null,T=x.children,Wc(f,x)?T=null:v!==null&&Wc(f,v)&&(o.flags|=32),Hv(s,o),zr(s,o,T,d),o.child;case 6:return s===null&&Ur(o),null;case 13:return Yv(s,o,d);case 4:return ug(o,o.stateNode.containerInfo),f=o.pendingProps,s===null?o.child=Ca(o,null,f,d):zr(s,o,f,d),o.child;case 11:return f=o.type,x=o.pendingProps,x=o.elementType===f?x:Ci(f,x),Uv(s,o,f,x,d);case 7:return zr(s,o,o.pendingProps,d),o.child;case 8:return zr(s,o,o.pendingProps.children,d),o.child;case 12:return zr(s,o,o.pendingProps.children,d),o.child;case 10:e:{if(f=o.type._context,x=o.pendingProps,v=o.memoizedProps,T=x.value,Jt(kl,f._currentValue),f._currentValue=T,v!==null)if(is(v.value,T)){if(v.children===x.children&&!cr.current){o=Pa(s,o,d);break e}}else for(v=o.child,v!==null&&(v.return=o);v!==null;){var $=v.dependencies;if($!==null){T=v.child;for(var G=$.firstContext;G!==null;){if(G.context===f){if(v.tag===1){G=Da(-1,d&-d),G.tag=2;var ue=v.updateQueue;if(ue!==null){ue=ue.shared;var Ne=ue.pending;Ne===null?G.next=G:(G.next=Ne.next,Ne.next=G),ue.pending=G}}v.lanes|=d,G=v.alternate,G!==null&&(G.lanes|=d),lg(v.return,d,o),$.lanes|=d;break}G=G.next}}else if(v.tag===10)T=v.type===o.type?null:v.child;else if(v.tag===18){if(T=v.return,T===null)throw Error(t(341));T.lanes|=d,$=T.alternate,$!==null&&($.lanes|=d),lg(T,d,o),T=v.sibling}else T=v.child;if(T!==null)T.return=v;else for(T=v;T!==null;){if(T===o){T=null;break}if(v=T.sibling,v!==null){v.return=T.return,T=v;break}T=T.return}v=T}zr(s,o,x.children,d),o=o.child}return o;case 9:return x=o.type,f=o.pendingProps.children,Xc(o,d),x=ei(x),f=f(x),o.flags|=1,zr(s,o,f,d),o.child;case 14:return f=o.type,x=Ci(f,o.pendingProps),x=Ci(f.type,x),zv(s,o,f,x,d);case 15:return qv(s,o,o.type,o.pendingProps,d);case 17:return f=o.type,x=o.pendingProps,x=o.elementType===f?x:Ci(f,x),Pm(s,o),o.tag=1,dr(f)?(s=!0,Sl(o)):s=!1,Xc(o,d),Ov(o,f,x),Ig(o,f,x,d),Ag(null,o,f,!0,s,d);case 19:return Xv(s,o,d);case 22:return Wv(s,o,d)}throw Error(t(156,o.tag))};function _b(s,o){return no(s,o)}function DS(s,o,d,f){this.tag=s,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ri(s,o,d,f){return new DS(s,o,d,f)}function Kg(s){return s=s.prototype,!(!s||!s.isReactComponent)}function PS(s){if(typeof s=="function")return Kg(s)?1:0;if(s!=null){if(s=s.$$typeof,s===K)return 11;if(s===me)return 14}return 2}function Ao(s,o){var d=s.alternate;return d===null?(d=ri(s.tag,o,s.key,s.mode),d.elementType=s.elementType,d.type=s.type,d.stateNode=s.stateNode,d.alternate=s,s.alternate=d):(d.pendingProps=o,d.type=s.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=s.flags&14680064,d.childLanes=s.childLanes,d.lanes=s.lanes,d.child=s.child,d.memoizedProps=s.memoizedProps,d.memoizedState=s.memoizedState,d.updateQueue=s.updateQueue,o=s.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=s.sibling,d.index=s.index,d.ref=s.ref,d}function Wm(s,o,d,f,x,v){var T=2;if(f=s,typeof s=="function")Kg(s)&&(T=1);else if(typeof s=="string")T=5;else e:switch(s){case D:return Ll(d.children,x,v,o);case k:T=8,x|=8;break;case O:return s=ri(12,d,o,x|2),s.elementType=O,s.lanes=v,s;case M:return s=ri(13,d,o,x),s.elementType=M,s.lanes=v,s;case Ve:return s=ri(19,d,o,x),s.elementType=Ve,s.lanes=v,s;case Se:return Hm(d,x,v,o);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case z:T=10;break e;case B:T=9;break e;case K:T=11;break e;case me:T=14;break e;case Te:T=16,f=null;break e}throw Error(t(130,s==null?s:typeof s,""))}return o=ri(T,d,o,x),o.elementType=s,o.type=f,o.lanes=v,o}function Ll(s,o,d,f){return s=ri(7,s,f,o),s.lanes=d,s}function Hm(s,o,d,f){return s=ri(22,s,f,o),s.elementType=Se,s.lanes=d,s.stateNode={isHidden:!1},s}function Qg(s,o,d){return s=ri(6,s,null,o),s.lanes=d,s}function Yg(s,o,d){return o=ri(4,s.children!==null?s.children:[],s.key,o),o.lanes=d,o.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},o}function OS(s,o,d,f,x){this.tag=o,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ot(0),this.expirationTimes=Ot(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ot(0),this.identifierPrefix=f,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function Jg(s,o,d,f,x,v,T,$,G){return s=new OS(s,o,d,$,G),o===1?(o=1,v===!0&&(o|=8)):o=0,v=ri(3,null,null,o),s.current=v,v.stateNode=s,v.memoizedState={element:f,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},dg(v),s}function MS(s,o,d){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ce,key:f==null?null:""+f,children:s,containerInfo:o,implementation:d}}function Nb(s){if(!s)return ji;s=s._reactInternals;e:{if(bs(s)!==s||s.tag!==1)throw Error(t(170));var o=s;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(dr(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(t(171))}if(s.tag===1){var d=s.type;if(dr(d))return gu(s,d,o)}return o}function Ib(s,o,d,f,x,v,T,$,G){return s=Jg(d,f,!0,s,x,v,T,$,G),s.context=Nb(null),d=s.current,f=qr(),x=To(d),v=Da(f,x),v.callback=o??null,_o(d,v,x),s.current.lanes=x,zi(s,x,f),ds(s,f),s}function Gm(s,o,d,f){var x=o.current,v=qr(),T=To(x);return d=Nb(d),o.context===null?o.context=d:o.pendingContext=d,o=Da(v,T),o.payload={element:s},f=f===void 0?null:f,f!==null&&(o.callback=f),s=_o(x,o,T),s!==null&&(Pi(s,x,T,v),Im(s,x,T)),T}function Km(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function Eb(s,o){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var d=s.retryLane;s.retryLane=d!==0&&d<o?d:o}}function Xg(s,o){Eb(s,o),(s=s.alternate)&&Eb(s,o)}function VS(){return null}var Tb=typeof reportError=="function"?reportError:function(s){console.error(s)};function Zg(s){this._internalRoot=s}Qm.prototype.render=Zg.prototype.render=function(s){var o=this._internalRoot;if(o===null)throw Error(t(409));Gm(s,o,null,null)},Qm.prototype.unmount=Zg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var o=s.containerInfo;Ol(function(){Gm(null,s,null,null)}),o[Xs]=null}};function Qm(s){this._internalRoot=s}Qm.prototype.unstable_scheduleHydration=function(s){if(s){var o=ll();s={blockedOn:null,target:s,priority:o};for(var d=0;d<Lr.length&&o!==0&&o<Lr[d].priority;d++);Lr.splice(d,0,s),d===0&&Gs(s)}};function ex(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function Ym(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function Sb(){}function LS(s,o,d,f,x){if(x){if(typeof f=="function"){var v=f;f=function(){var ue=Km(T);v.call(ue)}}var T=Ib(o,f,s,0,null,!1,!1,"",Sb);return s._reactRootContainer=T,s[Xs]=T.current,xo(s.nodeType===8?s.parentNode:s),Ol(),T}for(;x=s.lastChild;)s.removeChild(x);if(typeof f=="function"){var $=f;f=function(){var ue=Km(G);$.call(ue)}}var G=Jg(s,0,!1,null,null,!1,!1,"",Sb);return s._reactRootContainer=G,s[Xs]=G.current,xo(s.nodeType===8?s.parentNode:s),Ol(function(){Gm(o,G,d,f)}),G}function Jm(s,o,d,f,x){var v=d._reactRootContainer;if(v){var T=v;if(typeof x=="function"){var $=x;x=function(){var G=Km(T);$.call(G)}}Gm(o,T,s,x)}else T=LS(d,o,s,x,f);return Km(T)}oo=function(s){switch(s.tag){case 3:var o=s.stateNode;if(o.current.memoizedState.isDehydrated){var d=$t(o.pendingLanes);d!==0&&(ao(o,d|1),ds(o,qt()),(Bt&6)===0&&(rd=qt()+500,ki()))}break;case 13:Ol(function(){var f=Ra(s,1);if(f!==null){var x=qr();Pi(f,s,1,x)}}),Xg(s,1)}},ga=function(s){if(s.tag===13){var o=Ra(s,134217728);if(o!==null){var d=qr();Pi(o,s,134217728,d)}Xg(s,134217728)}},ol=function(s){if(s.tag===13){var o=To(s),d=Ra(s,o);if(d!==null){var f=qr();Pi(d,s,o,f)}Xg(s,o)}},ll=function(){return ft},xa=function(s,o){var d=ft;try{return ft=s,o()}finally{ft=d}},at=function(s,o,d){switch(o){case"input":if(it(s,d),o=d.name,d.type==="radio"&&o!=null){for(d=s;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<d.length;o++){var f=d[o];if(f!==s&&f.form===s.form){var x=El(f);if(!x)throw Error(t(90));nn(f),it(f,x)}}}break;case"textarea":pi(s,d);break;case"select":o=d.value,o!=null&&Gt(s,!!d.multiple,o,!1)}},En=Wg,vr=Ol;var $S={usingClientEntryPoint:!1,Events:[bo,Ta,El,Ze,ln,Wg]},Ru={findFiberByHostInstance:Gi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},FS={bundleType:Ru.bundleType,version:Ru.version,rendererPackageName:Ru.rendererPackageName,rendererConfig:Ru.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:he.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=Sc(s),s===null?null:s.stateNode},findFiberByHostInstance:Ru.findFiberByHostInstance||VS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xm.isDisabled&&Xm.supportsFiber)try{vi=Xm.inject(FS),Or=Xm}catch{}}return us.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$S,us.createPortal=function(s,o){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ex(o))throw Error(t(200));return MS(s,o,null,d)},us.createRoot=function(s,o){if(!ex(s))throw Error(t(299));var d=!1,f="",x=Tb;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onRecoverableError!==void 0&&(x=o.onRecoverableError)),o=Jg(s,1,!1,null,null,d,!1,f,x),s[Xs]=o.current,xo(s.nodeType===8?s.parentNode:s),new Zg(o)},us.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var o=s._reactInternals;if(o===void 0)throw typeof s.render=="function"?Error(t(188)):(s=Object.keys(s).join(","),Error(t(268,s)));return s=Sc(o),s=s===null?null:s.stateNode,s},us.flushSync=function(s){return Ol(s)},us.hydrate=function(s,o,d){if(!Ym(o))throw Error(t(200));return Jm(null,s,o,!0,d)},us.hydrateRoot=function(s,o,d){if(!ex(s))throw Error(t(405));var f=d!=null&&d.hydratedSources||null,x=!1,v="",T=Tb;if(d!=null&&(d.unstable_strictMode===!0&&(x=!0),d.identifierPrefix!==void 0&&(v=d.identifierPrefix),d.onRecoverableError!==void 0&&(T=d.onRecoverableError)),o=Ib(o,null,s,1,d??null,x,!1,v,T),s[Xs]=o.current,xo(s),f)for(s=0;s<f.length;s++)d=f[s],x=d._getVersion,x=x(d._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[d,x]:o.mutableSourceEagerHydrationData.push(d,x);return new Qm(o)},us.render=function(s,o,d){if(!Ym(o))throw Error(t(200));return Jm(null,s,o,!1,d)},us.unmountComponentAtNode=function(s){if(!Ym(s))throw Error(t(40));return s._reactRootContainer?(Ol(function(){Jm(null,null,s,!1,function(){s._reactRootContainer=null,s[Xs]=null})}),!0):!1},us.unstable_batchedUpdates=Wg,us.unstable_renderSubtreeIntoContainer=function(s,o,d,f){if(!Ym(d))throw Error(t(200));if(s==null||s._reactInternals===void 0)throw Error(t(38));return Jm(s,o,d,!1,f)},us.version="18.3.1-next-f1338f8080-20240426",us}var Ob;function TN(){if(Ob)return rx.exports;Ob=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),rx.exports=GS(),rx.exports}var Mb;function KS(){if(Mb)return Zm;Mb=1;var n=TN();return Zm.createRoot=n.createRoot,Zm.hydrateRoot=n.hydrateRoot,Zm}var QS=KS();const YS=EN(QS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JS=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),XS=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),Vb=n=>{const e=XS(n);return e.charAt(0).toUpperCase()+e.slice(1)},SN=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),ZS=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var eA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tA=q.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:i="",children:l,iconNode:c,...u},p)=>q.createElement("svg",{ref:p,...eA,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:SN("lucide",i),...!l&&!ZS(u)&&{"aria-hidden":"true"},...u},[...c.map(([g,b])=>q.createElement(g,b)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=(n,e)=>{const t=q.forwardRef(({className:r,...i},l)=>q.createElement(tA,{ref:l,iconNode:e,className:SN(`lucide-${JS(Vb(n))}`,`lucide-${n}`,r),...i}));return t.displayName=Vb(n),t};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nA=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],rA=ze("arrow-down",nA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sA=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Jl=ze("arrow-right",sA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iA=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],aA=ze("arrow-up",iA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oA=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ma=ze("ban",oA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lA=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Op=ze("bell",lA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cA=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],Bx=ze("briefcase",cA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dA=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],AN=ze("building-2",dA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uA=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Mp=ze("calendar",uA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hA=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Fl=ze("check",hA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mA=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],pA=ze("chevron-down",mA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fA=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],$a=ze("chevron-right",fA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Xi=ze("circle-alert",gA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xA=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ed=ze("circle-check-big",xA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],xp=ze("circle-check",yA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]],Ux=ze("circle-pause",vA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bA=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Lb=ze("circle-play",bA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wA=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],sh=ze("clock",wA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _A=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],NA=ze("copy",_A);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IA=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],EA=ze("credit-card",IA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TA=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],SA=ze("dollar-sign",TA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AA=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],$b=ze("download",AA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jA=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],kA=ze("eye-off",jA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CA=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ax=ze("eye",CA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RA=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Va=ze("file-text",RA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DA=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],Pu=ze("file",DA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PA=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],jN=ze("folder-kanban",PA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OA=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],MA=ze("funnel",OA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VA=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Fb=ze("history",VA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LA=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Bb=ze("image",LA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $A=[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]],yp=ze("indian-rupee",$A);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],kN=ze("info",FA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BA=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],UA=ze("layers",BA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zA=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],qA=ze("layout-dashboard",zA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WA=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Ou=ze("link-2",WA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HA=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],GA=ze("list-checks",HA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KA=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],ep=ze("list",KA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QA=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],YA=ze("loader",QA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JA=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],bh=ze("lock",JA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XA=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],ZA=ze("log-out",XA);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ej=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Vp=ze("mail",ej);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tj=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],nj=ze("menu",tj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rj=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],zx=ze("message-circle",rj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sj=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],tp=ze("message-square",sj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ij=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],aj=ze("palette",ij);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oj=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]],lj=ze("panels-top-left",oj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cj=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],CN=ze("pen-line",cj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dj=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],uj=ze("pencil",dj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hj=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Lp=ze("phone",hj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mj=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Oi=ze("plus",mj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pj=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ox=ze("send",pj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fj=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],gj=ze("settings",fj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xj=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],yj=ze("share-2",xj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vj=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],bj=ze("shield-check",vj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wj=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],qx=ze("shield",wj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _j=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],Nj=ze("shopping-bag",_j);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ij=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],lx=ze("smartphone",Ij);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ej=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Wx=ze("square-pen",Ej);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tj=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],$p=ze("tag",Tj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sj=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],np=ze("thumbs-down",Sj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aj=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],rp=ze("thumbs-up",Aj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jj=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ks=ze("trash-2",jj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kj=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Cj=ze("triangle-alert",kj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rj=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Wu=ze("upload",Rj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dj=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],RN=ze("user",Dj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pj=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Fp=ze("users",Pj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oj=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],Mj=ze("wallet",Oj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vj=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],mn=ze("x",Vj);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lj=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],$j=ze("zap",Lj);var DN={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Ub=li.createContext&&li.createContext(DN),zo=function(){return zo=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},zo.apply(this,arguments)},Fj=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};function PN(n){return n&&n.map(function(e,t){return li.createElement(e.tag,zo({key:t},e.attr),PN(e.child))})}function Bj(n){return function(e){return li.createElement(Uj,zo({attr:zo({},n.attr)},e),PN(n.child))}}function Uj(n){var e=function(t){var r=n.attr,i=n.size,l=n.title,c=Fj(n,["attr","size","title"]),u=i||t.size||"1em",p;return t.className&&(p=t.className),n.className&&(p=(p?p+" ":"")+n.className),li.createElement("svg",zo({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,c,{className:p,style:zo(zo({color:n.color||t.color},t.style),n.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),l&&li.createElement("title",null,l),n.children)};return Ub!==void 0?li.createElement(Ub.Consumer,null,function(t){return e(t)}):e(DN)}function zj(n){return Bj({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M344 144c-3.92 52.87-44 96-88 96s-84.15-43.12-88-96c-4-55 35-96 88-96s92 42 88 96z"}},{tag:"path",attr:{fill:"none",strokeMiterlimit:"10",strokeWidth:"32",d:"M256 304c-87 0-175.3 48-191.64 138.6C62.39 453.52 68.57 464 80 464h352c11.44 0 17.62-10.48 15.65-21.4C431.3 352 343 304 256 304z"}}]})(n)}var L=(n=>(n.ADMIN="Admin",n.DESIGNER="Designer",n.VENDOR="Vendor",n.CLIENT="Client",n))(L||{}),jn=(n=>(n.DISCOVERY="Discovery",n.PLANNING="Planning",n.EXECUTION="Execution",n.COMPLETED="Completed",n.ON_HOLD="On Hold",n))(jn||{}),ql=(n=>(n.DESIGNING="Designing",n.TURNKEY="Turnkey",n))(ql||{}),Oo=(n=>(n.COMMERCIAL="Commercial",n.RESIDENTIAL="Residential",n))(Oo||{}),xe=(n=>(n.TODO="To Do",n.IN_PROGRESS="In Progress",n.REVIEW="Review",n.DONE="Done",n.OVERDUE="Overdue",n.ABORTED="Aborted",n.ON_HOLD="On Hold",n))(xe||{});const qj=()=>{};var zb={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ON=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Wj=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const l=n[t++];e[r++]=String.fromCharCode((i&31)<<6|l&63)}else if(i>239&&i<365){const l=n[t++],c=n[t++],u=n[t++],p=((i&7)<<18|(l&63)<<12|(c&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(p>>10)),e[r++]=String.fromCharCode(56320+(p&1023))}else{const l=n[t++],c=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(l&63)<<6|c&63)}}return e.join("")},MN={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const l=n[i],c=i+1<n.length,u=c?n[i+1]:0,p=i+2<n.length,g=p?n[i+2]:0,b=l>>2,w=(l&3)<<4|u>>4;let E=(u&15)<<2|g>>6,C=g&63;p||(C=64,c||(E=64)),r.push(t[b],t[w],t[E],t[C])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(ON(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Wj(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const l=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;const g=i<n.length?t[n.charAt(i)]:64;++i;const w=i<n.length?t[n.charAt(i)]:64;if(++i,l==null||u==null||g==null||w==null)throw new Hj;const E=l<<2|u>>4;if(r.push(E),g!==64){const C=u<<4&240|g>>2;if(r.push(C),w!==64){const H=g<<6&192|w;r.push(H)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Hj extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Gj=function(n){const e=ON(n);return MN.encodeByteArray(e,!0)},Bp=function(n){return Gj(n).replace(/\./g,"")},VN=function(n){try{return MN.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LN(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kj=()=>LN().__FIREBASE_DEFAULTS__,Qj=()=>{if(typeof process>"u"||typeof zb>"u")return;const n=zb.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Yj=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&VN(n[1]);return e&&JSON.parse(e)},yf=()=>{try{return qj()||Kj()||Qj()||Yj()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},$N=n=>{var e,t;return(t=(e=yf())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},FN=n=>{const e=$N(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},BN=()=>{var n;return(n=yf())==null?void 0:n.config},UN=n=>{var e;return(e=yf())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jj{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zo(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ly(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zN(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,l=n.sub||n.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Bp(JSON.stringify(t)),Bp(JSON.stringify(c)),""].join(".")}const ih={};function Xj(){const n={prod:[],emulator:[]};for(const e of Object.keys(ih))ih[e]?n.emulator.push(e):n.prod.push(e);return n}function Zj(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let qb=!1;function $y(n,e){if(typeof window>"u"||typeof document>"u"||!Zo(window.location.host)||ih[n]===e||ih[n]||qb)return;ih[n]=e;function t(E){return`__firebase__banner__${E}`}const r="__firebase__banner",l=Xj().prod.length>0;function c(){const E=document.getElementById(r);E&&E.remove()}function u(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function p(E,C){E.setAttribute("width","24"),E.setAttribute("id",C),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function g(){const E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{qb=!0,c()},E}function b(E,C){E.setAttribute("id",C),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function w(){const E=Zj(r),C=t("text"),H=document.getElementById(C)||document.createElement("span"),F=t("learnmore"),U=document.getElementById(F)||document.createElement("a"),ae=t("preprendIcon"),re=document.getElementById(ae)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){const J=E.element;u(J),b(U,F);const he=g();p(re,ae),J.append(re,H,U,he),document.body.appendChild(J)}l?(H.innerText="Preview backend disconnected.",re.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(re.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,H.innerText="Preview backend running in this workspace."),H.setAttribute("id",C)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",w):w()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function e2(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Xn())}function qN(){var e;const n=(e=yf())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function t2(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function WN(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function n2(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function r2(){const n=Xn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function HN(){return!qN()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function GN(){return!qN()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function vf(){try{return typeof indexedDB=="object"}catch{return!1}}function Fy(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var l;e(((l=i.error)==null?void 0:l.message)||"")}}catch(t){e(t)}})}function KN(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s2="FirebaseError";class di extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=s2,Object.setPrototypeOf(this,di.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,el.prototype.create)}}class el{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,l=this.errors[e],c=l?i2(l,r):"Error",u=`${this.serviceName}: ${c} (${i}).`;return new di(i,u,r)}}function i2(n,e){return n.replace(a2,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const a2=/\{\$([^}]+)}/g;function o2(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Wa(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const l=n[i],c=e[i];if(Wb(l)&&Wb(c)){if(!Wa(l,c))return!1}else if(l!==c)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function Wb(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fd(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Hu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,l]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(l)}}),e}function Gu(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function l2(n,e){const t=new c2(n,e);return t.subscribe.bind(t)}class c2{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");d2(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=cx),i.error===void 0&&(i.error=cx),i.complete===void 0&&(i.complete=cx);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function d2(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function cx(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u2=1e3,h2=2,m2=14400*1e3,p2=.5;function Hb(n,e=u2,t=h2){const r=e*Math.pow(t,n),i=Math.round(p2*r*(Math.random()-.5)*2);return Math.min(m2,r+i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ht(n){return n&&n._delegate?n._delegate:n}class ps{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bl="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f2{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Jj;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(x2(e))try{this.getOrInitializeService({instanceIdentifier:Bl})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const l=this.getOrInitializeService({instanceIdentifier:i});r.resolve(l)}catch{}}}}clearInstance(e=Bl){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Bl){return this.instances.has(e)}getOptions(e=Bl){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[l,c]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(l);r===u&&c.resolve(i)}return i}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const l=this.instances.get(r);return l&&e(l,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:g2(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Bl){return this.component?this.component.multipleInstances?e:Bl:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function g2(n){return n===Bl?void 0:n}function x2(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y2{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new f2(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Dt||(Dt={}));const v2={debug:Dt.DEBUG,verbose:Dt.VERBOSE,info:Dt.INFO,warn:Dt.WARN,error:Dt.ERROR,silent:Dt.SILENT},b2=Dt.INFO,w2={[Dt.DEBUG]:"log",[Dt.VERBOSE]:"log",[Dt.INFO]:"info",[Dt.WARN]:"warn",[Dt.ERROR]:"error"},_2=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=w2[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class bf{constructor(e){this.name=e,this._logLevel=b2,this._logHandler=_2,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Dt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?v2[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Dt.DEBUG,...e),this._logHandler(this,Dt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Dt.VERBOSE,...e),this._logHandler(this,Dt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Dt.INFO,...e),this._logHandler(this,Dt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Dt.WARN,...e),this._logHandler(this,Dt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Dt.ERROR,...e),this._logHandler(this,Dt.ERROR,...e)}}const N2=(n,e)=>e.some(t=>n instanceof t);let Gb,Kb;function I2(){return Gb||(Gb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function E2(){return Kb||(Kb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const QN=new WeakMap,Hx=new WeakMap,YN=new WeakMap,dx=new WeakMap,By=new WeakMap;function T2(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",l),n.removeEventListener("error",c)},l=()=>{t(qa(n.result)),i()},c=()=>{r(n.error),i()};n.addEventListener("success",l),n.addEventListener("error",c)});return e.then(t=>{t instanceof IDBCursor&&QN.set(t,n)}).catch(()=>{}),By.set(e,n),e}function S2(n){if(Hx.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",l),n.removeEventListener("error",c),n.removeEventListener("abort",c)},l=()=>{t(),i()},c=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",l),n.addEventListener("error",c),n.addEventListener("abort",c)});Hx.set(n,e)}let Gx={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Hx.get(n);if(e==="objectStoreNames")return n.objectStoreNames||YN.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return qa(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function A2(n){Gx=n(Gx)}function j2(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(ux(this),e,...t);return YN.set(r,e.sort?e.sort():[e]),qa(r)}:E2().includes(n)?function(...e){return n.apply(ux(this),e),qa(QN.get(this))}:function(...e){return qa(n.apply(ux(this),e))}}function k2(n){return typeof n=="function"?j2(n):(n instanceof IDBTransaction&&S2(n),N2(n,I2())?new Proxy(n,Gx):n)}function qa(n){if(n instanceof IDBRequest)return T2(n);if(dx.has(n))return dx.get(n);const e=k2(n);return e!==n&&(dx.set(n,e),By.set(e,n)),e}const ux=n=>By.get(n);function wf(n,e,{blocked:t,upgrade:r,blocking:i,terminated:l}={}){const c=indexedDB.open(n,e),u=qa(c);return r&&c.addEventListener("upgradeneeded",p=>{r(qa(c.result),p.oldVersion,p.newVersion,qa(c.transaction),p)}),t&&c.addEventListener("blocked",p=>t(p.oldVersion,p.newVersion,p)),u.then(p=>{l&&p.addEventListener("close",()=>l()),i&&p.addEventListener("versionchange",g=>i(g.oldVersion,g.newVersion,g))}).catch(()=>{}),u}function hx(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),qa(t).then(()=>{})}const C2=["get","getKey","getAll","getAllKeys","count"],R2=["put","add","delete","clear"],mx=new Map;function Qb(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(mx.get(e))return mx.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=R2.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||C2.includes(t)))return;const l=async function(c,...u){const p=this.transaction(c,i?"readwrite":"readonly");let g=p.store;return r&&(g=g.index(u.shift())),(await Promise.all([g[t](...u),i&&p.done]))[0]};return mx.set(e,l),l}A2(n=>({...n,get:(e,t,r)=>Qb(e,t)||n.get(e,t,r),has:(e,t)=>!!Qb(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D2{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(P2(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function P2(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Kx="@firebase/app",Yb="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ha=new bf("@firebase/app"),O2="@firebase/app-compat",M2="@firebase/analytics-compat",V2="@firebase/analytics",L2="@firebase/app-check-compat",$2="@firebase/app-check",F2="@firebase/auth",B2="@firebase/auth-compat",U2="@firebase/database",z2="@firebase/data-connect",q2="@firebase/database-compat",W2="@firebase/functions",H2="@firebase/functions-compat",G2="@firebase/installations",K2="@firebase/installations-compat",Q2="@firebase/messaging",Y2="@firebase/messaging-compat",J2="@firebase/performance",X2="@firebase/performance-compat",Z2="@firebase/remote-config",ek="@firebase/remote-config-compat",tk="@firebase/storage",nk="@firebase/storage-compat",rk="@firebase/firestore",sk="@firebase/ai",ik="@firebase/firestore-compat",ak="firebase",ok="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qx="[DEFAULT]",lk={[Kx]:"fire-core",[O2]:"fire-core-compat",[V2]:"fire-analytics",[M2]:"fire-analytics-compat",[$2]:"fire-app-check",[L2]:"fire-app-check-compat",[F2]:"fire-auth",[B2]:"fire-auth-compat",[U2]:"fire-rtdb",[z2]:"fire-data-connect",[q2]:"fire-rtdb-compat",[W2]:"fire-fn",[H2]:"fire-fn-compat",[G2]:"fire-iid",[K2]:"fire-iid-compat",[Q2]:"fire-fcm",[Y2]:"fire-fcm-compat",[J2]:"fire-perf",[X2]:"fire-perf-compat",[Z2]:"fire-rc",[ek]:"fire-rc-compat",[tk]:"fire-gcs",[nk]:"fire-gcs-compat",[rk]:"fire-fst",[ik]:"fire-fst-compat",[sk]:"fire-vertex","fire-js":"fire-js",[ak]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sc=new Map,Yx=new Map,Jx=new Map;function Jb(n,e){try{n.container.addComponent(e)}catch(t){Ha.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ms(n){const e=n.name;if(Jx.has(e))return Ha.debug(`There were multiple attempts to register component ${e}.`),!1;Jx.set(e,n);for(const t of sc.values())Jb(t,n);for(const t of Yx.values())Jb(t,n);return!0}function Ya(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function hs(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ck={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},qo=new el("app","Firebase",ck);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dk{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ps("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw qo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wc=ok;function Uy(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Qx,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw qo.create("bad-app-name",{appName:String(i)});if(t||(t=BN()),!t)throw qo.create("no-options");const l=sc.get(i);if(l){if(Wa(t,l.options)&&Wa(r,l.config))return l;throw qo.create("duplicate-app",{appName:i})}const c=new y2(i);for(const p of Jx.values())c.addComponent(p);const u=new dk(t,r,c);return sc.set(i,u),u}function $h(n=Qx){const e=sc.get(n);if(!e&&n===Qx&&BN())return Uy();if(!e)throw qo.create("no-app",{appName:n});return e}function Xb(){return Array.from(sc.values())}async function uk(n){let e=!1;const t=n.name;sc.has(t)?(e=!0,sc.delete(t)):Yx.has(t)&&n.decRefCount()<=0&&(Yx.delete(t),e=!0),e&&(await Promise.all(n.container.getProviders().map(r=>r.delete())),n.isDeleted=!0)}function kr(n,e,t){let r=lk[n]??n;t&&(r+=`-${t}`);const i=r.match(/\s|\//),l=e.match(/\s|\//);if(i||l){const c=[`Unable to register library "${r}" with version "${e}":`];i&&c.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&l&&c.push("and"),l&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ha.warn(c.join(" "));return}Ms(new ps(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk="firebase-heartbeat-database",mk=1,wh="firebase-heartbeat-store";let px=null;function JN(){return px||(px=wf(hk,mk,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(wh)}catch(t){console.warn(t)}}}}).catch(n=>{throw qo.create("idb-open",{originalErrorMessage:n.message})})),px}async function pk(n){try{const t=(await JN()).transaction(wh),r=await t.objectStore(wh).get(XN(n));return await t.done,r}catch(e){if(e instanceof di)Ha.warn(e.message);else{const t=qo.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ha.warn(t.message)}}}async function Zb(n,e){try{const r=(await JN()).transaction(wh,"readwrite");await r.objectStore(wh).put(e,XN(n)),await r.done}catch(t){if(t instanceof di)Ha.warn(t.message);else{const r=qo.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Ha.warn(r.message)}}}function XN(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fk=1024,gk=30;class xk{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new vk(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),l=ew();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===l||this._heartbeatsCache.heartbeats.some(c=>c.date===l))return;if(this._heartbeatsCache.heartbeats.push({date:l,agent:i}),this._heartbeatsCache.heartbeats.length>gk){const c=bk(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(c,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ha.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=ew(),{heartbeatsToSend:r,unsentEntries:i}=yk(this._heartbeatsCache.heartbeats),l=Bp(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),l}catch(t){return Ha.warn(t),""}}}function ew(){return new Date().toISOString().substring(0,10)}function yk(n,e=fk){const t=[];let r=n.slice();for(const i of n){const l=t.find(c=>c.agent===i.agent);if(l){if(l.dates.push(i.date),tw(t)>e){l.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),tw(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class vk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return vf()?Fy().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await pk(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Zb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Zb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function tw(n){return Bp(JSON.stringify({version:2,heartbeats:n})).length}function bk(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wk(n){Ms(new ps("platform-logger",e=>new D2(e),"PRIVATE")),Ms(new ps("heartbeat",e=>new xk(e),"PRIVATE")),kr(Kx,Yb,n),kr(Kx,Yb,"esm2020"),kr("fire-js","")}wk("");function ZN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const _k=ZN,eI=new el("auth","Firebase",ZN());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Up=new bf("@firebase/auth");function Nk(n,...e){Up.logLevel<=Dt.WARN&&Up.warn(`Auth (${wc}): ${n}`,...e)}function vp(n,...e){Up.logLevel<=Dt.ERROR&&Up.error(`Auth (${wc}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Li(n,...e){throw zy(n,...e)}function Ps(n,...e){return zy(n,...e)}function tI(n,e,t){const r={..._k(),[e]:t};return new el("auth","Firebase",r).create(e,{appName:n.name})}function sa(n){return tI(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function zy(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return eI.create(n,...e)}function Ue(n,e,...t){if(!n)throw zy(e,...t)}function Fa(n){const e="INTERNAL ASSERTION FAILED: "+n;throw vp(e),new Error(e)}function Ga(n,e){n||Fa(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xx(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function nI(){return nw()==="http:"||nw()==="https:"}function nw(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ik(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(nI()||WN()||"connection"in navigator)?navigator.onLine:!0}function Ek(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ga(t>e,"Short delay should be less than long delay!"),this.isMobile=e2()||n2()}get(){return Ik()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qy(n,e){Ga(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Fa("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Fa("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Fa("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Ak=new Fh(3e4,6e4);function fs(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function ui(n,e,t,r,i={}){return sI(n,i,async()=>{let l={},c={};r&&(e==="GET"?c=r:l={body:JSON.stringify(r)});const u=Fd({key:n.config.apiKey,...c}).slice(1),p=await n._getAdditionalHeaders();p["Content-Type"]="application/json",n.languageCode&&(p["X-Firebase-Locale"]=n.languageCode);const g={method:e,headers:p,...l};return t2()||(g.referrerPolicy="no-referrer"),n.emulatorConfig&&Zo(n.emulatorConfig.host)&&(g.credentials="include"),rI.fetch()(await iI(n,n.config.apiHost,t,u),g)})}async function sI(n,e,t){n._canInitEmulator=!1;const r={...Tk,...e};try{const i=new kk(n),l=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const c=await l.json();if("needConfirmation"in c)throw Ku(n,"account-exists-with-different-credential",c);if(l.ok&&!("errorMessage"in c))return c;{const u=l.ok?c.errorMessage:c.error.message,[p,g]=u.split(" : ");if(p==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ku(n,"credential-already-in-use",c);if(p==="EMAIL_EXISTS")throw Ku(n,"email-already-in-use",c);if(p==="USER_DISABLED")throw Ku(n,"user-disabled",c);const b=r[p]||p.toLowerCase().replace(/[_\s]+/g,"-");if(g)throw tI(n,b,g);Li(n,b)}}catch(i){if(i instanceof di)throw i;Li(n,"network-request-failed",{message:String(i)})}}async function tl(n,e,t,r,i={}){const l=await ui(n,e,t,r,i);return"mfaPendingCredential"in l&&Li(n,"multi-factor-auth-required",{_serverResponse:l}),l}async function iI(n,e,t,r){const i=`${e}${t}?${r}`,l=n,c=l.config.emulator?qy(n.config,i):`${n.config.apiScheme}://${i}`;return Sk.includes(t)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(c).toString():c}function jk(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class kk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Ps(this.auth,"network-request-failed")),Ak.get())})}}function Ku(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=Ps(n,e,r);return i.customData._tokenResponse=t,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rw(n){return n!==void 0&&n.getResponse!==void 0}function sw(n){return n!==void 0&&n.enterprise!==void 0}class aI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return jk(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ck(n){return(await ui(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function oI(n,e){return ui(n,"GET","/v2/recaptchaConfig",fs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rk(n,e){return ui(n,"POST","/v1/accounts:delete",e)}async function zp(n,e){return ui(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ah(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Dk(n,e=!1){const t=Ht(n),r=await t.getIdToken(e),i=Wy(r);Ue(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const l=typeof i.firebase=="object"?i.firebase:void 0,c=l==null?void 0:l.sign_in_provider;return{claims:i,token:r,authTime:ah(fx(i.auth_time)),issuedAtTime:ah(fx(i.iat)),expirationTime:ah(fx(i.exp)),signInProvider:c||null,signInSecondFactor:(l==null?void 0:l.sign_in_second_factor)||null}}function fx(n){return Number(n)*1e3}function Wy(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return vp("JWT malformed, contained fewer than 3 sections"),null;try{const i=VN(t);return i?JSON.parse(i):(vp("Failed to decode base64 JWT payload"),null)}catch(i){return vp("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function iw(n){const e=Wy(n);return Ue(e,"internal-error"),Ue(typeof e.exp<"u","internal-error"),Ue(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _h(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof di&&Pk(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Pk({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ok{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zx{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ah(this.lastLoginAt),this.creationTime=ah(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qp(n){var w;const e=n.auth,t=await n.getIdToken(),r=await _h(n,zp(e,{idToken:t}));Ue(r==null?void 0:r.users.length,e,"internal-error");const i=r.users[0];n._notifyReloadListener(i);const l=(w=i.providerUserInfo)!=null&&w.length?lI(i.providerUserInfo):[],c=Vk(n.providerData,l),u=n.isAnonymous,p=!(n.email&&i.passwordHash)&&!(c!=null&&c.length),g=u?p:!1,b={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new Zx(i.createdAt,i.lastLoginAt),isAnonymous:g};Object.assign(n,b)}async function Mk(n){const e=Ht(n);await qp(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Vk(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function lI(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lk(n,e){const t=await sI(n,{},async()=>{const r=Fd({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:l}=n.config,c=await iI(n,i,"/v1/token",`key=${l}`),u=await n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const p={method:"POST",headers:u,body:r};return n.emulatorConfig&&Zo(n.emulatorConfig.host)&&(p.credentials="include"),rI.fetch()(c,p)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function $k(n,e){return ui(n,"POST","/v2/accounts:revokeToken",fs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vd{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ue(e.idToken,"internal-error"),Ue(typeof e.idToken<"u","internal-error"),Ue(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):iw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ue(e.length!==0,"internal-error");const t=iw(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ue(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:l}=await Lk(e,t);this.updateTokensAndExpiration(r,i,Number(l))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:l}=t,c=new vd;return r&&(Ue(typeof r=="string","internal-error",{appName:e}),c.refreshToken=r),i&&(Ue(typeof i=="string","internal-error",{appName:e}),c.accessToken=i),l&&(Ue(typeof l=="number","internal-error",{appName:e}),c.expirationTime=l),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new vd,this.toJSON())}_performRefresh(){return Fa("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ko(n,e){Ue(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Vi{constructor({uid:e,auth:t,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new Ok(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Zx(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await _h(this,this.stsTokenManager.getToken(this.auth,e));return Ue(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Dk(this,e)}reload(){return Mk(this)}_assign(e){this!==e&&(Ue(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Vi({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Ue(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await qp(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(hs(this.auth.app))return Promise.reject(sa(this.auth));const e=await this.getIdToken();return await _h(this,Rk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,i=t.email??void 0,l=t.phoneNumber??void 0,c=t.photoURL??void 0,u=t.tenantId??void 0,p=t._redirectEventId??void 0,g=t.createdAt??void 0,b=t.lastLoginAt??void 0,{uid:w,emailVerified:E,isAnonymous:C,providerData:H,stsTokenManager:F}=t;Ue(w&&F,e,"internal-error");const U=vd.fromJSON(this.name,F);Ue(typeof w=="string",e,"internal-error"),ko(r,e.name),ko(i,e.name),Ue(typeof E=="boolean",e,"internal-error"),Ue(typeof C=="boolean",e,"internal-error"),ko(l,e.name),ko(c,e.name),ko(u,e.name),ko(p,e.name),ko(g,e.name),ko(b,e.name);const ae=new Vi({uid:w,auth:e,email:i,emailVerified:E,displayName:r,isAnonymous:C,photoURL:c,phoneNumber:l,tenantId:u,stsTokenManager:U,createdAt:g,lastLoginAt:b});return H&&Array.isArray(H)&&(ae.providerData=H.map(re=>({...re}))),p&&(ae._redirectEventId=p),ae}static async _fromIdTokenResponse(e,t,r=!1){const i=new vd;i.updateFromServerResponse(t);const l=new Vi({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await qp(l),l}static async _fromGetAccountInfoResponse(e,t,r){const i=t.users[0];Ue(i.localId!==void 0,"internal-error");const l=i.providerUserInfo!==void 0?lI(i.providerUserInfo):[],c=!(i.email&&i.passwordHash)&&!(l!=null&&l.length),u=new vd;u.updateFromIdToken(r);const p=new Vi({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:c}),g={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new Zx(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(l!=null&&l.length)};return Object.assign(p,g),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aw=new Map;function Ba(n){Ga(n instanceof Function,"Expected a class definition");let e=aw.get(n);return e?(Ga(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,aw.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}cI.type="NONE";const ey=cI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bp(n,e,t){return`firebase:${n}:${e}:${t}`}class bd{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:l}=this.auth;this.fullUserKey=bp(this.userKey,i.apiKey,l),this.fullPersistenceKey=bp("persistence",i.apiKey,l),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await zp(this.auth,{idToken:e}).catch(()=>{});return t?Vi._fromGetAccountInfoResponse(this.auth,t,e):null}return Vi._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new bd(Ba(ey),e,r);const i=(await Promise.all(t.map(async g=>{if(await g._isAvailable())return g}))).filter(g=>g);let l=i[0]||Ba(ey);const c=bp(r,e.config.apiKey,e.name);let u=null;for(const g of t)try{const b=await g._get(c);if(b){let w;if(typeof b=="string"){const E=await zp(e,{idToken:b}).catch(()=>{});if(!E)break;w=await Vi._fromGetAccountInfoResponse(e,E,b)}else w=Vi._fromJSON(e,b);g!==l&&(u=w),l=g;break}}catch{}const p=i.filter(g=>g._shouldAllowMigration);return!l._shouldAllowMigration||!p.length?new bd(l,e,r):(l=p[0],u&&await l._set(c,u.toJSON()),await Promise.all(t.map(async g=>{if(g!==l)try{await g._remove(c)}catch{}})),new bd(l,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ow(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(mI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(dI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(fI(e))return"Blackberry";if(gI(e))return"Webos";if(uI(e))return"Safari";if((e.includes("chrome/")||hI(e))&&!e.includes("edge/"))return"Chrome";if(pI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function dI(n=Xn()){return/firefox\//i.test(n)}function uI(n=Xn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function hI(n=Xn()){return/crios\//i.test(n)}function mI(n=Xn()){return/iemobile/i.test(n)}function pI(n=Xn()){return/android/i.test(n)}function fI(n=Xn()){return/blackberry/i.test(n)}function gI(n=Xn()){return/webos/i.test(n)}function Hy(n=Xn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Fk(n=Xn()){var e;return Hy(n)&&!!((e=window.navigator)!=null&&e.standalone)}function Bk(){return r2()&&document.documentMode===10}function xI(n=Xn()){return Hy(n)||pI(n)||gI(n)||fI(n)||/windows phone/i.test(n)||mI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yI(n,e=[]){let t;switch(n){case"Browser":t=ow(Xn());break;case"Worker":t=`${ow(Xn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${wc}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=l=>new Promise((c,u)=>{try{const p=e(l);c(p)}catch(p){u(p)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zk(n,e={}){return ui(n,"GET","/v2/passwordPolicy",fs(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qk=6;class Wk{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??qk,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new lw(this),this.idTokenSubscription=new lw(this),this.beforeStateQueue=new Uk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=eI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ba(t)),this._initializationPromise=this.queue(async()=>{var r,i,l;if(!this._deleted&&(this.persistenceManager=await bd.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((i=this._popupRedirectResolver)!=null&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((l=this.currentUser)==null?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await zp(this,{idToken:e}),r=await Vi._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var l;if(hs(this.app)){const c=this.app.settings.authIdToken;return c?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(c).then(u,u))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const c=(l=this.redirectUser)==null?void 0:l._redirectEventId,u=r==null?void 0:r._redirectEventId,p=await this.tryRedirectSignIn(e);(!c||c===u)&&(p!=null&&p.user)&&(r=p.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(c){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(c))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ue(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await qp(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Ek()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(hs(this.app))return Promise.reject(sa(this));const t=e?Ht(e):null;return t&&Ue(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ue(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return hs(this.app)?Promise.reject(sa(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return hs(this.app)?Promise.reject(sa(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ba(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await zk(this),t=new Wk(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new el("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await $k(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ba(e)||this._popupRedirectResolver;Ue(t,this,"argument-error"),this.redirectPersistenceManager=await bd.create(this,[Ba(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const l=typeof t=="function"?t:t.next.bind(t);let c=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ue(u,this,"internal-error"),u.then(()=>{c||l(this.currentUser)}),typeof t=="function"){const p=e.addObserver(t,r,i);return()=>{c=!0,p()}}else{const p=e.addObserver(t);return()=>{c=!0,p()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ue(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=yI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var i;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((i=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(hs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&Nk(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function ua(n){return Ht(n)}class lw{constructor(e){this.auth=e,this.observer=null,this.addObserver=l2(t=>this.observer=t)}get next(){return Ue(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Gk(n){Bh=n}function Gy(n){return Bh.loadJS(n)}function Kk(){return Bh.recaptchaV2Script}function Qk(){return Bh.recaptchaEnterpriseScript}function Yk(){return Bh.gapiScript}function vI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jk=500,Xk=6e4,sp=1e12;class Zk{constructor(e){this.auth=e,this.counter=sp,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new nC(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||sp;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||sp;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||sp;return(r=this._widgets.get(t))==null||r.execute(),""}}class eC{constructor(){this.enterprise=new tC}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class tC{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class nC{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const i=typeof e=="string"?document.getElementById(e):e;Ue(i,"argument-error",{appName:t}),this.container=i,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=rC(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},Xk)},Jk))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function rC(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const sC="recaptcha-enterprise",oh="NO_RECAPTCHA";class bI{constructor(e){this.type=sC,this.auth=ua(e)}async verify(e="verify",t=!1){async function r(l){if(!t){if(l.tenantId==null&&l._agentRecaptchaConfig!=null)return l._agentRecaptchaConfig.siteKey;if(l.tenantId!=null&&l._tenantRecaptchaConfigs[l.tenantId]!==void 0)return l._tenantRecaptchaConfigs[l.tenantId].siteKey}return new Promise(async(c,u)=>{oI(l,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(p=>{if(p.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const g=new aI(p);return l.tenantId==null?l._agentRecaptchaConfig=g:l._tenantRecaptchaConfigs[l.tenantId]=g,c(g.siteKey)}}).catch(p=>{u(p)})})}function i(l,c,u){const p=window.grecaptcha;sw(p)?p.enterprise.ready(()=>{p.enterprise.execute(l,{action:e}).then(g=>{c(g)}).catch(()=>{c(oh)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new eC().execute("siteKey",{action:"verify"}):new Promise((l,c)=>{r(this.auth).then(u=>{if(!t&&sw(window.grecaptcha))i(u,l,c);else{if(typeof window>"u"){c(new Error("RecaptchaVerifier is only supported in browser"));return}let p=Qk();p.length!==0&&(p+=u),Gy(p).then(()=>{i(u,l,c)}).catch(g=>{c(g)})}}).catch(u=>{c(u)})})}}async function Mu(n,e,t,r=!1,i=!1){const l=new bI(n);let c;if(i)c=oh;else try{c=await l.verify(t)}catch{c=await l.verify(t,!0)}const u={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const p=u.phoneEnrollmentInfo.phoneNumber,g=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:p,recaptchaToken:g,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const p=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:p,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return r?Object.assign(u,{captchaResp:c}):Object.assign(u,{captchaResponse:c}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function wd(n,e,t,r,i){var l,c;if(i==="EMAIL_PASSWORD_PROVIDER")if((l=n._getRecaptchaConfig())!=null&&l.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const u=await Mu(n,e,t,t==="getOobCode");return r(n,u)}else return r(n,e).catch(async u=>{if(u.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const p=await Mu(n,e,t,t==="getOobCode");return r(n,p)}else return Promise.reject(u)});else if(i==="PHONE_PROVIDER")if((c=n._getRecaptchaConfig())!=null&&c.isProviderEnabled("PHONE_PROVIDER")){const u=await Mu(n,e,t);return r(n,u).catch(async p=>{var g;if(((g=n._getRecaptchaConfig())==null?void 0:g.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(p.code==="auth/missing-recaptcha-token"||p.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const b=await Mu(n,e,t,!1,!0);return r(n,b)}return Promise.reject(p)})}else{const u=await Mu(n,e,t,!1,!0);return r(n,u)}else return Promise.reject(i+" provider is not supported.")}async function iC(n){const e=ua(n),t=await oI(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new aI(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new bI(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wI(n,e){const t=Ya(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),l=t.getOptions();if(Wa(l,e??{}))return i;Li(i,"already-initialized")}return t.initialize({options:e})}function aC(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Ba);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function oC(n,e,t){const r=ua(n);Ue(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,l=_I(e),{host:c,port:u}=lC(e),p=u===null?"":`:${u}`,g={url:`${l}//${c}${p}/`},b=Object.freeze({host:c,port:u,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Ue(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ue(Wa(g,r.config.emulator)&&Wa(b,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=g,r.emulatorConfig=b,r.settings.appVerificationDisabledForTesting=!0,Zo(c)?(Ly(`${l}//${c}${p}`),$y("Auth",!0)):cC()}function _I(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function lC(n){const e=_I(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const l=i[1];return{host:l,port:cw(r.substr(l.length+1))}}else{const[l,c]=r.split(":");return{host:l,port:cw(c)}}}function cw(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function cC(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Fa("not implemented")}_getIdTokenResponse(e){return Fa("not implemented")}_linkToIdToken(e,t){return Fa("not implemented")}_getReauthenticationResolver(e){return Fa("not implemented")}}async function dC(n,e){return ui(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uC(n,e){return tl(n,"POST","/v1/accounts:signInWithPassword",fs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hC(n,e){return tl(n,"POST","/v1/accounts:signInWithEmailLink",fs(n,e))}async function mC(n,e){return tl(n,"POST","/v1/accounts:signInWithEmailLink",fs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh extends _f{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Nh(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Nh(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return wd(e,t,"signInWithPassword",uC,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return hC(e,{email:this._email,oobCode:this._password});default:Li(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return wd(e,r,"signUpPassword",dC,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return mC(e,{idToken:t,email:this._email,oobCode:this._password});default:Li(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _d(n,e){return tl(n,"POST","/v1/accounts:signInWithIdp",fs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pC="http://localhost";class ic extends _f{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ic(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Li("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...l}=t;if(!r||!i)return null;const c=new ic(r,i);return c.idToken=l.idToken||void 0,c.accessToken=l.accessToken||void 0,c.secret=l.secret,c.nonce=l.nonce,c.pendingToken=l.pendingToken||null,c}_getIdTokenResponse(e){const t=this.buildRequest();return _d(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,_d(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_d(e,t)}buildRequest(){const e={requestUri:pC,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Fd(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dw(n,e){return ui(n,"POST","/v1/accounts:sendVerificationCode",fs(n,e))}async function fC(n,e){return tl(n,"POST","/v1/accounts:signInWithPhoneNumber",fs(n,e))}async function gC(n,e){const t=await tl(n,"POST","/v1/accounts:signInWithPhoneNumber",fs(n,e));if(t.temporaryProof)throw Ku(n,"account-exists-with-different-credential",t);return t}const xC={USER_NOT_FOUND:"user-not-found"};async function yC(n,e){const t={...e,operation:"REAUTH"};return tl(n,"POST","/v1/accounts:signInWithPhoneNumber",fs(n,t),xC)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lh extends _f{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new lh({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new lh({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return fC(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return gC(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return yC(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:l}=e;return!r&&!t&&!i&&!l?null:new lh({verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vC(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function bC(n){const e=Hu(Gu(n)).link,t=e?Hu(Gu(e)).deep_link_id:null,r=Hu(Gu(n)).deep_link_id;return(r?Hu(Gu(r)).link:null)||r||t||e||n}class Ky{constructor(e){const t=Hu(Gu(e)),r=t.apiKey??null,i=t.oobCode??null,l=vC(t.mode??null);Ue(r&&i&&l,"argument-error"),this.apiKey=r,this.operation=l,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=bC(e);try{return new Ky(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd{constructor(){this.providerId=Bd.PROVIDER_ID}static credential(e,t){return Nh._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Ky.parseLink(t);return Ue(r,"argument-error"),Nh._fromEmailAndCode(e,r.code,r.tenantId)}}Bd.PROVIDER_ID="password";Bd.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Bd.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NI{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uh extends NI{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo extends Uh{constructor(){super("facebook.com")}static credential(e){return ic._fromParams({providerId:Mo.PROVIDER_ID,signInMethod:Mo.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Mo.credentialFromTaggedObject(e)}static credentialFromError(e){return Mo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Mo.credential(e.oauthAccessToken)}catch{return null}}}Mo.FACEBOOK_SIGN_IN_METHOD="facebook.com";Mo.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo extends Uh{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ic._fromParams({providerId:Vo.PROVIDER_ID,signInMethod:Vo.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Vo.credentialFromTaggedObject(e)}static credentialFromError(e){return Vo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Vo.credential(t,r)}catch{return null}}}Vo.GOOGLE_SIGN_IN_METHOD="google.com";Vo.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo extends Uh{constructor(){super("github.com")}static credential(e){return ic._fromParams({providerId:Lo.PROVIDER_ID,signInMethod:Lo.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Lo.credentialFromTaggedObject(e)}static credentialFromError(e){return Lo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Lo.credential(e.oauthAccessToken)}catch{return null}}}Lo.GITHUB_SIGN_IN_METHOD="github.com";Lo.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o extends Uh{constructor(){super("twitter.com")}static credential(e,t){return ic._fromParams({providerId:$o.PROVIDER_ID,signInMethod:$o.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return $o.credentialFromTaggedObject(e)}static credentialFromError(e){return $o.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return $o.credential(t,r)}catch{return null}}}$o.TWITTER_SIGN_IN_METHOD="twitter.com";$o.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wC(n,e){return tl(n,"POST","/v1/accounts:signUp",fs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const l=await Vi._fromIdTokenResponse(e,r,i),c=uw(r);return new ac({user:l,providerId:c,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=uw(r);return new ac({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function uw(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp extends di{constructor(e,t,r,i){super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,Wp.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new Wp(e,t,r,i)}}function II(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?Wp._fromErrorAndOperation(n,l,e,r):l})}async function _C(n,e,t=!1){const r=await _h(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ac._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NC(n,e,t=!1){const{auth:r}=n;if(hs(r.app))return Promise.reject(sa(r));const i="reauthenticate";try{const l=await _h(n,II(r,i,e,n),t);Ue(l.idToken,r,"internal-error");const c=Wy(l.idToken);Ue(c,r,"internal-error");const{sub:u}=c;return Ue(n.uid===u,r,"user-mismatch"),ac._forOperation(n,i,l)}catch(l){throw(l==null?void 0:l.code)==="auth/user-not-found"&&Li(r,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EI(n,e,t=!1){if(hs(n.app))return Promise.reject(sa(n));const r="signIn",i=await II(n,r,e),l=await ac._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(l.user),l}async function TI(n,e){return EI(ua(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SI(n){const e=ua(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function IC(n,e,t){if(hs(n.app))return Promise.reject(sa(n));const r=ua(n),c=await wd(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",wC,"EMAIL_PASSWORD_PROVIDER").catch(p=>{throw p.code==="auth/password-does-not-meet-requirements"&&SI(n),p}),u=await ac._fromIdTokenResponse(r,"signIn",c);return await r._updateCurrentUser(u.user),u}function EC(n,e,t){return hs(n.app)?Promise.reject(sa(n)):TI(Ht(n),Bd.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&SI(n),r})}function TC(n,e,t,r){return Ht(n).onIdTokenChanged(e,t,r)}function SC(n,e,t){return Ht(n).beforeAuthStateChanged(e,t)}function AC(n,e,t,r){return Ht(n).onAuthStateChanged(e,t,r)}function AI(n){return Ht(n).signOut()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hw(n,e){return ui(n,"POST","/v2/accounts/mfaEnrollment:start",fs(n,e))}const Hp="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Hp,"1"),this.storage.removeItem(Hp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jC=1e3,kC=10;class kI extends jI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=xI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((c,u,p)=>{this.notifyListeners(c,p)});return}const r=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const c=this.storage.getItem(r);!t&&this.localCache[r]===c||this.notifyListeners(r,c)},l=this.storage.getItem(r);Bk()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,kC):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},jC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}kI.type="LOCAL";const CC=kI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CI extends jI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}CI.type="SESSION";const RI=CI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RC(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new Nf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:l}=t.data,c=this.handlersMap[i];if(!(c!=null&&c.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const u=Array.from(c).map(async g=>g(t.origin,l)),p=await RC(u);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:p})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Nf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qy(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DC{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let l,c;return new Promise((u,p)=>{const g=Qy("",20);i.port1.start();const b=setTimeout(()=>{p(new Error("unsupported_event"))},r);c={messageChannel:i,onMessage(w){const E=w;if(E.data.eventId===g)switch(E.data.status){case"ack":clearTimeout(b),l=setTimeout(()=>{p(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),u(E.data.response);break;default:clearTimeout(b),clearTimeout(l),p(new Error("invalid_response"));break}}},this.handlers.add(c),i.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:g,data:t},[i.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zn(){return window}function PC(n){zn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yy(){return typeof zn().WorkerGlobalScope<"u"&&typeof zn().importScripts=="function"}async function OC(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function MC(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function VC(){return Yy()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DI="firebaseLocalStorageDb",LC=1,Gp="firebaseLocalStorage",PI="fbase_key";class zh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function If(n,e){return n.transaction([Gp],e?"readwrite":"readonly").objectStore(Gp)}function $C(){const n=indexedDB.deleteDatabase(DI);return new zh(n).toPromise()}function ty(){const n=indexedDB.open(DI,LC);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Gp,{keyPath:PI})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Gp)?e(r):(r.close(),await $C(),e(await ty()))})})}async function mw(n,e,t){const r=If(n,!0).put({[PI]:e,value:t});return new zh(r).toPromise()}async function FC(n,e){const t=If(n,!1).get(e),r=await new zh(t).toPromise();return r===void 0?null:r.value}function pw(n,e){const t=If(n,!0).delete(e);return new zh(t).toPromise()}const BC=800,UC=3;class OI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ty(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>UC)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Yy()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Nf._getInstance(VC()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await OC(),!this.activeServiceWorker)return;this.sender=new DC(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||MC()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ty();return await mw(e,Hp,"1"),await pw(e,Hp),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>mw(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>FC(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>pw(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const l=If(i,!1).getAll();return new zh(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:l}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(l)&&(this.notifyListeners(i,l),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),BC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}OI.type="LOCAL";const zC=OI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fw(n,e){return ui(n,"POST","/v2/accounts/mfaSignIn:start",fs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gx=vI("rcb"),qC=new Fh(3e4,6e4);class WC{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=zn().grecaptcha)!=null&&e.render)}load(e,t=""){return Ue(HC(t),e,"argument-error"),this.shouldResolveImmediately(t)&&rw(zn().grecaptcha)?Promise.resolve(zn().grecaptcha):new Promise((r,i)=>{const l=zn().setTimeout(()=>{i(Ps(e,"network-request-failed"))},qC.get());zn()[gx]=()=>{zn().clearTimeout(l),delete zn()[gx];const u=zn().grecaptcha;if(!u||!rw(u)){i(Ps(e,"internal-error"));return}const p=u.render;u.render=(g,b)=>{const w=p(g,b);return this.counter++,w},this.hostLanguage=t,r(u)};const c=`${Kk()}?${Fd({onload:gx,render:"explicit",hl:t})}`;Gy(c).catch(()=>{clearTimeout(l),i(Ps(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=zn().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function HC(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class GC{async load(e){return new Zk(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ch="recaptcha",KC={theme:"light",type:"image"};class QC{constructor(e,t,r={...KC}){this.parameters=r,this.type=ch,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ua(e),this.isInvisible=this.parameters.size==="invisible",Ue(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const i=typeof t=="string"?document.getElementById(t):t;Ue(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new GC:new WC,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(i=>{const l=c=>{c&&(this.tokenChangeListeners.delete(l),i(c))};this.tokenChangeListeners.add(l),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Ue(!this.parameters.sitekey,this.auth,"argument-error"),Ue(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Ue(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=zn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){Ue(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Ue(nI()&&!Yy(),this.auth,"internal-error"),await YC(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await Ck(this.auth);Ue(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Ue(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function YC(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=lh._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function XC(n,e,t){if(hs(n.app))return Promise.reject(sa(n));const r=ua(n),i=await ZC(r,e,Ht(t));return new JC(i,l=>TI(r,l))}async function ZC(n,e,t){var r;if(!n._getRecaptchaConfig())try{await iC(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const l=i.session;if("phoneNumber"in i){Ue(l.type==="enroll",n,"internal-error");const c={idToken:l.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await wd(n,c,"mfaSmsEnrollment",async(b,w)=>{if(w.phoneEnrollmentInfo.captchaResponse===oh){Ue((t==null?void 0:t.type)===ch,b,"argument-error");const E=await xx(b,w,t);return hw(b,E)}return hw(b,w)},"PHONE_PROVIDER").catch(b=>Promise.reject(b))).phoneSessionInfo.sessionInfo}else{Ue(l.type==="signin",n,"internal-error");const c=((r=i.multiFactorHint)==null?void 0:r.uid)||i.multiFactorUid;Ue(c,n,"missing-multi-factor-info");const u={mfaPendingCredential:l.credential,mfaEnrollmentId:c,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await wd(n,u,"mfaSmsSignIn",async(w,E)=>{if(E.phoneSignInInfo.captchaResponse===oh){Ue((t==null?void 0:t.type)===ch,w,"argument-error");const C=await xx(w,E,t);return fw(w,C)}return fw(w,E)},"PHONE_PROVIDER").catch(w=>Promise.reject(w))).phoneResponseInfo.sessionInfo}}else{const l={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await wd(n,l,"sendVerificationCode",async(g,b)=>{if(b.captchaResponse===oh){Ue((t==null?void 0:t.type)===ch,g,"argument-error");const w=await xx(g,b,t);return dw(g,w)}return dw(g,b)},"PHONE_PROVIDER").catch(g=>Promise.reject(g))).sessionInfo}}finally{t==null||t._reset()}}async function xx(n,e,t){Ue(t.type===ch,n,"argument-error");const r=await t.verify();Ue(typeof r=="string",n,"argument-error");const i={...e};if("phoneEnrollmentInfo"in i){const l=i.phoneEnrollmentInfo.phoneNumber,c=i.phoneEnrollmentInfo.captchaResponse,u=i.phoneEnrollmentInfo.clientType,p=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:r,captchaResponse:c,clientType:u,recaptchaVersion:p}}),i}else if("phoneSignInInfo"in i){const l=i.phoneSignInInfo.captchaResponse,c=i.phoneSignInInfo.clientType,u=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:l,clientType:c,recaptchaVersion:u}}),i}else return Object.assign(i,{recaptchaToken:r}),i}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eR(n,e){return e?Ba(e):(Ue(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy extends _f{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _d(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _d(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _d(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function tR(n){return EI(n.auth,new Jy(n),n.bypassAuthState)}function nR(n){const{auth:e,user:t}=n;return Ue(t,e,"internal-error"),NC(t,new Jy(n),n.bypassAuthState)}async function rR(n){const{auth:e,user:t}=n;return Ue(t,e,"internal-error"),_C(t,new Jy(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MI{constructor(e,t,r,i,l=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:l,error:c,type:u}=e;if(c){this.reject(c);return}const p={auth:this.auth,requestUri:t,sessionId:r,tenantId:l||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(p))}catch(g){this.reject(g)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return tR;case"linkViaPopup":case"linkViaRedirect":return rR;case"reauthViaPopup":case"reauthViaRedirect":return nR;default:Li(this.auth,"internal-error")}}resolve(e){Ga(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ga(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sR=new Fh(2e3,1e4);class yd extends MI{constructor(e,t,r,i,l){super(e,t,i,l),this.provider=r,this.authWindow=null,this.pollId=null,yd.currentPopupAction&&yd.currentPopupAction.cancel(),yd.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ue(e,this.auth,"internal-error"),e}async onExecution(){Ga(this.filter.length===1,"Popup operations only handle one event");const e=Qy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ps(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Ps(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,yd.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ps(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,sR.get())};e()}}yd.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iR="pendingRedirect",wp=new Map;class aR extends MI{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=wp.get(this.auth._key());if(!e){try{const r=await oR(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}wp.set(this.auth._key(),e)}return this.bypassAuthState||wp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function oR(n,e){const t=dR(e),r=cR(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}function lR(n,e){wp.set(n._key(),e)}function cR(n){return Ba(n._redirectPersistence)}function dR(n){return bp(iR,n.config.apiKey,n.name)}async function uR(n,e,t=!1){if(hs(n.app))return Promise.reject(sa(n));const r=ua(n),i=eR(r,e),c=await new aR(r,i,t).execute();return c&&!t&&(delete c.user._redirectEventId,await r._persistUserIfCurrent(c.user),await r._setRedirectUser(null,e)),c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hR=600*1e3;class mR{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!pR(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!VI(e)){const i=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(Ps(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=hR&&this.cachedEventUids.clear(),this.cachedEventUids.has(gw(e))}saveEventToCache(e){this.cachedEventUids.add(gw(e)),this.lastProcessedEventTime=Date.now()}}function gw(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function VI({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function pR(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return VI(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fR(n,e={}){return ui(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gR=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,xR=/^https?/;async function yR(n){if(n.config.emulator)return;const{authorizedDomains:e}=await fR(n);for(const t of e)try{if(vR(t))return}catch{}Li(n,"unauthorized-domain")}function vR(n){const e=Xx(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const c=new URL(n);return c.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&c.hostname===r}if(!xR.test(t))return!1;if(gR.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bR=new Fh(3e4,6e4);function xw(){const n=zn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function wR(n){return new Promise((e,t)=>{var i,l,c;function r(){xw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{xw(),t(Ps(n,"network-request-failed"))},timeout:bR.get()})}if((l=(i=zn().gapi)==null?void 0:i.iframes)!=null&&l.Iframe)e(gapi.iframes.getContext());else if((c=zn().gapi)!=null&&c.load)r();else{const u=vI("iframefcb");return zn()[u]=()=>{gapi.load?r():t(Ps(n,"network-request-failed"))},Gy(`${Yk()}?onload=${u}`).catch(p=>t(p))}}).catch(e=>{throw _p=null,e})}let _p=null;function _R(n){return _p=_p||wR(n),_p}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NR=new Fh(5e3,15e3),IR="__/auth/iframe",ER="emulator/auth/iframe",TR={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},SR=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function AR(n){const e=n.config;Ue(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?qy(e,ER):`https://${n.config.authDomain}/${IR}`,r={apiKey:e.apiKey,appName:n.name,v:wc},i=SR.get(n.config.apiHost);i&&(r.eid=i);const l=n._getFrameworks();return l.length&&(r.fw=l.join(",")),`${t}?${Fd(r).slice(1)}`}async function jR(n){const e=await _R(n),t=zn().gapi;return Ue(t,n,"internal-error"),e.open({where:document.body,url:AR(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:TR,dontclear:!0},r=>new Promise(async(i,l)=>{await r.restyle({setHideOnLeave:!1});const c=Ps(n,"network-request-failed"),u=zn().setTimeout(()=>{l(c)},NR.get());function p(){zn().clearTimeout(u),i(r)}r.ping(p).then(p,()=>{l(c)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kR={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},CR=500,RR=600,DR="_blank",PR="http://localhost";class yw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function OR(n,e,t,r=CR,i=RR){const l=Math.max((window.screen.availHeight-i)/2,0).toString(),c=Math.max((window.screen.availWidth-r)/2,0).toString();let u="";const p={...kR,width:r.toString(),height:i.toString(),top:l,left:c},g=Xn().toLowerCase();t&&(u=hI(g)?DR:t),dI(g)&&(e=e||PR,p.scrollbars="yes");const b=Object.entries(p).reduce((E,[C,H])=>`${E}${C}=${H},`,"");if(Fk(g)&&u!=="_self")return MR(e||"",u),new yw(null);const w=window.open(e||"",u,b);Ue(w,n,"popup-blocked");try{w.focus()}catch{}return new yw(w)}function MR(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VR="__/auth/handler",LR="emulator/auth/handler",$R=encodeURIComponent("fac");async function vw(n,e,t,r,i,l){Ue(n.config.authDomain,n,"auth-domain-config-required"),Ue(n.config.apiKey,n,"invalid-api-key");const c={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:wc,eventId:i};if(e instanceof NI){e.setDefaultLanguage(n.languageCode),c.providerId=e.providerId||"",o2(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[b,w]of Object.entries({}))c[b]=w}if(e instanceof Uh){const b=e.getScopes().filter(w=>w!=="");b.length>0&&(c.scopes=b.join(","))}n.tenantId&&(c.tid=n.tenantId);const u=c;for(const b of Object.keys(u))u[b]===void 0&&delete u[b];const p=await n._getAppCheckToken(),g=p?`#${$R}=${encodeURIComponent(p)}`:"";return`${FR(n)}?${Fd(u).slice(1)}${g}`}function FR({config:n}){return n.emulator?qy(n,LR):`https://${n.authDomain}/${VR}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yx="webStorageSupport";class BR{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=RI,this._completeRedirectFn=uR,this._overrideRedirectResult=lR}async _openPopup(e,t,r,i){var c;Ga((c=this.eventManagers[e._key()])==null?void 0:c.manager,"_initialize() not called before _openPopup()");const l=await vw(e,t,r,Xx(),i);return OR(e,l,Qy())}async _openRedirect(e,t,r,i){await this._originValidation(e);const l=await vw(e,t,r,Xx(),i);return PC(l),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:l}=this.eventManagers[t];return i?Promise.resolve(i):(Ga(l,"If manager is not set, promise should be"),l)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await jR(e),r=new mR(e);return t.register("authEvent",i=>(Ue(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(yx,{type:yx},i=>{var c;const l=(c=i==null?void 0:i[0])==null?void 0:c[yx];l!==void 0&&t(!!l),Li(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=yR(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return xI()||uI()||Hy()}}const UR=BR;var bw="@firebase/auth",ww="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zR{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ue(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qR(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function WR(n){Ms(new ps("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:c,authDomain:u}=r.options;Ue(c&&!c.includes(":"),"invalid-api-key",{appName:r.name});const p={apiKey:c,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:yI(n)},g=new Hk(r,i,l,p);return aC(g,t),g},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ms(new ps("auth-internal",e=>{const t=ua(e.getProvider("auth").getImmediate());return(r=>new zR(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),kr(bw,ww,qR(n)),kr(bw,ww,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HR=300,GR=UN("authIdTokenMaxAge")||HR;let _w=null;const KR=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>GR)return;const i=t==null?void 0:t.token;_w!==i&&(_w=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function LI(n=$h()){const e=Ya(n,"auth");if(e.isInitialized())return e.getImmediate();const t=wI(n,{popupRedirectResolver:UR,persistence:[zC,CC,RI]}),r=UN("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(r,location.origin);if(location.origin===l.origin){const c=KR(l.toString());SC(t,c,()=>c(t.currentUser)),TC(t,u=>c(u))}}const i=$N("auth");return i&&oC(t,`http://${i}`),t}function QR(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}Gk({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const l=Ps("internal-error");l.customData=i,t(l)},r.type="text/javascript",r.charset="UTF-8",QR().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});WR("Browser");var YR="firebase",JR="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */kr(YR,JR,"app");var Nw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Wo,$I;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(D,k){function O(){}O.prototype=k.prototype,D.F=k.prototype,D.prototype=new O,D.prototype.constructor=D,D.D=function(z,B,K){for(var M=Array(arguments.length-2),Ve=2;Ve<arguments.length;Ve++)M[Ve-2]=arguments[Ve];return k.prototype[B].apply(z,M)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(D,k,O){O||(O=0);const z=Array(16);if(typeof k=="string")for(var B=0;B<16;++B)z[B]=k.charCodeAt(O++)|k.charCodeAt(O++)<<8|k.charCodeAt(O++)<<16|k.charCodeAt(O++)<<24;else for(B=0;B<16;++B)z[B]=k[O++]|k[O++]<<8|k[O++]<<16|k[O++]<<24;k=D.g[0],O=D.g[1],B=D.g[2];let K=D.g[3],M;M=k+(K^O&(B^K))+z[0]+3614090360&4294967295,k=O+(M<<7&4294967295|M>>>25),M=K+(B^k&(O^B))+z[1]+3905402710&4294967295,K=k+(M<<12&4294967295|M>>>20),M=B+(O^K&(k^O))+z[2]+606105819&4294967295,B=K+(M<<17&4294967295|M>>>15),M=O+(k^B&(K^k))+z[3]+3250441966&4294967295,O=B+(M<<22&4294967295|M>>>10),M=k+(K^O&(B^K))+z[4]+4118548399&4294967295,k=O+(M<<7&4294967295|M>>>25),M=K+(B^k&(O^B))+z[5]+1200080426&4294967295,K=k+(M<<12&4294967295|M>>>20),M=B+(O^K&(k^O))+z[6]+2821735955&4294967295,B=K+(M<<17&4294967295|M>>>15),M=O+(k^B&(K^k))+z[7]+4249261313&4294967295,O=B+(M<<22&4294967295|M>>>10),M=k+(K^O&(B^K))+z[8]+1770035416&4294967295,k=O+(M<<7&4294967295|M>>>25),M=K+(B^k&(O^B))+z[9]+2336552879&4294967295,K=k+(M<<12&4294967295|M>>>20),M=B+(O^K&(k^O))+z[10]+4294925233&4294967295,B=K+(M<<17&4294967295|M>>>15),M=O+(k^B&(K^k))+z[11]+2304563134&4294967295,O=B+(M<<22&4294967295|M>>>10),M=k+(K^O&(B^K))+z[12]+1804603682&4294967295,k=O+(M<<7&4294967295|M>>>25),M=K+(B^k&(O^B))+z[13]+4254626195&4294967295,K=k+(M<<12&4294967295|M>>>20),M=B+(O^K&(k^O))+z[14]+2792965006&4294967295,B=K+(M<<17&4294967295|M>>>15),M=O+(k^B&(K^k))+z[15]+1236535329&4294967295,O=B+(M<<22&4294967295|M>>>10),M=k+(B^K&(O^B))+z[1]+4129170786&4294967295,k=O+(M<<5&4294967295|M>>>27),M=K+(O^B&(k^O))+z[6]+3225465664&4294967295,K=k+(M<<9&4294967295|M>>>23),M=B+(k^O&(K^k))+z[11]+643717713&4294967295,B=K+(M<<14&4294967295|M>>>18),M=O+(K^k&(B^K))+z[0]+3921069994&4294967295,O=B+(M<<20&4294967295|M>>>12),M=k+(B^K&(O^B))+z[5]+3593408605&4294967295,k=O+(M<<5&4294967295|M>>>27),M=K+(O^B&(k^O))+z[10]+38016083&4294967295,K=k+(M<<9&4294967295|M>>>23),M=B+(k^O&(K^k))+z[15]+3634488961&4294967295,B=K+(M<<14&4294967295|M>>>18),M=O+(K^k&(B^K))+z[4]+3889429448&4294967295,O=B+(M<<20&4294967295|M>>>12),M=k+(B^K&(O^B))+z[9]+568446438&4294967295,k=O+(M<<5&4294967295|M>>>27),M=K+(O^B&(k^O))+z[14]+3275163606&4294967295,K=k+(M<<9&4294967295|M>>>23),M=B+(k^O&(K^k))+z[3]+4107603335&4294967295,B=K+(M<<14&4294967295|M>>>18),M=O+(K^k&(B^K))+z[8]+1163531501&4294967295,O=B+(M<<20&4294967295|M>>>12),M=k+(B^K&(O^B))+z[13]+2850285829&4294967295,k=O+(M<<5&4294967295|M>>>27),M=K+(O^B&(k^O))+z[2]+4243563512&4294967295,K=k+(M<<9&4294967295|M>>>23),M=B+(k^O&(K^k))+z[7]+1735328473&4294967295,B=K+(M<<14&4294967295|M>>>18),M=O+(K^k&(B^K))+z[12]+2368359562&4294967295,O=B+(M<<20&4294967295|M>>>12),M=k+(O^B^K)+z[5]+4294588738&4294967295,k=O+(M<<4&4294967295|M>>>28),M=K+(k^O^B)+z[8]+2272392833&4294967295,K=k+(M<<11&4294967295|M>>>21),M=B+(K^k^O)+z[11]+1839030562&4294967295,B=K+(M<<16&4294967295|M>>>16),M=O+(B^K^k)+z[14]+4259657740&4294967295,O=B+(M<<23&4294967295|M>>>9),M=k+(O^B^K)+z[1]+2763975236&4294967295,k=O+(M<<4&4294967295|M>>>28),M=K+(k^O^B)+z[4]+1272893353&4294967295,K=k+(M<<11&4294967295|M>>>21),M=B+(K^k^O)+z[7]+4139469664&4294967295,B=K+(M<<16&4294967295|M>>>16),M=O+(B^K^k)+z[10]+3200236656&4294967295,O=B+(M<<23&4294967295|M>>>9),M=k+(O^B^K)+z[13]+681279174&4294967295,k=O+(M<<4&4294967295|M>>>28),M=K+(k^O^B)+z[0]+3936430074&4294967295,K=k+(M<<11&4294967295|M>>>21),M=B+(K^k^O)+z[3]+3572445317&4294967295,B=K+(M<<16&4294967295|M>>>16),M=O+(B^K^k)+z[6]+76029189&4294967295,O=B+(M<<23&4294967295|M>>>9),M=k+(O^B^K)+z[9]+3654602809&4294967295,k=O+(M<<4&4294967295|M>>>28),M=K+(k^O^B)+z[12]+3873151461&4294967295,K=k+(M<<11&4294967295|M>>>21),M=B+(K^k^O)+z[15]+530742520&4294967295,B=K+(M<<16&4294967295|M>>>16),M=O+(B^K^k)+z[2]+3299628645&4294967295,O=B+(M<<23&4294967295|M>>>9),M=k+(B^(O|~K))+z[0]+4096336452&4294967295,k=O+(M<<6&4294967295|M>>>26),M=K+(O^(k|~B))+z[7]+1126891415&4294967295,K=k+(M<<10&4294967295|M>>>22),M=B+(k^(K|~O))+z[14]+2878612391&4294967295,B=K+(M<<15&4294967295|M>>>17),M=O+(K^(B|~k))+z[5]+4237533241&4294967295,O=B+(M<<21&4294967295|M>>>11),M=k+(B^(O|~K))+z[12]+1700485571&4294967295,k=O+(M<<6&4294967295|M>>>26),M=K+(O^(k|~B))+z[3]+2399980690&4294967295,K=k+(M<<10&4294967295|M>>>22),M=B+(k^(K|~O))+z[10]+4293915773&4294967295,B=K+(M<<15&4294967295|M>>>17),M=O+(K^(B|~k))+z[1]+2240044497&4294967295,O=B+(M<<21&4294967295|M>>>11),M=k+(B^(O|~K))+z[8]+1873313359&4294967295,k=O+(M<<6&4294967295|M>>>26),M=K+(O^(k|~B))+z[15]+4264355552&4294967295,K=k+(M<<10&4294967295|M>>>22),M=B+(k^(K|~O))+z[6]+2734768916&4294967295,B=K+(M<<15&4294967295|M>>>17),M=O+(K^(B|~k))+z[13]+1309151649&4294967295,O=B+(M<<21&4294967295|M>>>11),M=k+(B^(O|~K))+z[4]+4149444226&4294967295,k=O+(M<<6&4294967295|M>>>26),M=K+(O^(k|~B))+z[11]+3174756917&4294967295,K=k+(M<<10&4294967295|M>>>22),M=B+(k^(K|~O))+z[2]+718787259&4294967295,B=K+(M<<15&4294967295|M>>>17),M=O+(K^(B|~k))+z[9]+3951481745&4294967295,D.g[0]=D.g[0]+k&4294967295,D.g[1]=D.g[1]+(B+(M<<21&4294967295|M>>>11))&4294967295,D.g[2]=D.g[2]+B&4294967295,D.g[3]=D.g[3]+K&4294967295}r.prototype.v=function(D,k){k===void 0&&(k=D.length);const O=k-this.blockSize,z=this.C;let B=this.h,K=0;for(;K<k;){if(B==0)for(;K<=O;)i(this,D,K),K+=this.blockSize;if(typeof D=="string"){for(;K<k;)if(z[B++]=D.charCodeAt(K++),B==this.blockSize){i(this,z),B=0;break}}else for(;K<k;)if(z[B++]=D[K++],B==this.blockSize){i(this,z),B=0;break}}this.h=B,this.o+=k},r.prototype.A=function(){var D=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);D[0]=128;for(var k=1;k<D.length-8;++k)D[k]=0;k=this.o*8;for(var O=D.length-8;O<D.length;++O)D[O]=k&255,k/=256;for(this.v(D),D=Array(16),k=0,O=0;O<4;++O)for(let z=0;z<32;z+=8)D[k++]=this.g[O]>>>z&255;return D};function l(D,k){var O=u;return Object.prototype.hasOwnProperty.call(O,D)?O[D]:O[D]=k(D)}function c(D,k){this.h=k;const O=[];let z=!0;for(let B=D.length-1;B>=0;B--){const K=D[B]|0;z&&K==k||(O[B]=K,z=!1)}this.g=O}var u={};function p(D){return-128<=D&&D<128?l(D,function(k){return new c([k|0],k<0?-1:0)}):new c([D|0],D<0?-1:0)}function g(D){if(isNaN(D)||!isFinite(D))return w;if(D<0)return U(g(-D));const k=[];let O=1;for(let z=0;D>=O;z++)k[z]=D/O|0,O*=4294967296;return new c(k,0)}function b(D,k){if(D.length==0)throw Error("number format error: empty string");if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(D.charAt(0)=="-")return U(b(D.substring(1),k));if(D.indexOf("-")>=0)throw Error('number format error: interior "-" character');const O=g(Math.pow(k,8));let z=w;for(let K=0;K<D.length;K+=8){var B=Math.min(8,D.length-K);const M=parseInt(D.substring(K,K+B),k);B<8?(B=g(Math.pow(k,B)),z=z.j(B).add(g(M))):(z=z.j(O),z=z.add(g(M)))}return z}var w=p(0),E=p(1),C=p(16777216);n=c.prototype,n.m=function(){if(F(this))return-U(this).m();let D=0,k=1;for(let O=0;O<this.g.length;O++){const z=this.i(O);D+=(z>=0?z:4294967296+z)*k,k*=4294967296}return D},n.toString=function(D){if(D=D||10,D<2||36<D)throw Error("radix out of range: "+D);if(H(this))return"0";if(F(this))return"-"+U(this).toString(D);const k=g(Math.pow(D,6));var O=this;let z="";for(;;){const B=he(O,k).g;O=ae(O,B.j(k));let K=((O.g.length>0?O.g[0]:O.h)>>>0).toString(D);if(O=B,H(O))return K+z;for(;K.length<6;)K="0"+K;z=K+z}},n.i=function(D){return D<0?0:D<this.g.length?this.g[D]:this.h};function H(D){if(D.h!=0)return!1;for(let k=0;k<D.g.length;k++)if(D.g[k]!=0)return!1;return!0}function F(D){return D.h==-1}n.l=function(D){return D=ae(this,D),F(D)?-1:H(D)?0:1};function U(D){const k=D.g.length,O=[];for(let z=0;z<k;z++)O[z]=~D.g[z];return new c(O,~D.h).add(E)}n.abs=function(){return F(this)?U(this):this},n.add=function(D){const k=Math.max(this.g.length,D.g.length),O=[];let z=0;for(let B=0;B<=k;B++){let K=z+(this.i(B)&65535)+(D.i(B)&65535),M=(K>>>16)+(this.i(B)>>>16)+(D.i(B)>>>16);z=M>>>16,K&=65535,M&=65535,O[B]=M<<16|K}return new c(O,O[O.length-1]&-2147483648?-1:0)};function ae(D,k){return D.add(U(k))}n.j=function(D){if(H(this)||H(D))return w;if(F(this))return F(D)?U(this).j(U(D)):U(U(this).j(D));if(F(D))return U(this.j(U(D)));if(this.l(C)<0&&D.l(C)<0)return g(this.m()*D.m());const k=this.g.length+D.g.length,O=[];for(var z=0;z<2*k;z++)O[z]=0;for(z=0;z<this.g.length;z++)for(let B=0;B<D.g.length;B++){const K=this.i(z)>>>16,M=this.i(z)&65535,Ve=D.i(B)>>>16,me=D.i(B)&65535;O[2*z+2*B]+=M*me,re(O,2*z+2*B),O[2*z+2*B+1]+=K*me,re(O,2*z+2*B+1),O[2*z+2*B+1]+=M*Ve,re(O,2*z+2*B+1),O[2*z+2*B+2]+=K*Ve,re(O,2*z+2*B+2)}for(D=0;D<k;D++)O[D]=O[2*D+1]<<16|O[2*D];for(D=k;D<2*k;D++)O[D]=0;return new c(O,0)};function re(D,k){for(;(D[k]&65535)!=D[k];)D[k+1]+=D[k]>>>16,D[k]&=65535,k++}function J(D,k){this.g=D,this.h=k}function he(D,k){if(H(k))throw Error("division by zero");if(H(D))return new J(w,w);if(F(D))return k=he(U(D),k),new J(U(k.g),U(k.h));if(F(k))return k=he(D,U(k)),new J(U(k.g),k.h);if(D.g.length>30){if(F(D)||F(k))throw Error("slowDivide_ only works with positive integers.");for(var O=E,z=k;z.l(D)<=0;)O=j(O),z=j(z);var B=ce(O,1),K=ce(z,1);for(z=ce(z,2),O=ce(O,2);!H(z);){var M=K.add(z);M.l(D)<=0&&(B=B.add(O),K=M),z=ce(z,1),O=ce(O,1)}return k=ae(D,B.j(k)),new J(B,k)}for(B=w;D.l(k)>=0;){for(O=Math.max(1,Math.floor(D.m()/k.m())),z=Math.ceil(Math.log(O)/Math.LN2),z=z<=48?1:Math.pow(2,z-48),K=g(O),M=K.j(k);F(M)||M.l(D)>0;)O-=z,K=g(O),M=K.j(k);H(K)&&(K=E),B=B.add(K),D=ae(D,M)}return new J(B,D)}n.B=function(D){return he(this,D).h},n.and=function(D){const k=Math.max(this.g.length,D.g.length),O=[];for(let z=0;z<k;z++)O[z]=this.i(z)&D.i(z);return new c(O,this.h&D.h)},n.or=function(D){const k=Math.max(this.g.length,D.g.length),O=[];for(let z=0;z<k;z++)O[z]=this.i(z)|D.i(z);return new c(O,this.h|D.h)},n.xor=function(D){const k=Math.max(this.g.length,D.g.length),O=[];for(let z=0;z<k;z++)O[z]=this.i(z)^D.i(z);return new c(O,this.h^D.h)};function j(D){const k=D.g.length+1,O=[];for(let z=0;z<k;z++)O[z]=D.i(z)<<1|D.i(z-1)>>>31;return new c(O,D.h)}function ce(D,k){const O=k>>5;k%=32;const z=D.g.length-O,B=[];for(let K=0;K<z;K++)B[K]=k>0?D.i(K+O)>>>k|D.i(K+O+1)<<32-k:D.i(K+O);return new c(B,D.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,$I=r,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.B,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=g,c.fromString=b,Wo=c}).apply(typeof Nw<"u"?Nw:typeof self<"u"?self:typeof window<"u"?window:{});var ip=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var FI,Qu,BI,Np,ny,UI,zI,qI;(function(){var n,e=Object.defineProperty;function t(m){m=[typeof globalThis=="object"&&globalThis,m,typeof window=="object"&&window,typeof self=="object"&&self,typeof ip=="object"&&ip];for(var y=0;y<m.length;++y){var I=m[y];if(I&&I.Math==Math)return I}throw Error("Cannot find global object")}var r=t(this);function i(m,y){if(y)e:{var I=r;m=m.split(".");for(var R=0;R<m.length-1;R++){var ee=m[R];if(!(ee in I))break e;I=I[ee]}m=m[m.length-1],R=I[m],y=y(R),y!=R&&y!=null&&e(I,m,{configurable:!0,writable:!0,value:y})}}i("Symbol.dispose",function(m){return m||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(m){return m||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(m){return m||function(y){var I=[],R;for(R in y)Object.prototype.hasOwnProperty.call(y,R)&&I.push([R,y[R]]);return I}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var l=l||{},c=this||self;function u(m){var y=typeof m;return y=="object"&&m!=null||y=="function"}function p(m,y,I){return m.call.apply(m.bind,arguments)}function g(m,y,I){return g=p,g.apply(null,arguments)}function b(m,y){var I=Array.prototype.slice.call(arguments,1);return function(){var R=I.slice();return R.push.apply(R,arguments),m.apply(this,R)}}function w(m,y){function I(){}I.prototype=y.prototype,m.Z=y.prototype,m.prototype=new I,m.prototype.constructor=m,m.Ob=function(R,ee,de){for(var Re=Array(arguments.length-2),gt=2;gt<arguments.length;gt++)Re[gt-2]=arguments[gt];return y.prototype[ee].apply(R,Re)}}var E=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?m=>m&&AsyncContext.Snapshot.wrap(m):m=>m;function C(m){const y=m.length;if(y>0){const I=Array(y);for(let R=0;R<y;R++)I[R]=m[R];return I}return[]}function H(m,y){for(let R=1;R<arguments.length;R++){const ee=arguments[R];var I=typeof ee;if(I=I!="object"?I:ee?Array.isArray(ee)?"array":I:"null",I=="array"||I=="object"&&typeof ee.length=="number"){I=m.length||0;const de=ee.length||0;m.length=I+de;for(let Re=0;Re<de;Re++)m[I+Re]=ee[Re]}else m.push(ee)}}class F{constructor(y,I){this.i=y,this.j=I,this.h=0,this.g=null}get(){let y;return this.h>0?(this.h--,y=this.g,this.g=y.next,y.next=null):y=this.i(),y}}function U(m){c.setTimeout(()=>{throw m},0)}function ae(){var m=D;let y=null;return m.g&&(y=m.g,m.g=m.g.next,m.g||(m.h=null),y.next=null),y}class re{constructor(){this.h=this.g=null}add(y,I){const R=J.get();R.set(y,I),this.h?this.h.next=R:this.g=R,this.h=R}}var J=new F(()=>new he,m=>m.reset());class he{constructor(){this.next=this.g=this.h=null}set(y,I){this.h=y,this.g=I,this.next=null}reset(){this.next=this.g=this.h=null}}let j,ce=!1,D=new re,k=()=>{const m=Promise.resolve(void 0);j=()=>{m.then(O)}};function O(){for(var m;m=ae();){try{m.h.call(m.g)}catch(I){U(I)}var y=J;y.j(m),y.h<100&&(y.h++,m.next=y.g,y.g=m)}ce=!1}function z(){this.u=this.u,this.C=this.C}z.prototype.u=!1,z.prototype.dispose=function(){this.u||(this.u=!0,this.N())},z.prototype[Symbol.dispose]=function(){this.dispose()},z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function B(m,y){this.type=m,this.g=this.target=y,this.defaultPrevented=!1}B.prototype.h=function(){this.defaultPrevented=!0};var K=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var m=!1,y=Object.defineProperty({},"passive",{get:function(){m=!0}});try{const I=()=>{};c.addEventListener("test",I,y),c.removeEventListener("test",I,y)}catch{}return m})();function M(m){return/^[\s\xa0]*$/.test(m)}function Ve(m,y){B.call(this,m?m.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,m&&this.init(m,y)}w(Ve,B),Ve.prototype.init=function(m,y){const I=this.type=m.type,R=m.changedTouches&&m.changedTouches.length?m.changedTouches[0]:null;this.target=m.target||m.srcElement,this.g=y,y=m.relatedTarget,y||(I=="mouseover"?y=m.fromElement:I=="mouseout"&&(y=m.toElement)),this.relatedTarget=y,R?(this.clientX=R.clientX!==void 0?R.clientX:R.pageX,this.clientY=R.clientY!==void 0?R.clientY:R.pageY,this.screenX=R.screenX||0,this.screenY=R.screenY||0):(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0),this.button=m.button,this.key=m.key||"",this.ctrlKey=m.ctrlKey,this.altKey=m.altKey,this.shiftKey=m.shiftKey,this.metaKey=m.metaKey,this.pointerId=m.pointerId||0,this.pointerType=m.pointerType,this.state=m.state,this.i=m,m.defaultPrevented&&Ve.Z.h.call(this)},Ve.prototype.h=function(){Ve.Z.h.call(this);const m=this.i;m.preventDefault?m.preventDefault():m.returnValue=!1};var me="closure_listenable_"+(Math.random()*1e6|0),Te=0;function Se(m,y,I,R,ee){this.listener=m,this.proxy=null,this.src=y,this.type=I,this.capture=!!R,this.ha=ee,this.key=++Te,this.da=this.fa=!1}function pe(m){m.da=!0,m.listener=null,m.proxy=null,m.src=null,m.ha=null}function P(m,y,I){for(const R in m)y.call(I,m[R],R,m)}function W(m,y){for(const I in m)y.call(void 0,m[I],I,m)}function V(m){const y={};for(const I in m)y[I]=m[I];return y}const le="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function we(m,y){let I,R;for(let ee=1;ee<arguments.length;ee++){R=arguments[ee];for(I in R)m[I]=R[I];for(let de=0;de<le.length;de++)I=le[de],Object.prototype.hasOwnProperty.call(R,I)&&(m[I]=R[I])}}function fe(m){this.src=m,this.g={},this.h=0}fe.prototype.add=function(m,y,I,R,ee){const de=m.toString();m=this.g[de],m||(m=this.g[de]=[],this.h++);const Re=ge(m,y,R,ee);return Re>-1?(y=m[Re],I||(y.fa=!1)):(y=new Se(y,this.src,de,!!R,ee),y.fa=I,m.push(y)),y};function Ce(m,y){const I=y.type;if(I in m.g){var R=m.g[I],ee=Array.prototype.indexOf.call(R,y,void 0),de;(de=ee>=0)&&Array.prototype.splice.call(R,ee,1),de&&(pe(y),m.g[I].length==0&&(delete m.g[I],m.h--))}}function ge(m,y,I,R){for(let ee=0;ee<m.length;++ee){const de=m[ee];if(!de.da&&de.listener==y&&de.capture==!!I&&de.ha==R)return ee}return-1}var $e="closure_lm_"+(Math.random()*1e6|0),ht={};function ot(m,y,I,R,ee){if(Array.isArray(y)){for(let de=0;de<y.length;de++)ot(m,y[de],I,R,ee);return null}return I=bt(I),m&&m[me]?m.J(y,I,u(R)?!!R.capture:!1,ee):ct(m,y,I,!1,R,ee)}function ct(m,y,I,R,ee,de){if(!y)throw Error("Invalid event type");const Re=u(ee)?!!ee.capture:!!ee;let gt=fn(m);if(gt||(m[$e]=gt=new fe(m)),I=gt.add(y,I,R,Re,de),I.proxy)return I;if(R=On(),I.proxy=R,R.src=m,R.listener=I,m.addEventListener)K||(ee=Re),ee===void 0&&(ee=!1),m.addEventListener(y.toString(),R,ee);else if(m.attachEvent)m.attachEvent(Ye(y.toString()),R);else if(m.addListener&&m.removeListener)m.addListener(R);else throw Error("addEventListener and attachEvent are unavailable.");return I}function On(){function m(I){return y.call(m.src,m.listener,I)}const y=un;return m}function nn(m,y,I,R,ee){if(Array.isArray(y))for(var de=0;de<y.length;de++)nn(m,y[de],I,R,ee);else R=u(R)?!!R.capture:!!R,I=bt(I),m&&m[me]?(m=m.i,de=String(y).toString(),de in m.g&&(y=m.g[de],I=ge(y,I,R,ee),I>-1&&(pe(y[I]),Array.prototype.splice.call(y,I,1),y.length==0&&(delete m.g[de],m.h--)))):m&&(m=fn(m))&&(y=m.g[y.toString()],m=-1,y&&(m=ge(y,I,R,ee)),(I=m>-1?y[m]:null)&&Ie(I))}function Ie(m){if(typeof m!="number"&&m&&!m.da){var y=m.src;if(y&&y[me])Ce(y.i,m);else{var I=m.type,R=m.proxy;y.removeEventListener?y.removeEventListener(I,R,m.capture):y.detachEvent?y.detachEvent(Ye(I),R):y.addListener&&y.removeListener&&y.removeListener(R),(I=fn(y))?(Ce(I,m),I.h==0&&(I.src=null,y[$e]=null)):pe(m)}}}function Ye(m){return m in ht?ht[m]:ht[m]="on"+m}function un(m,y){if(m.da)m=!0;else{y=new Ve(y,this);const I=m.listener,R=m.ha||m.src;m.fa&&Ie(m),m=I.call(R,y)}return m}function fn(m){return m=m[$e],m instanceof fe?m:null}var it="__closure_events_fn_"+(Math.random()*1e9>>>0);function bt(m){return typeof m=="function"?m:(m[it]||(m[it]=function(y){return m.handleEvent(y)}),m[it])}function wt(){z.call(this),this.i=new fe(this),this.M=this,this.G=null}w(wt,z),wt.prototype[me]=!0,wt.prototype.removeEventListener=function(m,y,I,R){nn(this,m,y,I,R)};function _t(m,y){var I,R=m.G;if(R)for(I=[];R;R=R.G)I.push(R);if(m=m.M,R=y.type||y,typeof y=="string")y=new B(y,m);else if(y instanceof B)y.target=y.target||m;else{var ee=y;y=new B(R,m),we(y,ee)}ee=!0;let de,Re;if(I)for(Re=I.length-1;Re>=0;Re--)de=y.g=I[Re],ee=Gt(de,R,!0,y)&&ee;if(de=y.g=m,ee=Gt(de,R,!0,y)&&ee,ee=Gt(de,R,!1,y)&&ee,I)for(Re=0;Re<I.length;Re++)de=y.g=I[Re],ee=Gt(de,R,!1,y)&&ee}wt.prototype.N=function(){if(wt.Z.N.call(this),this.i){var m=this.i;for(const y in m.g){const I=m.g[y];for(let R=0;R<I.length;R++)pe(I[R]);delete m.g[y],m.h--}}this.G=null},wt.prototype.J=function(m,y,I,R){return this.i.add(String(m),y,!1,I,R)},wt.prototype.K=function(m,y,I,R){return this.i.add(String(m),y,!0,I,R)};function Gt(m,y,I,R){if(y=m.i.g[String(y)],!y)return!0;y=y.concat();let ee=!0;for(let de=0;de<y.length;++de){const Re=y[de];if(Re&&!Re.da&&Re.capture==I){const gt=Re.listener,wn=Re.ha||Re.src;Re.fa&&Ce(m.i,Re),ee=gt.call(wn,R)!==!1&&ee}}return ee&&!R.defaultPrevented}function cn(m,y){if(typeof m!="function")if(m&&typeof m.handleEvent=="function")m=g(m.handleEvent,m);else throw Error("Invalid listener argument");return Number(y)>2147483647?-1:c.setTimeout(m,y||0)}function yr(m){m.g=cn(()=>{m.g=null,m.i&&(m.i=!1,yr(m))},m.l);const y=m.h;m.h=null,m.m.apply(null,y)}class pi extends z{constructor(y,I){super(),this.m=y,this.l=I,this.h=null,this.i=!1,this.g=null}j(y){this.h=arguments,this.g?this.i=!0:yr(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Fs(m){z.call(this),this.h=m,this.g={}}w(Fs,z);var fi=[];function Bs(m){P(m.g,function(y,I){this.g.hasOwnProperty(I)&&Ie(y)},m),m.g={}}Fs.prototype.N=function(){Fs.Z.N.call(this),Bs(this)},Fs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Jr=c.JSON.stringify,ma=c.JSON.parse,ar=class{stringify(m){return c.JSON.stringify(m,void 0)}parse(m){return c.JSON.parse(m,void 0)}};function gs(){}function gi(){}var ie={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function _e(){B.call(this,"d")}w(_e,B);function Be(){B.call(this,"c")}w(Be,B);var We={},X=null;function He(){return X=X||new wt}We.Ia="serverreachability";function Vt(m){B.call(this,We.Ia,m)}w(Vt,B);function at(m){const y=He();_t(y,new Vt(y))}We.STAT_EVENT="statevent";function xt(m,y){B.call(this,We.STAT_EVENT,m),this.stat=y}w(xt,B);function Me(m){const y=He();_t(y,new xt(y,m))}We.Ja="timingevent";function ve(m,y){B.call(this,We.Ja,m),this.size=y}w(ve,B);function Ze(m,y){if(typeof m!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){m()},y)}function ln(){this.g=!0}ln.prototype.ua=function(){this.g=!1};function En(m,y,I,R,ee,de){m.info(function(){if(m.g)if(de){var Re="",gt=de.split("&");for(let Ut=0;Ut<gt.length;Ut++){var wn=gt[Ut].split("=");if(wn.length>1){const yn=wn[0];wn=wn[1];const Br=yn.split("_");Re=Br.length>=2&&Br[1]=="type"?Re+(yn+"="+wn+"&"):Re+(yn+"=redacted&")}}}else Re=null;else Re=de;return"XMLHTTP REQ ("+R+") [attempt "+ee+"]: "+y+`
`+I+`
`+Re})}function vr(m,y,I,R,ee,de,Re){m.info(function(){return"XMLHTTP RESP ("+R+") [ attempt "+ee+"]: "+y+`
`+I+`
`+de+" "+Re})}function Ln(m,y,I,R){m.info(function(){return"XMLHTTP TEXT ("+y+"): "+mt(m,I)+(R?" "+R:"")})}function Pr(m,y){m.info(function(){return"TIMEOUT: "+y})}ln.prototype.info=function(){};function mt(m,y){if(!m.g)return y;if(!y)return null;try{const de=JSON.parse(y);if(de){for(m=0;m<de.length;m++)if(Array.isArray(de[m])){var I=de[m];if(!(I.length<2)){var R=I[1];if(Array.isArray(R)&&!(R.length<1)){var ee=R[0];if(ee!="noop"&&ee!="stop"&&ee!="close")for(let Re=1;Re<R.length;Re++)R[Re]=""}}}}return Jr(de)}catch{return y}}var Kt={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},$i={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},il;function xs(){}w(xs,gs),xs.prototype.g=function(){return new XMLHttpRequest},il=new xs;function Us(m){return encodeURIComponent(String(m))}function xi(m){var y=1;m=m.split(":");const I=[];for(;y>0&&m.length;)I.push(m.shift()),y--;return m.length&&I.push(m.join(":")),I}function Hn(m,y,I,R){this.j=m,this.i=y,this.l=I,this.S=R||1,this.V=new Fs(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ys}function ys(){this.i=null,this.g="",this.h=!1}var vs={},eo={};function bs(m,y,I){m.M=1,m.A=ws(Zr(y)),m.u=I,m.R=!0,yi(m,null)}function yi(m,y){m.F=Date.now(),zs(m),m.B=Zr(m.A);var I=m.B,R=m.S;Array.isArray(R)||(R=[String(R)]),ll(I.i,"t",R),m.C=0,I=m.j.L,m.h=new ys,m.g=kc(m.j,I?y:null,!m.u),m.P>0&&(m.O=new pi(g(m.Y,m,m.g),m.P)),y=m.V,I=m.g,R=m.ba;var ee="readystatechange";Array.isArray(ee)||(ee&&(fi[0]=ee.toString()),ee=fi);for(let de=0;de<ee.length;de++){const Re=ot(I,ee[de],R||y.handleEvent,!1,y.h||y);if(!Re)break;y.g[Re.key]=Re}y=m.J?V(m.J):{},m.u?(m.v||(m.v="POST"),y["Content-Type"]="application/x-www-form-urlencoded",m.g.ea(m.B,m.v,m.u,y)):(m.v="GET",m.g.ea(m.B,m.v,null,y)),at(),En(m.i,m.v,m.B,m.l,m.S,m.u)}Hn.prototype.ba=function(m){m=m.target;const y=this.O;y&&Es(m)==3?y.j():this.Y(m)},Hn.prototype.Y=function(m){try{if(m==this.g)e:{const gt=Es(this.g),wn=this.g.ya(),Ut=this.g.ca();if(!(gt<3)&&(gt!=3||this.g&&(this.h.h||this.g.la()||Ft(this.g)))){this.K||gt!=4||wn==7||(wn==8||Ut<=0?at(3):at(2)),pa(this);var y=this.g.ca();this.X=y;var I=Tc(this);if(this.o=y==200,vr(this.i,this.v,this.B,this.l,this.S,gt,y),this.o){if(this.U&&!this.L){t:{if(this.g){var R,ee=this.g;if((R=ee.g?ee.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(R)){var de=R;break t}}de=null}if(m=de)Ln(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,qt(this,m);else{this.o=!1,this.m=3,Me(12),qs(this),Fi(this);break e}}if(this.R){m=!0;let yn;for(;!this.K&&this.C<I.length;)if(yn=Sc(this,I),yn==eo){gt==4&&(this.m=4,Me(14),m=!1),Ln(this.i,this.l,null,"[Incomplete Response]");break}else if(yn==vs){this.m=4,Me(15),Ln(this.i,this.l,I,"[Invalid Chunk]"),m=!1;break}else Ln(this.i,this.l,yn,null),qt(this,yn);if(to(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),gt!=4||I.length!=0||this.h.h||(this.m=1,Me(16),m=!1),this.o=this.o&&m,!m)Ln(this.i,this.l,I,"[Invalid Chunked Response]"),qs(this),Fi(this);else if(I.length>0&&!this.W){this.W=!0;var Re=this.j;Re.g==this&&Re.aa&&!Re.P&&(Re.j.info("Great, no buffering proxy detected. Bytes received: "+I.length),ba(Re),Re.P=!0,Me(11))}}else Ln(this.i,this.l,I,null),qt(this,I);gt==4&&qs(this),this.o&&!this.K&&(gt==4?Ss(this.j,this):(this.o=!1,zs(this)))}else cl(this.g),y==400&&I.indexOf("Unknown SID")>0?(this.m=3,Me(12)):(this.m=0,Me(13)),qs(this),Fi(this)}}}catch{}finally{}};function Tc(m){if(!to(m))return m.g.la();const y=Ft(m.g);if(y==="")return"";let I="";const R=y.length,ee=Es(m.g)==4;if(!m.h.i){if(typeof TextDecoder>"u")return qs(m),Fi(m),"";m.h.i=new c.TextDecoder}for(let de=0;de<R;de++)m.h.h=!0,I+=m.h.i.decode(y[de],{stream:!(ee&&de==R-1)});return y.length=0,m.h.g+=I,m.C=0,m.h.g}function to(m){return m.g?m.v=="GET"&&m.M!=2&&m.j.Aa:!1}function Sc(m,y){var I=m.C,R=y.indexOf(`
`,I);return R==-1?eo:(I=Number(y.substring(I,R)),isNaN(I)?vs:(R+=1,R+I>y.length?eo:(y=y.slice(R,R+I),m.C=R+I,y)))}Hn.prototype.cancel=function(){this.K=!0,qs(this)};function zs(m){m.T=Date.now()+m.H,no(m,m.H)}function no(m,y){if(m.D!=null)throw Error("WatchDog timer not null");m.D=Ze(g(m.aa,m),y)}function pa(m){m.D&&(c.clearTimeout(m.D),m.D=null)}Hn.prototype.aa=function(){this.D=null;const m=Date.now();m-this.T>=0?(Pr(this.i,this.B),this.M!=2&&(at(),Me(17)),qs(this),this.m=2,Fi(this)):no(this,this.T-m)};function Fi(m){m.j.I==0||m.K||Ss(m.j,m)}function qs(m){pa(m);var y=m.O;y&&typeof y.dispose=="function"&&y.dispose(),m.O=null,Bs(m.V),m.g&&(y=m.g,m.g=null,y.abort(),y.dispose())}function qt(m,y){try{var I=m.j;if(I.I!=0&&(I.g==m||Ui(I.h,m))){if(!m.L&&Ui(I.h,m)&&I.I==3){try{var R=I.Ba.g.parse(y)}catch{R=null}if(Array.isArray(R)&&R.length==3){var ee=R;if(ee[0]==0){e:if(!I.v){if(I.g)if(I.g.F+3e3<m.F)ns(I),ts(I);else break e;Qs(I),Me(18)}}else I.xa=ee[1],0<I.xa-I.K&&ee[2]<37500&&I.F&&I.A==0&&!I.C&&(I.C=Ze(g(I.Va,I),6e3));or(I.h)<=1&&I.ta&&(I.ta=void 0)}else Yt(I,11)}else if((m.L||I.g==m)&&ns(I),!M(y))for(ee=I.Ba.g.parse(y),y=0;y<ee.length;y++){let Ut=ee[y];const yn=Ut[0];if(!(yn<=I.K))if(I.K=yn,Ut=Ut[1],I.I==2)if(Ut[0]=="c"){I.M=Ut[1],I.ba=Ut[2];const Br=Ut[3];Br!=null&&(I.ka=Br,I.j.info("VER="+I.ka));const rs=Ut[4];rs!=null&&(I.za=rs,I.j.info("SVER="+I.za));const Kn=Ut[5];Kn!=null&&typeof Kn=="number"&&Kn>0&&(R=1.5*Kn,I.O=R,I.j.info("backChannelRequestTimeoutMs_="+R)),R=I;const Mn=m.g;if(Mn){const lo=Mn.g?Mn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(lo){var de=R.h;de.g||lo.indexOf("spdy")==-1&&lo.indexOf("quic")==-1&&lo.indexOf("h2")==-1||(de.j=de.l,de.g=new Set,de.h&&(so(de,de.h),de.h=null))}if(R.G){const gl=Mn.g?Mn.g.getResponseHeader("X-HTTP-Session-Id"):null;gl&&(R.wa=gl,$t(R.J,R.G,gl))}}I.I=3,I.l&&I.l.ra(),I.aa&&(I.T=Date.now()-m.F,I.j.info("Handshake RTT: "+I.T+"ms")),R=I;var Re=m;if(R.na=wa(R,R.L?R.ba:null,R.W),Re.L){vi(R.h,Re);var gt=Re,wn=R.O;wn&&(gt.H=wn),gt.D&&(pa(gt),zs(gt)),R.g=Re}else Gn(R);I.i.length>0&&Tn(I)}else Ut[0]!="stop"&&Ut[0]!="close"||Yt(I,7);else I.I==3&&(Ut[0]=="stop"||Ut[0]=="close"?Ut[0]=="stop"?Yt(I,7):ul(I):Ut[0]!="noop"&&I.l&&I.l.qa(Ut),I.A=0)}}at(4)}catch{}}var Ac=class{constructor(m,y){this.g=m,this.map=y}};function ro(m){this.l=m||10,c.PerformanceNavigationTiming?(m=c.performance.getEntriesByType("navigation"),m=m.length>0&&(m[0].nextHopProtocol=="hq"||m[0].nextHopProtocol=="h2")):m=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=m?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Bi(m){return m.h?!0:m.g?m.g.size>=m.j:!1}function or(m){return m.h?1:m.g?m.g.size:0}function Ui(m,y){return m.h?m.h==y:m.g?m.g.has(y):!1}function so(m,y){m.g?m.g.add(y):m.h=y}function vi(m,y){m.h&&m.h==y?m.h=null:m.g&&m.g.has(y)&&m.g.delete(y)}ro.prototype.cancel=function(){if(this.i=Or(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const m of this.g.values())m.cancel();this.g.clear()}};function Or(m){if(m.h!=null)return m.i.concat(m.h.G);if(m.g!=null&&m.g.size!==0){let y=m.i;for(const I of m.g.values())y=y.concat(I.G);return y}return C(m.i)}var io=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function br(m,y){if(m){m=m.split("&");for(let I=0;I<m.length;I++){const R=m[I].indexOf("=");let ee,de=null;R>=0?(ee=m[I].substring(0,R),de=m[I].substring(R+1)):ee=m[I],y(ee,de?decodeURIComponent(de.replace(/\+/g," ")):"")}}}function Xr(m){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let y;m instanceof Xr?(this.l=m.l,bi(this,m.j),this.o=m.o,this.g=m.g,wr(this,m.u),this.h=m.h,Ws(this,xa(m.i)),this.m=m.m):m&&(y=String(m).match(io))?(this.l=!1,bi(this,y[1]||"",!0),this.o=Hs(y[2]||""),this.g=Hs(y[3]||"",!0),wr(this,y[4]),this.h=Hs(y[5]||"",!0),Ws(this,y[6]||"",!0),this.m=Hs(y[7]||"")):(this.l=!1,this.i=new ft(null,this.l))}Xr.prototype.toString=function(){const m=[];var y=this.j;y&&m.push(wi(y,fa,!0),":");var I=this.g;return(I||y=="file")&&(m.push("//"),(y=this.o)&&m.push(wi(y,fa,!0),"@"),m.push(Us(I).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),I=this.u,I!=null&&m.push(":",String(I))),(I=this.h)&&(this.g&&I.charAt(0)!="/"&&m.push("/"),m.push(wi(I,I.charAt(0)=="/"?zi:Ot,!0))),(I=this.i.toString())&&m.push("?",I),(I=this.m)&&m.push("#",wi(I,ao)),m.join("")},Xr.prototype.resolve=function(m){const y=Zr(this);let I=!!m.j;I?bi(y,m.j):I=!!m.o,I?y.o=m.o:I=!!m.g,I?y.g=m.g:I=m.u!=null;var R=m.h;if(I)wr(y,m.u);else if(I=!!m.h){if(R.charAt(0)!="/")if(this.g&&!this.h)R="/"+R;else{var ee=y.h.lastIndexOf("/");ee!=-1&&(R=y.h.slice(0,ee+1)+R)}if(ee=R,ee==".."||ee==".")R="";else if(ee.indexOf("./")!=-1||ee.indexOf("/.")!=-1){R=ee.lastIndexOf("/",0)==0,ee=ee.split("/");const de=[];for(let Re=0;Re<ee.length;){const gt=ee[Re++];gt=="."?R&&Re==ee.length&&de.push(""):gt==".."?((de.length>1||de.length==1&&de[0]!="")&&de.pop(),R&&Re==ee.length&&de.push("")):(de.push(gt),R=!0)}R=de.join("/")}else R=ee}return I?y.h=R:I=m.i.toString()!=="",I?Ws(y,xa(m.i)):I=!!m.m,I&&(y.m=m.m),y};function Zr(m){return new Xr(m)}function bi(m,y,I){m.j=I?Hs(y,!0):y,m.j&&(m.j=m.j.replace(/:$/,""))}function wr(m,y){if(y){if(y=Number(y),isNaN(y)||y<0)throw Error("Bad port number "+y);m.u=y}else m.u=null}function Ws(m,y,I){y instanceof ft?(m.i=y,_i(m.i,m.l)):(I||(y=wi(y,_s)),m.i=new ft(y,m.l))}function $t(m,y,I){m.i.set(y,I)}function ws(m){return $t(m,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),m}function Hs(m,y){return m?y?decodeURI(m.replace(/%25/g,"%2525")):decodeURIComponent(m):""}function wi(m,y,I){return typeof m=="string"?(m=encodeURI(m).replace(y,al),I&&(m=m.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m):null}function al(m){return m=m.charCodeAt(0),"%"+(m>>4&15).toString(16)+(m&15).toString(16)}var fa=/[#\/\?@]/g,Ot=/[#\?:]/g,zi=/[#\?]/g,_s=/[#\?@]/g,ao=/#/g;function ft(m,y){this.h=this.g=null,this.i=m||null,this.j=!!y}function es(m){m.g||(m.g=new Map,m.h=0,m.i&&br(m.i,function(y,I){m.add(decodeURIComponent(y.replace(/\+/g," ")),I)}))}n=ft.prototype,n.add=function(m,y){es(this),this.i=null,m=er(this,m);let I=this.g.get(m);return I||this.g.set(m,I=[]),I.push(y),this.h+=1,this};function oo(m,y){es(m),y=er(m,y),m.g.has(y)&&(m.i=null,m.h-=m.g.get(y).length,m.g.delete(y))}function ga(m,y){return es(m),y=er(m,y),m.g.has(y)}n.forEach=function(m,y){es(this),this.g.forEach(function(I,R){I.forEach(function(ee){m.call(y,ee,R,this)},this)},this)};function ol(m,y){es(m);let I=[];if(typeof y=="string")ga(m,y)&&(I=I.concat(m.g.get(er(m,y))));else for(m=Array.from(m.g.values()),y=0;y<m.length;y++)I=I.concat(m[y]);return I}n.set=function(m,y){return es(this),this.i=null,m=er(this,m),ga(this,m)&&(this.h-=this.g.get(m).length),this.g.set(m,[y]),this.h+=1,this},n.get=function(m,y){return m?(m=ol(this,m),m.length>0?String(m[0]):y):y};function ll(m,y,I){oo(m,y),I.length>0&&(m.i=null,m.g.set(er(m,y),C(I)),m.h+=I.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const m=[],y=Array.from(this.g.keys());for(let R=0;R<y.length;R++){var I=y[R];const ee=Us(I);I=ol(this,I);for(let de=0;de<I.length;de++){let Re=ee;I[de]!==""&&(Re+="="+Us(I[de])),m.push(Re)}}return this.i=m.join("&")};function xa(m){const y=new ft;return y.i=m.i,m.g&&(y.g=new Map(m.g),y.h=m.h),y}function er(m,y){return y=String(y),m.j&&(y=y.toLowerCase()),y}function _i(m,y){y&&!m.j&&(es(m),m.i=null,m.g.forEach(function(I,R){const ee=R.toLowerCase();R!=ee&&(oo(this,R),ll(this,ee,I))},m)),m.j=y}function Mr(m,y){const I=new ln;if(c.Image){const R=new Image;R.onload=b(rn,I,"TestLoadImage: loaded",!0,y,R),R.onerror=b(rn,I,"TestLoadImage: error",!1,y,R),R.onabort=b(rn,I,"TestLoadImage: abort",!1,y,R),R.ontimeout=b(rn,I,"TestLoadImage: timeout",!1,y,R),c.setTimeout(function(){R.ontimeout&&R.ontimeout()},1e4),R.src=m}else y(!1)}function Vr(m,y){const I=new ln,R=new AbortController,ee=setTimeout(()=>{R.abort(),rn(I,"TestPingServer: timeout",!1,y)},1e4);fetch(m,{signal:R.signal}).then(de=>{clearTimeout(ee),de.ok?rn(I,"TestPingServer: ok",!0,y):rn(I,"TestPingServer: server error",!1,y)}).catch(()=>{clearTimeout(ee),rn(I,"TestPingServer: error",!1,y)})}function rn(m,y,I,R,ee){try{ee&&(ee.onload=null,ee.onerror=null,ee.onabort=null,ee.ontimeout=null),R(I)}catch{}}function ya(){this.g=new ar}function _r(m){this.i=m.Sb||null,this.h=m.ab||!1}w(_r,gs),_r.prototype.g=function(){return new Lr(this.i,this.h)};function Lr(m,y){wt.call(this),this.H=m,this.o=y,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}w(Lr,wt),n=Lr.prototype,n.open=function(m,y){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=m,this.D=y,this.readyState=1,$r(this)},n.send=function(m){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const y={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};m&&(y.body=m),(this.H||c).fetch(new Request(this.D,y)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Wi(this)),this.readyState=0},n.Pa=function(m){if(this.g&&(this.l=m,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=m.headers,this.readyState=2,$r(this)),this.g&&(this.readyState=3,$r(this),this.g)))if(this.responseType==="arraybuffer")m.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in m){if(this.j=m.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;qi(this)}else m.text().then(this.Oa.bind(this),this.ga.bind(this))};function qi(m){m.j.read().then(m.Ma.bind(m)).catch(m.ga.bind(m))}n.Ma=function(m){if(this.g){if(this.o&&m.value)this.response.push(m.value);else if(!this.o){var y=m.value?m.value:new Uint8Array(0);(y=this.B.decode(y,{stream:!m.done}))&&(this.response=this.responseText+=y)}m.done?Wi(this):$r(this),this.readyState==3&&qi(this)}},n.Oa=function(m){this.g&&(this.response=this.responseText=m,Wi(this))},n.Na=function(m){this.g&&(this.response=m,Wi(this))},n.ga=function(){this.g&&Wi(this)};function Wi(m){m.readyState=4,m.l=null,m.j=null,m.B=null,$r(m)}n.setRequestHeader=function(m,y){this.A.append(m,y)},n.getResponseHeader=function(m){return this.h&&this.h.get(m.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const m=[],y=this.h.entries();for(var I=y.next();!I.done;)I=I.value,m.push(I[0]+": "+I[1]),I=y.next();return m.join(`\r
`)};function $r(m){m.onreadystatechange&&m.onreadystatechange.call(m)}Object.defineProperty(Lr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(m){this.m=m?"include":"same-origin"}});function jc(m){let y="";return P(m,function(I,R){y+=R,y+=":",y+=I,y+=`\r
`}),y}function Gs(m,y,I){e:{for(R in I){var R=!1;break e}R=!0}R||(I=jc(I),typeof m=="string"?I!=null&&Us(I):$t(m,y,I))}function Qt(m){wt.call(this),this.headers=new Map,this.L=m||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}w(Qt,wt);var kt=/^https?$/i,Nt=["POST","PUT"];n=Qt.prototype,n.Fa=function(m){this.H=m},n.ea=function(m,y,I,R){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+m);y=y?y.toUpperCase():"GET",this.D=m,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():il.g(),this.g.onreadystatechange=E(g(this.Ca,this));try{this.B=!0,this.g.open(y,String(m),!0),this.B=!1}catch(de){Ns(this,de);return}if(m=I||"",I=new Map(this.headers),R)if(Object.getPrototypeOf(R)===Object.prototype)for(var ee in R)I.set(ee,R[ee]);else if(typeof R.keys=="function"&&typeof R.get=="function")for(const de of R.keys())I.set(de,R.get(de));else throw Error("Unknown input type for opt_headers: "+String(R));R=Array.from(I.keys()).find(de=>de.toLowerCase()=="content-type"),ee=c.FormData&&m instanceof c.FormData,!(Array.prototype.indexOf.call(Nt,y,void 0)>=0)||R||ee||I.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[de,Re]of I)this.g.setRequestHeader(de,Re);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(m),this.v=!1}catch(de){Ns(this,de)}};function Ns(m,y){m.h=!1,m.g&&(m.j=!0,m.g.abort(),m.j=!1),m.l=y,m.o=5,Is(m),Mt(m)}function Is(m){m.A||(m.A=!0,_t(m,"complete"),_t(m,"error"))}n.abort=function(m){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=m||7,_t(this,"complete"),_t(this,"abort"),Mt(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Mt(this,!0)),Qt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?gn(this):this.Xa())},n.Xa=function(){gn(this)};function gn(m){if(m.h&&typeof l<"u"){if(m.v&&Es(m)==4)setTimeout(m.Ca.bind(m),0);else if(_t(m,"readystatechange"),Es(m)==4){m.h=!1;try{const de=m.ca();e:switch(de){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var y=!0;break e;default:y=!1}var I;if(!(I=y)){var R;if(R=de===0){let Re=String(m.D).match(io)[1]||null;!Re&&c.self&&c.self.location&&(Re=c.self.location.protocol.slice(0,-1)),R=!kt.test(Re?Re.toLowerCase():"")}I=R}if(I)_t(m,"complete"),_t(m,"success");else{m.o=6;try{var ee=Es(m)>2?m.g.statusText:""}catch{ee=""}m.l=ee+" ["+m.ca()+"]",Is(m)}}finally{Mt(m)}}}}function Mt(m,y){if(m.g){m.m&&(clearTimeout(m.m),m.m=null);const I=m.g;m.g=null,y||_t(m,"ready");try{I.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Es(m){return m.g?m.g.readyState:0}n.ca=function(){try{return Es(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(m){if(this.g){var y=this.g.responseText;return m&&y.indexOf(m)==0&&(y=y.substring(m.length)),ma(y)}};function Ft(m){try{if(!m.g)return null;if("response"in m.g)return m.g.response;switch(m.F){case"":case"text":return m.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in m.g)return m.g.mozResponseArrayBuffer}return null}catch{return null}}function cl(m){const y={};m=(m.g&&Es(m)>=2&&m.g.getAllResponseHeaders()||"").split(`\r
`);for(let R=0;R<m.length;R++){if(M(m[R]))continue;var I=xi(m[R]);const ee=I[0];if(I=I[1],typeof I!="string")continue;I=I.trim();const de=y[ee]||[];y[ee]=de,de.push(I)}W(y,function(R){return R.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ts(m,y,I){return I&&I.internalChannelParams&&I.internalChannelParams[m]||y}function dl(m){this.za=0,this.i=[],this.j=new ln,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ts("failFast",!1,m),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ts("baseRetryDelayMs",5e3,m),this.Za=Ts("retryDelaySeedMs",1e4,m),this.Ta=Ts("forwardChannelMaxRetries",2,m),this.va=Ts("forwardChannelRequestTimeoutMs",2e4,m),this.ma=m&&m.xmlHttpFactory||void 0,this.Ua=m&&m.Rb||void 0,this.Aa=m&&m.useFetchStreams||!1,this.O=void 0,this.L=m&&m.supportsCrossDomainXhr||!1,this.M="",this.h=new ro(m&&m.concurrentRequestLimit),this.Ba=new ya,this.S=m&&m.fastHandshake||!1,this.R=m&&m.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=m&&m.Pb||!1,m&&m.ua&&this.j.ua(),m&&m.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&m&&m.detectBufferingProxy||!1,this.ia=void 0,m&&m.longPollingTimeout&&m.longPollingTimeout>0&&(this.ia=m.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=dl.prototype,n.ka=8,n.I=1,n.connect=function(m,y,I,R){Me(0),this.W=m,this.H=y||{},I&&R!==void 0&&(this.H.OSID=I,this.H.OAID=R),this.F=this.X,this.J=wa(this,null,this.W),Tn(this)};function ul(m){if(hl(m),m.I==3){var y=m.V++,I=Zr(m.J);if($t(I,"SID",m.M),$t(I,"RID",y),$t(I,"TYPE","terminate"),Ks(m,I),y=new Hn(m,m.j,y),y.M=2,y.A=ws(Zr(I)),I=!1,c.navigator&&c.navigator.sendBeacon)try{I=c.navigator.sendBeacon(y.A.toString(),"")}catch{}!I&&c.Image&&(new Image().src=y.A,I=!0),I||(y.g=kc(y.j,null),y.g.ea(y.A)),y.F=Date.now(),zs(y)}Fr(m)}function ts(m){m.g&&(ba(m),m.g.cancel(),m.g=null)}function hl(m){ts(m),m.v&&(c.clearTimeout(m.v),m.v=null),ns(m),m.h.cancel(),m.m&&(typeof m.m=="number"&&c.clearTimeout(m.m),m.m=null)}function Tn(m){if(!Bi(m.h)&&!m.m){m.m=!0;var y=m.Ea;j||k(),ce||(j(),ce=!0),D.add(y,m),m.D=0}}function hn(m,y){return or(m.h)>=m.h.j-(m.m?1:0)?!1:m.m?(m.i=y.G.concat(m.i),!0):m.I==1||m.I==2||m.D>=(m.Sa?0:m.Ta)?!1:(m.m=Ze(g(m.Ea,m,y),tr(m,m.D)),m.D++,!0)}n.Ea=function(m){if(this.m)if(this.m=null,this.I==1){if(!m){this.V=Math.floor(Math.random()*1e5),m=this.V++;const ee=new Hn(this,this.j,m);let de=this.o;if(this.U&&(de?(de=V(de),we(de,this.U)):de=this.U),this.u!==null||this.R||(ee.J=de,de=null),this.S)e:{for(var y=0,I=0;I<this.i.length;I++){t:{var R=this.i[I];if("__data__"in R.map&&(R=R.map.__data__,typeof R=="string")){R=R.length;break t}R=void 0}if(R===void 0)break;if(y+=R,y>4096){y=I;break e}if(y===4096||I===this.i.length-1){y=I+1;break e}}y=1e3}else y=1e3;y=ml(this,ee,y),I=Zr(this.J),$t(I,"RID",m),$t(I,"CVER",22),this.G&&$t(I,"X-HTTP-Session-Id",this.G),Ks(this,I),de&&(this.R?y="headers="+Us(jc(de))+"&"+y:this.u&&Gs(I,this.u,de)),so(this.h,ee),this.Ra&&$t(I,"TYPE","init"),this.S?($t(I,"$req",y),$t(I,"SID","null"),ee.U=!0,bs(ee,I,null)):bs(ee,I,y),this.I=2}}else this.I==3&&(m?va(this,m):this.i.length==0||Bi(this.h)||va(this))};function va(m,y){var I;y?I=y.l:I=m.V++;const R=Zr(m.J);$t(R,"SID",m.M),$t(R,"RID",I),$t(R,"AID",m.K),Ks(m,R),m.u&&m.o&&Gs(R,m.u,m.o),I=new Hn(m,m.j,I,m.D+1),m.u===null&&(I.J=m.o),y&&(m.i=y.G.concat(m.i)),y=ml(m,I,1e3),I.H=Math.round(m.va*.5)+Math.round(m.va*.5*Math.random()),so(m.h,I),bs(I,R,y)}function Ks(m,y){m.H&&P(m.H,function(I,R){$t(y,R,I)}),m.l&&P({},function(I,R){$t(y,R,I)})}function ml(m,y,I){I=Math.min(m.i.length,I);const R=m.l?g(m.l.Ka,m.l,m):null;e:{var ee=m.i;let gt=-1;for(;;){const wn=["count="+I];gt==-1?I>0?(gt=ee[0].g,wn.push("ofs="+gt)):gt=0:wn.push("ofs="+gt);let Ut=!0;for(let yn=0;yn<I;yn++){var de=ee[yn].g;const Br=ee[yn].map;if(de-=gt,de<0)gt=Math.max(0,ee[yn].g-100),Ut=!1;else try{de="req"+de+"_"||"";try{var Re=Br instanceof Map?Br:Object.entries(Br);for(const[rs,Kn]of Re){let Mn=Kn;u(Kn)&&(Mn=Jr(Kn)),wn.push(de+rs+"="+encodeURIComponent(Mn))}}catch(rs){throw wn.push(de+"type="+encodeURIComponent("_badmap")),rs}}catch{R&&R(Br)}}if(Ut){Re=wn.join("&");break e}}Re=void 0}return m=m.i.splice(0,I),y.G=m,Re}function Gn(m){if(!m.g&&!m.v){m.Y=1;var y=m.Da;j||k(),ce||(j(),ce=!0),D.add(y,m),m.A=0}}function Qs(m){return m.g||m.v||m.A>=3?!1:(m.Y++,m.v=Ze(g(m.Da,m),tr(m,m.A)),m.A++,!0)}n.Da=function(){if(this.v=null,Ni(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var m=4*this.T;this.j.info("BP detection timer enabled: "+m),this.B=Ze(g(this.Wa,this),m)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Me(10),ts(this),Ni(this))};function ba(m){m.B!=null&&(c.clearTimeout(m.B),m.B=null)}function Ni(m){m.g=new Hn(m,m.j,"rpc",m.Y),m.u===null&&(m.g.J=m.o),m.g.P=0;var y=Zr(m.na);$t(y,"RID","rpc"),$t(y,"SID",m.M),$t(y,"AID",m.K),$t(y,"CI",m.F?"0":"1"),!m.F&&m.ia&&$t(y,"TO",m.ia),$t(y,"TYPE","xmlhttp"),Ks(m,y),m.u&&m.o&&Gs(y,m.u,m.o),m.O&&(m.g.H=m.O);var I=m.g;m=m.ba,I.M=1,I.A=ws(Zr(y)),I.u=null,I.R=!0,yi(I,m)}n.Va=function(){this.C!=null&&(this.C=null,ts(this),Qs(this),Me(19))};function ns(m){m.C!=null&&(c.clearTimeout(m.C),m.C=null)}function Ss(m,y){var I=null;if(m.g==y){ns(m),ba(m),m.g=null;var R=2}else if(Ui(m.h,y))I=y.G,vi(m.h,y),R=1;else return;if(m.I!=0){if(y.o)if(R==1){I=y.u?y.u.length:0,y=Date.now()-y.F;var ee=m.D;R=He(),_t(R,new ve(R,I)),Tn(m)}else Gn(m);else if(ee=y.m,ee==3||ee==0&&y.X>0||!(R==1&&hn(m,y)||R==2&&Qs(m)))switch(I&&I.length>0&&(y=m.h,y.i=y.i.concat(I)),ee){case 1:Yt(m,5);break;case 4:Yt(m,10);break;case 3:Yt(m,6);break;default:Yt(m,2)}}}function tr(m,y){let I=m.Qa+Math.floor(Math.random()*m.Za);return m.isActive()||(I*=2),I*y}function Yt(m,y){if(m.j.info("Error code "+y),y==2){var I=g(m.bb,m),R=m.Ua;const ee=!R;R=new Xr(R||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||bi(R,"https"),ws(R),ee?Mr(R.toString(),I):Vr(R.toString(),I)}else Me(2);m.I=0,m.l&&m.l.pa(y),Fr(m),hl(m)}n.bb=function(m){m?(this.j.info("Successfully pinged google.com"),Me(2)):(this.j.info("Failed to ping google.com"),Me(1))};function Fr(m){if(m.I=0,m.ja=[],m.l){const y=Or(m.h);(y.length!=0||m.i.length!=0)&&(H(m.ja,y),H(m.ja,m.i),m.h.i.length=0,C(m.i),m.i.length=0),m.l.oa()}}function wa(m,y,I){var R=I instanceof Xr?Zr(I):new Xr(I);if(R.g!="")y&&(R.g=y+"."+R.g),wr(R,R.u);else{var ee=c.location;R=ee.protocol,y=y?y+"."+ee.hostname:ee.hostname,ee=+ee.port;const de=new Xr(null);R&&bi(de,R),y&&(de.g=y),ee&&wr(de,ee),I&&(de.h=I),R=de}return I=m.G,y=m.wa,I&&y&&$t(R,I,y),$t(R,"VER",m.ka),Ks(m,R),R}function kc(m,y,I){if(y&&!m.L)throw Error("Can't create secondary domain capable XhrIo object.");return y=m.Aa&&!m.ma?new Qt(new _r({ab:I})):new Qt(m.ma),y.Fa(m.L),y}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function pl(){}n=pl.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function At(){}At.prototype.g=function(m,y){return new xn(m,y)};function xn(m,y){wt.call(this),this.g=new dl(y),this.l=m,this.h=y&&y.messageUrlParams||null,m=y&&y.messageHeaders||null,y&&y.clientProtocolHeaderRequired&&(m?m["X-Client-Protocol"]="webchannel":m={"X-Client-Protocol":"webchannel"}),this.g.o=m,m=y&&y.initMessageHeaders||null,y&&y.messageContentType&&(m?m["X-WebChannel-Content-Type"]=y.messageContentType:m={"X-WebChannel-Content-Type":y.messageContentType}),y&&y.sa&&(m?m["X-WebChannel-Client-Profile"]=y.sa:m={"X-WebChannel-Client-Profile":y.sa}),this.g.U=m,(m=y&&y.Qb)&&!M(m)&&(this.g.u=m),this.A=y&&y.supportsCrossDomainXhr||!1,this.v=y&&y.sendRawJson||!1,(y=y&&y.httpSessionIdParam)&&!M(y)&&(this.g.G=y,m=this.h,m!==null&&y in m&&(m=this.h,y in m&&delete m[y])),this.j=new Ii(this)}w(xn,wt),xn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},xn.prototype.close=function(){ul(this.g)},xn.prototype.o=function(m){var y=this.g;if(typeof m=="string"){var I={};I.__data__=m,m=I}else this.v&&(I={},I.__data__=Jr(m),m=I);y.i.push(new Ac(y.Ya++,m)),y.I==3&&Tn(y)},xn.prototype.N=function(){this.g.l=null,delete this.j,ul(this.g),delete this.g,xn.Z.N.call(this)};function Cc(m){_e.call(this),m.__headers__&&(this.headers=m.__headers__,this.statusCode=m.__status__,delete m.__headers__,delete m.__status__);var y=m.__sm__;if(y){e:{for(const I in y){m=I;break e}m=void 0}(this.i=m)&&(m=this.i,y=y!==null&&m in y?y[m]:void 0),this.data=y}else this.data=m}w(Cc,_e);function fl(){Be.call(this),this.status=1}w(fl,Be);function Ii(m){this.g=m}w(Ii,pl),Ii.prototype.ra=function(){_t(this.g,"a")},Ii.prototype.qa=function(m){_t(this.g,new Cc(m))},Ii.prototype.pa=function(m){_t(this.g,new fl)},Ii.prototype.oa=function(){_t(this.g,"b")},At.prototype.createWebChannel=At.prototype.g,xn.prototype.send=xn.prototype.o,xn.prototype.open=xn.prototype.m,xn.prototype.close=xn.prototype.close,qI=function(){return new At},zI=function(){return He()},UI=We,ny={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Kt.NO_ERROR=0,Kt.TIMEOUT=8,Kt.HTTP_ERROR=6,Np=Kt,$i.COMPLETE="complete",BI=$i,gi.EventType=ie,ie.OPEN="a",ie.CLOSE="b",ie.ERROR="c",ie.MESSAGE="d",wt.prototype.listen=wt.prototype.J,Qu=gi,Qt.prototype.listenOnce=Qt.prototype.K,Qt.prototype.getLastError=Qt.prototype.Ha,Qt.prototype.getLastErrorCode=Qt.prototype.ya,Qt.prototype.getStatus=Qt.prototype.ca,Qt.prototype.getResponseJson=Qt.prototype.La,Qt.prototype.getResponseText=Qt.prototype.la,Qt.prototype.send=Qt.prototype.ea,Qt.prototype.setWithCredentials=Qt.prototype.Fa,FI=Qt}).apply(typeof ip<"u"?ip:typeof self<"u"?self:typeof window<"u"?window:{});const Iw="@firebase/firestore",Ew="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}gr.UNAUTHENTICATED=new gr(null),gr.GOOGLE_CREDENTIALS=new gr("google-credentials-uid"),gr.FIRST_PARTY=new gr("first-party-uid"),gr.MOCK_USER=new gr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ud="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oc=new bf("@firebase/firestore");function ud(){return oc.logLevel}function Ae(n,...e){if(oc.logLevel<=Dt.DEBUG){const t=e.map(Xy);oc.debug(`Firestore (${Ud}): ${n}`,...t)}}function Hr(n,...e){if(oc.logLevel<=Dt.ERROR){const t=e.map(Xy);oc.error(`Firestore (${Ud}): ${n}`,...t)}}function lc(n,...e){if(oc.logLevel<=Dt.WARN){const t=e.map(Xy);oc.warn(`Firestore (${Ud}): ${n}`,...t)}}function Xy(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qe(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,WI(n,r,t)}function WI(n,e,t){let r=`FIRESTORE (${Ud}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Hr(r),new Error(r)}function rt(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||WI(e,i,r)}function vt(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ye={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Pe extends di{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HI{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class XR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(gr.UNAUTHENTICATED)))}shutdown(){}}class ZR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class eD{constructor(e){this.t=e,this.currentUser=gr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){rt(this.o===void 0,42304);let r=this.i;const i=p=>this.i!==r?(r=this.i,t(p)):Promise.resolve();let l=new ia;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new ia,e.enqueueRetryable((()=>i(this.currentUser)))};const c=()=>{const p=l;e.enqueueRetryable((async()=>{await p.promise,await i(this.currentUser)}))},u=p=>{Ae("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=p,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit((p=>u(p))),setTimeout((()=>{if(!this.auth){const p=this.t.getImmediate({optional:!0});p?u(p):(Ae("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new ia)}}),0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(Ae("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(rt(typeof r.accessToken=="string",31837,{l:r}),new HI(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return rt(e===null||typeof e=="string",2055,{h:e}),new gr(e)}}class tD{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=gr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class nD{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new tD(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(gr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Tw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rD{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,hs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){rt(this.o===void 0,3512);const r=l=>{l.error!=null&&Ae("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const c=l.token!==this.m;return this.m=l.token,Ae("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?t(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable((()=>r(l)))};const i=l=>{Ae("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((l=>i(l))),setTimeout((()=>{if(!this.appCheck){const l=this.V.getImmediate({optional:!0});l?i(l):Ae("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Tw(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(rt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Tw(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sD(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=sD(40);for(let l=0;l<i.length;++l)r.length<20&&i[l]<t&&(r+=e.charAt(i[l]%62))}return r}}function yt(n,e){return n<e?-1:n>e?1:0}function ry(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const i=n.charAt(r),l=e.charAt(r);if(i!==l)return vx(i)===vx(l)?yt(i,l):vx(i)?1:-1}return yt(n.length,e.length)}const iD=55296,aD=57343;function vx(n){const e=n.charCodeAt(0);return e>=iD&&e<=aD}function Td(n,e,t){return n.length===e.length&&n.every(((r,i)=>t(r,e[i])))}function GI(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sw="__name__";class Zi{constructor(e,t,r){t===void 0?t=0:t>e.length&&Qe(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&Qe(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Zi.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Zi?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const l=Zi.compareSegments(e.get(i),t.get(i));if(l!==0)return l}return yt(e.length,t.length)}static compareSegments(e,t){const r=Zi.isNumericId(e),i=Zi.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?Zi.extractNumericId(e).compare(Zi.extractNumericId(t)):ry(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Wo.fromString(e.substring(4,e.length-2))}}class Wt extends Zi{construct(e,t,r){return new Wt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Pe(ye.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((i=>i.length>0)))}return new Wt(t)}static emptyPath(){return new Wt([])}}const oD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class In extends Zi{construct(e,t,r){return new In(e,t,r)}static isValidIdentifier(e){return oD.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),In.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Sw}static keyField(){return new In([Sw])}static fromServerFormat(e){const t=[];let r="",i=0;const l=()=>{if(r.length===0)throw new Pe(ye.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let c=!1;for(;i<e.length;){const u=e[i];if(u==="\\"){if(i+1===e.length)throw new Pe(ye.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const p=e[i+1];if(p!=="\\"&&p!=="."&&p!=="`")throw new Pe(ye.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=p,i+=2}else u==="`"?(c=!c,i++):u!=="."||c?(r+=u,i++):(l(),i++)}if(l(),c)throw new Pe(ye.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new In(t)}static emptyPath(){return new In([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oe{constructor(e){this.path=e}static fromPath(e){return new Oe(Wt.fromString(e))}static fromName(e){return new Oe(Wt.fromString(e).popFirst(5))}static empty(){return new Oe(Wt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Wt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Wt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Oe(new Wt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KI(n,e,t){if(!t)throw new Pe(ye.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function lD(n,e,t,r){if(e===!0&&r===!0)throw new Pe(ye.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Aw(n){if(!Oe.isDocumentKey(n))throw new Pe(ye.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function jw(n){if(Oe.isDocumentKey(n))throw new Pe(ye.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function QI(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ef(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Qe(12329,{type:typeof n})}function Gr(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Pe(ye.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ef(n);throw new Pe(ye.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qn(n,e){const t={typeString:n};return e&&(t.value=e),t}function qh(n,e){if(!QI(n))throw new Pe(ye.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const i=e[r].typeString,l="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const c=n[r];if(i&&typeof c!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(l!==void 0&&c!==l.value){t=`Expected '${r}' field to equal '${l.value}'`;break}}if(t)throw new Pe(ye.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kw=-62135596800,Cw=1e6;class Zt{static now(){return Zt.fromMillis(Date.now())}static fromDate(e){return Zt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Cw);return new Zt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Pe(ye.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Pe(ye.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<kw)throw new Pe(ye.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Pe(ye.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Cw}_compareTo(e){return this.seconds===e.seconds?yt(this.nanoseconds,e.nanoseconds):yt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Zt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(qh(e,Zt._jsonSchema))return new Zt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-kw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Zt._jsonSchemaVersion="firestore/timestamp/1.0",Zt._jsonSchema={type:qn("string",Zt._jsonSchemaVersion),seconds:qn("number"),nanoseconds:qn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lt{static fromTimestamp(e){return new lt(e)}static min(){return new lt(new Zt(0,0))}static max(){return new lt(new Zt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ih=-1;class Kp{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function sy(n){return n.fields.find((e=>e.kind===2))}function Ul(n){return n.fields.filter((e=>e.kind!==2))}Kp.UNKNOWN_ID=-1;class Ip{constructor(e,t){this.fieldPath=e,this.kind=t}}class Eh{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Eh(0,Vs.min())}}function cD(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=lt.fromTimestamp(r===1e9?new Zt(t+1,0):new Zt(t,r));return new Vs(i,Oe.empty(),e)}function YI(n){return new Vs(n.readTime,n.key,Ih)}class Vs{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Vs(lt.min(),Oe.empty(),Ih)}static max(){return new Vs(lt.max(),Oe.empty(),Ih)}}function e0(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Oe.comparator(n.documentKey,e.documentKey),t!==0?t:yt(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class XI{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _c(n){if(n.code!==ye.FAILED_PRECONDITION||n.message!==JI)throw n;Ae("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Qe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new te(((r,i)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(r,i)},this.catchCallback=l=>{this.wrapFailure(t,l).next(r,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof te?t:te.resolve(t)}catch(t){return te.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):te.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):te.reject(t)}static resolve(e){return new te(((t,r)=>{t(e)}))}static reject(e){return new te(((t,r)=>{r(e)}))}static waitFor(e){return new te(((t,r)=>{let i=0,l=0,c=!1;e.forEach((u=>{++i,u.next((()=>{++l,c&&l===i&&t()}),(p=>r(p)))})),c=!0,l===i&&t()}))}static or(e){let t=te.resolve(!1);for(const r of e)t=t.next((i=>i?te.resolve(i):r()));return t}static forEach(e,t){const r=[];return e.forEach(((i,l)=>{r.push(t.call(this,i,l))})),this.waitFor(r)}static mapArray(e,t){return new te(((r,i)=>{const l=e.length,c=new Array(l);let u=0;for(let p=0;p<l;p++){const g=p;t(e[g]).next((b=>{c[g]=b,++u,u===l&&r(c)}),(b=>i(b)))}}))}static doWhile(e,t){return new te(((r,i)=>{const l=()=>{e()===!0?t().next((()=>{l()}),i):r()};l()}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cs="SimpleDb";class Tf{static open(e,t,r,i){try{return new Tf(t,e.transaction(i,r))}catch(l){throw new dh(t,l)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new ia,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new dh(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const i=t0(r.target.error);this.S.reject(new dh(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Ae(Cs,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new uD(t)}}class Ho{static delete(e){return Ae(Cs,"Removing database:",e),Wl(LN().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!vf())return!1;if(Ho.F())return!0;const e=Xn(),t=Ho.M(e),r=0<t&&t<10,i=ZI(e),l=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||l)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,Ho.M(Xn())===12.2&&Hr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Ae(Cs,"Opening database:",this.name),this.db=await new Promise(((t,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=l=>{const c=l.target.result;t(c)},i.onblocked=()=>{r(new dh(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=l=>{const c=l.target.error;c.name==="VersionError"?r(new Pe(ye.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):c.name==="InvalidStateError"?r(new Pe(ye.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+c)):r(new dh(e,c))},i.onupgradeneeded=l=>{Ae(Cs,'Database "'+this.name+'" requires upgrade from version:',l.oldVersion);const c=l.target.result;this.N.k(c,i.transaction,l.oldVersion,this.version).next((()=>{Ae(Cs,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,i){const l=t==="readonly";let c=0;for(;;){++c;try{this.db=await this.L(e);const u=Tf.open(this.db,e,l?"readonly":"readwrite",r),p=i(u).next((g=>(u.C(),g))).catch((g=>(u.abort(g),te.reject(g)))).toPromise();return p.catch((()=>{})),await u.D,p}catch(u){const p=u,g=p.name!=="FirebaseError"&&c<3;if(Ae(Cs,"Transaction failed with error:",p.message,"Retrying:",g),this.close(),!g)return Promise.reject(p)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ZI(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class dD{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Wl(this.U.delete())}}class dh extends Pe{constructor(e,t){super(ye.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function nl(n){return n.name==="IndexedDbTransactionError"}class uD{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(Ae(Cs,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(Ae(Cs,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Wl(r)}add(e){return Ae(Cs,"ADD",this.store.name,e,e),Wl(this.store.add(e))}get(e){return Wl(this.store.get(e)).next((t=>(t===void 0&&(t=null),Ae(Cs,"GET",this.store.name,e,t),t)))}delete(e){return Ae(Cs,"DELETE",this.store.name,e),Wl(this.store.delete(e))}count(){return Ae(Cs,"COUNT",this.store.name),Wl(this.store.count())}J(e,t){const r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){const l=i.getAll(r.range);return new te(((c,u)=>{l.onerror=p=>{u(p.target.error)},l.onsuccess=p=>{c(p.target.result)}}))}{const l=this.cursor(r),c=[];return this.H(l,((u,p)=>{c.push(p)})).next((()=>c))}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new te(((i,l)=>{r.onerror=c=>{l(c.target.error)},r.onsuccess=c=>{i(c.target.result)}}))}Z(e,t){Ae(Cs,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const i=this.cursor(r);return this.H(i,((l,c,u)=>u.delete()))}ee(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.H(i,t)}te(e){const t=this.cursor({});return new te(((r,i)=>{t.onerror=l=>{const c=t0(l.target.error);i(c)},t.onsuccess=l=>{const c=l.target.result;c?e(c.primaryKey,c.value).next((u=>{u?c.continue():r()})):r()}}))}H(e,t){const r=[];return new te(((i,l)=>{e.onerror=c=>{l(c.target.error)},e.onsuccess=c=>{const u=c.target.result;if(!u)return void i();const p=new dD(u),g=t(u.primaryKey,u.value,p);if(g instanceof te){const b=g.catch((w=>(p.done(),te.reject(w))));r.push(b)}p.isDone?i():p.G===null?u.continue():u.continue(p.G)}})).next((()=>te.waitFor(r)))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Wl(n){return new te(((e,t)=>{n.onsuccess=r=>{const i=r.target.result;e(i)},n.onerror=r=>{const i=t0(r.target.error);t(i)}}))}let Rw=!1;function t0(n){const e=Ho.M(Xn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new Pe("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Rw||(Rw=!0,setTimeout((()=>{throw r}),0)),r}}return n}const uh="IndexBackfiller";class hD{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){Ae(uh,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();Ae(uh,`Documents written: ${t}`)}catch(t){nl(t)?Ae(uh,"Ignoring IndexedDB error during index backfill: ",t):await _c(t)}await this.re(6e4)}))}}class mD{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const r=new Set;let i=t,l=!0;return te.doWhile((()=>l===!0&&i>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((c=>{if(c!==null&&!r.has(c))return Ae(uh,`Processing collection: ${c}`),this.oe(e,c,i).next((u=>{i-=u,r.add(c)}));l=!1})))).next((()=>t-i))}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next((l=>{const c=l.changes;return this.localStore.indexManager.updateIndexEntries(e,c).next((()=>this._e(i,l))).next((u=>(Ae(uh,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u)))).next((()=>c.size))}))))}_e(e,t){let r=e;return t.changes.forEach(((i,l)=>{const c=YI(l);e0(c,r)>0&&(r=c)})),new Vs(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}oi.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xl=-1;function Sf(n){return n==null}function Th(n){return n===0&&1/n==-1/0}function pD(n){return typeof n=="number"&&Number.isInteger(n)&&!Th(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qp="";function Cr(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Dw(e)),e=fD(n.get(t),e);return Dw(e)}function fD(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const l=n.charAt(i);switch(l){case"\0":t+="";break;case Qp:t+="";break;default:t+=l}}return t}function Dw(n){return n+Qp+""}function ea(n){const e=n.length;if(rt(e>=2,64408,{path:n}),e===2)return rt(n.charAt(0)===Qp&&n.charAt(1)==="",56145,{path:n}),Wt.emptyPath();const t=e-2,r=[];let i="";for(let l=0;l<e;){const c=n.indexOf(Qp,l);switch((c<0||c>t)&&Qe(50515,{path:n}),n.charAt(c+1)){case"":const u=n.substring(l,c);let p;i.length===0?p=u:(i+=u,p=i,i=""),r.push(p);break;case"":i+=n.substring(l,c),i+="\0";break;case"":i+=n.substring(l,c+1);break;default:Qe(61167,{path:n})}l=c+2}return new Wt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zl="remoteDocuments",Wh="owner",id="owner",Sh="mutationQueues",gD="userId",Mi="mutations",Pw="batchId",Ql="userMutationsIndex",Ow=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ep(n,e){return[n,Cr(e)]}function e1(n,e,t){return[n,Cr(e),t]}const xD={},Sd="documentMutations",Yp="remoteDocumentsV14",yD=["prefixPath","collectionGroup","readTime","documentId"],Tp="documentKeyIndex",vD=["prefixPath","collectionGroup","documentId"],t1="collectionGroupIndex",bD=["collectionGroup","readTime","prefixPath","documentId"],Ah="remoteDocumentGlobal",iy="remoteDocumentGlobalKey",Ad="targets",n1="queryTargetsIndex",wD=["canonicalId","targetId"],jd="targetDocuments",_D=["targetId","path"],n0="documentTargetsIndex",ND=["path","targetId"],Jp="targetGlobalKey",Zl="targetGlobal",jh="collectionParents",ID=["collectionId","parent"],kd="clientMetadata",ED="clientId",Af="bundles",TD="bundleId",jf="namedQueries",SD="name",r0="indexConfiguration",AD="indexId",ay="collectionGroupIndex",jD="collectionGroup",hh="indexState",kD=["indexId","uid"],r1="sequenceNumberIndex",CD=["uid","sequenceNumber"],mh="indexEntries",RD=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],s1="documentKeyIndex",DD=["indexId","uid","orderedDocumentKey"],kf="documentOverlays",PD=["userId","collectionPath","documentId"],oy="collectionPathOverlayIndex",OD=["userId","collectionPath","largestBatchId"],i1="collectionGroupOverlayIndex",MD=["userId","collectionGroup","largestBatchId"],s0="globals",VD="name",a1=[Sh,Mi,Sd,zl,Ad,Wh,Zl,jd,kd,Ah,jh,Af,jf],LD=[...a1,kf],o1=[Sh,Mi,Sd,Yp,Ad,Wh,Zl,jd,kd,Ah,jh,Af,jf,kf],l1=o1,i0=[...l1,r0,hh,mh],$D=i0,c1=[...i0,s0],FD=c1;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly extends XI{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Zn(n,e){const t=vt(n);return Ho.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mw(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function rl(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function d1(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(e,t){this.comparator=e,this.root=t||xr.EMPTY}insert(e,t){return new bn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xr.BLACK,null,null))}remove(e){return new bn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ap(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ap(this.root,e,this.comparator,!1)}getReverseIterator(){return new ap(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ap(this.root,e,this.comparator,!0)}}class ap{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=t?r(e.key,t):1,t&&i&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class xr{constructor(e,t,r,i,l){this.key=e,this.value=t,this.color=r??xr.RED,this.left=i??xr.EMPTY,this.right=l??xr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,l){return new xr(e??this.key,t??this.value,r??this.color,i??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const l=r(e,i.key);return i=l<0?i.copy(null,null,null,i.left.insert(e,t,r),null):l===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return xr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return xr.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,xr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,xr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Qe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Qe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Qe(27949);return e+(this.isRed()?0:1)}}xr.EMPTY=null,xr.RED=!0,xr.BLACK=!1;xr.EMPTY=new class{constructor(){this.size=0}get key(){throw Qe(57766)}get value(){throw Qe(16141)}get color(){throw Qe(16727)}get left(){throw Qe(29726)}get right(){throw Qe(36894)}copy(e,t,r,i,l){return this}insert(e,t,r){return new xr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e){this.comparator=e,this.data=new bn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Vw(this.data.getIterator())}getIteratorFrom(e){return new Vw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof tn)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,l=r.getNext().key;if(this.comparator(i,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new tn(this.comparator);return t.data=e,t}}class Vw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ad(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e){this.fields=e,e.sort(In.comparator)}static empty(){return new ms([])}unionWith(e){let t=new tn(In.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ms(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Td(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u1 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new u1("Invalid base64 string: "+l):l}})(e);return new Wn(t)}static fromUint8Array(e){const t=(function(i){let l="";for(let c=0;c<i.length;++c)l+=String.fromCharCode(i[c]);return l})(e);return new Wn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return yt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Wn.EMPTY_BYTE_STRING=new Wn("");const BD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ka(n){if(rt(!!n,39018),typeof n=="string"){let e=0;const t=BD.exec(n);if(rt(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:vn(n.seconds),nanos:vn(n.nanos)}}function vn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Qa(n){return typeof n=="string"?Wn.fromBase64String(n):Wn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h1="server_timestamp",m1="__type__",p1="__previous_value__",f1="__local_write_time__";function a0(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[m1])==null?void 0:r.stringValue)===h1}function Cf(n){const e=n.mapValue.fields[p1];return a0(e)?Cf(e):e}function kh(n){const e=Ka(n.mapValue.fields[f1].timestampValue);return new Zt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UD{constructor(e,t,r,i,l,c,u,p,g,b){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=l,this.forceLongPolling=c,this.autoDetectLongPolling=u,this.longPollingOptions=p,this.useFetchStreams=g,this.isUsingEmulator=b}}const Xp="(default)";class cc{constructor(e,t){this.projectId=e,this.database=t||Xp}static empty(){return new cc("","")}get isDefaultDatabase(){return this.database===Xp}isEqual(e){return e instanceof cc&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o0="__type__",g1="__max__",Uo={mapValue:{fields:{__type__:{stringValue:g1}}}},l0="__vector__",Cd="value",Sp={nullValue:"NULL_VALUE"};function Qo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?a0(n)?4:x1(n)?9007199254740991:Rf(n)?10:11:Qe(28295,{value:n})}function la(n,e){if(n===e)return!0;const t=Qo(n);if(t!==Qo(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return kh(n).isEqual(kh(e));case 3:return(function(i,l){if(typeof i.timestampValue=="string"&&typeof l.timestampValue=="string"&&i.timestampValue.length===l.timestampValue.length)return i.timestampValue===l.timestampValue;const c=Ka(i.timestampValue),u=Ka(l.timestampValue);return c.seconds===u.seconds&&c.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,l){return Qa(i.bytesValue).isEqual(Qa(l.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,l){return vn(i.geoPointValue.latitude)===vn(l.geoPointValue.latitude)&&vn(i.geoPointValue.longitude)===vn(l.geoPointValue.longitude)})(n,e);case 2:return(function(i,l){if("integerValue"in i&&"integerValue"in l)return vn(i.integerValue)===vn(l.integerValue);if("doubleValue"in i&&"doubleValue"in l){const c=vn(i.doubleValue),u=vn(l.doubleValue);return c===u?Th(c)===Th(u):isNaN(c)&&isNaN(u)}return!1})(n,e);case 9:return Td(n.arrayValue.values||[],e.arrayValue.values||[],la);case 10:case 11:return(function(i,l){const c=i.mapValue.fields||{},u=l.mapValue.fields||{};if(Mw(c)!==Mw(u))return!1;for(const p in c)if(c.hasOwnProperty(p)&&(u[p]===void 0||!la(c[p],u[p])))return!1;return!0})(n,e);default:return Qe(52216,{left:n})}}function Ch(n,e){return(n.values||[]).find((t=>la(t,e)))!==void 0}function Yo(n,e){if(n===e)return 0;const t=Qo(n),r=Qo(e);if(t!==r)return yt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return yt(n.booleanValue,e.booleanValue);case 2:return(function(l,c){const u=vn(l.integerValue||l.doubleValue),p=vn(c.integerValue||c.doubleValue);return u<p?-1:u>p?1:u===p?0:isNaN(u)?isNaN(p)?0:-1:1})(n,e);case 3:return Lw(n.timestampValue,e.timestampValue);case 4:return Lw(kh(n),kh(e));case 5:return ry(n.stringValue,e.stringValue);case 6:return(function(l,c){const u=Qa(l),p=Qa(c);return u.compareTo(p)})(n.bytesValue,e.bytesValue);case 7:return(function(l,c){const u=l.split("/"),p=c.split("/");for(let g=0;g<u.length&&g<p.length;g++){const b=yt(u[g],p[g]);if(b!==0)return b}return yt(u.length,p.length)})(n.referenceValue,e.referenceValue);case 8:return(function(l,c){const u=yt(vn(l.latitude),vn(c.latitude));return u!==0?u:yt(vn(l.longitude),vn(c.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return $w(n.arrayValue,e.arrayValue);case 10:return(function(l,c){var E,C,H,F;const u=l.fields||{},p=c.fields||{},g=(E=u[Cd])==null?void 0:E.arrayValue,b=(C=p[Cd])==null?void 0:C.arrayValue,w=yt(((H=g==null?void 0:g.values)==null?void 0:H.length)||0,((F=b==null?void 0:b.values)==null?void 0:F.length)||0);return w!==0?w:$w(g,b)})(n.mapValue,e.mapValue);case 11:return(function(l,c){if(l===Uo.mapValue&&c===Uo.mapValue)return 0;if(l===Uo.mapValue)return 1;if(c===Uo.mapValue)return-1;const u=l.fields||{},p=Object.keys(u),g=c.fields||{},b=Object.keys(g);p.sort(),b.sort();for(let w=0;w<p.length&&w<b.length;++w){const E=ry(p[w],b[w]);if(E!==0)return E;const C=Yo(u[p[w]],g[b[w]]);if(C!==0)return C}return yt(p.length,b.length)})(n.mapValue,e.mapValue);default:throw Qe(23264,{he:t})}}function Lw(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return yt(n,e);const t=Ka(n),r=Ka(e),i=yt(t.seconds,r.seconds);return i!==0?i:yt(t.nanos,r.nanos)}function $w(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const l=Yo(t[i],r[i]);if(l)return l}return yt(t.length,r.length)}function Rd(n){return cy(n)}function cy(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=Ka(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Qa(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return Oe.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(const l of t.values||[])i?i=!1:r+=",",r+=cy(l);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let i="{",l=!0;for(const c of r)l?l=!1:i+=",",i+=`${c}:${cy(t.fields[c])}`;return i+"}"})(n.mapValue):Qe(61005,{value:n})}function Ap(n){switch(Qo(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Cf(n);return e?16+Ap(e):16;case 5:return 2*n.stringValue.length;case 6:return Qa(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,l)=>i+Ap(l)),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return rl(r.fields,((l,c)=>{i+=l.length+Ap(c)})),i})(n.mapValue);default:throw Qe(13486,{value:n})}}function Rh(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function dy(n){return!!n&&"integerValue"in n}function Dh(n){return!!n&&"arrayValue"in n}function Fw(n){return!!n&&"nullValue"in n}function Bw(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function jp(n){return!!n&&"mapValue"in n}function Rf(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[o0])==null?void 0:r.stringValue)===l0}function ph(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return rl(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=ph(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ph(n.arrayValue.values[t]);return e}return{...n}}function x1(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===g1}const y1={mapValue:{fields:{[o0]:{stringValue:l0},[Cd]:{arrayValue:{}}}}};function zD(n){return"nullValue"in n?Sp:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Rh(cc.empty(),Oe.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Rf(n)?y1:{mapValue:{}}:Qe(35942,{value:n})}function qD(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Rh(cc.empty(),Oe.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?y1:"mapValue"in n?Rf(n)?{mapValue:{}}:Uo:Qe(61959,{value:n})}function Uw(n,e){const t=Yo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function zw(n,e){const t=Yo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e){this.value=e}static empty(){return new Ar({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!jp(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ph(t)}setAll(e){let t=In.emptyPath(),r={},i=[];e.forEach(((c,u)=>{if(!t.isImmediateParentOf(u)){const p=this.getFieldsMap(t);this.applyChanges(p,r,i),r={},i=[],t=u.popLast()}c?r[u.lastSegment()]=ph(c):i.push(u.lastSegment())}));const l=this.getFieldsMap(t);this.applyChanges(l,r,i)}delete(e){const t=this.field(e.popLast());jp(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return la(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];jp(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){rl(t,((i,l)=>e[i]=l));for(const i of r)delete e[i]}clone(){return new Ar(ph(this.value))}}function v1(n){const e=[];return rl(n.fields,((t,r)=>{const i=new In([t]);if(jp(r)){const l=v1(r.mapValue).fields;if(l.length===0)e.push(i);else for(const c of l)e.push(i.child(c))}else e.push(i)})),new ms(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cn{constructor(e,t,r,i,l,c,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=l,this.data=c,this.documentState=u}static newInvalidDocument(e){return new Cn(e,0,lt.min(),lt.min(),lt.min(),Ar.empty(),0)}static newFoundDocument(e,t,r,i){return new Cn(e,1,t,lt.min(),r,i,0)}static newNoDocument(e,t){return new Cn(e,2,t,lt.min(),lt.min(),Ar.empty(),0)}static newUnknownDocument(e,t){return new Cn(e,3,t,lt.min(),lt.min(),Ar.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(lt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ar.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ar.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=lt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Cn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Cn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dd{constructor(e,t){this.position=e,this.inclusive=t}}function qw(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const l=e[i],c=n.position[i];if(l.field.isKeyField()?r=Oe.comparator(Oe.fromName(c.referenceValue),t.key):r=Yo(c,t.data.field(l.field)),l.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ww(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!la(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(e,t="asc"){this.field=e,this.dir=t}}function WD(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b1{}class Pt extends b1{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new HD(e,t,r):t==="array-contains"?new QD(e,r):t==="in"?new T1(e,r):t==="not-in"?new YD(e,r):t==="array-contains-any"?new JD(e,r):new Pt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new GD(e,r):new KD(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Yo(t,this.value)):t!==null&&Qo(this.value)===Qo(t)&&this.matchesComparison(Yo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Qe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class en extends b1{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new en(e,t)}matches(e){return Pd(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Pd(n){return n.op==="and"}function uy(n){return n.op==="or"}function c0(n){return w1(n)&&Pd(n)}function w1(n){for(const e of n.filters)if(e instanceof en)return!1;return!0}function hy(n){if(n instanceof Pt)return n.field.canonicalString()+n.op.toString()+Rd(n.value);if(c0(n))return n.filters.map((e=>hy(e))).join(",");{const e=n.filters.map((t=>hy(t))).join(",");return`${n.op}(${e})`}}function _1(n,e){return n instanceof Pt?(function(r,i){return i instanceof Pt&&r.op===i.op&&r.field.isEqual(i.field)&&la(r.value,i.value)})(n,e):n instanceof en?(function(r,i){return i instanceof en&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((l,c,u)=>l&&_1(c,i.filters[u])),!0):!1})(n,e):void Qe(19439)}function N1(n,e){const t=n.filters.concat(e);return en.create(t,n.op)}function I1(n){return n instanceof Pt?(function(t){return`${t.field.canonicalString()} ${t.op} ${Rd(t.value)}`})(n):n instanceof en?(function(t){return t.op.toString()+" {"+t.getFilters().map(I1).join(" ,")+"}"})(n):"Filter"}class HD extends Pt{constructor(e,t,r){super(e,t,r),this.key=Oe.fromName(r.referenceValue)}matches(e){const t=Oe.comparator(e.key,this.key);return this.matchesComparison(t)}}class GD extends Pt{constructor(e,t){super(e,"in",t),this.keys=E1("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class KD extends Pt{constructor(e,t){super(e,"not-in",t),this.keys=E1("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function E1(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map((r=>Oe.fromName(r.referenceValue)))}class QD extends Pt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Dh(t)&&Ch(t.arrayValue,this.value)}}class T1 extends Pt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ch(this.value.arrayValue,t)}}class YD extends Pt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ch(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ch(this.value.arrayValue,t)}}class JD extends Pt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Dh(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Ch(this.value.arrayValue,r)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XD{constructor(e,t=null,r=[],i=[],l=null,c=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=l,this.startAt=c,this.endAt=u,this.Te=null}}function my(n,e=null,t=[],r=[],i=null,l=null,c=null){return new XD(n,e,t,r,i,l,c)}function dc(n){const e=vt(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>hy(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(l){return l.field.canonicalString()+l.dir})(r))).join(","),Sf(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Rd(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Rd(r))).join(",")),e.Te=t}return e.Te}function Hh(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!WD(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!_1(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ww(n.startAt,e.startAt)&&Ww(n.endAt,e.endAt)}function ef(n){return Oe.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function tf(n,e){return n.filters.filter((t=>t instanceof Pt&&t.field.isEqual(e)))}function Hw(n,e,t){let r=Sp,i=!0;for(const l of tf(n,e)){let c=Sp,u=!0;switch(l.op){case"<":case"<=":c=zD(l.value);break;case"==":case"in":case">=":c=l.value;break;case">":c=l.value,u=!1;break;case"!=":case"not-in":c=Sp}Uw({value:r,inclusive:i},{value:c,inclusive:u})<0&&(r=c,i=u)}if(t!==null){for(let l=0;l<n.orderBy.length;++l)if(n.orderBy[l].field.isEqual(e)){const c=t.position[l];Uw({value:r,inclusive:i},{value:c,inclusive:t.inclusive})<0&&(r=c,i=t.inclusive);break}}return{value:r,inclusive:i}}function Gw(n,e,t){let r=Uo,i=!0;for(const l of tf(n,e)){let c=Uo,u=!0;switch(l.op){case">=":case">":c=qD(l.value),u=!1;break;case"==":case"in":case"<=":c=l.value;break;case"<":c=l.value,u=!1;break;case"!=":case"not-in":c=Uo}zw({value:r,inclusive:i},{value:c,inclusive:u})>0&&(r=c,i=u)}if(t!==null){for(let l=0;l<n.orderBy.length;++l)if(n.orderBy[l].field.isEqual(e)){const c=t.position[l];zw({value:r,inclusive:i},{value:c,inclusive:t.inclusive})>0&&(r=c,i=t.inclusive);break}}return{value:r,inclusive:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gh{constructor(e,t=null,r=[],i=[],l=null,c="F",u=null,p=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=l,this.limitType=c,this.startAt=u,this.endAt=p,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function ZD(n,e,t,r,i,l,c,u){return new Gh(n,e,t,r,i,l,c,u)}function Kh(n){return new Gh(n)}function Kw(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function S1(n){return n.collectionGroup!==null}function fh(n){const e=vt(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const l of e.explicitOrderBy)e.Ie.push(l),t.add(l.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let u=new tn(In.comparator);return c.filters.forEach((p=>{p.getFlattenedFilters().forEach((g=>{g.isInequality()&&(u=u.add(g.field))}))})),u})(e).forEach((l=>{t.has(l.canonicalString())||l.isKeyField()||e.Ie.push(new Zp(l,r))})),t.has(In.keyField().canonicalString())||e.Ie.push(new Zp(In.keyField(),r))}return e.Ie}function ci(n){const e=vt(n);return e.Ee||(e.Ee=eP(e,fh(n))),e.Ee}function eP(n,e){if(n.limitType==="F")return my(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{const l=i.dir==="desc"?"asc":"desc";return new Zp(i.field,l)}));const t=n.endAt?new Dd(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Dd(n.startAt.position,n.startAt.inclusive):null;return my(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function py(n,e){const t=n.filters.concat([e]);return new Gh(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function fy(n,e,t){return new Gh(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Df(n,e){return Hh(ci(n),ci(e))&&n.limitType===e.limitType}function A1(n){return`${dc(ci(n))}|lt:${n.limitType}`}function hd(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((i=>I1(i))).join(", ")}]`),Sf(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((i=>(function(c){return`${c.field.canonicalString()} (${c.dir})`})(i))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((i=>Rd(i))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((i=>Rd(i))).join(",")),`Target(${r})`})(ci(n))}; limitType=${n.limitType})`}function Qh(n,e){return e.isFoundDocument()&&(function(r,i){const l=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(l):Oe.isDocumentKey(r.path)?r.path.isEqual(l):r.path.isImmediateParentOf(l)})(n,e)&&(function(r,i){for(const l of fh(r))if(!l.field.isKeyField()&&i.data.field(l.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(const l of r.filters)if(!l.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(c,u,p){const g=qw(c,u,p);return c.inclusive?g<=0:g<0})(r.startAt,fh(r),i)||r.endAt&&!(function(c,u,p){const g=qw(c,u,p);return c.inclusive?g>=0:g>0})(r.endAt,fh(r),i))})(n,e)}function tP(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function j1(n){return(e,t)=>{let r=!1;for(const i of fh(n)){const l=nP(i,e,t);if(l!==0)return l;r=r||i.field.isKeyField()}return 0}}function nP(n,e,t){const r=n.field.isKeyField()?Oe.comparator(e.key,t.key):(function(l,c,u){const p=c.data.field(l),g=u.data.field(l);return p!==null&&g!==null?Yo(p,g):Qe(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Qe(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,l]of r)if(this.equalsFn(i,e))return l}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let l=0;l<i.length;l++)if(this.equalsFn(i[l][0],e))return void(i[l]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){rl(this.inner,((t,r)=>{for(const[i,l]of r)e(i,l)}))}isEmpty(){return d1(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rP=new bn(Oe.comparator);function Rs(){return rP}const k1=new bn(Oe.comparator);function Yu(...n){let e=k1;for(const t of n)e=e.insert(t.key,t);return e}function C1(n){let e=k1;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function ta(){return gh()}function R1(){return gh()}function gh(){return new Ja((n=>n.toString()),((n,e)=>n.isEqual(e)))}const sP=new bn(Oe.comparator),iP=new tn(Oe.comparator);function jt(...n){let e=iP;for(const t of n)e=e.add(t);return e}const aP=new tn(yt);function oP(){return aP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d0(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Th(e)?"-0":e}}function D1(n){return{integerValue:""+n}}function lP(n,e){return pD(e)?D1(e):d0(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(){this._=void 0}}function cP(n,e,t){return n instanceof Ph?(function(i,l){const c={fields:{[m1]:{stringValue:h1},[f1]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return l&&a0(l)&&(l=Cf(l)),l&&(c.fields[p1]=l),{mapValue:c}})(t,e):n instanceof uc?O1(n,e):n instanceof Od?M1(n,e):(function(i,l){const c=P1(i,l),u=Qw(c)+Qw(i.Ae);return dy(c)&&dy(i.Ae)?D1(u):d0(i.serializer,u)})(n,e)}function dP(n,e,t){return n instanceof uc?O1(n,e):n instanceof Od?M1(n,e):t}function P1(n,e){return n instanceof Oh?(function(r){return dy(r)||(function(l){return!!l&&"doubleValue"in l})(r)})(e)?e:{integerValue:0}:null}class Ph extends Pf{}class uc extends Pf{constructor(e){super(),this.elements=e}}function O1(n,e){const t=V1(e);for(const r of n.elements)t.some((i=>la(i,r)))||t.push(r);return{arrayValue:{values:t}}}class Od extends Pf{constructor(e){super(),this.elements=e}}function M1(n,e){let t=V1(e);for(const r of n.elements)t=t.filter((i=>!la(i,r)));return{arrayValue:{values:t}}}class Oh extends Pf{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Qw(n){return vn(n.integerValue||n.doubleValue)}function V1(n){return Dh(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L1{constructor(e,t){this.field=e,this.transform=t}}function uP(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof uc&&i instanceof uc||r instanceof Od&&i instanceof Od?Td(r.elements,i.elements,la):r instanceof Oh&&i instanceof Oh?la(r.Ae,i.Ae):r instanceof Ph&&i instanceof Ph})(n.transform,e.transform)}class hP{constructor(e,t){this.version=e,this.transformResults=t}}class jr{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new jr}static exists(e){return new jr(void 0,e)}static updateTime(e){return new jr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function kp(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Of{}function $1(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Mf(n.key,jr.none()):new zd(n.key,n.data,jr.none());{const t=n.data,r=Ar.empty();let i=new tn(In.comparator);for(let l of e.fields)if(!i.has(l)){let c=t.field(l);c===null&&l.length>1&&(l=l.popLast(),c=t.field(l)),c===null?r.delete(l):r.set(l,c),i=i.add(l)}return new Xa(n.key,r,new ms(i.toArray()),jr.none())}}function mP(n,e,t){n instanceof zd?(function(i,l,c){const u=i.value.clone(),p=Jw(i.fieldTransforms,l,c.transformResults);u.setAll(p),l.convertToFoundDocument(c.version,u).setHasCommittedMutations()})(n,e,t):n instanceof Xa?(function(i,l,c){if(!kp(i.precondition,l))return void l.convertToUnknownDocument(c.version);const u=Jw(i.fieldTransforms,l,c.transformResults),p=l.data;p.setAll(F1(i)),p.setAll(u),l.convertToFoundDocument(c.version,p).setHasCommittedMutations()})(n,e,t):(function(i,l,c){l.convertToNoDocument(c.version).setHasCommittedMutations()})(0,e,t)}function xh(n,e,t,r){return n instanceof zd?(function(l,c,u,p){if(!kp(l.precondition,c))return u;const g=l.value.clone(),b=Xw(l.fieldTransforms,p,c);return g.setAll(b),c.convertToFoundDocument(c.version,g).setHasLocalMutations(),null})(n,e,t,r):n instanceof Xa?(function(l,c,u,p){if(!kp(l.precondition,c))return u;const g=Xw(l.fieldTransforms,p,c),b=c.data;return b.setAll(F1(l)),b.setAll(g),c.convertToFoundDocument(c.version,b).setHasLocalMutations(),u===null?null:u.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map((w=>w.field)))})(n,e,t,r):(function(l,c,u){return kp(l.precondition,c)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):u})(n,e,t)}function pP(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),l=P1(r.transform,i||null);l!=null&&(t===null&&(t=Ar.empty()),t.set(r.field,l))}return t||null}function Yw(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Td(r,i,((l,c)=>uP(l,c)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class zd extends Of{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Xa extends Of{constructor(e,t,r,i,l=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function F1(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Jw(n,e,t){const r=new Map;rt(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){const l=n[i],c=l.transform,u=e.data.field(l.field);r.set(l.field,dP(c,u,t[i]))}return r}function Xw(n,e,t){const r=new Map;for(const i of n){const l=i.transform,c=t.data.field(i.field);r.set(i.field,cP(l,c,e))}return r}class Mf extends Of{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class B1 extends Of{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const l=this.mutations[i];l.key.isEqual(e.key)&&mP(l,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=xh(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=xh(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=R1();return this.mutations.forEach((i=>{const l=e.get(i.key),c=l.overlayedDocument;let u=this.applyToLocalView(c,l.mutatedFields);u=t.has(i.key)?null:u;const p=$1(c,u);p!==null&&r.set(i.key,p),c.isValidDocument()||c.convertToNoDocument(lt.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),jt())}isEqual(e){return this.batchId===e.batchId&&Td(this.mutations,e.mutations,((t,r)=>Yw(t,r)))&&Td(this.baseMutations,e.baseMutations,((t,r)=>Yw(t,r)))}}class h0{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){rt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return sP})();const l=e.mutations;for(let c=0;c<l.length;c++)i=i.insert(l[c].key,r[c].version);return new h0(e,t,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fP{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Un,Lt;function gP(n){switch(n){case ye.OK:return Qe(64938);case ye.CANCELLED:case ye.UNKNOWN:case ye.DEADLINE_EXCEEDED:case ye.RESOURCE_EXHAUSTED:case ye.INTERNAL:case ye.UNAVAILABLE:case ye.UNAUTHENTICATED:return!1;case ye.INVALID_ARGUMENT:case ye.NOT_FOUND:case ye.ALREADY_EXISTS:case ye.PERMISSION_DENIED:case ye.FAILED_PRECONDITION:case ye.ABORTED:case ye.OUT_OF_RANGE:case ye.UNIMPLEMENTED:case ye.DATA_LOSS:return!0;default:return Qe(15467,{code:n})}}function U1(n){if(n===void 0)return Hr("GRPC error has no .code"),ye.UNKNOWN;switch(n){case Un.OK:return ye.OK;case Un.CANCELLED:return ye.CANCELLED;case Un.UNKNOWN:return ye.UNKNOWN;case Un.DEADLINE_EXCEEDED:return ye.DEADLINE_EXCEEDED;case Un.RESOURCE_EXHAUSTED:return ye.RESOURCE_EXHAUSTED;case Un.INTERNAL:return ye.INTERNAL;case Un.UNAVAILABLE:return ye.UNAVAILABLE;case Un.UNAUTHENTICATED:return ye.UNAUTHENTICATED;case Un.INVALID_ARGUMENT:return ye.INVALID_ARGUMENT;case Un.NOT_FOUND:return ye.NOT_FOUND;case Un.ALREADY_EXISTS:return ye.ALREADY_EXISTS;case Un.PERMISSION_DENIED:return ye.PERMISSION_DENIED;case Un.FAILED_PRECONDITION:return ye.FAILED_PRECONDITION;case Un.ABORTED:return ye.ABORTED;case Un.OUT_OF_RANGE:return ye.OUT_OF_RANGE;case Un.UNIMPLEMENTED:return ye.UNIMPLEMENTED;case Un.DATA_LOSS:return ye.DATA_LOSS;default:return Qe(39323,{code:n})}}(Lt=Un||(Un={}))[Lt.OK=0]="OK",Lt[Lt.CANCELLED=1]="CANCELLED",Lt[Lt.UNKNOWN=2]="UNKNOWN",Lt[Lt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Lt[Lt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Lt[Lt.NOT_FOUND=5]="NOT_FOUND",Lt[Lt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Lt[Lt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Lt[Lt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Lt[Lt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Lt[Lt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Lt[Lt.ABORTED=10]="ABORTED",Lt[Lt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Lt[Lt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Lt[Lt.INTERNAL=13]="INTERNAL",Lt[Lt.UNAVAILABLE=14]="UNAVAILABLE",Lt[Lt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xP(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yP=new Wo([4294967295,4294967295],0);function Zw(n){const e=xP().encode(n),t=new $I;return t.update(e),new Uint8Array(t.digest())}function e_(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new Wo([t,r],0),new Wo([i,l],0)]}class p0{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ju(`Invalid padding: ${t}`);if(r<0)throw new Ju(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ju(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ju(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Wo.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(Wo.fromNumber(r)));return i.compare(yP)===1&&(i=new Wo([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Zw(e),[r,i]=e_(t);for(let l=0;l<this.hashCount;l++){const c=this.ye(r,i,l);if(!this.we(c))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),c=new p0(l,i,t);return r.forEach((u=>c.insert(u))),c}insert(e){if(this.ge===0)return;const t=Zw(e),[r,i]=e_(t);for(let l=0;l<this.hashCount;l++){const c=this.ye(r,i,l);this.Se(c)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Ju extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(e,t,r,i,l){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Yh.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Vf(lt.min(),i,new bn(yt),Rs(),jt())}}class Yh{constructor(e,t,r,i,l){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Yh(r,t,jt(),jt(),jt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cp{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}}class z1{constructor(e,t){this.targetId=e,this.Ce=t}}class q1{constructor(e,t,r=Wn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class t_{constructor(){this.ve=0,this.Fe=n_(),this.Me=Wn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=jt(),t=jt(),r=jt();return this.Fe.forEach(((i,l)=>{switch(l){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Qe(38017,{changeType:l})}})),new Yh(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=n_()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,rt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class vP{constructor(e){this.Ge=e,this.ze=new Map,this.je=Rs(),this.Je=op(),this.He=op(),this.Ye=new bn(yt)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:Qe(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){const l=i.target;if(ef(l))if(r===0){const c=new Oe(l.path);this.et(t,c,Cn.newNoDocument(c,lt.min()))}else rt(r===1,20013,{expectedCount:r});else{const c=this._t(t);if(c!==r){const u=this.ut(e),p=u?this.ct(u,e,c):1;if(p!==0){this.it(t);const g=p===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,g)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:l=0}=t;let c,u;try{c=Qa(r).toUint8Array()}catch(p){if(p instanceof u1)return lc("Decoding the base64 bloom filter in existence filter failed ("+p.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw p}try{u=new p0(c,i,l)}catch(p){return lc(p instanceof Ju?"BloomFilter error: ":"Applying bloom filter failed: ",p),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let i=0;return r.forEach((l=>{const c=this.Ge.ht(),u=`projects/${c.projectId}/databases/${c.database}/documents/${l.path.canonicalString()}`;e.mightContain(u)||(this.et(t,l,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((l,c)=>{const u=this.ot(c);if(u){if(l.current&&ef(u.target)){const p=new Oe(u.target.path);this.It(p).has(c)||this.Et(c,p)||this.et(c,p,Cn.newNoDocument(p,e))}l.Be&&(t.set(c,l.ke()),l.qe())}}));let r=jt();this.He.forEach(((l,c)=>{let u=!0;c.forEachWhile((p=>{const g=this.ot(p);return!g||g.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(l))})),this.je.forEach(((l,c)=>c.setReadTime(e)));const i=new Vf(e,t,this.Ye,this.je,r);return this.je=Rs(),this.Je=op(),this.He=op(),this.Ye=new bn(yt),i}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new t_,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new tn(yt),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new tn(yt),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Ae("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new t_),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function op(){return new bn(Oe.comparator)}function n_(){return new bn(Oe.comparator)}const bP={asc:"ASCENDING",desc:"DESCENDING"},wP={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},_P={and:"AND",or:"OR"};class NP{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function gy(n,e){return n.useProto3Json||Sf(e)?e:{value:e}}function Md(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function W1(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function IP(n,e){return Md(n,e.toTimestamp())}function Kr(n){return rt(!!n,49232),lt.fromTimestamp((function(t){const r=Ka(t);return new Zt(r.seconds,r.nanos)})(n))}function f0(n,e){return xy(n,e).canonicalString()}function xy(n,e){const t=(function(i){return new Wt(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function H1(n){const e=Wt.fromString(n);return rt(tE(e),10190,{key:e.toString()}),e}function nf(n,e){return f0(n.databaseId,e.path)}function ec(n,e){const t=H1(e);if(t.get(1)!==n.databaseId.projectId)throw new Pe(ye.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Pe(ye.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Oe(Q1(t))}function G1(n,e){return f0(n.databaseId,e)}function K1(n){const e=H1(n);return e.length===4?Wt.emptyPath():Q1(e)}function yy(n){return new Wt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Q1(n){return rt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function r_(n,e,t){return{name:nf(n,e),fields:t.value.mapValue.fields}}function EP(n,e,t){const r=ec(n,e.name),i=Kr(e.updateTime),l=e.createTime?Kr(e.createTime):lt.min(),c=new Ar({mapValue:{fields:e.fields}}),u=Cn.newFoundDocument(r,i,l,c);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function TP(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(g){return g==="NO_CHANGE"?0:g==="ADD"?1:g==="REMOVE"?2:g==="CURRENT"?3:g==="RESET"?4:Qe(39313,{state:g})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],l=(function(g,b){return g.useProto3Json?(rt(b===void 0||typeof b=="string",58123),Wn.fromBase64String(b||"")):(rt(b===void 0||b instanceof Buffer||b instanceof Uint8Array,16193),Wn.fromUint8Array(b||new Uint8Array))})(n,e.targetChange.resumeToken),c=e.targetChange.cause,u=c&&(function(g){const b=g.code===void 0?ye.UNKNOWN:U1(g.code);return new Pe(b,g.message||"")})(c);t=new q1(r,i,l,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=ec(n,r.document.name),l=Kr(r.document.updateTime),c=r.document.createTime?Kr(r.document.createTime):lt.min(),u=new Ar({mapValue:{fields:r.document.fields}}),p=Cn.newFoundDocument(i,l,c,u),g=r.targetIds||[],b=r.removedTargetIds||[];t=new Cp(g,b,p.key,p)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=ec(n,r.document),l=r.readTime?Kr(r.readTime):lt.min(),c=Cn.newNoDocument(i,l),u=r.removedTargetIds||[];t=new Cp([],u,c.key,c)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=ec(n,r.document),l=r.removedTargetIds||[];t=new Cp([],l,i,null)}else{if(!("filter"in e))return Qe(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:l}=r,c=new fP(i,l),u=r.targetId;t=new z1(u,c)}}return t}function rf(n,e){let t;if(e instanceof zd)t={update:r_(n,e.key,e.value)};else if(e instanceof Mf)t={delete:nf(n,e.key)};else if(e instanceof Xa)t={update:r_(n,e.key,e.data),updateMask:RP(e.fieldMask)};else{if(!(e instanceof B1))return Qe(16599,{Vt:e.type});t={verify:nf(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(l,c){const u=c.transform;if(u instanceof Ph)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof uc)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Od)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Oh)return{fieldPath:c.field.canonicalString(),increment:u.Ae};throw Qe(20930,{transform:c.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(i,l){return l.updateTime!==void 0?{updateTime:IP(i,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:Qe(27497)})(n,e.precondition)),t}function vy(n,e){const t=e.currentDocument?(function(l){return l.updateTime!==void 0?jr.updateTime(Kr(l.updateTime)):l.exists!==void 0?jr.exists(l.exists):jr.none()})(e.currentDocument):jr.none(),r=e.updateTransforms?e.updateTransforms.map((i=>(function(c,u){let p=null;if("setToServerValue"in u)rt(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),p=new Ph;else if("appendMissingElements"in u){const b=u.appendMissingElements.values||[];p=new uc(b)}else if("removeAllFromArray"in u){const b=u.removeAllFromArray.values||[];p=new Od(b)}else"increment"in u?p=new Oh(c,u.increment):Qe(16584,{proto:u});const g=In.fromServerFormat(u.fieldPath);return new L1(g,p)})(n,i))):[];if(e.update){e.update.name;const i=ec(n,e.update.name),l=new Ar({mapValue:{fields:e.update.fields}});if(e.updateMask){const c=(function(p){const g=p.fieldPaths||[];return new ms(g.map((b=>In.fromServerFormat(b))))})(e.updateMask);return new Xa(i,l,c,t,r)}return new zd(i,l,t,r)}if(e.delete){const i=ec(n,e.delete);return new Mf(i,t)}if(e.verify){const i=ec(n,e.verify);return new B1(i,t)}return Qe(1463,{proto:e})}function SP(n,e){return n&&n.length>0?(rt(e!==void 0,14353),n.map((t=>(function(i,l){let c=i.updateTime?Kr(i.updateTime):Kr(l);return c.isEqual(lt.min())&&(c=Kr(l)),new hP(c,i.transformResults||[])})(t,e)))):[]}function Y1(n,e){return{documents:[G1(n,e.path)]}}function J1(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=G1(n,i);const l=(function(g){if(g.length!==0)return eE(en.create(g,"and"))})(e.filters);l&&(t.structuredQuery.where=l);const c=(function(g){if(g.length!==0)return g.map((b=>(function(E){return{field:md(E.field),direction:jP(E.dir)}})(b)))})(e.orderBy);c&&(t.structuredQuery.orderBy=c);const u=gy(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(g){return{before:g.inclusive,values:g.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(g){return{before:!g.inclusive,values:g.position}})(e.endAt)),{ft:t,parent:i}}function X1(n){let e=K1(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){rt(r===1,65062);const b=t.from[0];b.allDescendants?i=b.collectionId:e=e.child(b.collectionId)}let l=[];t.where&&(l=(function(w){const E=Z1(w);return E instanceof en&&c0(E)?E.getFilters():[E]})(t.where));let c=[];t.orderBy&&(c=(function(w){return w.map((E=>(function(H){return new Zp(pd(H.field),(function(U){switch(U){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(H.direction))})(E)))})(t.orderBy));let u=null;t.limit&&(u=(function(w){let E;return E=typeof w=="object"?w.value:w,Sf(E)?null:E})(t.limit));let p=null;t.startAt&&(p=(function(w){const E=!!w.before,C=w.values||[];return new Dd(C,E)})(t.startAt));let g=null;return t.endAt&&(g=(function(w){const E=!w.before,C=w.values||[];return new Dd(C,E)})(t.endAt)),ZD(e,i,c,l,u,"F",p,g)}function AP(n,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Qe(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Z1(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=pd(t.unaryFilter.field);return Pt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=pd(t.unaryFilter.field);return Pt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=pd(t.unaryFilter.field);return Pt.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const c=pd(t.unaryFilter.field);return Pt.create(c,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Qe(61313);default:return Qe(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Pt.create(pd(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Qe(58110);default:return Qe(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return en.create(t.compositeFilter.filters.map((r=>Z1(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Qe(1026)}})(t.compositeFilter.op))})(n):Qe(30097,{filter:n})}function jP(n){return bP[n]}function kP(n){return wP[n]}function CP(n){return _P[n]}function md(n){return{fieldPath:n.canonicalString()}}function pd(n){return In.fromServerFormat(n.fieldPath)}function eE(n){return n instanceof Pt?(function(t){if(t.op==="=="){if(Bw(t.value))return{unaryFilter:{field:md(t.field),op:"IS_NAN"}};if(Fw(t.value))return{unaryFilter:{field:md(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Bw(t.value))return{unaryFilter:{field:md(t.field),op:"IS_NOT_NAN"}};if(Fw(t.value))return{unaryFilter:{field:md(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:md(t.field),op:kP(t.op),value:t.value}}})(n):n instanceof en?(function(t){const r=t.getFilters().map((i=>eE(i)));return r.length===1?r[0]:{compositeFilter:{op:CP(t.op),filters:r}}})(n):Qe(54877,{filter:n})}function RP(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function tE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(e,t,r,i,l=lt.min(),c=lt.min(),u=Wn.EMPTY_BYTE_STRING,p=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=u,this.expectedCount=p}withSequenceNumber(e){return new Ua(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ua(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ua(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ua(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nE{constructor(e){this.yt=e}}function DP(n,e){let t;if(e.document)t=EP(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Oe.fromSegments(e.noDocument.path),i=mc(e.noDocument.readTime);t=Cn.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Qe(56709);{const r=Oe.fromSegments(e.unknownDocument.path),i=mc(e.unknownDocument.version);t=Cn.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime((function(i){const l=new Zt(i[0],i[1]);return lt.fromTimestamp(l)})(e.readTime)),t}function s_(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:sf(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=(function(l,c){return{name:nf(l,c.key),fields:c.data.value.mapValue.fields,updateTime:Md(l,c.version.toTimestamp()),createTime:Md(l,c.createTime.toTimestamp())}})(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:hc(e.version)};else{if(!e.isUnknownDocument())return Qe(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:hc(e.version)}}return r}function sf(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function hc(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function mc(n){const e=new Zt(n.seconds,n.nanoseconds);return lt.fromTimestamp(e)}function Hl(n,e){const t=(e.baseMutations||[]).map((l=>vy(n.yt,l)));for(let l=0;l<e.mutations.length-1;++l){const c=e.mutations[l];if(l+1<e.mutations.length&&e.mutations[l+1].transform!==void 0){const u=e.mutations[l+1];c.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(l+1,1),++l}}const r=e.mutations.map((l=>vy(n.yt,l))),i=Zt.fromMillis(e.localWriteTimeMs);return new u0(e.batchId,i,t,r)}function Xu(n){const e=mc(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?mc(n.lastLimboFreeSnapshotVersion):lt.min();let r;return r=(function(l){return l.documents!==void 0})(n.query)?(function(l){const c=l.documents.length;return rt(c===1,1966,{count:c}),ci(Kh(K1(l.documents[0])))})(n.query):(function(l){return ci(X1(l))})(n.query),new Ua(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Wn.fromBase64String(n.resumeToken))}function rE(n,e){const t=hc(e.snapshotVersion),r=hc(e.lastLimboFreeSnapshotVersion);let i;i=ef(e.target)?Y1(n.yt,e.target):J1(n.yt,e.target).ft;const l=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:dc(e.target),readTime:t,resumeToken:l,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function sE(n){const e=X1({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?fy(e,e.limit,"L"):e}function bx(n,e){return new m0(e.largestBatchId,vy(n.yt,e.overlayMutation))}function i_(n,e){const t=e.path.lastSegment();return[n,Cr(e.path.popLast()),t]}function a_(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:hc(r.readTime),documentKey:Cr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{getBundleMetadata(e,t){return o_(e).get(t).next((r=>{if(r)return(function(l){return{id:l.bundleId,createTime:mc(l.createTime),version:l.version}})(r)}))}saveBundleMetadata(e,t){return o_(e).put((function(i){return{bundleId:i.id,createTime:hc(Kr(i.createTime)),version:i.version}})(t))}getNamedQuery(e,t){return l_(e).get(t).next((r=>{if(r)return(function(l){return{name:l.name,query:sE(l.bundledQuery),readTime:mc(l.readTime)}})(r)}))}saveNamedQuery(e,t){return l_(e).put((function(i){return{name:i.name,readTime:hc(Kr(i.readTime)),bundledQuery:i.bundledQuery}})(t))}}function o_(n){return Zn(n,Af)}function l_(n){return Zn(n,jf)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new Lf(e,r)}getOverlay(e,t){return Vu(e).get(i_(this.userId,t)).next((r=>r?bx(this.serializer,r):null))}getOverlays(e,t){const r=ta();return te.forEach(t,(i=>this.getOverlay(e,i).next((l=>{l!==null&&r.set(i,l)})))).next((()=>r))}saveOverlays(e,t,r){const i=[];return r.forEach(((l,c)=>{const u=new m0(t,c);i.push(this.St(e,u))})),te.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach((c=>i.add(Cr(c.getCollectionPath()))));const l=[];return i.forEach((c=>{const u=IDBKeyRange.bound([this.userId,c,r],[this.userId,c,r+1],!1,!0);l.push(Vu(e).Z(oy,u))})),te.waitFor(l)}getOverlaysForCollection(e,t,r){const i=ta(),l=Cr(t),c=IDBKeyRange.bound([this.userId,l,r],[this.userId,l,Number.POSITIVE_INFINITY],!0);return Vu(e).J(oy,c).next((u=>{for(const p of u){const g=bx(this.serializer,p);i.set(g.getKey(),g)}return i}))}getOverlaysForCollectionGroup(e,t,r,i){const l=ta();let c;const u=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Vu(e).ee({index:i1,range:u},((p,g,b)=>{const w=bx(this.serializer,g);l.size()<i||w.largestBatchId===c?(l.set(w.getKey(),w),c=w.largestBatchId):b.done()})).next((()=>l))}St(e,t){return Vu(e).put((function(i,l,c){const[u,p,g]=i_(l,c.mutation.key);return{userId:l,collectionPath:p,documentId:g,collectionGroup:c.mutation.key.getCollectionGroup(),largestBatchId:c.largestBatchId,overlayMutation:rf(i.yt,c.mutation)}})(this.serializer,this.userId,t))}}function Vu(n){return Zn(n,kf)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OP{bt(e){return Zn(e,s0)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const r=t==null?void 0:t.value;return r?Wn.fromUint8Array(r):Wn.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gl{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(vn(e.integerValue));else if("doubleValue"in e){const r=vn(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Th(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=Ka(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Qa(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?x1(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Rf(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):Qe(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const i of Object.keys(r))this.Ot(i,t),this.Ct(r[i],t)}kt(e,t){var c,u;const r=e.fields||{};this.Ft(t,53);const i=Cd,l=((u=(c=r[i].arrayValue)==null?void 0:c.values)==null?void 0:u.length)||0;this.Ft(t,15),t.Mt(vn(l)),this.Ot(i,t),this.Ct(r[i],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const i of r)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),Oe.fromName(e).path.forEach((r=>{this.Ft(t,60),this.Ut(r,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Gl.Kt=new Gl;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const od=255;function MP(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function c_(n){const e=64-(function(r){let i=0;for(let l=0;l<8;++l){const c=MP(255&r[l]);if(i+=c,c!==8)break}return i})(n);return Math.ceil(e/8)}class VP{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const i=t.codePointAt(0);this.Gt(240|i>>>18),this.Gt(128|63&i>>>12),this.Gt(128|63&i>>>6),this.Gt(128|63&i)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const i=t.codePointAt(0);this.Jt(240|i>>>18),this.Jt(128|63&i>>>12),this.Jt(128|63&i>>>6),this.Jt(128|63&i)}}this.Ht()}Xt(e){const t=this.en(e),r=c_(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}nn(e){const t=this.en(e),r=c_(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}rn(){this.sn(od),this.sn(255)}_n(){this.an(od),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(l){const c=new DataView(new ArrayBuffer(8));return c.setFloat64(0,l,!1),new Uint8Array(c.buffer)})(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===od?(this.sn(od),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===od?(this.an(od),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class LP{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class $P{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Lu{constructor(){this.cn=new VP,this.ln=new LP(this.cn),this.hn=new $P(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kl{constructor(e,t,r,i){this.Tn=e,this.In=t,this.En=r,this.dn=i}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new Kl(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:Rp(this.En),directionalValue:Rp(this.dn),orderedDocumentKey:Rp(t),documentKey:r.path.toArray()}}Vn(e,t,r){const i=this.Rn(e,t,r);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}}function Co(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=d_(n.En,e.En),t!==0?t:(t=d_(n.dn,e.dn),t!==0?t:Oe.comparator(n.In,e.In)))}function d_(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function Rp(n){return GN()?(function(t){let r="";for(let i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return r})(n):n}function u_(n){return typeof n!="string"?n:(function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(n)}class h_{constructor(e){this.mn=new tn(((t,r)=>In.comparator(t.field,r.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(rt(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=sy(e);if(t!==void 0&&!this.wn(t))return!1;const r=Ul(e);let i=new Set,l=0,c=0;for(;l<r.length&&this.wn(r[l]);++l)i=i.add(r[l].fieldPath.canonicalString());if(l===r.length)return!0;if(this.mn.size>0){const u=this.mn.getIterator().getNext();if(!i.has(u.field.canonicalString())){const p=r[l];if(!this.Sn(u,p)||!this.bn(this.fn[c++],p))return!1}++l}for(;l<r.length;++l){const u=r[l];if(c>=this.fn.length||!this.bn(this.fn[c++],u))return!1}return!0}Dn(){if(this.pn)return null;let e=new tn(In.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Ip(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ip(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ip(r.field,r.dir==="asc"?0:1)));return new Kp(Kp.UNKNOWN_ID,this.collectionId,t,Eh.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iE(n){var t,r;if(rt(n instanceof Pt||n instanceof en,20012),n instanceof Pt){if(n instanceof T1){const i=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map((l=>Pt.create(n.field,"==",l))))||[];return en.create(i,"or")}return n}const e=n.filters.map((i=>iE(i)));return en.create(e,n.op)}function FP(n){if(n.getFilters().length===0)return[];const e=_y(iE(n));return rt(aE(e),7391),by(e)||wy(e)?[e]:e.getFilters()}function by(n){return n instanceof Pt}function wy(n){return n instanceof en&&c0(n)}function aE(n){return by(n)||wy(n)||(function(t){if(t instanceof en&&uy(t)){for(const r of t.getFilters())if(!by(r)&&!wy(r))return!1;return!0}return!1})(n)}function _y(n){if(rt(n instanceof Pt||n instanceof en,34018),n instanceof Pt)return n;if(n.filters.length===1)return _y(n.filters[0]);const e=n.filters.map((r=>_y(r)));let t=en.create(e,n.op);return t=af(t),aE(t)?t:(rt(t instanceof en,64498),rt(Pd(t),40251),rt(t.filters.length>1,57927),t.filters.reduce(((r,i)=>g0(r,i))))}function g0(n,e){let t;return rt(n instanceof Pt||n instanceof en,38388),rt(e instanceof Pt||e instanceof en,25473),t=n instanceof Pt?e instanceof Pt?(function(i,l){return en.create([i,l],"and")})(n,e):m_(n,e):e instanceof Pt?m_(e,n):(function(i,l){if(rt(i.filters.length>0&&l.filters.length>0,48005),Pd(i)&&Pd(l))return N1(i,l.getFilters());const c=uy(i)?i:l,u=uy(i)?l:i,p=c.filters.map((g=>g0(g,u)));return en.create(p,"or")})(n,e),af(t)}function m_(n,e){if(Pd(e))return N1(e,n.getFilters());{const t=e.filters.map((r=>g0(n,r)));return en.create(t,"or")}}function af(n){if(rt(n instanceof Pt||n instanceof en,11850),n instanceof Pt)return n;const e=n.getFilters();if(e.length===1)return af(e[0]);if(w1(n))return n;const t=e.map((i=>af(i))),r=[];return t.forEach((i=>{i instanceof Pt?r.push(i):i instanceof en&&(i.op===n.op?r.push(...i.filters):r.push(i))})),r.length===1?r[0]:en.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BP{constructor(){this.Cn=new x0}addToCollectionParentIndex(e,t){return this.Cn.add(t),te.resolve()}getCollectionParents(e,t){return te.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return te.resolve()}deleteFieldIndex(e,t){return te.resolve()}deleteAllFieldIndexes(e){return te.resolve()}createTargetIndexes(e,t){return te.resolve()}getDocumentsMatchingTarget(e,t){return te.resolve(null)}getIndexType(e,t){return te.resolve(0)}getFieldIndexes(e,t){return te.resolve([])}getNextCollectionGroupToUpdate(e){return te.resolve(null)}getMinOffset(e,t){return te.resolve(Vs.min())}getMinOffsetFromCollectionGroup(e,t){return te.resolve(Vs.min())}updateCollectionGroup(e,t,r){return te.resolve()}updateIndexEntries(e,t){return te.resolve()}}class x0{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new tn(Wt.comparator),l=!i.has(r);return this.index[t]=i.add(r),l}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new tn(Wt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p_="IndexedDbIndexManager",lp=new Uint8Array(0);class UP{constructor(e,t){this.databaseId=t,this.vn=new x0,this.Fn=new Ja((r=>dc(r)),((r,i)=>Hh(r,i))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const l={collectionId:r,parent:Cr(i)};return f_(e).put(l)}return te.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[GI(t),""],!1,!0);return f_(e).J(i).next((l=>{for(const c of l){if(c.collectionId!==t)break;r.push(ea(c.parent))}return r}))}addFieldIndex(e,t){const r=$u(e),i=(function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map((p=>[p.fieldPath.canonicalString(),p.kind]))}})(t);delete i.indexId;const l=r.add(i);if(t.indexState){const c=cd(e);return l.next((u=>{c.put(a_(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return l.next()}deleteFieldIndex(e,t){const r=$u(e),i=cd(e),l=ld(e);return r.delete(t.indexId).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>l.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=$u(e),r=ld(e),i=cd(e);return t.Z().next((()=>r.Z())).next((()=>i.Z()))}createTargetIndexes(e,t){return te.forEach(this.Mn(t),(r=>this.getIndexType(e,r).next((i=>{if(i===0||i===1){const l=new h_(r).Dn();if(l!=null)return this.addFieldIndex(e,l)}}))))}getDocumentsMatchingTarget(e,t){const r=ld(e);let i=!0;const l=new Map;return te.forEach(this.Mn(t),(c=>this.xn(e,c).next((u=>{i&&(i=!!u),l.set(c,u)})))).next((()=>{if(i){let c=jt();const u=[];return te.forEach(l,((p,g)=>{Ae(p_,`Using index ${(function(J){return`id=${J.indexId}|cg=${J.collectionGroup}|f=${J.fields.map((he=>`${he.fieldPath}:${he.kind}`)).join(",")}`})(p)} to execute ${dc(t)}`);const b=(function(J,he){const j=sy(he);if(j===void 0)return null;for(const ce of tf(J,j.fieldPath))switch(ce.op){case"array-contains-any":return ce.value.arrayValue.values||[];case"array-contains":return[ce.value]}return null})(g,p),w=(function(J,he){const j=new Map;for(const ce of Ul(he))for(const D of tf(J,ce.fieldPath))switch(D.op){case"==":case"in":j.set(ce.fieldPath.canonicalString(),D.value);break;case"not-in":case"!=":return j.set(ce.fieldPath.canonicalString(),D.value),Array.from(j.values())}return null})(g,p),E=(function(J,he){const j=[];let ce=!0;for(const D of Ul(he)){const k=D.kind===0?Hw(J,D.fieldPath,J.startAt):Gw(J,D.fieldPath,J.startAt);j.push(k.value),ce&&(ce=k.inclusive)}return new Dd(j,ce)})(g,p),C=(function(J,he){const j=[];let ce=!0;for(const D of Ul(he)){const k=D.kind===0?Gw(J,D.fieldPath,J.endAt):Hw(J,D.fieldPath,J.endAt);j.push(k.value),ce&&(ce=k.inclusive)}return new Dd(j,ce)})(g,p),H=this.On(p,g,E),F=this.On(p,g,C),U=this.Nn(p,g,w),ae=this.Bn(p.indexId,b,H,E.inclusive,F,C.inclusive,U);return te.forEach(ae,(re=>r.Y(re,t.limit).next((J=>{J.forEach((he=>{const j=Oe.fromSegments(he.documentKey);c.has(j)||(c=c.add(j),u.push(j))}))}))))})).next((()=>u))}return te.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=FP(en.create(e.filters,"and")).map((r=>my(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,r,i,l,c,u){const p=(t!=null?t.length:1)*Math.max(r.length,l.length),g=p/(t!=null?t.length:1),b=[];for(let w=0;w<p;++w){const E=t?this.Ln(t[w/g]):lp,C=this.kn(e,E,r[w%g],i),H=this.qn(e,E,l[w%g],c),F=u.map((U=>this.kn(e,E,U,!0)));b.push(...this.createRange(C,H,F))}return b}kn(e,t,r,i){const l=new Kl(e,Oe.empty(),t,r);return i?l:l.An()}qn(e,t,r,i){const l=new Kl(e,Oe.empty(),t,r);return i?l.An():l}xn(e,t){const r=new h_(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next((l=>{let c=null;for(const u of l)r.yn(u)&&(!c||u.fields.length>c.fields.length)&&(c=u);return c}))}getIndexType(e,t){let r=2;const i=this.Mn(t);return te.forEach(i,(l=>this.xn(e,l).next((c=>{c?r!==0&&c.fields.length<(function(p){let g=new tn(In.comparator),b=!1;for(const w of p.filters)for(const E of w.getFlattenedFilters())E.field.isKeyField()||(E.op==="array-contains"||E.op==="array-contains-any"?b=!0:g=g.add(E.field));for(const w of p.orderBy)w.field.isKeyField()||(g=g.add(w.field));return g.size+(b?1:0)})(l)&&(r=1):r=0})))).next((()=>(function(c){return c.limit!==null})(t)&&i.length>1&&r===2?1:r))}Qn(e,t){const r=new Lu;for(const i of Ul(e)){const l=t.data.field(i.fieldPath);if(l==null)return null;const c=r.Pn(i.kind);Gl.Kt.Dt(l,c)}return r.un()}Ln(e){const t=new Lu;return Gl.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new Lu;return Gl.Kt.Dt(Rh(this.databaseId,t),r.Pn((function(l){const c=Ul(l);return c.length===0?0:c[c.length-1].kind})(e))),r.un()}Nn(e,t,r){if(r===null)return[];let i=[];i.push(new Lu);let l=0;for(const c of Ul(e)){const u=r[l++];for(const p of i)if(this.Un(t,c.fieldPath)&&Dh(u))i=this.Kn(i,c,u);else{const g=p.Pn(c.kind);Gl.Kt.Dt(u,g)}}return this.Wn(i)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const i=[...e],l=[];for(const c of r.arrayValue.values||[])for(const u of i){const p=new Lu;p.seed(u.un()),Gl.Kt.Dt(c,p.Pn(t.kind)),l.push(p)}return l}Un(e,t){return!!e.filters.find((r=>r instanceof Pt&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in")))}getFieldIndexes(e,t){const r=$u(e),i=cd(e);return(t?r.J(ay,IDBKeyRange.bound(t,t)):r.J()).next((l=>{const c=[];return te.forEach(l,(u=>i.get([u.indexId,this.uid]).next((p=>{c.push((function(b,w){const E=w?new Eh(w.sequenceNumber,new Vs(mc(w.readTime),new Oe(ea(w.documentKey)),w.largestBatchId)):Eh.empty(),C=b.fields.map((([H,F])=>new Ip(In.fromServerFormat(H),F)));return new Kp(b.indexId,b.collectionGroup,C,E)})(u,p))})))).next((()=>c))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((r,i)=>{const l=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return l!==0?l:yt(r.collectionGroup,i.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,r){const i=$u(e),l=cd(e);return this.Gn(e).next((c=>i.J(ay,IDBKeyRange.bound(t,t)).next((u=>te.forEach(u,(p=>l.put(a_(p.indexId,this.uid,c,r))))))))}updateIndexEntries(e,t){const r=new Map;return te.forEach(t,((i,l)=>{const c=r.get(i.collectionGroup);return(c?te.resolve(c):this.getFieldIndexes(e,i.collectionGroup)).next((u=>(r.set(i.collectionGroup,u),te.forEach(u,(p=>this.zn(e,i,p).next((g=>{const b=this.jn(l,p);return g.isEqual(b)?te.resolve():this.Jn(e,l,p,g,b)})))))))}))}Hn(e,t,r,i){return ld(e).put(i.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,i){return ld(e).delete(i.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const i=ld(e);let l=new tn(Co);return i.ee({index:s1,range:IDBKeyRange.only([r.indexId,this.uid,Rp(this.$n(r,t))])},((c,u)=>{l=l.add(new Kl(r.indexId,t,u_(u.arrayValue),u_(u.directionalValue)))})).next((()=>l))}jn(e,t){let r=new tn(Co);const i=this.Qn(t,e);if(i==null)return r;const l=sy(t);if(l!=null){const c=e.data.field(l.fieldPath);if(Dh(c))for(const u of c.arrayValue.values||[])r=r.add(new Kl(t.indexId,e.key,this.Ln(u),i))}else r=r.add(new Kl(t.indexId,e.key,lp,i));return r}Jn(e,t,r,i,l){Ae(p_,"Updating index entries for document '%s'",t.key);const c=[];return(function(p,g,b,w,E){const C=p.getIterator(),H=g.getIterator();let F=ad(C),U=ad(H);for(;F||U;){let ae=!1,re=!1;if(F&&U){const J=b(F,U);J<0?re=!0:J>0&&(ae=!0)}else F!=null?re=!0:ae=!0;ae?(w(U),U=ad(H)):re?(E(F),F=ad(C)):(F=ad(C),U=ad(H))}})(i,l,Co,(u=>{c.push(this.Hn(e,t,r,u))}),(u=>{c.push(this.Yn(e,t,r,u))})),te.waitFor(c)}Gn(e){let t=1;return cd(e).ee({index:r1,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((r,i,l)=>{l.done(),t=i.sequenceNumber+1})).next((()=>t))}createRange(e,t,r){r=r.sort(((c,u)=>Co(c,u))).filter(((c,u,p)=>!u||Co(c,p[u-1])!==0));const i=[];i.push(e);for(const c of r){const u=Co(c,e),p=Co(c,t);if(u===0)i[0]=e.An();else if(u>0&&p<0)i.push(c),i.push(c.An());else if(p>0)break}i.push(t);const l=[];for(let c=0;c<i.length;c+=2){if(this.Zn(i[c],i[c+1]))return[];const u=i[c].Vn(this.uid,lp,Oe.empty()),p=i[c+1].Vn(this.uid,lp,Oe.empty());l.push(IDBKeyRange.bound(u,p))}return l}Zn(e,t){return Co(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(g_)}getMinOffset(e,t){return te.mapArray(this.Mn(t),(r=>this.xn(e,r).next((i=>i||Qe(44426))))).next(g_)}}function f_(n){return Zn(n,jh)}function ld(n){return Zn(n,mh)}function $u(n){return Zn(n,r0)}function cd(n){return Zn(n,hh)}function g_(n){rt(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;e0(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Vs(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},oE=41943040;class Sr{static withCacheSize(e){return new Sr(e,Sr.DEFAULT_COLLECTION_PERCENTILE,Sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lE(n,e,t){const r=n.store(Mi),i=n.store(Sd),l=[],c=IDBKeyRange.only(t.batchId);let u=0;const p=r.ee({range:c},((b,w,E)=>(u++,E.delete())));l.push(p.next((()=>{rt(u===1,47070,{batchId:t.batchId})})));const g=[];for(const b of t.mutations){const w=e1(e,b.key.path,t.batchId);l.push(i.delete(w)),g.push(b.key)}return te.waitFor(l).next((()=>g))}function of(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Qe(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Sr.DEFAULT_COLLECTION_PERCENTILE=10,Sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Sr.DEFAULT=new Sr(oE,Sr.DEFAULT_COLLECTION_PERCENTILE,Sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Sr.DISABLED=new Sr(-1,0,0);class $f{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Xn={}}static wt(e,t,r,i){rt(e.uid!=="",64387);const l=e.isAuthenticated()?e.uid:"";return new $f(l,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ro(e).ee({index:Ql,range:r},((i,l,c)=>{t=!1,c.done()})).next((()=>t))}addMutationBatch(e,t,r,i){const l=fd(e),c=Ro(e);return c.add({}).next((u=>{rt(typeof u=="number",49019);const p=new u0(u,t,r,i),g=(function(C,H,F){const U=F.baseMutations.map((re=>rf(C.yt,re))),ae=F.mutations.map((re=>rf(C.yt,re)));return{userId:H,batchId:F.batchId,localWriteTimeMs:F.localWriteTime.toMillis(),baseMutations:U,mutations:ae}})(this.serializer,this.userId,p),b=[];let w=new tn(((E,C)=>yt(E.canonicalString(),C.canonicalString())));for(const E of i){const C=e1(this.userId,E.key.path,u);w=w.add(E.key.path.popLast()),b.push(c.put(g)),b.push(l.put(C,xD))}return w.forEach((E=>{b.push(this.indexManager.addToCollectionParentIndex(e,E))})),e.addOnCommittedListener((()=>{this.Xn[u]=p.keys()})),te.waitFor(b).next((()=>p))}))}lookupMutationBatch(e,t){return Ro(e).get(t).next((r=>r?(rt(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),Hl(this.serializer,r)):null))}er(e,t){return this.Xn[t]?te.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((r=>{if(r){const i=r.keys();return this.Xn[t]=i,i}return null}))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let l=null;return Ro(e).ee({index:Ql,range:i},((c,u,p)=>{u.userId===this.userId&&(rt(u.batchId>=r,47524,{tr:r}),l=Hl(this.serializer,u)),p.done()})).next((()=>l))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=Xl;return Ro(e).ee({index:Ql,range:t,reverse:!0},((i,l,c)=>{r=l.batchId,c.done()})).next((()=>r))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Xl],[this.userId,Number.POSITIVE_INFINITY]);return Ro(e).J(Ql,t).next((r=>r.map((i=>Hl(this.serializer,i)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Ep(this.userId,t.path),i=IDBKeyRange.lowerBound(r),l=[];return fd(e).ee({range:i},((c,u,p)=>{const[g,b,w]=c,E=ea(b);if(g===this.userId&&t.path.isEqual(E))return Ro(e).get(w).next((C=>{if(!C)throw Qe(61480,{nr:c,batchId:w});rt(C.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:C.userId,batchId:w}),l.push(Hl(this.serializer,C))}));p.done()})).next((()=>l))}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new tn(yt);const i=[];return t.forEach((l=>{const c=Ep(this.userId,l.path),u=IDBKeyRange.lowerBound(c),p=fd(e).ee({range:u},((g,b,w)=>{const[E,C,H]=g,F=ea(C);E===this.userId&&l.path.isEqual(F)?r=r.add(H):w.done()}));i.push(p)})),te.waitFor(i).next((()=>this.rr(e,r)))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,l=Ep(this.userId,r),c=IDBKeyRange.lowerBound(l);let u=new tn(yt);return fd(e).ee({range:c},((p,g,b)=>{const[w,E,C]=p,H=ea(E);w===this.userId&&r.isPrefixOf(H)?H.length===i&&(u=u.add(C)):b.done()})).next((()=>this.rr(e,u)))}rr(e,t){const r=[],i=[];return t.forEach((l=>{i.push(Ro(e).get(l).next((c=>{if(c===null)throw Qe(35274,{batchId:l});rt(c.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:c.userId,batchId:l}),r.push(Hl(this.serializer,c))})))})),te.waitFor(i).next((()=>r))}removeMutationBatch(e,t){return lE(e.le,this.userId,t).next((r=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),te.forEach(r,(i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return te.resolve();const r=IDBKeyRange.lowerBound((function(c){return[c]})(this.userId)),i=[];return fd(e).ee({range:r},((l,c,u)=>{if(l[0]===this.userId){const p=ea(l[1]);i.push(p)}else u.done()})).next((()=>{rt(i.length===0,56720,{sr:i.map((l=>l.canonicalString()))})}))}))}containsKey(e,t){return cE(e,this.userId,t)}_r(e){return dE(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:Xl,lastStreamToken:""}))}}function cE(n,e,t){const r=Ep(e,t.path),i=r[1],l=IDBKeyRange.lowerBound(r);let c=!1;return fd(n).ee({range:l,X:!0},((u,p,g)=>{const[b,w,E]=u;b===e&&w===i&&(c=!0),g.done()})).next((()=>c))}function Ro(n){return Zn(n,Mi)}function fd(n){return Zn(n,Sd)}function dE(n){return Zn(n,Sh)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new pc(0)}static cr(){return new pc(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zP{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const r=new pc(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>lt.fromTimestamp(new Zt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,r){return this.lr(e).next((i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.hr(e,i))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>dd(e).delete(t.targetId))).next((()=>this.lr(e))).next((r=>(rt(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r))))}removeTargets(e,t,r){let i=0;const l=[];return dd(e).ee(((c,u)=>{const p=Xu(u);p.sequenceNumber<=t&&r.get(p.targetId)===null&&(i++,l.push(this.removeTargetData(e,p)))})).next((()=>te.waitFor(l))).next((()=>i))}forEachTarget(e,t){return dd(e).ee(((r,i)=>{const l=Xu(i);t(l)}))}lr(e){return y_(e).get(Jp).next((t=>(rt(t!==null,2888),t)))}hr(e,t){return y_(e).put(Jp,t)}Pr(e,t){return dd(e).put(rE(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const r=dc(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let l=null;return dd(e).ee({range:i,index:n1},((c,u,p)=>{const g=Xu(u);Hh(t,g.target)&&(l=g,p.done())})).next((()=>l))}addMatchingKeys(e,t,r){const i=[],l=Fo(e);return t.forEach((c=>{const u=Cr(c.path);i.push(l.put({targetId:r,path:u})),i.push(this.referenceDelegate.addReference(e,r,c))})),te.waitFor(i)}removeMatchingKeys(e,t,r){const i=Fo(e);return te.forEach(t,(l=>{const c=Cr(l.path);return te.waitFor([i.delete([r,c]),this.referenceDelegate.removeReference(e,r,l)])}))}removeMatchingKeysForTargetId(e,t){const r=Fo(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Fo(e);let l=jt();return i.ee({range:r,X:!0},((c,u,p)=>{const g=ea(c[1]),b=new Oe(g);l=l.add(b)})).next((()=>l))}containsKey(e,t){const r=Cr(t.path),i=IDBKeyRange.bound([r],[GI(r)],!1,!0);let l=0;return Fo(e).ee({index:n0,X:!0,range:i},(([c,u],p,g)=>{c!==0&&(l++,g.done())})).next((()=>l>0))}At(e,t){return dd(e).get(t).next((r=>r?Xu(r):null))}}function dd(n){return Zn(n,Ad)}function y_(n){return Zn(n,Zl)}function Fo(n){return Zn(n,jd)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v_="LruGarbageCollector",qP=1048576;function b_([n,e],[t,r]){const i=yt(n,t);return i===0?yt(e,r):i}class WP{constructor(e){this.Ir=e,this.buffer=new tn(b_),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();b_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class uE{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ae(v_,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){nl(t)?Ae(v_,"Ignoring IndexedDB error during garbage collection: ",t):await _c(t)}await this.Vr(3e5)}))}}class HP{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return te.resolve(oi.ce);const r=new WP(t);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ae("LruGarbageCollector","Garbage collection skipped; disabled"),te.resolve(x_)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Ae("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),x_):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,l,c,u,p,g;const b=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((w=>(w>this.params.maximumSequenceNumbersToCollect?(Ae("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${w}`),i=this.params.maximumSequenceNumbersToCollect):i=w,c=Date.now(),this.nthSequenceNumber(e,i)))).next((w=>(r=w,u=Date.now(),this.removeTargets(e,r,t)))).next((w=>(l=w,p=Date.now(),this.removeOrphanedDocuments(e,r)))).next((w=>(g=Date.now(),ud()<=Dt.DEBUG&&Ae("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${c-b}ms
	Determined least recently used ${i} in `+(u-c)+`ms
	Removed ${l} targets in `+(p-u)+`ms
	Removed ${w} documents in `+(g-p)+`ms
Total Duration: ${g-b}ms`),te.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:l,documentsRemoved:w}))))}}function hE(n,e){return new HP(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GP{constructor(e,t){this.db=e,this.garbageCollector=hE(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((r,i)=>t(i)))}addReference(e,t,r){return cp(e,r)}removeReference(e,t,r){return cp(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return cp(e,t)}br(e,t){return(function(i,l){let c=!1;return dE(i).te((u=>cE(i,u,l).next((p=>(p&&(c=!0),te.resolve(!p)))))).next((()=>c))})(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let l=0;return this.Sr(e,((c,u)=>{if(u<=t){const p=this.br(e,c).next((g=>{if(!g)return l++,r.getEntry(e,c).next((()=>(r.removeEntry(c,lt.min()),Fo(e).delete((function(w){return[0,Cr(w.path)]})(c)))))}));i.push(p)}})).next((()=>te.waitFor(i))).next((()=>r.apply(e))).next((()=>l))}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return cp(e,t)}Sr(e,t){const r=Fo(e);let i,l=oi.ce;return r.ee({index:n0},(([c,u],{path:p,sequenceNumber:g})=>{c===0?(l!==oi.ce&&t(new Oe(ea(i)),l),l=g,i=p):l=oi.ce})).next((()=>{l!==oi.ce&&t(new Oe(ea(i)),l)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function cp(n,e){return Fo(n).put((function(r,i){return{targetId:0,path:Cr(r.path),sequenceNumber:i}})(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mE{constructor(){this.changes=new Ja((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Cn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?te.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return $l(e).put(r)}removeEntry(e,t,r){return $l(e).delete((function(l,c){const u=l.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],sf(c),u[u.length-1]]})(t,r))}updateMetadata(e,t){return this.getMetadata(e).next((r=>(r.byteSize+=t,this.Dr(e,r))))}getEntry(e,t){let r=Cn.newInvalidDocument(t);return $l(e).ee({index:Tp,range:IDBKeyRange.only(Fu(t))},((i,l)=>{r=this.Cr(t,l)})).next((()=>r))}vr(e,t){let r={size:0,document:Cn.newInvalidDocument(t)};return $l(e).ee({index:Tp,range:IDBKeyRange.only(Fu(t))},((i,l)=>{r={document:this.Cr(t,l),size:of(l)}})).next((()=>r))}getEntries(e,t){let r=Rs();return this.Fr(e,t,((i,l)=>{const c=this.Cr(i,l);r=r.insert(i,c)})).next((()=>r))}Mr(e,t){let r=Rs(),i=new bn(Oe.comparator);return this.Fr(e,t,((l,c)=>{const u=this.Cr(l,c);r=r.insert(l,u),i=i.insert(l,of(c))})).next((()=>({documents:r,Or:i})))}Fr(e,t,r){if(t.isEmpty())return te.resolve();let i=new tn(N_);t.forEach((p=>i=i.add(p)));const l=IDBKeyRange.bound(Fu(i.first()),Fu(i.last())),c=i.getIterator();let u=c.getNext();return $l(e).ee({index:Tp,range:l},((p,g,b)=>{const w=Oe.fromSegments([...g.prefixPath,g.collectionGroup,g.documentId]);for(;u&&N_(u,w)<0;)r(u,null),u=c.getNext();u&&u.isEqual(w)&&(r(u,g),u=c.hasNext()?c.getNext():null),u?b.j(Fu(u)):b.done()})).next((()=>{for(;u;)r(u,null),u=c.hasNext()?c.getNext():null}))}getDocumentsMatchingQuery(e,t,r,i,l){const c=t.path,u=[c.popLast().toArray(),c.lastSegment(),sf(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],p=[c.popLast().toArray(),c.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return $l(e).J(IDBKeyRange.bound(u,p,!0)).next((g=>{l==null||l.incrementDocumentReadCount(g.length);let b=Rs();for(const w of g){const E=this.Cr(Oe.fromSegments(w.prefixPath.concat(w.collectionGroup,w.documentId)),w);E.isFoundDocument()&&(Qh(t,E)||i.has(E.key))&&(b=b.insert(E.key,E))}return b}))}getAllFromCollectionGroup(e,t,r,i){let l=Rs();const c=__(t,r),u=__(t,Vs.max());return $l(e).ee({index:t1,range:IDBKeyRange.bound(c,u,!0)},((p,g,b)=>{const w=this.Cr(Oe.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);l=l.insert(w.key,w),l.size===i&&b.done()})).next((()=>l))}newChangeBuffer(e){return new QP(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return w_(e).get(iy).next((t=>(rt(!!t,20021),t)))}Dr(e,t){return w_(e).put(iy,t)}Cr(e,t){if(t){const r=DP(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(lt.min())))return r}return Cn.newInvalidDocument(e)}}function pE(n){return new KP(n)}class QP extends mE{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Ja((r=>r.toString()),((r,i)=>r.isEqual(i)))}applyChanges(e){const t=[];let r=0,i=new tn(((l,c)=>yt(l.canonicalString(),c.canonicalString())));return this.changes.forEach(((l,c)=>{const u=this.Br.get(l);if(t.push(this.Nr.removeEntry(e,l,u.readTime)),c.isValidDocument()){const p=s_(this.Nr.serializer,c);i=i.add(l.path.popLast());const g=of(p);r+=g-u.size,t.push(this.Nr.addEntry(e,l,p))}else if(r-=u.size,this.trackRemovals){const p=s_(this.Nr.serializer,c.convertToNoDocument(lt.min()));t.push(this.Nr.addEntry(e,l,p))}})),i.forEach((l=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,l))})),t.push(this.Nr.updateMetadata(e,r)),te.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:r,Or:i})=>(i.forEach(((l,c)=>{this.Br.set(l,{size:c,readTime:r.get(l).readTime})})),r)))}}function w_(n){return Zn(n,Ah)}function $l(n){return Zn(n,Yp)}function Fu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function __(n,e){const t=e.documentKey.path.toArray();return[n,sf(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function N_(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let l=0;l<t.length-2&&l<r.length-2;++l)if(i=yt(t[l],r[l]),i)return i;return i=yt(t.length,r.length),i||(i=yt(t[t.length-2],r[r.length-2]),i||yt(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YP{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fE{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(r!==null&&xh(r.mutation,i,ms.empty(),Zt.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,jt()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=jt()){const i=ta();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,r).next((l=>{let c=Yu();return l.forEach(((u,p)=>{c=c.insert(u,p.overlayedDocument)})),c}))))}getOverlayedDocuments(e,t){const r=ta();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,jt())))}populateOverlays(e,t,r){const i=[];return r.forEach((l=>{t.has(l)||i.push(l)})),this.documentOverlayCache.getOverlays(e,i).next((l=>{l.forEach(((c,u)=>{t.set(c,u)}))}))}computeViews(e,t,r,i){let l=Rs();const c=gh(),u=(function(){return gh()})();return t.forEach(((p,g)=>{const b=r.get(g.key);i.has(g.key)&&(b===void 0||b.mutation instanceof Xa)?l=l.insert(g.key,g):b!==void 0?(c.set(g.key,b.mutation.getFieldMask()),xh(b.mutation,g,b.mutation.getFieldMask(),Zt.now())):c.set(g.key,ms.empty())})),this.recalculateAndSaveOverlays(e,l).next((p=>(p.forEach(((g,b)=>c.set(g,b))),t.forEach(((g,b)=>u.set(g,new YP(b,c.get(g)??null)))),u)))}recalculateAndSaveOverlays(e,t){const r=gh();let i=new bn(((c,u)=>c-u)),l=jt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((c=>{for(const u of c)u.keys().forEach((p=>{const g=t.get(p);if(g===null)return;let b=r.get(p)||ms.empty();b=u.applyToLocalView(g,b),r.set(p,b);const w=(i.get(u.batchId)||jt()).add(p);i=i.insert(u.batchId,w)}))})).next((()=>{const c=[],u=i.getReverseIterator();for(;u.hasNext();){const p=u.getNext(),g=p.key,b=p.value,w=R1();b.forEach((E=>{if(!l.has(E)){const C=$1(t.get(E),r.get(E));C!==null&&w.set(E,C),l=l.add(E)}})),c.push(this.documentOverlayCache.saveOverlays(e,g,w))}return te.waitFor(c)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,i){return(function(c){return Oe.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):S1(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next((l=>{const c=i-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-l.size):te.resolve(ta());let u=Ih,p=l;return c.next((g=>te.forEach(g,((b,w)=>(u<w.largestBatchId&&(u=w.largestBatchId),l.get(b)?te.resolve():this.remoteDocumentCache.getEntry(e,b).next((E=>{p=p.insert(b,E)}))))).next((()=>this.populateOverlays(e,g,l))).next((()=>this.computeViews(e,p,g,jt()))).next((b=>({batchId:u,changes:C1(b)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Oe(t)).next((r=>{let i=Yu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const l=t.collectionGroup;let c=Yu();return this.indexManager.getCollectionParents(e,l).next((u=>te.forEach(u,(p=>{const g=(function(w,E){return new Gh(E,null,w.explicitOrderBy.slice(),w.filters.slice(),w.limit,w.limitType,w.startAt,w.endAt)})(t,p.child(l));return this.getDocumentsMatchingCollectionQuery(e,g,r,i).next((b=>{b.forEach(((w,E)=>{c=c.insert(w,E)}))}))})).next((()=>c))))}getDocumentsMatchingCollectionQuery(e,t,r,i){let l;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((c=>(l=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,l,i)))).next((c=>{l.forEach(((p,g)=>{const b=g.getKey();c.get(b)===null&&(c=c.insert(b,Cn.newInvalidDocument(b)))}));let u=Yu();return c.forEach(((p,g)=>{const b=l.get(p);b!==void 0&&xh(b.mutation,g,ms.empty(),Zt.now()),Qh(t,g)&&(u=u.insert(p,g))})),u}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return te.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Kr(i.createTime)}})(t)),te.resolve()}getNamedQuery(e,t){return te.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:sE(i.bundledQuery),readTime:Kr(i.readTime)}})(t)),te.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XP{constructor(){this.overlays=new bn(Oe.comparator),this.qr=new Map}getOverlay(e,t){return te.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ta();return te.forEach(t,(i=>this.getOverlay(e,i).next((l=>{l!==null&&r.set(i,l)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((i,l)=>{this.St(e,t,l)})),te.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((l=>this.overlays=this.overlays.remove(l))),this.qr.delete(r)),te.resolve()}getOverlaysForCollection(e,t,r){const i=ta(),l=t.length+1,c=new Oe(t.child("")),u=this.overlays.getIteratorFrom(c);for(;u.hasNext();){const p=u.getNext().value,g=p.getKey();if(!t.isPrefixOf(g.path))break;g.path.length===l&&p.largestBatchId>r&&i.set(p.getKey(),p)}return te.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let l=new bn(((g,b)=>g-b));const c=this.overlays.getIterator();for(;c.hasNext();){const g=c.getNext().value;if(g.getKey().getCollectionGroup()===t&&g.largestBatchId>r){let b=l.get(g.largestBatchId);b===null&&(b=ta(),l=l.insert(g.largestBatchId,b)),b.set(g.getKey(),g)}}const u=ta(),p=l.getIterator();for(;p.hasNext()&&(p.getNext().value.forEach(((g,b)=>u.set(g,b))),!(u.size()>=i)););return te.resolve(u)}St(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const c=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,c)}this.overlays=this.overlays.insert(r.key,new m0(t,r));let l=this.qr.get(t);l===void 0&&(l=jt(),this.qr.set(t,l)),this.qr.set(t,l.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZP{constructor(){this.sessionToken=Wn.EMPTY_BYTE_STRING}getSessionToken(e){return te.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,te.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(){this.Qr=new tn(ir.$r),this.Ur=new tn(ir.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new ir(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new ir(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new Oe(new Wt([])),r=new ir(t,e),i=new ir(t,e+1),l=[];return this.Ur.forEachInRange([r,i],(c=>{this.Gr(c),l.push(c.key)})),l}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Oe(new Wt([])),r=new ir(t,e),i=new ir(t,e+1);let l=jt();return this.Ur.forEachInRange([r,i],(c=>{l=l.add(c.key)})),l}containsKey(e){const t=new ir(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class ir{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Oe.comparator(e.key,t.key)||yt(e.Yr,t.Yr)}static Kr(e,t){return yt(e.Yr,t.Yr)||Oe.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new tn(ir.$r)}checkEmpty(e){return te.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const l=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const c=new u0(l,t,r,i);this.mutationQueue.push(c);for(const u of i)this.Zr=this.Zr.add(new ir(u.key,l)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return te.resolve(c)}lookupMutationBatch(e,t){return te.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.ei(r),l=i<0?0:i;return te.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return te.resolve(this.mutationQueue.length===0?Xl:this.tr-1)}getAllMutationBatches(e){return te.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ir(t,0),i=new ir(t,Number.POSITIVE_INFINITY),l=[];return this.Zr.forEachInRange([r,i],(c=>{const u=this.Xr(c.Yr);l.push(u)})),te.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new tn(yt);return t.forEach((i=>{const l=new ir(i,0),c=new ir(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([l,c],(u=>{r=r.add(u.Yr)}))})),te.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let l=r;Oe.isDocumentKey(l)||(l=l.child(""));const c=new ir(new Oe(l),0);let u=new tn(yt);return this.Zr.forEachWhile((p=>{const g=p.key.path;return!!r.isPrefixOf(g)&&(g.length===i&&(u=u.add(p.Yr)),!0)}),c),te.resolve(this.ti(u))}ti(e){const t=[];return e.forEach((r=>{const i=this.Xr(r);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){rt(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return te.forEach(t.mutations,(i=>{const l=new ir(i.key,t.batchId);return r=r.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new ir(t,0),i=this.Zr.firstAfterOrEqual(r);return te.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,te.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t4{constructor(e){this.ri=e,this.docs=(function(){return new bn(Oe.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),l=i?i.size:0,c=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:c}),this.size+=c-l,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return te.resolve(r?r.document.mutableCopy():Cn.newInvalidDocument(t))}getEntries(e,t){let r=Rs();return t.forEach((i=>{const l=this.docs.get(i);r=r.insert(i,l?l.document.mutableCopy():Cn.newInvalidDocument(i))})),te.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let l=Rs();const c=t.path,u=new Oe(c.child("__id-9223372036854775808__")),p=this.docs.getIteratorFrom(u);for(;p.hasNext();){const{key:g,value:{document:b}}=p.getNext();if(!c.isPrefixOf(g.path))break;g.path.length>c.length+1||e0(YI(b),r)<=0||(i.has(b.key)||Qh(t,b))&&(l=l.insert(b.key,b.mutableCopy()))}return te.resolve(l)}getAllFromCollectionGroup(e,t,r,i){Qe(9500)}ii(e,t){return te.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new n4(this)}getSize(e){return te.resolve(this.size)}}class n4 extends mE{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),te.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r4{constructor(e){this.persistence=e,this.si=new Ja((t=>dc(t)),Hh),this.lastRemoteSnapshotVersion=lt.min(),this.highestTargetId=0,this.oi=0,this._i=new y0,this.targetCount=0,this.ai=pc.ur()}forEachTarget(e,t){return this.si.forEach(((r,i)=>t(i))),te.resolve()}getLastRemoteSnapshotVersion(e){return te.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return te.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),te.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),te.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new pc(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,te.resolve()}updateTargetData(e,t){return this.Pr(t),te.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,te.resolve()}removeTargets(e,t,r){let i=0;const l=[];return this.si.forEach(((c,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.si.delete(c),l.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)})),te.waitFor(l).next((()=>i))}getTargetCount(e){return te.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return te.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),te.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const i=this.persistence.referenceDelegate,l=[];return i&&t.forEach((c=>{l.push(i.markPotentiallyOrphaned(e,c))})),te.waitFor(l)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),te.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return te.resolve(r)}containsKey(e,t){return te.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v0{constructor(e,t){this.ui={},this.overlays={},this.ci=new oi(0),this.li=!1,this.li=!0,this.hi=new ZP,this.referenceDelegate=e(this),this.Pi=new r4(this),this.indexManager=new BP,this.remoteDocumentCache=(function(i){return new t4(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new nE(t),this.Ii=new JP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new XP,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new e4(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){Ae("MemoryPersistence","Starting transaction:",e);const i=new s4(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((l=>this.referenceDelegate.di(i).next((()=>l)))).toPromise().then((l=>(i.raiseOnCommittedEvent(),l)))}Ai(e,t){return te.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class s4 extends XI{constructor(e){super(),this.currentSequenceNumber=e}}class Ff{constructor(e){this.persistence=e,this.Ri=new y0,this.Vi=null}static mi(e){return new Ff(e)}get fi(){if(this.Vi)return this.Vi;throw Qe(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),te.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),te.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),te.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((l=>this.fi.add(l.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return te.forEach(this.fi,(r=>{const i=Oe.fromPath(r);return this.gi(e,i).next((l=>{l||t.removeEntry(i,lt.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return te.or([()=>te.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class lf{constructor(e,t){this.persistence=e,this.pi=new Ja((r=>Cr(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=hE(this,t)}static mi(e,t){return new lf(e,t)}Ei(){}di(e){return te.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return te.forEach(this.pi,((r,i)=>this.br(e,r,i).next((l=>l?te.resolve():t(i)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),l=i.newChangeBuffer();return i.ii(e,(c=>this.br(e,c,t).next((u=>{u||(r++,l.removeEntry(c,lt.min()))})))).next((()=>l.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),te.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),te.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),te.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),te.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ap(e.data.value)),t}br(e,t,r){return te.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return te.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i4{constructor(e){this.serializer=e}k(e,t,r,i){const l=new Tf("createOrUpgrade",t);r<1&&i>=1&&((function(p){p.createObjectStore(Wh)})(e),(function(p){p.createObjectStore(Sh,{keyPath:gD}),p.createObjectStore(Mi,{keyPath:Pw,autoIncrement:!0}).createIndex(Ql,Ow,{unique:!0}),p.createObjectStore(Sd)})(e),I_(e),(function(p){p.createObjectStore(zl)})(e));let c=te.resolve();return r<3&&i>=3&&(r!==0&&((function(p){p.deleteObjectStore(jd),p.deleteObjectStore(Ad),p.deleteObjectStore(Zl)})(e),I_(e)),c=c.next((()=>(function(p){const g=p.store(Zl),b={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:lt.min().toTimestamp(),targetCount:0};return g.put(Jp,b)})(l)))),r<4&&i>=4&&(r!==0&&(c=c.next((()=>(function(p,g){return g.store(Mi).J().next((w=>{p.deleteObjectStore(Mi),p.createObjectStore(Mi,{keyPath:Pw,autoIncrement:!0}).createIndex(Ql,Ow,{unique:!0});const E=g.store(Mi),C=w.map((H=>E.put(H)));return te.waitFor(C)}))})(e,l)))),c=c.next((()=>{(function(p){p.createObjectStore(kd,{keyPath:ED})})(e)}))),r<5&&i>=5&&(c=c.next((()=>this.yi(l)))),r<6&&i>=6&&(c=c.next((()=>((function(p){p.createObjectStore(Ah)})(e),this.wi(l))))),r<7&&i>=7&&(c=c.next((()=>this.Si(l)))),r<8&&i>=8&&(c=c.next((()=>this.bi(e,l)))),r<9&&i>=9&&(c=c.next((()=>{(function(p){p.objectStoreNames.contains("remoteDocumentChanges")&&p.deleteObjectStore("remoteDocumentChanges")})(e)}))),r<10&&i>=10&&(c=c.next((()=>this.Di(l)))),r<11&&i>=11&&(c=c.next((()=>{(function(p){p.createObjectStore(Af,{keyPath:TD})})(e),(function(p){p.createObjectStore(jf,{keyPath:SD})})(e)}))),r<12&&i>=12&&(c=c.next((()=>{(function(p){const g=p.createObjectStore(kf,{keyPath:PD});g.createIndex(oy,OD,{unique:!1}),g.createIndex(i1,MD,{unique:!1})})(e)}))),r<13&&i>=13&&(c=c.next((()=>(function(p){const g=p.createObjectStore(Yp,{keyPath:yD});g.createIndex(Tp,vD),g.createIndex(t1,bD)})(e))).next((()=>this.Ci(e,l))).next((()=>e.deleteObjectStore(zl)))),r<14&&i>=14&&(c=c.next((()=>this.Fi(e,l)))),r<15&&i>=15&&(c=c.next((()=>(function(p){p.createObjectStore(r0,{keyPath:AD,autoIncrement:!0}).createIndex(ay,jD,{unique:!1}),p.createObjectStore(hh,{keyPath:kD}).createIndex(r1,CD,{unique:!1}),p.createObjectStore(mh,{keyPath:RD}).createIndex(s1,DD,{unique:!1})})(e)))),r<16&&i>=16&&(c=c.next((()=>{t.objectStore(hh).clear()})).next((()=>{t.objectStore(mh).clear()}))),r<17&&i>=17&&(c=c.next((()=>{(function(p){p.createObjectStore(s0,{keyPath:VD})})(e)}))),r<18&&i>=18&&GN()&&(c=c.next((()=>{t.objectStore(hh).clear()})).next((()=>{t.objectStore(mh).clear()}))),c}wi(e){let t=0;return e.store(zl).ee(((r,i)=>{t+=of(i)})).next((()=>{const r={byteSize:t};return e.store(Ah).put(iy,r)}))}yi(e){const t=e.store(Sh),r=e.store(Mi);return t.J().next((i=>te.forEach(i,(l=>{const c=IDBKeyRange.bound([l.userId,Xl],[l.userId,l.lastAcknowledgedBatchId]);return r.J(Ql,c).next((u=>te.forEach(u,(p=>{rt(p.userId===l.userId,18650,"Cannot process batch from unexpected user",{batchId:p.batchId});const g=Hl(this.serializer,p);return lE(e,l.userId,g).next((()=>{}))}))))}))))}Si(e){const t=e.store(jd),r=e.store(zl);return e.store(Zl).get(Jp).next((i=>{const l=[];return r.ee(((c,u)=>{const p=new Wt(c),g=(function(w){return[0,Cr(w)]})(p);l.push(t.get(g).next((b=>b?te.resolve():(w=>t.put({targetId:0,path:Cr(w),sequenceNumber:i.highestListenSequenceNumber}))(p))))})).next((()=>te.waitFor(l)))}))}bi(e,t){e.createObjectStore(jh,{keyPath:ID});const r=t.store(jh),i=new x0,l=c=>{if(i.add(c)){const u=c.lastSegment(),p=c.popLast();return r.put({collectionId:u,parent:Cr(p)})}};return t.store(zl).ee({X:!0},((c,u)=>{const p=new Wt(c);return l(p.popLast())})).next((()=>t.store(Sd).ee({X:!0},(([c,u,p],g)=>{const b=ea(u);return l(b.popLast())}))))}Di(e){const t=e.store(Ad);return t.ee(((r,i)=>{const l=Xu(i),c=rE(this.serializer,l);return t.put(c)}))}Ci(e,t){const r=t.store(zl),i=[];return r.ee(((l,c)=>{const u=t.store(Yp),p=(function(w){return w.document?new Oe(Wt.fromString(w.document.name).popFirst(5)):w.noDocument?Oe.fromSegments(w.noDocument.path):w.unknownDocument?Oe.fromSegments(w.unknownDocument.path):Qe(36783)})(c).path.toArray(),g={prefixPath:p.slice(0,p.length-2),collectionGroup:p[p.length-2],documentId:p[p.length-1],readTime:c.readTime||[0,0],unknownDocument:c.unknownDocument,noDocument:c.noDocument,document:c.document,hasCommittedMutations:!!c.hasCommittedMutations};i.push(u.put(g))})).next((()=>te.waitFor(i)))}Fi(e,t){const r=t.store(Mi),i=pE(this.serializer),l=new v0(Ff.mi,this.serializer.yt);return r.J().next((c=>{const u=new Map;return c.forEach((p=>{let g=u.get(p.userId)??jt();Hl(this.serializer,p).keys().forEach((b=>g=g.add(b))),u.set(p.userId,g)})),te.forEach(u,((p,g)=>{const b=new gr(g),w=Lf.wt(this.serializer,b),E=l.getIndexManager(b),C=$f.wt(b,this.serializer,E,l.referenceDelegate);return new fE(i,C,w,E).recalculateAndSaveOverlaysForDocumentKeys(new ly(t,oi.ce),p).next()}))}))}}function I_(n){n.createObjectStore(jd,{keyPath:_D}).createIndex(n0,ND,{unique:!0}),n.createObjectStore(Ad,{keyPath:"targetId"}).createIndex(n1,wD,{unique:!0}),n.createObjectStore(Zl)}const Do="IndexedDbPersistence",wx=18e5,_x=5e3,Nx="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",a4="main";class b0{constructor(e,t,r,i,l,c,u,p,g,b,w=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=l,this.window=c,this.document=u,this.xi=g,this.Oi=b,this.Ni=w,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=E=>Promise.resolve(),!b0.v())throw new Pe(ye.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new GP(this,i),this.$i=t+a4,this.serializer=new nE(p),this.Ui=new Ho(this.$i,this.Ni,new i4(this.serializer)),this.hi=new OP,this.Pi=new zP(this.referenceDelegate,this.serializer),this.remoteDocumentCache=pE(this.serializer),this.Ii=new PP,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,b===!1&&Hr(Do,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Pe(ye.FAILED_PRECONDITION,Nx);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new oi(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>dp(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(nl(e))return Ae(Do,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Ae(Do,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return Bu(e).get(id).next((t=>te.resolve(this.es(t))))}ts(e){return dp(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,wx)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const r=Zn(t,kd);return r.J().next((i=>{const l=this.ss(i,wx),c=i.filter((u=>l.indexOf(u)===-1));return te.forEach(c,(u=>r.delete(u.clientId))).next((()=>c))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?te.resolve(!0):Bu(e).get(id).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,_x)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new Pe(ye.FAILED_PRECONDITION,Nx);return!1}}return!(!this.networkEnabled||!this.inForeground)||dp(e).J().next((r=>this.ss(r,_x).find((i=>{if(this.clientId!==i.clientId){const l=!this.networkEnabled&&i.networkEnabled,c=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(l||c&&u)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&Ae(Do,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Wh,kd],(e=>{const t=new ly(e,oi.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>dp(e).J().next((t=>this.ss(t,wx).map((r=>r.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return $f.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new UP(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Lf.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){Ae(Do,"Starting transaction:",e);const i=t==="readonly"?"readonly":"readwrite",l=(function(p){return p===18?FD:p===17?c1:p===16?$D:p===15?i0:p===14?l1:p===13?o1:p===12?LD:p===11?a1:void Qe(60245)})(this.Ni);let c;return this.Ui.runTransaction(e,i,l,(u=>(c=new ly(u,this.ci?this.ci.next():oi.ce),t==="readwrite-primary"?this.Hi(c).next((p=>!!p||this.Yi(c))).next((p=>{if(!p)throw Hr(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new Pe(ye.FAILED_PRECONDITION,JI);return r(c)})).next((p=>this.Xi(c).next((()=>p)))):this.Is(c).next((()=>r(c)))))).then((u=>(c.raiseOnCommittedEvent(),u)))}Is(e){return Bu(e).get(id).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,_x)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Pe(ye.FAILED_PRECONDITION,Nx)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Bu(e).put(id,t)}static v(){return Ho.v()}Zi(e){const t=Bu(e);return t.get(id).next((r=>this.es(r)?(Ae(Do,"Releasing primary lease."),t.delete(id)):te.resolve()))}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Hr(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;HN()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return Ae(Do,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Hr(Do,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Hr("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Bu(n){return Zn(n,Wh)}function dp(n){return Zn(n,kd)}function o4(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=jt(),i=jt();for(const l of t.docChanges)switch(l.type){case 0:r=r.add(l.doc.key);break;case 1:i=i.add(l.doc.key)}return new w0(e,t.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l4{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return HN()?8:ZI(Xn())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){const l={result:null};return this.ys(e,t).next((c=>{l.result=c})).next((()=>{if(!l.result)return this.ws(e,t,i,r).next((c=>{l.result=c}))})).next((()=>{if(l.result)return;const c=new l4;return this.Ss(e,t,c).next((u=>{if(l.result=u,this.Vs)return this.bs(e,t,c,u.size)}))})).next((()=>l.result))}bs(e,t,r,i){return r.documentReadCount<this.fs?(ud()<=Dt.DEBUG&&Ae("QueryEngine","SDK will not create cache indexes for query:",hd(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),te.resolve()):(ud()<=Dt.DEBUG&&Ae("QueryEngine","Query:",hd(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(ud()<=Dt.DEBUG&&Ae("QueryEngine","The SDK decides to create cache indexes for query:",hd(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ci(t))):te.resolve())}ys(e,t){if(Kw(t))return te.resolve(null);let r=ci(t);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=fy(t,null,"F"),r=ci(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((l=>{const c=jt(...l);return this.ps.getDocuments(e,c).next((u=>this.indexManager.getMinOffset(e,r).next((p=>{const g=this.Ds(t,u);return this.Cs(t,g,c,p.readTime)?this.ys(e,fy(t,null,"F")):this.vs(e,g,t,p)}))))})))))}ws(e,t,r,i){return Kw(t)||i.isEqual(lt.min())?te.resolve(null):this.ps.getDocuments(e,r).next((l=>{const c=this.Ds(t,l);return this.Cs(t,c,r,i)?te.resolve(null):(ud()<=Dt.DEBUG&&Ae("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),hd(t)),this.vs(e,c,t,cD(i,Ih)).next((u=>u)))}))}Ds(e,t){let r=new tn(j1(e));return t.forEach(((i,l)=>{Qh(e,l)&&(r=r.add(l))})),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const l=e.limitType==="F"?t.last():t.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(i)>0)}Ss(e,t,r){return ud()<=Dt.DEBUG&&Ae("QueryEngine","Using full collection scan to execute query:",hd(t)),this.ps.getDocumentsMatchingQuery(e,t,Vs.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((l=>(t.forEach((c=>{l=l.insert(c.key,c)})),l)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _0="LocalStore",c4=3e8;class d4{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new bn(yt),this.xs=new Ja((l=>dc(l)),Hh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new fE(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function xE(n,e,t,r){return new d4(n,e,t,r)}async function yE(n,e){const t=vt(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next((l=>(i=l,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((l=>{const c=[],u=[];let p=jt();for(const g of i){c.push(g.batchId);for(const b of g.mutations)p=p.add(b.key)}for(const g of l){u.push(g.batchId);for(const b of g.mutations)p=p.add(b.key)}return t.localDocuments.getDocuments(r,p).next((g=>({Ls:g,removedBatchIds:c,addedBatchIds:u})))}))}))}function u4(n,e){const t=vt(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=e.batch.keys(),l=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,p,g,b){const w=g.batch,E=w.keys();let C=te.resolve();return E.forEach((H=>{C=C.next((()=>b.getEntry(p,H))).next((F=>{const U=g.docVersions.get(H);rt(U!==null,48541),F.version.compareTo(U)<0&&(w.applyToRemoteDocument(F,g),F.isValidDocument()&&(F.setReadTime(g.commitVersion),b.addEntry(F)))}))})),C.next((()=>u.mutationQueue.removeMutationBatch(p,w)))})(t,r,e,l).next((()=>l.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let p=jt();for(let g=0;g<u.mutationResults.length;++g)u.mutationResults[g].transformResults.length>0&&(p=p.add(u.batch.mutations[g].key));return p})(e)))).next((()=>t.localDocuments.getDocuments(r,i)))}))}function vE(n){const e=vt(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function h4(n,e){const t=vt(n),r=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(l=>{const c=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const u=[];e.targetChanges.forEach(((b,w)=>{const E=i.get(w);if(!E)return;u.push(t.Pi.removeMatchingKeys(l,b.removedDocuments,w).next((()=>t.Pi.addMatchingKeys(l,b.addedDocuments,w))));let C=E.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(w)!==null?C=C.withResumeToken(Wn.EMPTY_BYTE_STRING,lt.min()).withLastLimboFreeSnapshotVersion(lt.min()):b.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(b.resumeToken,r)),i=i.insert(w,C),(function(F,U,ae){return F.resumeToken.approximateByteSize()===0||U.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=c4?!0:ae.addedDocuments.size+ae.modifiedDocuments.size+ae.removedDocuments.size>0})(E,C,b)&&u.push(t.Pi.updateTargetData(l,C))}));let p=Rs(),g=jt();if(e.documentUpdates.forEach((b=>{e.resolvedLimboDocuments.has(b)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(l,b))})),u.push(m4(l,c,e.documentUpdates).next((b=>{p=b.ks,g=b.qs}))),!r.isEqual(lt.min())){const b=t.Pi.getLastRemoteSnapshotVersion(l).next((w=>t.Pi.setTargetsMetadata(l,l.currentSequenceNumber,r)));u.push(b)}return te.waitFor(u).next((()=>c.apply(l))).next((()=>t.localDocuments.getLocalViewOfDocuments(l,p,g))).next((()=>p))})).then((l=>(t.Ms=i,l)))}function m4(n,e,t){let r=jt(),i=jt();return t.forEach((l=>r=r.add(l))),e.getEntries(n,r).next((l=>{let c=Rs();return t.forEach(((u,p)=>{const g=l.get(u);p.isFoundDocument()!==g.isFoundDocument()&&(i=i.add(u)),p.isNoDocument()&&p.version.isEqual(lt.min())?(e.removeEntry(u,p.readTime),c=c.insert(u,p)):!g.isValidDocument()||p.version.compareTo(g.version)>0||p.version.compareTo(g.version)===0&&g.hasPendingWrites?(e.addEntry(p),c=c.insert(u,p)):Ae(_0,"Ignoring outdated watch update for ",u,". Current version:",g.version," Watch version:",p.version)})),{ks:c,qs:i}}))}function p4(n,e){const t=vt(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Xl),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function f4(n,e){const t=vt(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return t.Pi.getTargetData(r,e).next((l=>l?(i=l,te.resolve(i)):t.Pi.allocateTargetId(r).next((c=>(i=new Ua(e,c,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function Ny(n,e,t){const r=vt(n),i=r.Ms.get(e),l=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",l,(c=>r.persistence.referenceDelegate.removeTarget(c,i)))}catch(c){if(!nl(c))throw c;Ae(_0,`Failed to update sequence numbers for target ${e}: ${c}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function E_(n,e,t){const r=vt(n);let i=lt.min(),l=jt();return r.persistence.runTransaction("Execute query","readwrite",(c=>(function(p,g,b){const w=vt(p),E=w.xs.get(b);return E!==void 0?te.resolve(w.Ms.get(E)):w.Pi.getTargetData(g,b)})(r,c,ci(e)).next((u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(c,u.targetId).next((p=>{l=p}))})).next((()=>r.Fs.getDocumentsMatchingQuery(c,e,t?i:lt.min(),t?l:jt()))).next((u=>(g4(r,tP(e),u),{documents:u,Qs:l})))))}function g4(n,e,t){let r=n.Os.get(e)||lt.min();t.forEach(((i,l)=>{l.readTime.compareTo(r)>0&&(r=l.readTime)})),n.Os.set(e,r)}class T_{constructor(){this.activeTargetIds=oP()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class bE{constructor(){this.Mo=new T_,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new T_,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x4{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S_="ConnectivityMonitor";class A_{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ae(S_,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ae(S_,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let up=null;function Iy(){return up===null?up=(function(){return 268435456+Math.round(2147483648*Math.random())})():up++,"0x"+up.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ix="RestConnection",y4={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class v4{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===Xp?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,l){const c=Iy(),u=this.zo(e,t.toUriEncodedString());Ae(Ix,`Sending RPC '${e}' ${c}:`,u,r);const p={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(p,i,l);const{host:g}=new URL(u),b=Zo(g);return this.Jo(e,u,p,r,b).then((w=>(Ae(Ix,`Received RPC '${e}' ${c}: `,w),w)),(w=>{throw lc(Ix,`RPC '${e}' ${c} failed with error: `,w,"url: ",u,"request:",r),w}))}Ho(e,t,r,i,l,c){return this.Go(e,t,r,i,l)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ud})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,l)=>e[l]=i)),r&&r.headers.forEach(((i,l)=>e[l]=i))}zo(e,t){const r=y4[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b4{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tr="WebChannelConnection";class w4 extends v4{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,l){const c=Iy();return new Promise(((u,p)=>{const g=new FI;g.setWithCredentials(!0),g.listenOnce(BI.COMPLETE,(()=>{try{switch(g.getLastErrorCode()){case Np.NO_ERROR:const w=g.getResponseJson();Ae(Tr,`XHR for RPC '${e}' ${c} received:`,JSON.stringify(w)),u(w);break;case Np.TIMEOUT:Ae(Tr,`RPC '${e}' ${c} timed out`),p(new Pe(ye.DEADLINE_EXCEEDED,"Request time out"));break;case Np.HTTP_ERROR:const E=g.getStatus();if(Ae(Tr,`RPC '${e}' ${c} failed with status:`,E,"response text:",g.getResponseText()),E>0){let C=g.getResponseJson();Array.isArray(C)&&(C=C[0]);const H=C==null?void 0:C.error;if(H&&H.status&&H.message){const F=(function(ae){const re=ae.toLowerCase().replace(/_/g,"-");return Object.values(ye).indexOf(re)>=0?re:ye.UNKNOWN})(H.status);p(new Pe(F,H.message))}else p(new Pe(ye.UNKNOWN,"Server responded with status "+g.getStatus()))}else p(new Pe(ye.UNAVAILABLE,"Connection failed."));break;default:Qe(9055,{l_:e,streamId:c,h_:g.getLastErrorCode(),P_:g.getLastError()})}}finally{Ae(Tr,`RPC '${e}' ${c} completed.`)}}));const b=JSON.stringify(i);Ae(Tr,`RPC '${e}' ${c} sending request:`,i),g.send(t,"POST",b,r,15)}))}T_(e,t,r){const i=Iy(),l=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=qI(),u=zI(),p={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;g!==void 0&&(p.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(p.useFetchStreams=!0),this.jo(p.initMessageHeaders,t,r),p.encodeInitMessageHeaders=!0;const b=l.join("");Ae(Tr,`Creating RPC '${e}' stream ${i}: ${b}`,p);const w=c.createWebChannel(b,p);this.I_(w);let E=!1,C=!1;const H=new b4({Yo:U=>{C?Ae(Tr,`Not sending because RPC '${e}' stream ${i} is closed:`,U):(E||(Ae(Tr,`Opening RPC '${e}' stream ${i} transport.`),w.open(),E=!0),Ae(Tr,`RPC '${e}' stream ${i} sending:`,U),w.send(U))},Zo:()=>w.close()}),F=(U,ae,re)=>{U.listen(ae,(J=>{try{re(J)}catch(he){setTimeout((()=>{throw he}),0)}}))};return F(w,Qu.EventType.OPEN,(()=>{C||(Ae(Tr,`RPC '${e}' stream ${i} transport opened.`),H.o_())})),F(w,Qu.EventType.CLOSE,(()=>{C||(C=!0,Ae(Tr,`RPC '${e}' stream ${i} transport closed`),H.a_(),this.E_(w))})),F(w,Qu.EventType.ERROR,(U=>{C||(C=!0,lc(Tr,`RPC '${e}' stream ${i} transport errored. Name:`,U.name,"Message:",U.message),H.a_(new Pe(ye.UNAVAILABLE,"The operation could not be completed")))})),F(w,Qu.EventType.MESSAGE,(U=>{var ae;if(!C){const re=U.data[0];rt(!!re,16349);const J=re,he=(J==null?void 0:J.error)||((ae=J[0])==null?void 0:ae.error);if(he){Ae(Tr,`RPC '${e}' stream ${i} received error:`,he);const j=he.status;let ce=(function(O){const z=Un[O];if(z!==void 0)return U1(z)})(j),D=he.message;ce===void 0&&(ce=ye.INTERNAL,D="Unknown error status: "+j+" with message "+he.message),C=!0,H.a_(new Pe(ce,D)),w.close()}else Ae(Tr,`RPC '${e}' stream ${i} received:`,re),H.u_(re)}})),F(u,UI.STAT_EVENT,(U=>{U.stat===ny.PROXY?Ae(Tr,`RPC '${e}' stream ${i} detected buffering proxy`):U.stat===ny.NOPROXY&&Ae(Tr,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{H.__()}),0),H}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _4(){return typeof window<"u"?window:null}function Dp(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bf(n){return new NP(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wE{constructor(e,t,r=1e3,i=1.5,l=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=l,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&Ae("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j_="PersistentStream";class _E{constructor(e,t,r,i,l,c,u,p){this.Mi=e,this.S_=r,this.b_=i,this.connection=l,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=u,this.listener=p,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new wE(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===ye.RESOURCE_EXHAUSTED?(Hr(t.toString()),Hr("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===ye.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===t&&this.G_(r,i)}),(r=>{e((()=>{const i=new Pe(ye.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ae(j_,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(Ae(j_,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class N4 extends _E{constructor(e,t,r,i,l,c){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,c),this.serializer=l}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=TP(this.serializer,e),r=(function(l){if(!("targetChange"in l))return lt.min();const c=l.targetChange;return c.targetIds&&c.targetIds.length?lt.min():c.readTime?Kr(c.readTime):lt.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=yy(this.serializer),t.addTarget=(function(l,c){let u;const p=c.target;if(u=ef(p)?{documents:Y1(l,p)}:{query:J1(l,p).ft},u.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){u.resumeToken=W1(l,c.resumeToken);const g=gy(l,c.expectedCount);g!==null&&(u.expectedCount=g)}else if(c.snapshotVersion.compareTo(lt.min())>0){u.readTime=Md(l,c.snapshotVersion.toTimestamp());const g=gy(l,c.expectedCount);g!==null&&(u.expectedCount=g)}return u})(this.serializer,e);const r=AP(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=yy(this.serializer),t.removeTarget=e,this.q_(t)}}class I4 extends _E{constructor(e,t,r,i,l,c){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,c),this.serializer=l}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return rt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,rt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){rt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=SP(e.writeResults,e.commitTime),r=Kr(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=yy(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>rf(this.serializer,r)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E4{}class T4 extends E4{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Pe(ye.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,c])=>this.connection.Go(e,xy(t,r),i,l,c))).catch((l=>{throw l.name==="FirebaseError"?(l.code===ye.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Pe(ye.UNKNOWN,l.toString())}))}Ho(e,t,r,i,l){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([c,u])=>this.connection.Ho(e,xy(t,r),i,c,u,l))).catch((c=>{throw c.name==="FirebaseError"?(c.code===ye.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new Pe(ye.UNKNOWN,c.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class S4{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Hr(t),this.aa=!1):Ae("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fc="RemoteStore";class A4{constructor(e,t,r,i,l){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=l,this.Aa.Oo((c=>{r.enqueueAndForget((async()=>{Nc(this)&&(Ae(fc,"Restarting streams for network reachability change."),await(async function(p){const g=vt(p);g.Ea.add(4),await Jh(g),g.Ra.set("Unknown"),g.Ea.delete(4),await Uf(g)})(this))}))})),this.Ra=new S4(r,i)}}async function Uf(n){if(Nc(n))for(const e of n.da)await e(!0)}async function Jh(n){for(const e of n.da)await e(!1)}function NE(n,e){const t=vt(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),T0(t)?E0(t):qd(t).O_()&&I0(t,e))}function N0(n,e){const t=vt(n),r=qd(t);t.Ia.delete(e),r.O_()&&IE(t,e),t.Ia.size===0&&(r.O_()?r.L_():Nc(t)&&t.Ra.set("Unknown"))}function I0(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(lt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}qd(n).Y_(e)}function IE(n,e){n.Va.Ue(e),qd(n).Z_(e)}function E0(n){n.Va=new vP({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),qd(n).start(),n.Ra.ua()}function T0(n){return Nc(n)&&!qd(n).x_()&&n.Ia.size>0}function Nc(n){return vt(n).Ea.size===0}function EE(n){n.Va=void 0}async function j4(n){n.Ra.set("Online")}async function k4(n){n.Ia.forEach(((e,t)=>{I0(n,e)}))}async function C4(n,e){EE(n),T0(n)?(n.Ra.ha(e),E0(n)):n.Ra.set("Unknown")}async function R4(n,e,t){if(n.Ra.set("Online"),e instanceof q1&&e.state===2&&e.cause)try{await(async function(i,l){const c=l.cause;for(const u of l.targetIds)i.Ia.has(u)&&(await i.remoteSyncer.rejectListen(u,c),i.Ia.delete(u),i.Va.removeTarget(u))})(n,e)}catch(r){Ae(fc,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await cf(n,r)}else if(e instanceof Cp?n.Va.Ze(e):e instanceof z1?n.Va.st(e):n.Va.tt(e),!t.isEqual(lt.min()))try{const r=await vE(n.localStore);t.compareTo(r)>=0&&await(function(l,c){const u=l.Va.Tt(c);return u.targetChanges.forEach(((p,g)=>{if(p.resumeToken.approximateByteSize()>0){const b=l.Ia.get(g);b&&l.Ia.set(g,b.withResumeToken(p.resumeToken,c))}})),u.targetMismatches.forEach(((p,g)=>{const b=l.Ia.get(p);if(!b)return;l.Ia.set(p,b.withResumeToken(Wn.EMPTY_BYTE_STRING,b.snapshotVersion)),IE(l,p);const w=new Ua(b.target,p,g,b.sequenceNumber);I0(l,w)})),l.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(r){Ae(fc,"Failed to raise snapshot:",r),await cf(n,r)}}async function cf(n,e,t){if(!nl(e))throw e;n.Ea.add(1),await Jh(n),n.Ra.set("Offline"),t||(t=()=>vE(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{Ae(fc,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Uf(n)}))}function TE(n,e){return e().catch((t=>cf(n,t,e)))}async function Xh(n){const e=vt(n),t=Jo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Xl;for(;D4(e);)try{const i=await p4(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,P4(e,i)}catch(i){await cf(e,i)}SE(e)&&AE(e)}function D4(n){return Nc(n)&&n.Ta.length<10}function P4(n,e){n.Ta.push(e);const t=Jo(n);t.O_()&&t.X_&&t.ea(e.mutations)}function SE(n){return Nc(n)&&!Jo(n).x_()&&n.Ta.length>0}function AE(n){Jo(n).start()}async function O4(n){Jo(n).ra()}async function M4(n){const e=Jo(n);for(const t of n.Ta)e.ea(t.mutations)}async function V4(n,e,t){const r=n.Ta.shift(),i=h0.from(r,e,t);await TE(n,(()=>n.remoteSyncer.applySuccessfulWrite(i))),await Xh(n)}async function L4(n,e){e&&Jo(n).X_&&await(async function(r,i){if((function(c){return gP(c)&&c!==ye.ABORTED})(i.code)){const l=r.Ta.shift();Jo(r).B_(),await TE(r,(()=>r.remoteSyncer.rejectFailedWrite(l.batchId,i))),await Xh(r)}})(n,e),SE(n)&&AE(n)}async function k_(n,e){const t=vt(n);t.asyncQueue.verifyOperationInProgress(),Ae(fc,"RemoteStore received new credentials");const r=Nc(t);t.Ea.add(3),await Jh(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Uf(t)}async function $4(n,e){const t=vt(n);e?(t.Ea.delete(2),await Uf(t)):e||(t.Ea.add(2),await Jh(t),t.Ra.set("Unknown"))}function qd(n){return n.ma||(n.ma=(function(t,r,i){const l=vt(t);return l.sa(),new N4(r,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,i)})(n.datastore,n.asyncQueue,{Xo:j4.bind(null,n),t_:k4.bind(null,n),r_:C4.bind(null,n),H_:R4.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),T0(n)?E0(n):n.Ra.set("Unknown")):(await n.ma.stop(),EE(n))}))),n.ma}function Jo(n){return n.fa||(n.fa=(function(t,r,i){const l=vt(t);return l.sa(),new I4(r,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,i)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:O4.bind(null,n),r_:L4.bind(null,n),ta:M4.bind(null,n),na:V4.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await Xh(n)):(await n.fa.stop(),n.Ta.length>0&&(Ae(fc,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S0{constructor(e,t,r,i,l){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=l,this.deferred=new ia,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((c=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,l){const c=Date.now()+r,u=new S0(e,t,c,i,l);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Pe(ye.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function A0(n,e){if(Hr("AsyncQueue",`${e}: ${n}`),nl(n))return new Pe(ye.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nd{static emptySet(e){return new Nd(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||Oe.comparator(t.key,r.key):(t,r)=>Oe.comparator(t.key,r.key),this.keyedMap=Yu(),this.sortedSet=new bn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Nd)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,l=r.getNext().key;if(!i.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Nd;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C_{constructor(){this.ga=new bn(Oe.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Qe(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Vd{constructor(e,t,r,i,l,c,u,p,g){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=l,this.fromCache=c,this.syncStateChanged=u,this.excludesMetadataChanges=p,this.hasCachedResults=g}static fromInitialDocuments(e,t,r,i,l){const c=[];return t.forEach((u=>{c.push({type:0,doc:u})})),new Vd(e,t,Nd.emptySet(t),c,r,i,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Df(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F4{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class B4{constructor(){this.queries=R_(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const i=vt(t),l=i.queries;i.queries=R_(),l.forEach(((c,u)=>{for(const p of u.Sa)p.onError(r)}))})(this,new Pe(ye.ABORTED,"Firestore shutting down"))}}function R_(){return new Ja((n=>A1(n)),Df)}async function j0(n,e){const t=vt(n);let r=3;const i=e.query;let l=t.queries.get(i);l?!l.ba()&&e.Da()&&(r=2):(l=new F4,r=e.Da()?0:1);try{switch(r){case 0:l.wa=await t.onListen(i,!0);break;case 1:l.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(c){const u=A0(c,`Initialization of query '${hd(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,l),l.Sa.push(e),e.va(t.onlineState),l.wa&&e.Fa(l.wa)&&C0(t)}async function k0(n,e){const t=vt(n),r=e.query;let i=3;const l=t.queries.get(r);if(l){const c=l.Sa.indexOf(e);c>=0&&(l.Sa.splice(c,1),l.Sa.length===0?i=e.Da()?0:1:!l.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function U4(n,e){const t=vt(n);let r=!1;for(const i of e){const l=i.query,c=t.queries.get(l);if(c){for(const u of c.Sa)u.Fa(i)&&(r=!0);c.wa=i}}r&&C0(t)}function z4(n,e,t){const r=vt(n),i=r.queries.get(e);if(i)for(const l of i.Sa)l.onError(t);r.queries.delete(e)}function C0(n){n.Ca.forEach((e=>{e.next()}))}var Ey,D_;(D_=Ey||(Ey={})).Ma="default",D_.Cache="cache";class R0{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Vd(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Vd.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ey.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jE{constructor(e){this.key=e}}class kE{constructor(e){this.key=e}}class q4{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=jt(),this.mutatedKeys=jt(),this.eu=j1(e),this.tu=new Nd(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new C_,i=t?t.tu:this.tu;let l=t?t.mutatedKeys:this.mutatedKeys,c=i,u=!1;const p=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,g=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((b,w)=>{const E=i.get(b),C=Qh(this.query,w)?w:null,H=!!E&&this.mutatedKeys.has(E.key),F=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations);let U=!1;E&&C?E.data.isEqual(C.data)?H!==F&&(r.track({type:3,doc:C}),U=!0):this.su(E,C)||(r.track({type:2,doc:C}),U=!0,(p&&this.eu(C,p)>0||g&&this.eu(C,g)<0)&&(u=!0)):!E&&C?(r.track({type:0,doc:C}),U=!0):E&&!C&&(r.track({type:1,doc:E}),U=!0,(p||g)&&(u=!0)),U&&(C?(c=c.add(C),l=F?l.add(b):l.delete(b)):(c=c.delete(b),l=l.delete(b)))})),this.query.limit!==null)for(;c.size>this.query.limit;){const b=this.query.limitType==="F"?c.last():c.first();c=c.delete(b.key),l=l.delete(b.key),r.track({type:1,doc:b})}return{tu:c,iu:r,Cs:u,mutatedKeys:l}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const l=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const c=e.iu.ya();c.sort(((b,w)=>(function(C,H){const F=U=>{switch(U){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Qe(20277,{Rt:U})}};return F(C)-F(H)})(b.type,w.type)||this.eu(b.doc,w.doc))),this.ou(r),i=i??!1;const u=t&&!i?this._u():[],p=this.Xa.size===0&&this.current&&!i?1:0,g=p!==this.Za;return this.Za=p,c.length!==0||g?{snapshot:new Vd(this.query,e.tu,l,c,e.mutatedKeys,p===0,g,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new C_,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=jt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new kE(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new jE(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=jt();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Vd.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const D0="SyncEngine";class W4{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class H4{constructor(e){this.key=e,this.hu=!1}}class G4{constructor(e,t,r,i,l,c){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=l,this.maxConcurrentLimboResolutions=c,this.Pu={},this.Tu=new Ja((u=>A1(u)),Df),this.Iu=new Map,this.Eu=new Set,this.du=new bn(Oe.comparator),this.Au=new Map,this.Ru=new y0,this.Vu={},this.mu=new Map,this.fu=pc.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function K4(n,e,t=!0){const r=ME(n);let i;const l=r.Tu.get(e);return l?(r.sharedClientState.addLocalQueryTarget(l.targetId),i=l.view.lu()):i=await CE(r,e,t,!0),i}async function Q4(n,e){const t=ME(n);await CE(t,e,!0,!1)}async function CE(n,e,t,r){const i=await f4(n.localStore,ci(e)),l=i.targetId,c=n.sharedClientState.addLocalQueryTarget(l,t);let u;return r&&(u=await Y4(n,e,l,c==="current",i.resumeToken)),n.isPrimaryClient&&t&&NE(n.remoteStore,i),u}async function Y4(n,e,t,r,i){n.pu=(w,E,C)=>(async function(F,U,ae,re){let J=U.view.ru(ae);J.Cs&&(J=await E_(F.localStore,U.query,!1).then((({documents:D})=>U.view.ru(D,J))));const he=re&&re.targetChanges.get(U.targetId),j=re&&re.targetMismatches.get(U.targetId)!=null,ce=U.view.applyChanges(J,F.isPrimaryClient,he,j);return O_(F,U.targetId,ce.au),ce.snapshot})(n,w,E,C);const l=await E_(n.localStore,e,!0),c=new q4(e,l.Qs),u=c.ru(l.documents),p=Yh.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),g=c.applyChanges(u,n.isPrimaryClient,p);O_(n,t,g.au);const b=new W4(e,t,c);return n.Tu.set(e,b),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),g.snapshot}async function J4(n,e,t){const r=vt(n),i=r.Tu.get(e),l=r.Iu.get(i.targetId);if(l.length>1)return r.Iu.set(i.targetId,l.filter((c=>!Df(c,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Ny(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),t&&N0(r.remoteStore,i.targetId),Ty(r,i.targetId)})).catch(_c)):(Ty(r,i.targetId),await Ny(r.localStore,i.targetId,!0))}async function X4(n,e){const t=vt(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),N0(t.remoteStore,r.targetId))}async function Z4(n,e,t){const r=VE(n);try{const i=await(function(c,u){const p=vt(c),g=Zt.now(),b=u.reduce(((C,H)=>C.add(H.key)),jt());let w,E;return p.persistence.runTransaction("Locally write mutations","readwrite",(C=>{let H=Rs(),F=jt();return p.Ns.getEntries(C,b).next((U=>{H=U,H.forEach(((ae,re)=>{re.isValidDocument()||(F=F.add(ae))}))})).next((()=>p.localDocuments.getOverlayedDocuments(C,H))).next((U=>{w=U;const ae=[];for(const re of u){const J=pP(re,w.get(re.key).overlayedDocument);J!=null&&ae.push(new Xa(re.key,J,v1(J.value.mapValue),jr.exists(!0)))}return p.mutationQueue.addMutationBatch(C,g,ae,u)})).next((U=>{E=U;const ae=U.applyToLocalDocumentSet(w,F);return p.documentOverlayCache.saveOverlays(C,U.batchId,ae)}))})).then((()=>({batchId:E.batchId,changes:C1(w)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(c,u,p){let g=c.Vu[c.currentUser.toKey()];g||(g=new bn(yt)),g=g.insert(u,p),c.Vu[c.currentUser.toKey()]=g})(r,i.batchId,t),await Zh(r,i.changes),await Xh(r.remoteStore)}catch(i){const l=A0(i,"Failed to persist write");t.reject(l)}}async function RE(n,e){const t=vt(n);try{const r=await h4(t.localStore,e);e.targetChanges.forEach(((i,l)=>{const c=t.Au.get(l);c&&(rt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?c.hu=!0:i.modifiedDocuments.size>0?rt(c.hu,14607):i.removedDocuments.size>0&&(rt(c.hu,42227),c.hu=!1))})),await Zh(t,r,e)}catch(r){await _c(r)}}function P_(n,e,t){const r=vt(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.Tu.forEach(((l,c)=>{const u=c.view.va(e);u.snapshot&&i.push(u.snapshot)})),(function(c,u){const p=vt(c);p.onlineState=u;let g=!1;p.queries.forEach(((b,w)=>{for(const E of w.Sa)E.va(u)&&(g=!0)})),g&&C0(p)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function e5(n,e,t){const r=vt(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Au.get(e),l=i&&i.key;if(l){let c=new bn(Oe.comparator);c=c.insert(l,Cn.newNoDocument(l,lt.min()));const u=jt().add(l),p=new Vf(lt.min(),new Map,new bn(yt),c,u);await RE(r,p),r.du=r.du.remove(l),r.Au.delete(e),P0(r)}else await Ny(r.localStore,e,!1).then((()=>Ty(r,e,t))).catch(_c)}async function t5(n,e){const t=vt(n),r=e.batch.batchId;try{const i=await u4(t.localStore,e);PE(t,r,null),DE(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Zh(t,i)}catch(i){await _c(i)}}async function n5(n,e,t){const r=vt(n);try{const i=await(function(c,u){const p=vt(c);return p.persistence.runTransaction("Reject batch","readwrite-primary",(g=>{let b;return p.mutationQueue.lookupMutationBatch(g,u).next((w=>(rt(w!==null,37113),b=w.keys(),p.mutationQueue.removeMutationBatch(g,w)))).next((()=>p.mutationQueue.performConsistencyCheck(g))).next((()=>p.documentOverlayCache.removeOverlaysForBatchId(g,b,u))).next((()=>p.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(g,b))).next((()=>p.localDocuments.getDocuments(g,b)))}))})(r.localStore,e);PE(r,e,t),DE(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Zh(r,i)}catch(i){await _c(i)}}function DE(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function PE(n,e,t){const r=vt(n);let i=r.Vu[r.currentUser.toKey()];if(i){const l=i.get(e);l&&(t?l.reject(t):l.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Ty(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||OE(n,r)}))}function OE(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(N0(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),P0(n))}function O_(n,e,t){for(const r of t)r instanceof jE?(n.Ru.addReference(r.key,e),r5(n,r)):r instanceof kE?(Ae(D0,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||OE(n,r.key)):Qe(19791,{wu:r})}function r5(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(Ae(D0,"New document in limbo: "+t),n.Eu.add(r),P0(n))}function P0(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Oe(Wt.fromString(e)),r=n.fu.next();n.Au.set(r,new H4(t)),n.du=n.du.insert(t,r),NE(n.remoteStore,new Ua(ci(Kh(t.path)),r,"TargetPurposeLimboResolution",oi.ce))}}async function Zh(n,e,t){const r=vt(n),i=[],l=[],c=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,p)=>{c.push(r.pu(p,e,t).then((g=>{var b;if((g||t)&&r.isPrimaryClient){const w=g?!g.fromCache:(b=t==null?void 0:t.targetChanges.get(p.targetId))==null?void 0:b.current;r.sharedClientState.updateQueryState(p.targetId,w?"current":"not-current")}if(g){i.push(g);const w=w0.As(p.targetId,g);l.push(w)}})))})),await Promise.all(c),r.Pu.H_(i),await(async function(p,g){const b=vt(p);try{await b.persistence.runTransaction("notifyLocalViewChanges","readwrite",(w=>te.forEach(g,(E=>te.forEach(E.Es,(C=>b.persistence.referenceDelegate.addReference(w,E.targetId,C))).next((()=>te.forEach(E.ds,(C=>b.persistence.referenceDelegate.removeReference(w,E.targetId,C)))))))))}catch(w){if(!nl(w))throw w;Ae(_0,"Failed to update sequence numbers: "+w)}for(const w of g){const E=w.targetId;if(!w.fromCache){const C=b.Ms.get(E),H=C.snapshotVersion,F=C.withLastLimboFreeSnapshotVersion(H);b.Ms=b.Ms.insert(E,F)}}})(r.localStore,l))}async function s5(n,e){const t=vt(n);if(!t.currentUser.isEqual(e)){Ae(D0,"User change. New user:",e.toKey());const r=await yE(t.localStore,e);t.currentUser=e,(function(l,c){l.mu.forEach((u=>{u.forEach((p=>{p.reject(new Pe(ye.CANCELLED,c))}))})),l.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Zh(t,r.Ls)}}function i5(n,e){const t=vt(n),r=t.Au.get(e);if(r&&r.hu)return jt().add(r.key);{let i=jt();const l=t.Iu.get(e);if(!l)return i;for(const c of l){const u=t.Tu.get(c);i=i.unionWith(u.view.nu)}return i}}function ME(n){const e=vt(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=RE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=i5.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=e5.bind(null,e),e.Pu.H_=U4.bind(null,e.eventManager),e.Pu.yu=z4.bind(null,e.eventManager),e}function VE(n){const e=vt(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=t5.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=n5.bind(null,e),e}class Mh{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Bf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return xE(this.persistence,new gE,e.initialUser,this.serializer)}Cu(e){return new v0(Ff.mi,this.serializer)}Du(e){return new bE}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Mh.provider={build:()=>new Mh};class a5 extends Mh{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){rt(this.persistence.referenceDelegate instanceof lf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new uE(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Sr.withCacheSize(this.cacheSizeBytes):Sr.DEFAULT;return new v0((r=>lf.mi(r,t)),this.serializer)}}class o5 extends Mh{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await VE(this.xu.syncEngine),await Xh(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return xE(this.persistence,new gE,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new uE(r,e.asyncQueue,t)}Mu(e,t){const r=new mD(t,this.persistence);return new hD(e.asyncQueue,r)}Cu(e){const t=o4(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Sr.withCacheSize(this.cacheSizeBytes):Sr.DEFAULT;return new b0(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,_4(),Dp(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new bE}}class df{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>P_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=s5.bind(null,this.syncEngine),await $4(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new B4})()}createDatastore(e){const t=Bf(e.databaseInfo.databaseId),r=(function(l){return new w4(l)})(e.databaseInfo);return(function(l,c,u,p){return new T4(l,c,u,p)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,i,l,c,u){return new A4(r,i,l,c,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>P_(this.syncEngine,t,0)),(function(){return A_.v()?new A_:new x4})())}createSyncEngine(e,t){return(function(i,l,c,u,p,g,b){const w=new G4(i,l,c,u,p,g);return b&&(w.gu=!0),w})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(i){const l=vt(i);Ae(fc,"RemoteStore shutting down."),l.Ea.add(5),await Jh(l),l.Aa.shutdown(),l.Ra.set("Unknown")})(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}df.provider={build:()=>new df};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O0{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Hr("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xo="FirestoreClient";class l5{constructor(e,t,r,i,l){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=gr.UNAUTHENTICATED,this.clientId=Zy.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(r,(async c=>{Ae(Xo,"Received user=",c.uid),await this.authCredentialListener(c),this.user=c})),this.appCheckCredentials.start(r,(c=>(Ae(Xo,"Received new app check token=",c),this.appCheckCredentialListener(c,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ia;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=A0(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Ex(n,e){n.asyncQueue.verifyOperationInProgress(),Ae(Xo,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async i=>{r.isEqual(i)||(await yE(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function M_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await c5(n);Ae(Xo,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>k_(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,i)=>k_(e.remoteStore,i))),n._onlineComponents=e}async function c5(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Ae(Xo,"Using user provided OfflineComponentProvider");try{await Ex(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===ye.FAILED_PRECONDITION||i.code===ye.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;lc("Error using user provided cache. Falling back to memory cache: "+t),await Ex(n,new Mh)}}else Ae(Xo,"Using default OfflineComponentProvider"),await Ex(n,new a5(void 0));return n._offlineComponents}async function LE(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Ae(Xo,"Using user provided OnlineComponentProvider"),await M_(n,n._uninitializedComponentsProvider._online)):(Ae(Xo,"Using default OnlineComponentProvider"),await M_(n,new df))),n._onlineComponents}function d5(n){return LE(n).then((e=>e.syncEngine))}async function uf(n){const e=await LE(n),t=e.eventManager;return t.onListen=K4.bind(null,e.syncEngine),t.onUnlisten=J4.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Q4.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=X4.bind(null,e.syncEngine),t}function u5(n,e,t={}){const r=new ia;return n.asyncQueue.enqueueAndForget((async()=>(function(l,c,u,p,g){const b=new O0({next:E=>{b.Nu(),c.enqueueAndForget((()=>k0(l,w)));const C=E.docs.has(u);!C&&E.fromCache?g.reject(new Pe(ye.UNAVAILABLE,"Failed to get document because the client is offline.")):C&&E.fromCache&&p&&p.source==="server"?g.reject(new Pe(ye.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):g.resolve(E)},error:E=>g.reject(E)}),w=new R0(Kh(u.path),b,{includeMetadataChanges:!0,qa:!0});return j0(l,w)})(await uf(n),n.asyncQueue,e,t,r))),r.promise}function h5(n,e,t={}){const r=new ia;return n.asyncQueue.enqueueAndForget((async()=>(function(l,c,u,p,g){const b=new O0({next:E=>{b.Nu(),c.enqueueAndForget((()=>k0(l,w))),E.fromCache&&p.source==="server"?g.reject(new Pe(ye.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):g.resolve(E)},error:E=>g.reject(E)}),w=new R0(u,b,{includeMetadataChanges:!0,qa:!0});return j0(l,w)})(await uf(n),n.asyncQueue,e,t,r))),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $E(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V_=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FE="firestore.googleapis.com",L_=!0;class $_{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Pe(ye.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=FE,this.ssl=L_}else this.host=e.host,this.ssl=e.ssl??L_;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=oE;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<qP)throw new Pe(ye.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}lD("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$E(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Pe(ye.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Pe(ye.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Pe(ye.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class zf{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $_({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Pe(ye.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Pe(ye.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $_(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new XR;switch(r.type){case"firstParty":return new nD(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Pe(ye.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=V_.get(t);r&&(Ae("ComponentProvider","Removing Datastore"),V_.delete(t),r.terminate())})(this),Promise.resolve()}}function m5(n,e,t,r={}){var g;n=Gr(n,zf);const i=Zo(e),l=n._getSettings(),c={...l,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;i&&(Ly(`https://${u}`),$y("Firestore",!0)),l.host!==FE&&l.host!==u&&lc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const p={...l,host:u,ssl:i,emulatorOptions:r};if(!Wa(p,c)&&(n._setSettings(p),r.mockUserToken)){let b,w;if(typeof r.mockUserToken=="string")b=r.mockUserToken,w=gr.MOCK_USER;else{b=zN(r.mockUserToken,(g=n._app)==null?void 0:g.options.projectId);const E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new Pe(ye.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new gr(E)}n._authCredentials=new ZR(new HI(b,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ic(this.firestore,e,this._query)}}class Rn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Go(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Rn(this.firestore,e,this._key)}toJSON(){return{type:Rn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(qh(t,Rn._jsonSchema))return new Rn(e,r||null,new Oe(Wt.fromString(t.referencePath)))}}Rn._jsonSchemaVersion="firestore/documentReference/1.0",Rn._jsonSchema={type:qn("string",Rn._jsonSchemaVersion),referencePath:qn("string")};class Go extends Ic{constructor(e,t,r){super(e,t,Kh(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Rn(this.firestore,null,new Oe(e))}withConverter(e){return new Go(this.firestore,e,this._path)}}function pn(n,e,...t){if(n=Ht(n),KI("collection","path",e),n instanceof zf){const r=Wt.fromString(e,...t);return jw(r),new Go(n,null,r)}{if(!(n instanceof Rn||n instanceof Go))throw new Pe(ye.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Wt.fromString(e,...t));return jw(r),new Go(n.firestore,null,r)}}function It(n,e,...t){if(n=Ht(n),arguments.length===1&&(e=Zy.newId()),KI("doc","path",e),n instanceof zf){const r=Wt.fromString(e,...t);return Aw(r),new Rn(n,null,new Oe(r))}{if(!(n instanceof Rn||n instanceof Go))throw new Pe(ye.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Wt.fromString(e,...t));return Aw(r),new Rn(n.firestore,n instanceof Go?n.converter:null,new Oe(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F_="AsyncQueue";class B_{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new wE(this,"async_queue_retry"),this._c=()=>{const r=Dp();r&&Ae(F_,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Dp();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Dp();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new ia;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!nl(e))throw e;Ae(F_,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Hr("INTERNAL UNHANDLED ERROR: ",U_(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=S0.createAndSchedule(this,e,t,r,(l=>this.hc(l)));return this.tc.push(i),i}uc(){this.nc&&Qe(47125,{Pc:U_(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function U_(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z_(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;const i=t;for(const l of r)if(l in i&&typeof i[l]=="function")return!0;return!1})(n,["next","error","complete"])}class ca extends zf{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new B_,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new B_(e),this._firestoreClient=void 0,await e}}}function BE(n,e){const t=typeof n=="object"?n:$h(),r=typeof n=="string"?n:Xp,i=Ya(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const l=FN("firestore");l&&m5(i,...l)}return i}function qf(n){if(n._terminated)throw new Pe(ye.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||UE(n),n._firestoreClient}function UE(n){var r,i,l;const e=n._freezeSettings(),t=(function(u,p,g,b){return new UD(u,p,g,b.host,b.ssl,b.experimentalForceLongPolling,b.experimentalAutoDetectLongPolling,$E(b.experimentalLongPollingOptions),b.useFetchStreams,b.isUsingEmulator)})(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(i=e.localCache)!=null&&i._offlineComponentProvider&&((l=e.localCache)!=null&&l._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new l5(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(u){const p=u==null?void 0:u._online.build();return{_offline:u==null?void 0:u._offline.build(p),_online:p}})(n._componentsProvider))}function p5(n,e){lc("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return f5(n,df.provider,{build:r=>new o5(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}function f5(n,e,t){if((n=Gr(n,ca))._firestoreClient||n._terminated)throw new Pe(ye.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new Pe(ye.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},UE(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ai(Wn.fromBase64String(e))}catch(t){throw new Pe(ye.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ai(Wn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ai._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(qh(e,ai._jsonSchema))return ai.fromBase64String(e.bytes)}}ai._jsonSchemaVersion="firestore/bytes/1.0",ai._jsonSchema={type:qn("string",ai._jsonSchemaVersion),bytes:qn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wf{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Pe(ye.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new In(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Pe(ye.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Pe(ye.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return yt(this._lat,e._lat)||yt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:aa._jsonSchemaVersion}}static fromJSON(e){if(qh(e,aa._jsonSchema))return new aa(e.latitude,e.longitude)}}aa._jsonSchemaVersion="firestore/geoPoint/1.0",aa._jsonSchema={type:qn("string",aa._jsonSchemaVersion),latitude:qn("number"),longitude:qn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let l=0;l<r.length;++l)if(r[l]!==i[l])return!1;return!0})(this._values,e._values)}toJSON(){return{type:oa._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(qh(e,oa._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new oa(e.vectorValues);throw new Pe(ye.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}oa._jsonSchemaVersion="firestore/vectorValue/1.0",oa._jsonSchema={type:qn("string",oa._jsonSchemaVersion),vectorValues:qn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g5=/^__.*__$/;class x5{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Xa(e,this.data,this.fieldMask,t,this.fieldTransforms):new zd(e,this.data,t,this.fieldTransforms)}}class zE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Xa(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function qE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Qe(40011,{Ac:n})}}class Gf{constructor(e,t,r,i,l,c){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,l===void 0&&this.Rc(),this.fieldTransforms=l||[],this.fieldMask=c||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Gf({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var i;const t=(i=this.path)==null?void 0:i.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var i;const t=(i=this.path)==null?void 0:i.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return hf(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(qE(this.Ac)&&g5.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class y5{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Bf(e)}Cc(e,t,r,i=!1){return new Gf({Ac:e,methodName:t,Dc:r,path:In.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Kf(n){const e=n._freezeSettings(),t=Bf(n._databaseId);return new y5(n._databaseId,!!e.ignoreUndefinedProperties,t)}function WE(n,e,t,r,i,l={}){const c=n.Cc(l.merge||l.mergeFields?2:0,e,t,i);V0("Data must be an object, but it was:",c,r);const u=HE(r,c);let p,g;if(l.merge)p=new ms(c.fieldMask),g=c.fieldTransforms;else if(l.mergeFields){const b=[];for(const w of l.mergeFields){const E=Sy(e,w,t);if(!c.contains(E))throw new Pe(ye.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);KE(b,E)||b.push(E)}p=new ms(b),g=c.fieldTransforms.filter((w=>p.covers(w.field)))}else p=null,g=c.fieldTransforms;return new x5(new Ar(u),p,g)}class Qf extends Hf{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Qf}}function v5(n,e,t){return new Gf({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class M0 extends Hf{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=v5(this,e,!0),r=this.vc.map((l=>Wd(l,t))),i=new uc(r);return new L1(e.path,i)}isEqual(e){return e instanceof M0&&Wa(this.vc,e.vc)}}function b5(n,e,t,r){const i=n.Cc(1,e,t);V0("Data must be an object, but it was:",i,r);const l=[],c=Ar.empty();rl(r,((p,g)=>{const b=L0(e,p,t);g=Ht(g);const w=i.yc(b);if(g instanceof Qf)l.push(b);else{const E=Wd(g,w);E!=null&&(l.push(b),c.set(b,E))}}));const u=new ms(l);return new zE(c,u,i.fieldTransforms)}function w5(n,e,t,r,i,l){const c=n.Cc(1,e,t),u=[Sy(e,r,t)],p=[i];if(l.length%2!=0)throw new Pe(ye.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let E=0;E<l.length;E+=2)u.push(Sy(e,l[E])),p.push(l[E+1]);const g=[],b=Ar.empty();for(let E=u.length-1;E>=0;--E)if(!KE(g,u[E])){const C=u[E];let H=p[E];H=Ht(H);const F=c.yc(C);if(H instanceof Qf)g.push(C);else{const U=Wd(H,F);U!=null&&(g.push(C),b.set(C,U))}}const w=new ms(g);return new zE(b,w,c.fieldTransforms)}function _5(n,e,t,r=!1){return Wd(t,n.Cc(r?4:3,e))}function Wd(n,e){if(GE(n=Ht(n)))return V0("Unsupported field value:",e,n),HE(n,e);if(n instanceof Hf)return(function(r,i){if(!qE(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const l=r._toFieldTransform(i);l&&i.fieldTransforms.push(l)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){const l=[];let c=0;for(const u of r){let p=Wd(u,i.wc(c));p==null&&(p={nullValue:"NULL_VALUE"}),l.push(p),c++}return{arrayValue:{values:l}}})(n,e)}return(function(r,i){if((r=Ht(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return lP(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const l=Zt.fromDate(r);return{timestampValue:Md(i.serializer,l)}}if(r instanceof Zt){const l=new Zt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Md(i.serializer,l)}}if(r instanceof aa)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ai)return{bytesValue:W1(i.serializer,r._byteString)};if(r instanceof Rn){const l=i.databaseId,c=r.firestore._databaseId;if(!c.isEqual(l))throw i.Sc(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:f0(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof oa)return(function(c,u){return{mapValue:{fields:{[o0]:{stringValue:l0},[Cd]:{arrayValue:{values:c.toArray().map((g=>{if(typeof g!="number")throw u.Sc("VectorValues must only contain numeric values.");return d0(u.serializer,g)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Ef(r)}`)})(n,e)}function HE(n,e){const t={};return d1(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):rl(n,((r,i)=>{const l=Wd(i,e.mc(r));l!=null&&(t[r]=l)})),{mapValue:{fields:t}}}function GE(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Zt||n instanceof aa||n instanceof ai||n instanceof Rn||n instanceof Hf||n instanceof oa)}function V0(n,e,t){if(!GE(t)||!QI(t)){const r=Ef(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Sy(n,e,t){if((e=Ht(e))instanceof Wf)return e._internalPath;if(typeof e=="string")return L0(n,e);throw hf("Field path arguments must be of type string or ",n,!1,void 0,t)}const N5=new RegExp("[~\\*/\\[\\]]");function L0(n,e,t){if(e.search(N5)>=0)throw hf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Wf(...e.split("."))._internalPath}catch{throw hf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function hf(n,e,t,r,i){const l=r&&!r.isEmpty(),c=i!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let p="";return(l||c)&&(p+=" (found",l&&(p+=` in field ${r}`),c&&(p+=` in document ${i}`),p+=")"),new Pe(ye.INVALID_ARGUMENT,u+n+p)}function KE(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QE{constructor(e,t,r,i,l){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new Rn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new I5(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field($0("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class I5 extends QE{data(){return super.data()}}function $0(n,e){return typeof e=="string"?L0(n,e):e instanceof Wf?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Pe(ye.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class F0{}class E5 extends F0{}function Ls(n,e,...t){let r=[];e instanceof F0&&r.push(e),r=r.concat(t),(function(l){const c=l.filter((p=>p instanceof B0)).length,u=l.filter((p=>p instanceof Yf)).length;if(c>1||c>0&&u>0)throw new Pe(ye.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const i of r)n=i._apply(n);return n}class Yf extends E5{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Yf(e,t,r)}_apply(e){const t=this._parse(e);return JE(e._query,t),new Ic(e.firestore,e.converter,py(e._query,t))}_parse(e){const t=Kf(e.firestore);return(function(l,c,u,p,g,b,w){let E;if(g.isKeyField()){if(b==="array-contains"||b==="array-contains-any")throw new Pe(ye.INVALID_ARGUMENT,`Invalid Query. You can't perform '${b}' queries on documentId().`);if(b==="in"||b==="not-in"){W_(w,b);const H=[];for(const F of w)H.push(q_(p,l,F));E={arrayValue:{values:H}}}else E=q_(p,l,w)}else b!=="in"&&b!=="not-in"&&b!=="array-contains-any"||W_(w,b),E=_5(u,c,w,b==="in"||b==="not-in");return Pt.create(g,b,E)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ec(n,e,t){const r=e,i=$0("where",n);return Yf._create(i,r,t)}class B0 extends F0{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new B0(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:en.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(i,l){let c=i;const u=l.getFlattenedFilters();for(const p of u)JE(c,p),c=py(c,p)})(e._query,t),new Ic(e.firestore,e.converter,py(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function q_(n,e,t){if(typeof(t=Ht(t))=="string"){if(t==="")throw new Pe(ye.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!S1(e)&&t.indexOf("/")!==-1)throw new Pe(ye.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Wt.fromString(t));if(!Oe.isDocumentKey(r))throw new Pe(ye.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Rh(n,new Oe(r))}if(t instanceof Rn)return Rh(n,t._key);throw new Pe(ye.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ef(t)}.`)}function W_(n,e){if(!Array.isArray(n)||n.length===0)throw new Pe(ye.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function JE(n,e){const t=(function(i,l){for(const c of i)for(const u of c.getFlattenedFilters())if(l.indexOf(u.op)>=0)return u.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new Pe(ye.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Pe(ye.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class T5{convertValue(e,t="none"){switch(Qo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return vn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Qa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Qe(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return rl(e,((i,l)=>{r[i]=this.convertValue(l,t)})),r}convertVectorValue(e){var r,i,l;const t=(l=(i=(r=e.fields)==null?void 0:r[Cd].arrayValue)==null?void 0:i.values)==null?void 0:l.map((c=>vn(c.doubleValue)));return new oa(t)}convertGeoPoint(e){return new aa(vn(e.latitude),vn(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Cf(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(kh(e));default:return null}}convertTimestamp(e){const t=Ka(e);return new Zt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Wt.fromString(e);rt(tE(r),9688,{name:e});const i=new cc(r.get(1),r.get(3)),l=new Oe(r.popFirst(5));return i.isEqual(t)||Hr(`Document ${l} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XE(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Zu{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class tc extends QE{constructor(e,t,r,i,l,c){super(e,t,r,i,c),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Pp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field($0("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Pe(ye.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=tc._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}tc._jsonSchemaVersion="firestore/documentSnapshot/1.0",tc._jsonSchema={type:qn("string",tc._jsonSchemaVersion),bundleSource:qn("string","DocumentSnapshot"),bundleName:qn("string"),bundle:qn("string")};class Pp extends tc{data(e={}){return super.data(e)}}class nc{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Zu(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Pp(this._firestore,this._userDataWriter,r.key,r,new Zu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Pe(ye.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,l){if(i._snapshot.oldDocs.isEmpty()){let c=0;return i._snapshot.docChanges.map((u=>{const p=new Pp(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Zu(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:p,oldIndex:-1,newIndex:c++}}))}{let c=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((u=>l||u.type!==3)).map((u=>{const p=new Pp(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Zu(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let g=-1,b=-1;return u.type!==0&&(g=c.indexOf(u.doc.key),c=c.delete(u.doc.key)),u.type!==1&&(c=c.add(u.doc),b=c.indexOf(u.doc.key)),{type:S5(u.type),doc:p,oldIndex:g,newIndex:b}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Pe(ye.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=nc._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Zy.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],i=[];return this.docs.forEach((l=>{l._document!==null&&(t.push(l._document),r.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),i.push(l.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function S5(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Qe(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function da(n){n=Gr(n,Rn);const e=Gr(n.firestore,ca);return u5(qf(e),n._key).then((t=>eT(e,n,t)))}nc._jsonSchemaVersion="firestore/querySnapshot/1.0",nc._jsonSchema={type:qn("string",nc._jsonSchemaVersion),bundleSource:qn("string","QuerySnapshot"),bundleName:qn("string"),bundle:qn("string")};class U0 extends T5{constructor(e){super(),this.firestore=e}convertBytes(e){return new ai(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rn(this.firestore,null,t)}}function ZE(n){n=Gr(n,Ic);const e=Gr(n.firestore,ca),t=qf(e),r=new U0(e);return YE(n._query),h5(t,n._query).then((i=>new nc(e,r,n,i)))}function $s(n,e,t){n=Gr(n,Rn);const r=Gr(n.firestore,ca),i=XE(n.converter,e,t);return Jf(r,[WE(Kf(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,jr.none())])}function Rr(n,e,t,...r){n=Gr(n,Rn);const i=Gr(n.firestore,ca),l=Kf(i);let c;return c=typeof(e=Ht(e))=="string"||e instanceof Wf?w5(l,"updateDoc",n._key,e,t,r):b5(l,"updateDoc",n._key,e),Jf(i,[c.toMutation(n._key,jr.exists(!0))])}function gc(n){return Jf(Gr(n.firestore,ca),[new Mf(n._key,jr.none())])}function A5(n,e){const t=Gr(n.firestore,ca),r=It(n),i=XE(n.converter,e);return Jf(t,[WE(Kf(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,jr.exists(!1))]).then((()=>r))}function hi(n,...e){var p,g,b;n=Ht(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||z_(e[r])||(t=e[r++]);const i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(z_(e[r])){const w=e[r];e[r]=(p=w.next)==null?void 0:p.bind(w),e[r+1]=(g=w.error)==null?void 0:g.bind(w),e[r+2]=(b=w.complete)==null?void 0:b.bind(w)}let l,c,u;if(n instanceof Rn)c=Gr(n.firestore,ca),u=Kh(n._key.path),l={next:w=>{e[r]&&e[r](eT(c,n,w))},error:e[r+1],complete:e[r+2]};else{const w=Gr(n,Ic);c=Gr(w.firestore,ca),u=w._query;const E=new U0(c);l={next:C=>{e[r]&&e[r](new nc(c,E,w,C))},error:e[r+1],complete:e[r+2]},YE(n._query)}return(function(E,C,H,F){const U=new O0(F),ae=new R0(C,U,H);return E.asyncQueue.enqueueAndForget((async()=>j0(await uf(E),ae))),()=>{U.Nu(),E.asyncQueue.enqueueAndForget((async()=>k0(await uf(E),ae)))}})(qf(c),u,i,l)}function Jf(n,e){return(function(r,i){const l=new ia;return r.asyncQueue.enqueueAndForget((async()=>Z4(await d5(r),i,l))),l.promise})(qf(n),e)}function eT(n,e,t){const r=t.docs.get(e._key),i=new U0(n);return new tc(n,i,e._key,r,new Zu(t.hasPendingWrites,t.fromCache),e.converter)}function xc(...n){return new M0("arrayUnion",n)}(function(e,t=!0){(function(i){Ud=i})(wc),Ms(new ps("firestore",((r,{instanceIdentifier:i,options:l})=>{const c=r.getProvider("app").getImmediate(),u=new ca(new eD(r.getProvider("auth-internal")),new rD(c,r.getProvider("app-check-internal")),(function(g,b){if(!Object.prototype.hasOwnProperty.apply(g.options,["projectId"]))throw new Pe(ye.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new cc(g.options.projectId,b)})(c,i),c);return l={useFetchStreams:t,...l},u._setSettings(l),u}),"PUBLIC").setMultipleInstances(!0)),kr(Iw,Ew,e),kr(Iw,Ew,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tT="firebasestorage.googleapis.com",nT="storageBucket",j5=120*1e3,k5=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn extends di{constructor(e,t,r=0){super(Tx(e),`Firebase Storage: ${t} (${Tx(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Pn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Tx(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Dn;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Dn||(Dn={}));function Tx(n){return"storage/"+n}function z0(){const n="An unknown error occurred, please check the error payload for server response.";return new Pn(Dn.UNKNOWN,n)}function C5(n){return new Pn(Dn.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function R5(n){return new Pn(Dn.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function D5(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Pn(Dn.UNAUTHENTICATED,n)}function P5(){return new Pn(Dn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function O5(n){return new Pn(Dn.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function M5(){return new Pn(Dn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function V5(){return new Pn(Dn.CANCELED,"User canceled the upload/download.")}function L5(n){return new Pn(Dn.INVALID_URL,"Invalid URL '"+n+"'.")}function $5(n){return new Pn(Dn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function F5(){return new Pn(Dn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+nT+"' property when initializing the app?")}function B5(){return new Pn(Dn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function U5(){return new Pn(Dn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function z5(n){return new Pn(Dn.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Ay(n){return new Pn(Dn.INVALID_ARGUMENT,n)}function rT(){return new Pn(Dn.APP_DELETED,"The Firebase app was deleted.")}function q5(n){return new Pn(Dn.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function yh(n,e){return new Pn(Dn.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Uu(n){throw new Pn(Dn.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=Ds.makeFromUrl(e,t)}catch{return new Ds(e,"")}if(r.path==="")return r;throw $5(e)}static makeFromUrl(e,t){let r=null;const i="([A-Za-z0-9.\\-_]+)";function l(he){he.path.charAt(he.path.length-1)==="/"&&(he.path_=he.path_.slice(0,-1))}const c="(/(.*))?$",u=new RegExp("^gs://"+i+c,"i"),p={bucket:1,path:3};function g(he){he.path_=decodeURIComponent(he.path)}const b="v[A-Za-z0-9_]+",w=t.replace(/[.]/g,"\\."),E="(/([^?#]*).*)?$",C=new RegExp(`^https?://${w}/${b}/b/${i}/o${E}`,"i"),H={bucket:1,path:3},F=t===tT?"(?:storage.googleapis.com|storage.cloud.google.com)":t,U="([^?#]*)",ae=new RegExp(`^https?://${F}/${i}/${U}`,"i"),J=[{regex:u,indices:p,postModify:l},{regex:C,indices:H,postModify:g},{regex:ae,indices:{bucket:1,path:2},postModify:g}];for(let he=0;he<J.length;he++){const j=J[he],ce=j.regex.exec(e);if(ce){const D=ce[j.indices.bucket];let k=ce[j.indices.path];k||(k=""),r=new Ds(D,k),j.postModify(r);break}}if(r==null)throw L5(e);return r}}class W5{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H5(n,e,t){let r=1,i=null,l=null,c=!1,u=0;function p(){return u===2}let g=!1;function b(...U){g||(g=!0,e.apply(null,U))}function w(U){i=setTimeout(()=>{i=null,n(C,p())},U)}function E(){l&&clearTimeout(l)}function C(U,...ae){if(g){E();return}if(U){E(),b.call(null,U,...ae);return}if(p()||c){E(),b.call(null,U,...ae);return}r<64&&(r*=2);let J;u===1?(u=2,J=0):J=(r+Math.random())*1e3,w(J)}let H=!1;function F(U){H||(H=!0,E(),!g&&(i!==null?(U||(u=2),clearTimeout(i),w(0)):U||(u=1)))}return w(0),l=setTimeout(()=>{c=!0,F(!0)},t),F}function G5(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K5(n){return n!==void 0}function Q5(n){return typeof n=="object"&&!Array.isArray(n)}function q0(n){return typeof n=="string"||n instanceof String}function H_(n){return W0()&&n instanceof Blob}function W0(){return typeof Blob<"u"}function G_(n,e,t,r){if(r<e)throw Ay(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Ay(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H0(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function sT(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const i=e(r)+"="+e(n[r]);t=t+i+"&"}return t=t.slice(0,-1),t}var rc;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(rc||(rc={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y5(n,e){const t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,l=e.indexOf(n)!==-1;return t||i||l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J5{constructor(e,t,r,i,l,c,u,p,g,b,w,E=!0,C=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=l,this.additionalRetryCodes_=c,this.callback_=u,this.errorCallback_=p,this.timeout_=g,this.progressCallback_=b,this.connectionFactory_=w,this.retry=E,this.isUsingEmulator=C,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((H,F)=>{this.resolve_=H,this.reject_=F,this.start_()})}start_(){const e=(r,i)=>{if(i){r(!1,new hp(!1,null,!0));return}const l=this.connectionFactory_();this.pendingConnection_=l;const c=u=>{const p=u.loaded,g=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(p,g)};this.progressCallback_!==null&&l.addUploadProgressListener(c),l.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&l.removeUploadProgressListener(c),this.pendingConnection_=null;const u=l.getErrorCode()===rc.NO_ERROR,p=l.getStatus();if(!u||Y5(p,this.additionalRetryCodes_)&&this.retry){const b=l.getErrorCode()===rc.ABORT;r(!1,new hp(!1,null,b));return}const g=this.successCodes_.indexOf(p)!==-1;r(!0,new hp(g,l))})},t=(r,i)=>{const l=this.resolve_,c=this.reject_,u=i.connection;if(i.wasSuccessCode)try{const p=this.callback_(u,u.getResponse());K5(p)?l(p):l()}catch(p){c(p)}else if(u!==null){const p=z0();p.serverResponse=u.getErrorText(),this.errorCallback_?c(this.errorCallback_(u,p)):c(p)}else if(i.canceled){const p=this.appDelete_?rT():V5();c(p)}else{const p=M5();c(p)}};this.canceled_?t(!1,new hp(!1,null,!0)):this.backoffId_=H5(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&G5(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class hp{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function X5(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function Z5(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function eO(n,e){e&&(n["X-Firebase-GMPID"]=e)}function tO(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function nO(n,e,t,r,i,l,c=!0,u=!1){const p=sT(n.urlParams),g=n.url+p,b=Object.assign({},n.headers);return eO(b,e),X5(b,t),Z5(b,l),tO(b,r),new J5(g,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,c,u)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rO(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function sO(...n){const e=rO();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(W0())return new Blob(n);throw new Pn(Dn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function iO(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aO(n){if(typeof atob>"u")throw z5("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const na={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Sx{constructor(e,t){this.data=e,this.contentType=t||null}}function oO(n,e){switch(n){case na.RAW:return new Sx(iT(e));case na.BASE64:case na.BASE64URL:return new Sx(aT(n,e));case na.DATA_URL:return new Sx(cO(e),dO(e))}throw z0()}function iT(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const l=r,c=n.charCodeAt(++t);r=65536|(l&1023)<<10|c&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function lO(n){let e;try{e=decodeURIComponent(n)}catch{throw yh(na.DATA_URL,"Malformed data URL.")}return iT(e)}function aT(n,e){switch(n){case na.BASE64:{const i=e.indexOf("-")!==-1,l=e.indexOf("_")!==-1;if(i||l)throw yh(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case na.BASE64URL:{const i=e.indexOf("+")!==-1,l=e.indexOf("/")!==-1;if(i||l)throw yh(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=aO(e)}catch(i){throw i.message.includes("polyfill")?i:yh(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}class oT{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw yh(na.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=uO(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function cO(n){const e=new oT(n);return e.base64?aT(na.BASE64,e.rest):lO(e.rest)}function dO(n){return new oT(n).contentType}function uO(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(e,t){let r=0,i="";H_(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(H_(this.data_)){const r=this.data_,i=iO(r,e,t);return i===null?null:new Bo(i)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new Bo(r,!0)}}static getBlob(...e){if(W0()){const t=e.map(r=>r instanceof Bo?r.data_:r);return new Bo(sO.apply(null,t))}else{const t=e.map(c=>q0(c)?oO(na.RAW,c).data:c.data_);let r=0;t.forEach(c=>{r+=c.byteLength});const i=new Uint8Array(r);let l=0;return t.forEach(c=>{for(let u=0;u<c.length;u++)i[l++]=c[u]}),new Bo(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lT(n){let e;try{e=JSON.parse(n)}catch{return null}return Q5(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hO(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function mO(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function cT(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pO(n,e){return e}class Wr{constructor(e,t,r,i){this.server=e,this.local=t||e,this.writable=!!r,this.xform=i||pO}}let mp=null;function fO(n){return!q0(n)||n.length<2?n:cT(n)}function dT(){if(mp)return mp;const n=[];n.push(new Wr("bucket")),n.push(new Wr("generation")),n.push(new Wr("metageneration")),n.push(new Wr("name","fullPath",!0));function e(l,c){return fO(c)}const t=new Wr("name");t.xform=e,n.push(t);function r(l,c){return c!==void 0?Number(c):c}const i=new Wr("size");return i.xform=r,n.push(i),n.push(new Wr("timeCreated")),n.push(new Wr("updated")),n.push(new Wr("md5Hash",null,!0)),n.push(new Wr("cacheControl",null,!0)),n.push(new Wr("contentDisposition",null,!0)),n.push(new Wr("contentEncoding",null,!0)),n.push(new Wr("contentLanguage",null,!0)),n.push(new Wr("contentType",null,!0)),n.push(new Wr("metadata","customMetadata",!0)),mp=n,mp}function gO(n,e){function t(){const r=n.bucket,i=n.fullPath,l=new Ds(r,i);return e._makeStorageReference(l)}Object.defineProperty(n,"ref",{get:t})}function xO(n,e,t){const r={};r.type="file";const i=t.length;for(let l=0;l<i;l++){const c=t[l];r[c.local]=c.xform(r,e[c.server])}return gO(r,n),r}function uT(n,e,t){const r=lT(e);return r===null?null:xO(n,r,t)}function yO(n,e,t,r){const i=lT(e);if(i===null||!q0(i.downloadTokens))return null;const l=i.downloadTokens;if(l.length===0)return null;const c=encodeURIComponent;return l.split(",").map(g=>{const b=n.bucket,w=n.fullPath,E="/b/"+c(b)+"/o/"+c(w),C=H0(E,t,r),H=sT({alt:"media",token:g});return C+H})[0]}function vO(n,e){const t={},r=e.length;for(let i=0;i<r;i++){const l=e[i];l.writable&&(t[l.server]=n[l.local])}return JSON.stringify(t)}class hT{constructor(e,t,r,i){this.url=e,this.method=t,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mT(n){if(!n)throw z0()}function bO(n,e){function t(r,i){const l=uT(n,i,e);return mT(l!==null),l}return t}function wO(n,e){function t(r,i){const l=uT(n,i,e);return mT(l!==null),yO(l,i,n.host,n._protocol)}return t}function pT(n){function e(t,r){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=P5():i=D5():t.getStatus()===402?i=R5(n.bucket):t.getStatus()===403?i=O5(n.path):i=r,i.status=t.getStatus(),i.serverResponse=r.serverResponse,i}return e}function _O(n){const e=pT(n);function t(r,i){let l=e(r,i);return r.getStatus()===404&&(l=C5(n.path)),l.serverResponse=i.serverResponse,l}return t}function NO(n,e,t){const r=e.fullServerUrl(),i=H0(r,n.host,n._protocol),l="GET",c=n.maxOperationRetryTime,u=new hT(i,l,wO(n,t),c);return u.errorHandler=_O(e),u}function IO(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function EO(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=IO(null,e)),r}function TO(n,e,t,r,i){const l=e.bucketOnlyServerUrl(),c={"X-Goog-Upload-Protocol":"multipart"};function u(){let J="";for(let he=0;he<2;he++)J=J+Math.random().toString().slice(2);return J}const p=u();c["Content-Type"]="multipart/related; boundary="+p;const g=EO(e,r,i),b=vO(g,t),w="--"+p+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+b+`\r
--`+p+`\r
Content-Type: `+g.contentType+`\r
\r
`,E=`\r
--`+p+"--",C=Bo.getBlob(w,r,E);if(C===null)throw B5();const H={name:g.fullPath},F=H0(l,n.host,n._protocol),U="POST",ae=n.maxUploadRetryTime,re=new hT(F,U,bO(n,t),ae);return re.urlParams=H,re.headers=c,re.body=C.uploadData(),re.errorHandler=pT(e),re}class SO{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=rc.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=rc.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=rc.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,i,l){if(this.sent_)throw Uu("cannot .send() more than once");if(Zo(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),l!==void 0)for(const c in l)l.hasOwnProperty(c)&&this.xhr_.setRequestHeader(c,l[c].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Uu("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Uu("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Uu("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Uu("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class AO extends SO{initXhr(){this.xhr_.responseType="text"}}function fT(){return new AO}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yc{constructor(e,t){this._service=e,t instanceof Ds?this._location=t:this._location=Ds.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new yc(e,t)}get root(){const e=new Ds(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return cT(this._location.path)}get storage(){return this._service}get parent(){const e=hO(this._location.path);if(e===null)return null;const t=new Ds(this._location.bucket,e);return new yc(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw q5(e)}}function jO(n,e,t){n._throwIfRoot("uploadBytes");const r=TO(n.storage,n._location,dT(),new Bo(e,!0),t);return n.storage.makeRequestWithTokens(r,fT).then(i=>({metadata:i,ref:n}))}function kO(n){n._throwIfRoot("getDownloadURL");const e=NO(n.storage,n._location,dT());return n.storage.makeRequestWithTokens(e,fT).then(t=>{if(t===null)throw U5();return t})}function CO(n,e){const t=mO(n._location.path,e),r=new Ds(n._location.bucket,t);return new yc(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RO(n){return/^[A-Za-z]+:\/\//.test(n)}function DO(n,e){return new yc(n,e)}function gT(n,e){if(n instanceof G0){const t=n;if(t._bucket==null)throw F5();const r=new yc(t,t._bucket);return e!=null?gT(r,e):r}else return e!==void 0?CO(n,e):n}function PO(n,e){if(e&&RO(e)){if(n instanceof G0)return DO(n,e);throw Ay("To use ref(service, url), the first argument must be a Storage instance.")}else return gT(n,e)}function K_(n,e){const t=e==null?void 0:e[nT];return t==null?null:Ds.makeFromBucketSpec(t,n)}function OO(n,e,t,r={}){n.host=`${e}:${t}`;const i=Zo(e);i&&(Ly(`https://${n.host}/b`),$y("Storage",!0)),n._isUsingEmulator=!0,n._protocol=i?"https":"http";const{mockUserToken:l}=r;l&&(n._overrideAuthToken=typeof l=="string"?l:zN(l,n.app.options.projectId))}class G0{constructor(e,t,r,i,l,c=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=l,this._isUsingEmulator=c,this._bucket=null,this._host=tT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=j5,this._maxUploadRetryTime=k5,this._requests=new Set,i!=null?this._bucket=Ds.makeFromBucketSpec(i,this._host):this._bucket=K_(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ds.makeFromBucketSpec(this._url,e):this._bucket=K_(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){G_("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){G_("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(hs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new yc(this,e)}_makeRequest(e,t,r,i,l=!0){if(this._deleted)return new W5(rT());{const c=nO(e,this._appId,r,i,t,this._firebaseVersion,l,this._isUsingEmulator);return this._requests.add(c),c.getPromise().then(()=>this._requests.delete(c),()=>this._requests.delete(c)),c}}async makeRequestWithTokens(e,t){const[r,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,i).getPromise()}}const Q_="@firebase/storage",Y_="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT="storage";function eh(n,e,t){return n=Ht(n),jO(n,e,t)}function th(n){return n=Ht(n),kO(n)}function nh(n,e){return n=Ht(n),PO(n,e)}function MO(n=$h(),e){n=Ht(n);const r=Ya(n,xT).getImmediate({identifier:e}),i=FN("storage");return i&&VO(r,...i),r}function VO(n,e,t,r={}){OO(n,e,t,r)}function LO(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new G0(t,r,i,e,wc)}function $O(){Ms(new ps(xT,LO,"PUBLIC").setMultipleInstances(!0)),kr(Q_,Y_,""),kr(Q_,Y_,"esm2020")}$O();const yT="@firebase/installations",K0="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vT=1e4,bT=`w:${K0}`,wT="FIS_v2",FO="https://firebaseinstallations.googleapis.com/v1",BO=3600*1e3,UO="installations",zO="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qO={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},vc=new el(UO,zO,qO);function _T(n){return n instanceof di&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NT({projectId:n}){return`${FO}/projects/${n}/installations`}function IT(n){return{token:n.token,requestStatus:2,expiresIn:HO(n.expiresIn),creationTime:Date.now()}}async function ET(n,e){const r=(await e.json()).error;return vc.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function TT({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function WO(n,{refreshToken:e}){const t=TT(n);return t.append("Authorization",GO(e)),t}async function ST(n){const e=await n();return e.status>=500&&e.status<600?n():e}function HO(n){return Number(n.replace("s","000"))}function GO(n){return`${wT} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KO({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=NT(n),i=TT(n),l=e.getImmediate({optional:!0});if(l){const g=await l.getHeartbeatsHeader();g&&i.append("x-firebase-client",g)}const c={fid:t,authVersion:wT,appId:n.appId,sdkVersion:bT},u={method:"POST",headers:i,body:JSON.stringify(c)},p=await ST(()=>fetch(r,u));if(p.ok){const g=await p.json();return{fid:g.fid||t,registrationStatus:2,refreshToken:g.refreshToken,authToken:IT(g.authToken)}}else throw await ET("Create Installation",p)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AT(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QO(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YO=/^[cdef][\w-]{21}$/,jy="";function JO(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=XO(n);return YO.test(t)?t:jy}catch{return jy}}function XO(n){return QO(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xf(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jT=new Map;function kT(n,e){const t=Xf(n);CT(t,e),ZO(t,e)}function CT(n,e){const t=jT.get(n);if(t)for(const r of t)r(e)}function ZO(n,e){const t=e3();t&&t.postMessage({key:n,fid:e}),t3()}let Yl=null;function e3(){return!Yl&&"BroadcastChannel"in self&&(Yl=new BroadcastChannel("[Firebase] FID Change"),Yl.onmessage=n=>{CT(n.data.key,n.data.fid)}),Yl}function t3(){jT.size===0&&Yl&&(Yl.close(),Yl=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n3="firebase-installations-database",r3=1,bc="firebase-installations-store";let Ax=null;function Q0(){return Ax||(Ax=wf(n3,r3,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(bc)}}})),Ax}async function mf(n,e){const t=Xf(n),i=(await Q0()).transaction(bc,"readwrite"),l=i.objectStore(bc),c=await l.get(t);return await l.put(e,t),await i.done,(!c||c.fid!==e.fid)&&kT(n,e.fid),e}async function RT(n){const e=Xf(n),r=(await Q0()).transaction(bc,"readwrite");await r.objectStore(bc).delete(e),await r.done}async function Zf(n,e){const t=Xf(n),i=(await Q0()).transaction(bc,"readwrite"),l=i.objectStore(bc),c=await l.get(t),u=e(c);return u===void 0?await l.delete(t):await l.put(u,t),await i.done,u&&(!c||c.fid!==u.fid)&&kT(n,u.fid),u}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y0(n){let e;const t=await Zf(n.appConfig,r=>{const i=s3(r),l=i3(n,i);return e=l.registrationPromise,l.installationEntry});return t.fid===jy?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function s3(n){const e=n||{fid:JO(),registrationStatus:0};return DT(e)}function i3(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const i=Promise.reject(vc.create("app-offline"));return{installationEntry:e,registrationPromise:i}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=a3(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:o3(n)}:{installationEntry:e}}async function a3(n,e){try{const t=await KO(n,e);return mf(n.appConfig,t)}catch(t){throw _T(t)&&t.customData.serverCode===409?await RT(n.appConfig):await mf(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function o3(n){let e=await J_(n.appConfig);for(;e.registrationStatus===1;)await AT(100),e=await J_(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await Y0(n);return r||t}return e}function J_(n){return Zf(n,e=>{if(!e)throw vc.create("installation-not-found");return DT(e)})}function DT(n){return l3(n)?{fid:n.fid,registrationStatus:0}:n}function l3(n){return n.registrationStatus===1&&n.registrationTime+vT<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c3({appConfig:n,heartbeatServiceProvider:e},t){const r=d3(n,t),i=WO(n,t),l=e.getImmediate({optional:!0});if(l){const g=await l.getHeartbeatsHeader();g&&i.append("x-firebase-client",g)}const c={installation:{sdkVersion:bT,appId:n.appId}},u={method:"POST",headers:i,body:JSON.stringify(c)},p=await ST(()=>fetch(r,u));if(p.ok){const g=await p.json();return IT(g)}else throw await ET("Generate Auth Token",p)}function d3(n,{fid:e}){return`${NT(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function J0(n,e=!1){let t;const r=await Zf(n.appConfig,l=>{if(!PT(l))throw vc.create("not-registered");const c=l.authToken;if(!e&&m3(c))return l;if(c.requestStatus===1)return t=u3(n,e),l;{if(!navigator.onLine)throw vc.create("app-offline");const u=f3(l);return t=h3(n,u),u}});return t?await t:r.authToken}async function u3(n,e){let t=await X_(n.appConfig);for(;t.authToken.requestStatus===1;)await AT(100),t=await X_(n.appConfig);const r=t.authToken;return r.requestStatus===0?J0(n,e):r}function X_(n){return Zf(n,e=>{if(!PT(e))throw vc.create("not-registered");const t=e.authToken;return g3(t)?{...e,authToken:{requestStatus:0}}:e})}async function h3(n,e){try{const t=await c3(n,e),r={...e,authToken:t};return await mf(n.appConfig,r),t}catch(t){if(_T(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await RT(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await mf(n.appConfig,r)}throw t}}function PT(n){return n!==void 0&&n.registrationStatus===2}function m3(n){return n.requestStatus===2&&!p3(n)}function p3(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+BO}function f3(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function g3(n){return n.requestStatus===1&&n.requestTime+vT<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x3(n){const e=n,{installationEntry:t,registrationPromise:r}=await Y0(e);return r?r.catch(console.error):J0(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y3(n,e=!1){const t=n;return await v3(t),(await J0(t,e)).token}async function v3(n){const{registrationPromise:e}=await Y0(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b3(n){if(!n||!n.options)throw jx("App Configuration");if(!n.name)throw jx("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw jx(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function jx(n){return vc.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OT="installations",w3="installations-internal",_3=n=>{const e=n.getProvider("app").getImmediate(),t=b3(e),r=Ya(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},N3=n=>{const e=n.getProvider("app").getImmediate(),t=Ya(e,OT).getImmediate();return{getId:()=>x3(t),getToken:i=>y3(t,i)}};function I3(){Ms(new ps(OT,_3,"PUBLIC")),Ms(new ps(w3,N3,"PRIVATE"))}I3();kr(yT,K0);kr(yT,K0,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pf="analytics",E3="firebase_id",T3="origin",S3=60*1e3,A3="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",X0="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qr=new bf("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j3={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Os=new el("analytics","Analytics",j3);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k3(n){if(!n.startsWith(X0)){const e=Os.create("invalid-gtag-resource",{gtagURL:n});return Qr.warn(e.message),""}return n}function MT(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function C3(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function R3(n,e){const t=C3("firebase-js-sdk-policy",{createScriptURL:k3}),r=document.createElement("script"),i=`${X0}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function D3(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function P3(n,e,t,r,i,l){const c=r[i];try{if(c)await e[c];else{const p=(await MT(t)).find(g=>g.measurementId===i);p&&await e[p.appId]}}catch(u){Qr.error(u)}n("config",i,l)}async function O3(n,e,t,r,i){try{let l=[];if(i&&i.send_to){let c=i.send_to;Array.isArray(c)||(c=[c]);const u=await MT(t);for(const p of c){const g=u.find(w=>w.measurementId===p),b=g&&e[g.appId];if(b)l.push(b);else{l=[];break}}}l.length===0&&(l=Object.values(e)),await Promise.all(l),n("event",r,i||{})}catch(l){Qr.error(l)}}function M3(n,e,t,r){async function i(l,...c){try{if(l==="event"){const[u,p]=c;await O3(n,e,t,u,p)}else if(l==="config"){const[u,p]=c;await P3(n,e,t,r,u,p)}else if(l==="consent"){const[u,p]=c;n("consent",u,p)}else if(l==="get"){const[u,p,g]=c;n("get",u,p,g)}else if(l==="set"){const[u]=c;n("set",u)}else n(l,...c)}catch(u){Qr.error(u)}}return i}function V3(n,e,t,r,i){let l=function(...c){window[r].push(arguments)};return window[i]&&typeof window[i]=="function"&&(l=window[i]),window[i]=M3(l,n,e,t),{gtagCore:l,wrappedGtag:window[i]}}function L3(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(X0)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $3=30,F3=1e3;class B3{constructor(e={},t=F3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const VT=new B3;function U3(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function z3(n){var c;const{appId:e,apiKey:t}=n,r={method:"GET",headers:U3(t)},i=A3.replace("{app-id}",e),l=await fetch(i,r);if(l.status!==200&&l.status!==304){let u="";try{const p=await l.json();(c=p.error)!=null&&c.message&&(u=p.error.message)}catch{}throw Os.create("config-fetch-failed",{httpStatus:l.status,responseMessage:u})}return l.json()}async function q3(n,e=VT,t){const{appId:r,apiKey:i,measurementId:l}=n.options;if(!r)throw Os.create("no-app-id");if(!i){if(l)return{measurementId:l,appId:r};throw Os.create("no-api-key")}const c=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},u=new G3;return setTimeout(async()=>{u.abort()},S3),LT({appId:r,apiKey:i,measurementId:l},c,u,e)}async function LT(n,{throttleEndTimeMillis:e,backoffCount:t},r,i=VT){var u;const{appId:l,measurementId:c}=n;try{await W3(r,e)}catch(p){if(c)return Qr.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${p==null?void 0:p.message}]`),{appId:l,measurementId:c};throw p}try{const p=await z3(n);return i.deleteThrottleMetadata(l),p}catch(p){const g=p;if(!H3(g)){if(i.deleteThrottleMetadata(l),c)return Qr.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${g==null?void 0:g.message}]`),{appId:l,measurementId:c};throw p}const b=Number((u=g==null?void 0:g.customData)==null?void 0:u.httpStatus)===503?Hb(t,i.intervalMillis,$3):Hb(t,i.intervalMillis),w={throttleEndTimeMillis:Date.now()+b,backoffCount:t+1};return i.setThrottleMetadata(l,w),Qr.debug(`Calling attemptFetch again in ${b} millis`),LT(n,w,r,i)}}function W3(n,e){return new Promise((t,r)=>{const i=Math.max(e-Date.now(),0),l=setTimeout(t,i);n.addEventListener(()=>{clearTimeout(l),r(Os.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function H3(n){if(!(n instanceof di)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class G3{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function K3(n,e,t,r,i){if(i&&i.global){n("event",t,r);return}else{const l=await e,c={...r,send_to:l};n("event",t,c)}}async function Q3(n,e,t,r){if(r&&r.global){const i={};for(const l of Object.keys(t))i[`user_properties.${l}`]=t[l];return n("set",i),Promise.resolve()}else{const i=await e;n("config",i,{update:!0,user_properties:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y3(){if(vf())try{await Fy()}catch(n){return Qr.warn(Os.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Qr.warn(Os.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function J3(n,e,t,r,i,l,c){const u=q3(n);u.then(E=>{t[E.measurementId]=E.appId,n.options.measurementId&&E.measurementId!==n.options.measurementId&&Qr.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${E.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(E=>Qr.error(E)),e.push(u);const p=Y3().then(E=>{if(E)return r.getId()}),[g,b]=await Promise.all([u,p]);L3(l)||R3(l,g.measurementId),i("js",new Date);const w=(c==null?void 0:c.config)??{};return w[T3]="firebase",w.update=!0,b!=null&&(w[E3]=b),i("config",g.measurementId,w),g.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X3{constructor(e){this.app=e}_delete(){return delete Id[this.app.options.appId],Promise.resolve()}}let Id={},Z_=[];const eN={};let kx="dataLayer",Z3="gtag",tN,Z0,nN=!1;function eM(){const n=[];if(WN()&&n.push("This is a browser extension environment."),KN()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,i)=>`(${i+1}) ${r}`).join(" "),t=Os.create("invalid-analytics-context",{errorInfo:e});Qr.warn(t.message)}}function tM(n,e,t){eM();const r=n.options.appId;if(!r)throw Os.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Qr.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Os.create("no-api-key");if(Id[r]!=null)throw Os.create("already-exists",{id:r});if(!nN){D3(kx);const{wrappedGtag:l,gtagCore:c}=V3(Id,Z_,eN,kx,Z3);Z0=l,tN=c,nN=!0}return Id[r]=J3(n,Z_,eN,e,tN,kx,t),new X3(n)}function nM(n=$h()){n=Ht(n);const e=Ya(n,pf);return e.isInitialized()?e.getImmediate():rM(n)}function rM(n,e={}){const t=Ya(n,pf);if(t.isInitialized()){const i=t.getImmediate();if(Wa(e,t.getOptions()))return i;throw Os.create("already-initialized")}return t.initialize({options:e})}function sM(n,e,t){n=Ht(n),Q3(Z0,Id[n.app.options.appId],e,t).catch(r=>Qr.error(r))}function iM(n,e,t,r){n=Ht(n),K3(Z0,Id[n.app.options.appId],e,t,r).catch(i=>Qr.error(i))}const rN="@firebase/analytics",sN="0.10.19";function aM(){Ms(new ps(pf,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return tM(r,i,t)},"PUBLIC")),Ms(new ps("analytics-internal",n,"PRIVATE")),kr(rN,sN),kr(rN,sN,"esm2020");function n(e){try{const t=e.getProvider(pf).getImmediate();return{logEvent:(r,i,l)=>iM(t,r,i,l),setUserProperties:(r,i)=>sM(t,r,i)}}catch(t){throw Os.create("interop-component-reg-failed",{reason:t})}}}aM();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oM="/firebase-messaging-sw.js",lM="/firebase-cloud-messaging-push-scope",$T="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",cM="https://fcmregistrations.googleapis.com/v1",FT="google.c.a.c_id",dM="google.c.a.c_l",uM="google.c.a.ts",hM="google.c.a.e",iN=1e4;var aN;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(aN||(aN={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var Vh;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(Vh||(Vh={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function La(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function mM(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),i=new Uint8Array(r.length);for(let l=0;l<r.length;++l)i[l]=r.charCodeAt(l);return i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cx="fcm_token_details_db",pM=5,oN="fcm_token_object_Store";async function fM(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(l=>l.name).includes(Cx))return null;let e=null;return(await wf(Cx,pM,{upgrade:async(r,i,l,c)=>{if(i<2||!r.objectStoreNames.contains(oN))return;const u=c.objectStore(oN),p=await u.index("fcmSenderId").get(n);if(await u.clear(),!!p){if(i===2){const g=p;if(!g.auth||!g.p256dh||!g.endpoint)return;e={token:g.fcmToken,createTime:g.createTime??Date.now(),subscriptionOptions:{auth:g.auth,p256dh:g.p256dh,endpoint:g.endpoint,swScope:g.swScope,vapidKey:typeof g.vapidKey=="string"?g.vapidKey:La(g.vapidKey)}}}else if(i===3){const g=p;e={token:g.fcmToken,createTime:g.createTime,subscriptionOptions:{auth:La(g.auth),p256dh:La(g.p256dh),endpoint:g.endpoint,swScope:g.swScope,vapidKey:La(g.vapidKey)}}}else if(i===4){const g=p;e={token:g.fcmToken,createTime:g.createTime,subscriptionOptions:{auth:La(g.auth),p256dh:La(g.p256dh),endpoint:g.endpoint,swScope:g.swScope,vapidKey:La(g.vapidKey)}}}}}})).close(),await hx(Cx),await hx("fcm_vapid_details_db"),await hx("undefined"),gM(e)?e:null}function gM(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xM="firebase-messaging-database",yM=1,Lh="firebase-messaging-store";let Rx=null;function BT(){return Rx||(Rx=wf(xM,yM,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Lh)}}})),Rx}async function vM(n){const e=UT(n),r=await(await BT()).transaction(Lh).objectStore(Lh).get(e);if(r)return r;{const i=await fM(n.appConfig.senderId);if(i)return await ev(n,i),i}}async function ev(n,e){const t=UT(n),i=(await BT()).transaction(Lh,"readwrite");return await i.objectStore(Lh).put(e,t),await i.done,e}function UT({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bM={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},Dr=new el("messaging","Messaging",bM);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wM(n,e){const t=await nv(n),r=zT(e),i={method:"POST",headers:t,body:JSON.stringify(r)};let l;try{l=await(await fetch(tv(n.appConfig),i)).json()}catch(c){throw Dr.create("token-subscribe-failed",{errorInfo:c==null?void 0:c.toString()})}if(l.error){const c=l.error.message;throw Dr.create("token-subscribe-failed",{errorInfo:c})}if(!l.token)throw Dr.create("token-subscribe-no-token");return l.token}async function _M(n,e){const t=await nv(n),r=zT(e.subscriptionOptions),i={method:"PATCH",headers:t,body:JSON.stringify(r)};let l;try{l=await(await fetch(`${tv(n.appConfig)}/${e.token}`,i)).json()}catch(c){throw Dr.create("token-update-failed",{errorInfo:c==null?void 0:c.toString()})}if(l.error){const c=l.error.message;throw Dr.create("token-update-failed",{errorInfo:c})}if(!l.token)throw Dr.create("token-update-no-token");return l.token}async function NM(n,e){const r={method:"DELETE",headers:await nv(n)};try{const l=await(await fetch(`${tv(n.appConfig)}/${e}`,r)).json();if(l.error){const c=l.error.message;throw Dr.create("token-unsubscribe-failed",{errorInfo:c})}}catch(i){throw Dr.create("token-unsubscribe-failed",{errorInfo:i==null?void 0:i.toString()})}}function tv({projectId:n}){return`${cM}/projects/${n}/registrations`}async function nv({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function zT({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const i={web:{endpoint:t,auth:e,p256dh:n}};return r!==$T&&(i.web.applicationPubKey=r),i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IM=10080*60*1e3;async function EM(n){const e=await SM(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:La(e.getKey("auth")),p256dh:La(e.getKey("p256dh"))},r=await vM(n.firebaseDependencies);if(r){if(AM(r.subscriptionOptions,t))return Date.now()>=r.createTime+IM?TM(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await NM(n.firebaseDependencies,r.token)}catch(i){console.warn(i)}return lN(n.firebaseDependencies,t)}else return lN(n.firebaseDependencies,t)}async function TM(n,e){try{const t=await _M(n.firebaseDependencies,e),r={...e,token:t,createTime:Date.now()};return await ev(n.firebaseDependencies,r),t}catch(t){throw t}}async function lN(n,e){const r={token:await wM(n,e),createTime:Date.now(),subscriptionOptions:e};return await ev(n,r),r.token}async function SM(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:mM(e)})}function AM(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,i=e.auth===n.auth,l=e.p256dh===n.p256dh;return t&&r&&i&&l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cN(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return jM(e,n),kM(e,n),CM(e,n),e}function jM(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const i=e.notification.image;i&&(n.notification.image=i);const l=e.notification.icon;l&&(n.notification.icon=l)}function kM(n,e){e.data&&(n.data=e.data)}function CM(n,e){var i,l,c,u;if(!e.fcmOptions&&!((i=e.notification)!=null&&i.click_action))return;n.fcmOptions={};const t=((l=e.fcmOptions)==null?void 0:l.link)??((c=e.notification)==null?void 0:c.click_action);t&&(n.fcmOptions.link=t);const r=(u=e.fcmOptions)==null?void 0:u.analytics_label;r&&(n.fcmOptions.analyticsLabel=r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RM(n){return typeof n=="object"&&!!n&&FT in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DM(n){if(!n||!n.options)throw Dx("App Configuration Object");if(!n.name)throw Dx("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw Dx(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Dx(n){return Dr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PM{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const i=DM(e);this.firebaseDependencies={app:e,appConfig:i,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OM(n){try{n.swRegistration=await navigator.serviceWorker.register(oM,{scope:lM}),n.swRegistration.update().catch(()=>{}),await MM(n.swRegistration)}catch(e){throw Dr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}async function MM(n){return new Promise((e,t)=>{const r=setTimeout(()=>t(new Error(`Service worker not registered after ${iN} ms`)),iN),i=n.installing||n.waiting;n.active?(clearTimeout(r),e()):i?i.onstatechange=l=>{var c;((c=l.target)==null?void 0:c.state)==="activated"&&(i.onstatechange=null,clearTimeout(r),e())}:(clearTimeout(r),t(new Error("No incoming service worker found.")))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VM(n,e){if(!e&&!n.swRegistration&&await OM(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw Dr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LM(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=$T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qT(n,e){if(!navigator)throw Dr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw Dr.create("permission-blocked");return await LM(n,e==null?void 0:e.vapidKey),await VM(n,e==null?void 0:e.serviceWorkerRegistration),EM(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $M(n,e,t){const r=FM(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[FT],message_name:t[dM],message_time:t[uM],message_device_time:Math.floor(Date.now()/1e3)})}function FM(n){switch(n){case Vh.NOTIFICATION_CLICKED:return"notification_open";case Vh.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BM(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===Vh.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(cN(t)):n.onMessageHandler.next(cN(t)));const r=t.data;RM(r)&&r[hM]==="1"&&await $M(n,t.messageType,r)}const dN="@firebase/messaging",uN="0.12.23";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UM=n=>{const e=new PM(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>BM(e,t)),e},zM=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>qT(e,r)}};function qM(){Ms(new ps("messaging",UM,"PUBLIC")),Ms(new ps("messaging-internal",zM,"PRIVATE")),kr(dN,uN),kr(dN,uN,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WM(){try{await Fy()}catch{return!1}return typeof window<"u"&&vf()&&KN()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HM(n,e){if(!navigator)throw Dr.create("only-available-in-window");return n.onMessageHandler=e,()=>{n.onMessageHandler=null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GM(n=$h()){return WM().then(e=>{if(!e)throw Dr.create("unsupported-browser")},e=>{throw Dr.create("indexed-db-unsupported")}),Ya(Ht(n),"messaging").getImmediate()}async function KM(n,e){return n=Ht(n),qT(n,e)}function QM(n,e){return n=Ht(n),HM(n,e)}qM();const WT={apiKey:"AIzaSyBm3qcPWMOt_AmyFmtW-0DfFYBnM-qjhCs",authDomain:"btw-erp.firebaseapp.com",projectId:"btw-erp",storageBucket:"btw-erp.firebasestorage.app",messagingSenderId:"700838936930",appId:"1:700838936930:web:00474b6818f67f872aec3b",measurementId:"G-HDRN5MET3X"},em=Uy(WT),Ld=LI(em),st=BE(em),rh=MO(em);nM(em);let ky;try{ky=GM(em)}catch(n){console.warn("Firebase Messaging not supported:",n),ky=null}const ff=ky;try{p5(st).catch(n=>{n.code==="failed-precondition"?console.warn("Multiple tabs open, persistence can only be enabled in one tab at a time."):n.code==="unimplemented"&&console.warn("Current browser doesn't support persistence.")})}catch(n){console.warn("Firestore persistence error:",n)}async function hN(n){var e;try{let t=Ls(pn(st,"projects"));n&&(t=Ls(pn(st,"projects"),Ec("tenantId","==",n)));const i=(await ZE(t)).docs.map(c=>({...c.data(),id:c.id})),l={};for(const c of i){const u=new Set;(e=c.tasks)==null||e.forEach(p=>{p.assigneeId&&u.add(p.assigneeId)});for(const p of u){l[p]||(l[p]={});const g=(c.tasks||[]).filter(H=>H.assigneeId===p).length,b=(c.financials||[]).filter(H=>H.adminApproved&&H.clientApproved&&H.vendorId===p),w=b.filter(H=>H.receivedByName&&H.receivedByName.includes(p)).reduce((H,F)=>H+F.amount,0),E=b.filter(H=>H.vendorId===p).reduce((H,F)=>H+F.amount,0),C=w-E;l[p][c.id]={projectName:c.name,taskCount:g,netAmount:C}}}for(const[c,u]of Object.entries(l))try{await Rr(It(st,"users",c),{projectMetrics:u})}catch(p){p.code!=="not-found"&&console.warn(` Could not update metrics for vendor ${c}:`,p.message)}}catch(t){console.error(" Error syncing vendor metrics:",t)}}const Cy=pn(st,"projects"),gf=n=>Array.isArray(n)?n.map(e=>gf(e)).filter(e=>e!==void 0):n!==null&&typeof n=="object"?Object.fromEntries(Object.entries(n).map(([e,t])=>[e,gf(t)]).filter(([e,t])=>t!==void 0)):n,YM=async n=>{try{const e=It(Cy),t=gf(n);return await $s(e,t),e.id}catch(e){throw console.error("Error creating project:",e),e}},rv=async(n,e)=>{try{const t=gf(e);await Rr(It(st,"projects",n),t)}catch(t){throw console.error("Error updating project:",t),t}},HT=async n=>{try{await gc(It(st,"projects",n))}catch(e){throw console.error("Error deleting project:",e),e}},JM=(n,e)=>{let t=Ls(Cy);return e&&(t=Ls(Cy,Ec("tenantId","==",e))),hi(t,r=>{const i=r.docs.map(l=>({...l.data(),id:l.id}));n(i)},r=>{r.code!=="permission-denied"&&console.error(" Error in projects collection listener:",r)})},mN=pn(st,"users"),Ry=async n=>{try{const e=await da(It(st,"users",n));if(e.exists()){const r={...e.data(),id:e.id};if(!r.tenantId){console.warn(` User ${n} missing tenantId. Assigning UID as tenantId.`),r.tenantId=n;try{await Rr(It(st,"users",n),{tenantId:n}),console.log(` Updated user ${n} with tenantId in Firestore`)}catch{console.warn(` Could not persist tenantId to Firestore for ${n}, will use in-memory value`)}}return r}console.log(`User ${n} not found in users collection, checking clients...`);const t=await da(It(st,"clients",n));if(t.exists()){const r={...t.data(),id:t.id};if(!r.tenantId){console.warn(` Client ${n} missing tenantId. Assigning UID as tenantId.`),r.tenantId=n;try{await Rr(It(st,"clients",n),{tenantId:n}),console.log(` Updated client ${n} with tenantId in Firestore`)}catch{console.warn(` Could not persist tenantId to Firestore for ${n}, will use in-memory value`)}}return r}return console.warn(`User document not found for ID: ${n}. Make sure to create a user profile in Firestore.`),null}catch(e){throw e.code==="failed-precondition"?console.error(`Firebase offline: ${e.message}`):console.error("Error fetching user:",e),e}},GT=async(n,e)=>{try{console.log(` Phone login - UID: ${n}, Phone: ${e}`);const t=It(st,"users",n),r=await da(t);if(r.exists()){const p=r.data();return console.log(` Found user by UID: ${n}`),p}console.log(" UID not found, searching vendors by phone...");const i=pn(st,"vendors"),l=e.replace(/\D/g,"");console.log(` Searching with normalized phone: "${l}"`);const c=Ls(i,Ec("phone","==",l)),u=await ZE(c);if(!u.empty){const p=u.docs[0].data(),g=u.docs[0].id;console.log(` Found vendor by phone: ${l}, oldID: ${g}`);let b=p;if(b.tenantId||(b.tenantId=n),g!==n){console.log(` Migrating document from ${g} to real UID: ${n}`);const w={...p,id:n,tenantId:n};b=w,await $s(It(st,"users",n),w),await $s(It(st,"vendors",n),w),console.log(` Deleting old documents with ID: ${g}`),await gc(It(st,"users",g)),await gc(It(st,"vendors",g)),console.log(` Deleted old documents with ID: ${g}`)}return b}return console.log(` No vendor found with phone: ${l}`),null}catch(t){return console.error("Error claiming phone profile:",t),null}},XM=(n,e)=>{let t=[],r=[],i=Ls(mN);e&&(i=Ls(mN,Ec("tenantId","==",e)));const l=hi(i,c=>{t=c.docs.map(p=>({...p.data(),id:p.id})),n(t)},c=>{console.error(" Error in users collection listener:",c)});return r.push(l),()=>{r.forEach(c=>c())}},ZM=(n,e)=>{let t=Ls(pn(st,"designers"));return e&&(t=Ls(pn(st,"designers"),Ec("tenantId","==",e))),hi(t,r=>{const i=r.docs.map(l=>({...l.data(),id:l.id}));n(i)},r=>{r.code!=="permission-denied"&&console.error(" Error in designers collection listener:",r)})},e6=(n,e)=>{let t=Ls(pn(st,"vendors"));return e&&(t=Ls(pn(st,"vendors"),Ec("tenantId","==",e))),hi(t,r=>{const i=r.docs.map(l=>({...l.data(),id:l.id}));n(i)},r=>{r.code!=="permission-denied"&&console.error(" Error in vendors collection listener:",r)})},t6=(n,e)=>{let t=Ls(pn(st,"clients"));return e&&(t=Ls(pn(st,"clients"),Ec("tenantId","==",e))),hi(t,r=>{const i=r.docs.map(l=>({...l.data(),id:l.id}));n(i)},r=>{r.code!=="permission-denied"&&console.error(" Error in clients collection listener:",r)})},n6=(n,e,t)=>{const r=new Set(t.filter(i=>i.leadDesignerId===e||(i.teamMembers||[]).includes(e)).flatMap(i=>{const l=[];return i.clientId&&l.push(i.clientId),i.clientIds&&l.push(...i.clientIds),l}));return n.filter(i=>r.has(i.id))},KT=()=>{const n=window.navigator,e=window.screen,t=[n.userAgent,n.language,e.width+"x"+e.height,e.colorDepth,new Date().getTimezoneOffset(),n.hardwareConcurrency||"unknown",n.deviceMemory||"unknown"].join("|");let r=0;for(let i=0;i<t.length;i++){const l=t.charCodeAt(i);r=(r<<5)-r+l,r=r&r}return Math.abs(r).toString(36)},r6=()=>{const n=navigator.userAgent.toLowerCase();return/tablet|ipad|playbook|silk|(android(?!.*mobi|phone|windows phone))/.test(n)?"tablet":/mobile|phone|windows phone|iphone|android|blackberry|opera mini/.test(n)?"mobile":"desktop"},QT=()=>{const n=navigator.userAgent;return n.includes("Firefox")?"Firefox":n.includes("Chrome")&&!n.includes("Chromium")?"Chrome":n.includes("Safari")&&!n.includes("Chrome")?"Safari":n.includes("Edge")||n.includes("Edg")?"Edge":n.includes("Opera")?"Opera":"Unknown Browser"},YT=()=>{const n=navigator.userAgent.toLowerCase();return n.includes("win")?"Windows":n.includes("mac")?"macOS":n.includes("linux")?"Linux":n.includes("android")?"Android":n.includes("iphone")||n.includes("ipad")?"iOS":"Unknown OS"},s6=()=>{const n=QT(),e=YT();return`${n} on ${e}`},i6=()=>{const n=new Date().toISOString();return{id:KT(),name:s6(),type:r6(),browser:QT(),os:YT(),lastLogin:n,createdAt:n}},a6=n=>{try{const e=JSON.parse(localStorage.getItem("rememberedDevices")||"{}");e[n.id]=n,localStorage.setItem("rememberedDevices",JSON.stringify(e))}catch(e){console.error("Failed to save device to localStorage:",e)}},o6=()=>{try{const n=JSON.parse(localStorage.getItem("rememberedDevices")||"{}");return Object.values(n)}catch(n){return console.error("Failed to get remembered devices:",n),[]}},l6=()=>KT(),c6=n=>{try{const e=JSON.parse(localStorage.getItem("rememberedDevices")||"{}");delete e[n],localStorage.setItem("rememberedDevices",JSON.stringify(e))}catch(e){console.error("Failed to forget device:",e)}},d6=n=>{try{const e=JSON.parse(localStorage.getItem("rememberedDevices")||"{}");e[n]&&(e[n].lastLogin=new Date().toISOString(),localStorage.setItem("rememberedDevices",JSON.stringify(e)))}catch(e){console.error("Failed to update device last login:",e)}},sv="erp_session",JT="erp_session_expiry",u6=1440*60*1e3,h6=1380*60*1e3,Dy=n=>{try{const e=new Date,t=new Date(e.getTime()+u6),r={user:n,loginTime:e.toISOString(),expiresAt:t.toISOString(),isAutoRestored:!1};localStorage.setItem(sv,JSON.stringify(r)),localStorage.setItem(JT,t.toISOString())}catch(e){console.error("Failed to save session:",e)}},iv=()=>{try{const n=localStorage.getItem(sv);if(!n)return null;const e=JSON.parse(n),t=new Date(e.expiresAt);return new Date>t?(XT(),null):e}catch(n){return console.error("Failed to get session:",n),null}},m6=()=>{const n=iv();if(!n)return 0;const e=new Date(n.expiresAt),t=new Date,r=e.getTime()-t.getTime();return Math.max(0,r)},p6=()=>{const n=m6();if(n<=0)return"Session expired";const e=Math.floor(n/(1e3*60*60)),t=Math.floor(n%(1e3*60*60)/(1e3*60));return e>0?`${e}h ${t}m remaining`:`${t}m remaining`},f6=()=>{const n=iv();if(!n)return!1;const e=new Date(n.loginTime);return new Date().getTime()-e.getTime()>=h6},g6=n=>{Dy(n)},XT=()=>{try{localStorage.removeItem(sv),localStorage.removeItem(JT)}catch(n){console.error("Failed to clear session:",n)}},ZT=q.createContext(void 0),x6=({children:n})=>{const[e,t]=q.useState(null),[r,i]=q.useState(null),[l,c]=q.useState(!0),[u,p]=q.useState(null);q.useEffect(()=>AC(Ld,async C=>{var H;try{if(C){let F=null;try{F=await Ry(C.uid),!F&&C.phoneNumber&&(F=await GT(C.uid,C.phoneNumber))}catch(U){console.warn("Could not fetch user profile:",U)}if(!F){if(C.phoneNumber){console.warn("Phone user has no profile and claim failed. Access denied."),i(null),t(null),c(!1);return}F={id:C.uid,name:((H=C.email)==null?void 0:H.split("@")[0])||"Admin",email:C.email||"",role:"Admin",phone:"",tenantId:C.uid}}i(C),t(F),Dy(F)}else{const F=iv();if(F){t(F.user),c(!1);return}i(null),t(null)}}catch(F){console.error("Auth state change error:",F),i(null),t(null)}finally{c(!1)}}),[]);const g=E=>{t(E),Dy(E);try{const{generateDeviceFingerprint:C}=require("../utils/deviceUtils"),H=C();d6(H)}catch{}},b=async()=>{try{t(null),i(null),XT(),await new Promise(E=>setTimeout(E,100)),await AI(Ld)}catch(E){throw console.error("Logout error:",E),E}},w=()=>{e&&g6(e)};return a.jsx(ZT.Provider,{value:{user:e,firebaseUser:r,login:g,logout:b,loading:l,adminCredentials:u,setAdminCredentials:p,extendSession:w},children:n})},ha=()=>{const n=q.useContext(ZT);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},y6=n=>{if(!n)return null;const e=n.split("?")[0].replace(/^\/+/,""),t=new URLSearchParams(n.split("?")[1]||""),r=e.split("/").filter(Boolean);if(r[0]==="project"&&r[1]){const i=r[1],l=t.get("tab")||void 0;return r[2]==="task"&&r[3]?{view:"project-detail",projectId:i,taskId:r[3],targetTab:l}:r[2]==="meeting"&&r[3]?{view:"project-detail",projectId:i,meetingId:r[3],targetTab:"meetings"}:{view:"project-detail",projectId:i,targetTab:l}}return r[0]==="projects"?{view:"projects"}:r[0]==="dashboard"?{view:"dashboard"}:r[0]==="designers"?{view:"designers"}:r[0]==="clients"?{view:"clients"}:r[0]==="vendors"?{view:"vendors"}:r[0]==="admins"?{view:"admins"}:null},pN=(n,e)=>{try{if(e.setCurrentView(n.view),n.projectId&&n.view==="project-detail"){const t=e.projects.find(r=>r.id===n.projectId);if(t&&(e.setSelectedProject(t),n.targetTab&&e.setInitialProjectTab(n.targetTab),n.taskId&&e.tasks)){const i=(e.tasks.get(n.projectId)||[]).find(l=>l.id===n.taskId);i&&e.setSelectedTask(i)}}}catch(t){console.error("Error executing deep link:",t)}},eS=q.createContext(void 0),v6=({children:n,projects:e=[]})=>{const{user:t}=ha(),[r,i]=q.useState([]),[l,c]=q.useState([]),[u,p]=q.useState(null),g=(re,J)=>{var k;const he=e.find(O=>O.id===J);if(!he)return!1;const j=he.clientId===re,ce=he.leadDesignerId===re,D=((k=he.teamMembers)==null?void 0:k.includes(re))||!1;return j||ce||D},b=r.filter(re=>t?re.recipientId?re.recipientId===t.id:re.projectId?g(t.id,re.projectId):!1:!1),w=b.filter(re=>!re.read).length,E=(re,J,he="info",j,ce,D,k)=>{let O;typeof re=="object"?O=re:O={title:re,message:J,type:he,recipientId:j,projectId:ce,projectName:D,targetTab:k};const z={id:Math.random().toString(36).substr(2,9),title:O.title,message:O.message,type:O.type||"info",recipientId:O.recipientId,projectId:O.projectId,projectName:O.projectName,timestamp:new Date,read:!1,targetTab:O.targetTab,taskId:O.taskId,meetingId:O.meetingId,deepLinkPath:O.deepLinkPath};i(B=>[z,...B]),z.recipientId?z.recipientId===(t==null?void 0:t.id)&&(c(B=>[...B,z]),setTimeout(()=>{c(B=>B.filter(K=>K.id!==z.id))},5e3)):z.projectId&&z.projectName&&t&&(c(B=>[...B,z]),setTimeout(()=>{c(B=>B.filter(K=>K.id!==z.id))},5e3))},C=re=>{i(J=>J.map(he=>he.id===re?{...he,read:!0}:he))},H=()=>{i(re=>re.map(J=>!t||J.recipientId&&J.recipientId!==t.id||!J.recipientId&&J.projectId&&!g(t.id,J.projectId)||!J.recipientId&&!J.projectId?J:{...J,read:!0}))},F=()=>{i(re=>t?re.filter(J=>!!(J.recipientId&&J.recipientId!==t.id||!J.recipientId&&J.projectId&&!g(t.id,J.projectId)||!J.recipientId&&!J.projectId)):re)},U=re=>{if(!u)return;if(re.deepLinkPath){const he=y6(re.deepLinkPath);if(he){u(he);return}}const J={view:re.projectId?"project-detail":"dashboard",projectId:re.projectId,taskId:re.taskId,meetingId:re.meetingId,targetTab:re.targetTab};u(J)},ae=re=>{c(J=>J.filter(he=>he.id!==re))};return a.jsxs(eS.Provider,{value:{notifications:b,unreadCount:w,addNotification:E,markAsRead:C,markAllAsRead:H,clearNotifications:F,setDeepLinkHandler:p,handleNotificationDeepLink:U},children:[n,a.jsx("div",{className:"fixed bottom-6 right-6 z-[100] flex flex-col gap-2 pointer-events-none",children:l.map(re=>a.jsxs("div",{className:"bg-white rounded-lg shadow-xl border-l-4 p-4 w-80 pointer-events-auto transform transition-all animate-fade-in flex items-start gap-3",style:{borderColor:re.type==="error"?"#ef4444":re.type==="warning"?"#f59e0b":re.type==="success"?"#22c55e":"#3b82f6"},children:[a.jsxs("div",{className:"mt-0.5",children:[re.type==="success"&&a.jsx(Ed,{className:"w-5 h-5 text-green-500"}),re.type==="error"&&a.jsx(Xi,{className:"w-5 h-5 text-red-500"}),re.type==="warning"&&a.jsx(Cj,{className:"w-5 h-5 text-yellow-500"}),re.type==="info"&&a.jsx(kN,{className:"w-5 h-5 text-blue-500"})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-bold text-gray-800 text-sm",children:re.title}),a.jsx("p",{className:"text-xs text-gray-600 mt-1",children:re.message})]}),a.jsx("button",{onClick:()=>ae(re.id),className:"text-gray-400 hover:text-gray-600",children:a.jsx(mn,{className:"w-4 h-4"})})]},re.id))})]})},sl=()=>{const n=q.useContext(eS);if(!n)throw new Error("useNotifications must be used within a NotificationProvider");return n},tS=q.createContext({loading:!1,showLoading:()=>{},hideLoading:()=>{},message:null}),b6=({children:n})=>{const[e,t]=q.useState(!1),[r,i]=q.useState(null),l=u=>{u&&i(u),t(!0);try{document.body.style.overflow="hidden"}catch{}},c=()=>{t(!1),i(null);try{document.body.style.overflow=""}catch{}};return a.jsx(tS.Provider,{value:{loading:e,showLoading:l,hideLoading:c,message:r},children:n})},tm=()=>q.useContext(tS),si=async(n,e,t,r="completed",i,l)=>{try{const u=new Date().toISOString();let p=i||u,g=l||u;if(p&&!/^\d{4}-\d{2}-\d{2}/.test(p))console.warn(`Invalid startDate format: ${p}, using current timestamp instead`),p=u;else if(p){const w=new Date(p);isNaN(w.getTime())&&(console.warn(`Invalid startDate value: ${p}, using current timestamp instead`),p=u)}if(g&&!/^\d{4}-\d{2}-\d{2}/.test(g))console.warn(`Invalid endDate format: ${g}, using current timestamp instead`),g=u;else if(g){const w=new Date(g);isNaN(w.getTime())&&(console.warn(`Invalid endDate value: ${g}, using current timestamp instead`),g=u)}new Date(g)<new Date(p)&&(g=p);const b={projectId:n,title:e,description:t,status:r,type:"milestone",startDate:p,endDate:g,createdAt:new Date().toISOString()};return await C6(n,b)}catch(c){throw console.error("Error logging timeline event:",c),c}},w6=async(n,e)=>{try{const t=pn(st,"projects",n,"tasks"),r=It(t),i=Object.fromEntries(Object.entries({...e}).filter(([l,c])=>c!==void 0));if(await $s(r,{...i,createdAt:new Date,updatedAt:new Date}),e.assigneeId){const l=It(st,"projects",n);try{const c=await da(It(st,"users",e.assigneeId));c.exists()&&c.data().role==="Vendor"?await Rr(l,{vendorIds:xc(e.assigneeId)}):(await da(It(st,"vendors",e.assigneeId))).exists()&&await Rr(l,{vendorIds:xc(e.assigneeId)})}catch(c){console.warn("Failed to update project vendorIds:",c)}}return r.id}catch(t){throw console.error("Error creating task:",t),t}},ii=async(n,e,t)=>{try{const r=Object.fromEntries(Object.entries({...t}).filter(([i,l])=>l!==void 0));if(await Rr(It(st,"projects",n,"tasks",e),{...r,updatedAt:new Date}),t.assigneeId){const i=It(st,"projects",n);try{const l=await da(It(st,"users",t.assigneeId));l.exists()&&l.data().role==="Vendor"?await Rr(i,{vendorIds:xc(t.assigneeId)}):(await da(It(st,"vendors",t.assigneeId))).exists()&&await Rr(i,{vendorIds:xc(t.assigneeId)})}catch(l){console.warn("Failed to update project vendorIds on task update:",l)}}}catch(r){throw console.error("Error updating task:",r),r}},_6=async(n,e)=>{try{await gc(It(st,"projects",n,"tasks",e))}catch(t){throw console.error("Error deleting task:",t),t}},av=(n,e)=>hi(pn(st,"projects",n,"tasks"),t=>{const r=t.docs.map(i=>({...i.data(),id:i.id}));e(r)},t=>{t.code!=="permission-denied"&&console.error("Error subscribing to tasks:",t)}),N6=async(n,e)=>{try{const t=pn(st,"projects",n,"meetings"),r=It(t),i=Object.fromEntries(Object.entries({...e}).filter(([l,c])=>c!==void 0));return await $s(r,{...i,createdAt:new Date,updatedAt:new Date}),r.id}catch(t){throw console.error("Error creating meeting:",t),t}},I6=async(n,e,t)=>{try{const r=Object.fromEntries(Object.entries({...t}).filter(([i,l])=>l!==void 0));await Rr(It(st,"projects",n,"meetings",e),{...r,updatedAt:new Date})}catch(r){throw console.error("Error updating meeting:",r),r}},E6=async(n,e)=>{try{await gc(It(st,"projects",n,"meetings",e))}catch(t){throw console.error("Error deleting meeting:",t),t}},T6=(n,e)=>hi(pn(st,"projects",n,"meetings"),t=>{const r=t.docs.map(i=>({...i.data(),id:i.id}));e(r)},t=>{t.code!=="permission-denied"&&console.error("Error subscribing to meetings:",t)}),S6=async(n,e,t)=>{try{const r=pn(st,"projects",n,"meetings",e,"comments"),i=It(r),l=Object.fromEntries(Object.entries({...t}).filter(([c,u])=>u!==void 0));return await $s(i,{...l,createdAt:new Date}),i.id}catch(r){throw console.error("Error adding comment to meeting:",r),r}},A6=(n,e,t)=>hi(pn(st,"projects",n,"meetings",e,"comments"),r=>{const i=r.docs.map(l=>({...l.data(),id:l.id}));t(i)}),Py=async(n,e)=>{try{const t=pn(st,"projects",n,"documents"),r=It(t),i=Object.fromEntries(Object.entries({...e}).filter(([l,c])=>c!==void 0));return await $s(r,{...i,createdAt:new Date,updatedAt:new Date}),r.id}catch(t){throw console.error("Error creating document:",t),t}},zu=async(n,e,t)=>{try{const r=Object.fromEntries(Object.entries({...t}).filter(([i,l])=>l!==void 0));await Rr(It(st,"projects",n,"documents",e),{...r,updatedAt:new Date})}catch(r){throw console.error("Error updating document:",r),r}},j6=async(n,e)=>{try{await gc(It(st,"projects",n,"documents",e))}catch(t){throw console.error("Error deleting document:",t),t}},nS=(n,e)=>{const t=new Map,r=[],i=hi(pn(st,"projects",n,"documents"),l=>{l.docs.forEach(c=>{const u=c.id,p=c.data();t.set(u,{...p,id:u,comments:p.comments||[]})}),t.forEach((c,u)=>{l.docs.find(p=>p.id===u)||t.delete(u)}),e(Array.from(t.values()))},l=>{l.code!=="permission-denied"&&console.error("Error subscribing to documents:",l)});return r.push(i),()=>{r.forEach(l=>l())}},k6=async(n,e,t)=>{try{const r=It(st,"projects",n,"documents",e),i=Object.fromEntries(Object.entries({...t}).filter(([u,p])=>p!==void 0)),l=Math.random().toString(36).substr(2,9),c={id:l,userId:i.userId||"",text:i.text||"",timestamp:i.timestamp||new Date().toISOString(),...i};return await Rr(r,{comments:xc(c)}),l}catch(r){throw console.error("Error adding comment:",r),r}},C6=async(n,e)=>{try{const t=pn(st,"projects",n,"timelines"),r=It(t),i=Object.fromEntries(Object.entries({...e}).filter(([l,c])=>c!==void 0));return await $s(r,{...i,createdAt:new Date,updatedAt:new Date}),r.id}catch(t){throw console.error("Error creating timeline:",t),t}},R6=(n,e)=>{try{const t=pn(st,"projects",n,"timelines");return hi(t,r=>{const i=r.docs.map(l=>({...l.data(),id:l.id}));e(i)},r=>{r.code!=="permission-denied"&&console.error("Error subscribing to timelines:",r)})}catch(t){throw console.error("Error subscribing to timelines:",t),t}};/*! Capacitor: https://capacitorjs.com/ - MIT License */var $d;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})($d||($d={}));class Px extends Error{constructor(e,t,r){super(e),this.message=e,this.code=t,this.data=r}}const D6=n=>{var e,t;return n!=null&&n.androidBridge?"android":!((t=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},P6=n=>{const e=n.CapacitorCustomPlatform||null,t=n.Capacitor||{},r=t.Plugins=t.Plugins||{},i=()=>e!==null?e.name:D6(n),l=()=>i()!=="web",c=w=>{const E=g.get(w);return!!(E!=null&&E.platforms.has(i())||u(w))},u=w=>{var E;return(E=t.PluginHeaders)===null||E===void 0?void 0:E.find(C=>C.name===w)},p=w=>n.console.error(w),g=new Map,b=(w,E={})=>{const C=g.get(w);if(C)return console.warn(`Capacitor plugin "${w}" already registered. Cannot register plugins twice.`),C.proxy;const H=i(),F=u(w);let U;const ae=async()=>(!U&&H in E?U=typeof E[H]=="function"?U=await E[H]():U=E[H]:e!==null&&!U&&"web"in E&&(U=typeof E.web=="function"?U=await E.web():U=E.web),U),re=(k,O)=>{var z,B;if(F){const K=F==null?void 0:F.methods.find(M=>O===M.name);if(K)return K.rtype==="promise"?M=>t.nativePromise(w,O.toString(),M):(M,Ve)=>t.nativeCallback(w,O.toString(),M,Ve);if(k)return(z=k[O])===null||z===void 0?void 0:z.bind(k)}else{if(k)return(B=k[O])===null||B===void 0?void 0:B.bind(k);throw new Px(`"${w}" plugin is not implemented on ${H}`,$d.Unimplemented)}},J=k=>{let O;const z=(...B)=>{const K=ae().then(M=>{const Ve=re(M,k);if(Ve){const me=Ve(...B);return O=me==null?void 0:me.remove,me}else throw new Px(`"${w}.${k}()" is not implemented on ${H}`,$d.Unimplemented)});return k==="addListener"&&(K.remove=async()=>O()),K};return z.toString=()=>`${k.toString()}() { [capacitor code] }`,Object.defineProperty(z,"name",{value:k,writable:!1,configurable:!1}),z},he=J("addListener"),j=J("removeListener"),ce=(k,O)=>{const z=he({eventName:k},O),B=async()=>{const M=await z;j({eventName:k,callbackId:M},O)},K=new Promise(M=>z.then(()=>M({remove:B})));return K.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await B()},K},D=new Proxy({},{get(k,O){switch(O){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return F?ce:he;case"removeListener":return j;default:return J(O)}}});return r[w]=D,g.set(w,{name:w,proxy:D,platforms:new Set([...Object.keys(E),...F?[H]:[]])}),D};return t.convertFileSrc||(t.convertFileSrc=w=>w),t.getPlatform=i,t.handleError=p,t.isNativePlatform=l,t.isPluginAvailable=c,t.registerPlugin=b,t.Exception=Px,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},O6=n=>n.Capacitor=P6(n),Ko=O6(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),nm=Ko.registerPlugin;class ov{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let r=!1;this.listeners[e]||(this.listeners[e]=[],r=!0),this.listeners[e].push(t);const l=this.windowListeners[e];l&&!l.registered&&this.addWindowListener(l),r&&this.sendRetainedArgumentsForEvent(e);const c=async()=>this.removeListener(e,t);return Promise.resolve({remove:c})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,r){const i=this.listeners[e];if(!i){if(r){let l=this.retainedEventArguments[e];l||(l=[]),l.push(t),this.retainedEventArguments[e]=l}return}i.forEach(l=>l(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:r=>{this.notifyListeners(t,r)}}}unimplemented(e="not implemented"){return new Ko.Exception(e,$d.Unimplemented)}unavailable(e="not available"){return new Ko.Exception(e,$d.Unavailable)}async removeListener(e,t){const r=this.listeners[e];if(!r)return;const i=r.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(r=>{this.notifyListeners(e,r)}))}}const fN=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),gN=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class M6 extends ov{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(r=>{if(r.length<=0)return;let[i,l]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=gN(i).trim(),l=gN(l).trim(),t[i]=l}),t}async setCookie(e){try{const t=fN(e.key),r=fN(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,l=(e.path||"/").replace("path=",""),c=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${r||""}${i}; path=${l}; ${c};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}nm("CapacitorCookies",{web:()=>new M6});const V6=async n=>new Promise((e,t)=>{const r=new FileReader;r.onload=()=>{const i=r.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},r.onerror=i=>t(i),r.readAsDataURL(n)}),L6=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(i=>i.toLocaleLowerCase()).reduce((i,l,c)=>(i[l]=n[e[c]],i),{})},$6=(n,e=!0)=>n?Object.entries(n).reduce((r,i)=>{const[l,c]=i;let u,p;return Array.isArray(c)?(p="",c.forEach(g=>{u=e?encodeURIComponent(g):g,p+=`${l}=${u}&`}),p.slice(0,-1)):(u=e?encodeURIComponent(c):c,p=`${l}=${u}`),`${r}&${p}`},"").substr(1):null,F6=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),i=L6(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(i.includes("application/x-www-form-urlencoded")){const l=new URLSearchParams;for(const[c,u]of Object.entries(n.data||{}))l.set(c,u);t.body=l.toString()}else if(i.includes("multipart/form-data")||n.data instanceof FormData){const l=new FormData;if(n.data instanceof FormData)n.data.forEach((u,p)=>{l.append(p,u)});else for(const u of Object.keys(n.data))l.append(u,n.data[u]);t.body=l;const c=new Headers(t.headers);c.delete("content-type"),t.headers=c}else(i.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class B6 extends ov{async request(e){const t=F6(e,e.webFetchExtra),r=$6(e.params,e.shouldEncodeUrlParams),i=r?`${e.url}?${r}`:e.url,l=await fetch(i,t),c=l.headers.get("content-type")||"";let{responseType:u="text"}=l.ok?e:{};c.includes("application/json")&&(u="json");let p,g;switch(u){case"arraybuffer":case"blob":g=await l.blob(),p=await V6(g);break;case"json":p=await l.json();break;case"document":case"text":default:p=await l.text()}const b={};return l.headers.forEach((w,E)=>{b[E]=w}),{data:p,headers:b,status:l.status,url:l.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}nm("CapacitorHttp",{web:()=>new B6});var xN;(function(n){n.Dark="DARK",n.Light="LIGHT",n.Default="DEFAULT"})(xN||(xN={}));var yN;(function(n){n.StatusBar="StatusBar",n.NavigationBar="NavigationBar"})(yN||(yN={}));class U6 extends ov{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}nm("SystemBars",{web:()=>new U6});const gd=nm("PushNotifications",{}),Ox=async n=>{if(Ko.isNativePlatform())try{let e=await gd.checkPermissions();return e.receive==="prompt"&&(e=await gd.requestPermissions()),e.receive!=="granted"?(console.log("Push notification permission denied"),null):(await gd.register(),new Promise(t=>{gd.addListener("registration",async({value:r})=>{if(console.log("Push registration success, token: "+r),r&&n){const i=It(st,"users",n);(await da(i)).exists()&&(await Rr(i,{fcmTokens:xc(r)}),console.log(" Native Token saved successfully!"))}t(r)}),gd.addListener("registrationError",r=>{console.error("Error on registration: "+JSON.stringify(r)),t(null)})}))}catch(e){return console.error("Error requesting native notification permission:",e),null}if(!ff)return console.log("Notification permission skipped: Messaging not supported"),null;try{console.log("Requesting notification permission for user:",n);const e=await Notification.requestPermission();if(console.log("Permission status:",e),e==="granted"){console.log("Getting FCM token...");const t=await KM(ff,{vapidKey:"BC8fFC7blIHMaLia44KI9ALElvAUqVUTn_x_GL7Ce17SVafTMdVNyMIRSnxPu6UjbkSrisqkYJb2_XZvzTCKjq0"});if(console.log("FCM Token received:",t?t.substring(0,20)+"...":"null"),t&&n){const r=It(st,"users",n);(await da(r)).exists()?(console.log("Saving token to user profile..."),await Rr(r,{fcmTokens:xc(t)}),console.log(" Token saved successfully!")):console.error("User document doesn't exist:",n)}else console.error("Token or userId missing:",{hasToken:!!t,userId:n});return t}else return console.log("Notification permission denied"),null}catch(e){return console.error("Error requesting notification permission:",e),null}},z6=(n,e)=>new Promise(t=>{if(Ko.isNativePlatform()){gd.addListener("pushNotificationReceived",r=>{var i,l,c,u,p;if(console.log("Push received: "+JSON.stringify(r)),n){const g=((i=r.data)==null?void 0:i.deepLinkPath)||"/";n({title:r.title||"New Notification",message:r.body||"",type:"info",projectId:(l=r.data)==null?void 0:l.projectId,taskId:(c=r.data)==null?void 0:c.taskId,meetingId:(u=r.data)==null?void 0:u.meetingId,targetTab:(p=r.data)==null?void 0:p.targetTab,deepLinkPath:g})}t(r)});return}if(!ff){t(null);return}QM(ff,r=>{var g,b,w,E,C,H,F,U,ae,re,J;console.log(" Foreground message received:",r);const i=((g=r.data)==null?void 0:g.deepLinkPath)||((b=r.fcmOptions)==null?void 0:b.link)||"/",l=(w=r.data)==null?void 0:w.projectId,c=(E=r.data)==null?void 0:E.taskId,u=(C=r.data)==null?void 0:C.meetingId,p=(H=r.data)==null?void 0:H.targetTab;if(Notification.permission==="granted"){const he=((F=r.notification)==null?void 0:F.title)||"New Notification",j={body:((U=r.notification)==null?void 0:U.body)||"",icon:((ae=r.notification)==null?void 0:ae.icon)||"/icons/icon-192x192.png",badge:"/icons/icon-192x192.png",tag:"notification-"+Date.now(),requireInteraction:!1,data:{url:i,deepLinkPath:i,projectId:l,taskId:c,meetingId:u,targetTab:p}},ce=new Notification(he,j);ce.onclick=D=>{D.preventDefault(),window.focus(),i!=="/"&&(window.location.href=i),ce.close()},console.log(" Browser notification displayed with deep-link:",i)}n&&n({title:((re=r.notification)==null?void 0:re.title)||"New Notification",message:((J=r.notification)==null?void 0:J.body)||"",type:"info",projectId:l,taskId:c,meetingId:u,targetTab:p,deepLinkPath:i}),t(r)})}),q6=()=>"https://sendpushnotification-jl3d2uhdra-uc.a.run.app",W6=q6(),mi=async(n,e,t,r)=>{try{const i={recipientId:n,title:e,body:t,deepLinkPath:(r==null?void 0:r.deepLinkPath)||"/",projectId:r==null?void 0:r.projectId,taskId:r==null?void 0:r.taskId,meetingId:r==null?void 0:r.meetingId,targetTab:r==null?void 0:r.targetTab,icon:(r==null?void 0:r.icon)||"/icons/icon-192x192.png"};await fetch(W6,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}catch(i){console.error("Error sending push notification:",i)}},H6=n=>n.split(" ").slice(0,2).map(e=>e.charAt(0).toUpperCase()).join(""),G6=(n,e)=>{if(e==="client")return{bg:"bg-blue-100",text:"text-blue-700",border:"border-blue-200"};if(e==="vendor")return{bg:"bg-amber-100",text:"text-amber-700",border:"border-amber-200"};if(e==="designer"||e==="team")return{bg:"bg-indigo-100",text:"text-indigo-700",border:"border-indigo-200"};if(e==="admin")return{bg:"bg-gray-800",text:"text-white",border:"border-gray-700"};const t=[{bg:"bg-red-500",text:"text-white"},{bg:"bg-blue-500",text:"text-white"},{bg:"bg-green-500",text:"text-white"},{bg:"bg-purple-500",text:"text-white"},{bg:"bg-pink-500",text:"text-white"},{bg:"bg-yellow-500",text:"text-white"},{bg:"bg-indigo-500",text:"text-white"},{bg:"bg-teal-500",text:"text-white"},{bg:"bg-orange-500",text:"text-white"},{bg:"bg-cyan-500",text:"text-white"}],r=n.split("").reduce((i,l)=>i+l.charCodeAt(0),0);return t[r%t.length]},za=({avatar:n,name:e,size:t="md",role:r})=>{const i=H6(e),l=G6(i,r),c={sm:"w-8 h-8 text-xs",md:"w-12 h-12 text-sm",lg:"w-16 h-16 text-lg"},u=l.border?l.border:"border-gray-200";return a.jsx("div",{className:`${c[t]} ${l.bg} rounded-full flex items-center justify-center ${l.text} font-bold border-2 ${u}`,children:i})},ra=n=>{if(n.progress!==void 0&&n.progress!==null)return Math.min(Math.max(n.progress,0),100);if(n.subtasks&&n.subtasks.length>0){const e=n.subtasks.filter(t=>t.isCompleted).length;return Math.round(e/n.subtasks.length*100)}return n.status===xe.DONE||n.status===xe.REVIEW?100:n.status===xe.IN_PROGRESS?50:0},vh=n=>{if(!n||n.length===0)return 0;const e=n.reduce((t,r)=>t+ra(r),0);return Math.round(e/n.length)},pp=(n,e=xe.TODO)=>{var i,l,c,u,p,g,b,w,E,C,H,F;if(e===xe.ABORTED||e===xe.ON_HOLD)return e;const t=n.subtasks||[];if(t.length===0)return e;const r=t.filter(U=>U.isCompleted).length;if(r===0)return xe.TODO;if(r===t.length){const U=((c=(l=(i=n.approvals)==null?void 0:i.start)==null?void 0:l.client)==null?void 0:c.status)==="approved",ae=((g=(p=(u=n.approvals)==null?void 0:u.start)==null?void 0:p.admin)==null?void 0:g.status)==="approved",re=((E=(w=(b=n.approvals)==null?void 0:b.completion)==null?void 0:w.client)==null?void 0:E.status)==="approved",J=((F=(H=(C=n.approvals)==null?void 0:C.completion)==null?void 0:H.admin)==null?void 0:F.status)==="approved";return U&&ae&&re&&J?xe.DONE:xe.REVIEW}return xe.IN_PROGRESS},Mx=n=>{try{const e=new Date(n);if(isNaN(e.getTime()))return n;const r=new Date().getTime()-e.getTime(),i=Math.floor(r/1e3),l=Math.floor(i/60),c=Math.floor(l/60),u=Math.floor(c/24),p=Math.floor(u/7),g=Math.floor(u/30);return i<60?"Just now":l<60?`${l} minute${l>1?"s":""} ago`:c<24?`${c} hour${c>1?"s":""} ago`:u<7?`${u} day${u>1?"s":""} ago`:p<4?`${p} week${p>1?"s":""} ago`:`${g} month${g>1?"s":""} ago`}catch{return n}},dn=n=>{if(!n)return"";try{let e;if(n.includes("-"))e=new Date(n);else if(n.includes("/")){const l=n.split("/");if(l.length===3){const c=parseInt(l[0]),u=parseInt(l[1]),p=parseInt(l[2]);if(c>12)return n;e=new Date(p,u-1,c)}else return n}else e=new Date(n);if(isNaN(e.getTime()))return n;const t=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),i=e.getFullYear();return`${t}/${r}/${i}`}catch{return n}},Oy=async(n,e)=>{try{const t=pn(st,"projects",n,"finances"),r=It(t),i=Object.fromEntries(Object.entries({...e}).filter(([l,c])=>c!==void 0));return await $s(r,{...i,createdAt:new Date,updatedAt:new Date}),r.id}catch(t){throw console.error("Error creating financial record:",t),t}},xd=async(n,e,t)=>{try{const r=Object.fromEntries(Object.entries({...t}).filter(([i,l])=>l!==void 0));await Rr(It(st,"projects",n,"finances",e),{...r,updatedAt:new Date})}catch(r){throw console.error("Error updating financial record:",r),r}},K6=async(n,e)=>{try{await gc(It(st,"projects",n,"finances",e))}catch(t){throw console.error("Error deleting financial record:",t),t}},rS=(n,e)=>hi(pn(st,"projects",n,"finances"),t=>{const r=t.docs.map(i=>({...i.data(),id:i.id}));e(r)},t=>{t.code!=="permission-denied"&&console.error("Error subscribing to financial records:",t)}),Q6=()=>"https://sendemail-jl3d2uhdra-uc.a.run.app",Y6=Q6(),Yr=async n=>{if(!n.to||!n.subject||!n.htmlContent)return{success:!1,error:"Missing required email fields"};try{const e={to:n.to,recipientName:n.recipientName||n.to.split("@")[0],subject:n.subject,htmlContent:n.htmlContent},t=await fetch(Y6,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const i=await t.json();return console.error(" Cloud Function error:",i),{success:!1,error:i.error||"Failed to send email"}}return{success:!0,messageId:(await t.json()).messageId}}catch(e){return console.error(" Error sending email:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}},sS=async(n,e,t,r,i)=>{const l=`
    <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background-color: #f9fafb; padding: 20px;">
      <div style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">
        <h2 style="color: #fff; margin: 0; font-size: 24px;"> Task Reminder</h2>
      </div>
      
      <div style="background-color: white; padding: 30px; border-radius: 0 0 8px 8px;">
        <p style="color: #333; font-size: 16px;">Hi <strong>${e}</strong>,</p>
        
        <p style="color: #555; font-size: 14px;">This is a friendly reminder about the following task:</p>
        
        <div style="background-color: #eff6ff; border-left: 4px solid #2563eb; padding: 15px; margin: 20px 0; border-radius: 4px;">
          <p style="margin: 8px 0; color: #333;"><strong>Task:</strong> ${t}</p>
          <p style="margin: 8px 0; color: #333;"><strong>Project:</strong> ${r}</p>
          <p style="margin: 8px 0; color: #d97706;"><strong>Due Date:</strong> ${dn(i)}</p>
        </div>
        
        <p style="color: #555; font-size: 14px;">Please update the task status at your earliest convenience.</p>
        
        <p style="margin-top: 30px; color: #999; font-size: 12px; border-top: 1px solid #e5e7eb; padding-top: 20px;">
          Regards,<br>
          <strong>ID ERP System</strong>
        </p>
      </div>
    </div>
  `;return Yr({to:n,recipientName:e,subject:`Reminder: ${t}`,htmlContent:l})},J6=async(n,e,t,r)=>{const i=`
    <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background-color: #f9fafb; padding: 20px;">
      <div style="background: linear-gradient(135deg, #ca8a04 0%, #b45309 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">
        <h2 style="color: #fff; margin: 0; font-size: 24px;"> Payment Reminder</h2>
      </div>
      
      <div style="background-color: white; padding: 30px; border-radius: 0 0 8px 8px;">
        <p style="color: #333; font-size: 16px;">Hi <strong>${e}</strong>,</p>
        
        <p style="color: #555; font-size: 14px;">This is a gentle reminder regarding pending payments for the following project:</p>
        
        <div style="background-color: #fef3c7; border-left: 4px solid #ca8a04; padding: 15px; margin: 20px 0; border-radius: 4px;">
          <p style="margin: 8px 0; color: #333;"><strong>Project:</strong> ${t}</p>
          
        </div>
        
        <p style="color: #555; font-size: 14px;">Please clear the dues at your earliest convenience to avoid any service delays.</p>
        
        <p style="margin-top: 30px; color: #999; font-size: 12px; border-top: 1px solid #e5e7eb; padding-top: 20px;">
          Regards,<br>
          <strong>ID ERP System</strong>
        </p>
      </div>
    </div>
  `;return Yr({to:n,recipientName:e,subject:`Payment Reminder: ${t}`,htmlContent:i})};var Za={};const X6=async(n,e,t,r=new Set)=>{const i=new Date,l=new Date(i.getTime()+1440*60*1e3),c=new Date(i.getTime()+1500*60*1e3);for(const u of n){const p=new Date(u.dueDate),g=`${u.id}-24h-reminder`;if(p>l&&p<c&&!r.has(g)){const b=e.find(w=>w.id===u.assigneeId);if(b!=null&&b.email)try{const w=await sS(b.email,b.name,u.title,t,u.dueDate);w.success?(r.add(g),await mi(b.id,"Task Due Reminder",`Task "${u.title}" is due tomorrow in project ${t}`)):console.error(" Failed to send 24-hour reminder:",w.error)}catch(w){console.error(" Error sending 24-hour reminder:",w)}}}},Z6=async(n,e,t,r,i)=>{const l=typeof window<"u"?window.location.origin:Za.REACT_APP_BASE_URL||"http://localhost:5173",c=i?`${l}?projectId=${i}&tab=documents`:void 0;for(const u of r){if(!u.email){console.warn(` No email for recipient ${u.name}`);continue}try{const p=`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #1f2937;">New Document Uploaded</h2>
          <p>Hi ${u.name},</p>
          <p><strong>${e}</strong> uploaded a new document in project <strong>${t}</strong>:</p>
          
          <div style="background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">
            <p style="margin: 0; color: #4b5563;"><strong>Document:</strong> ${n.name}</p>
            <p style="margin: 10px 0 0 0; color: #6b7280;"><strong>Type:</strong> ${n.type}</p>
          </div>
          
          <p style="margin-top: 20px;">
            <a href="${c}" style="background-color: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;">View Document</a>
          </p>
        </div>
      `,g=await Yr({to:u.email,recipientName:u.name,subject:`New Document Uploaded: ${n.name} - ${t}`,htmlContent:p});g.success?await mi(u.id,`New Document - ${t}`,`${e} uploaded "${n.name}" (${n.type})`,c):console.error(` Failed to send document upload notification to ${u.name}:`,g.error)}catch(p){console.error(` Error sending document upload notification to ${u.name}:`,p)}}},Vx=async(n,e,t,r,i)=>{if(!e.email){console.warn(` No email for recipient ${e.name}`);return}const l=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: #dcfce7; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: #16a34a; margin: 0;"> Task Approved</h2>
      </div>
      
      <p>Hi <strong>${e.name}</strong>,</p>
      
      <p>The task <strong>"${n}"</strong> in project <strong>${t}</strong> has been approved.</p>
      
      <div style="background-color: #f0fdf4; border-left: 4px solid #16a34a; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Task:</strong> ${n}</p>
        <p style="margin: 5px 0;"><strong>Project:</strong> ${t}</p>
        <p style="margin: 5px 0;"><strong>Approval Stage:</strong> ${i}</p>
        <p style="margin: 5px 0;"><strong>Approved by:</strong> ${r}</p>
      </div>
      
      <p>Great work! The task has been successfully approved and is moving forward.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;try{const c=await Yr({to:e.email,recipientName:e.name,subject:`Task Approved: ${n}`,htmlContent:l});c.success?await mi(e.id,"Task Approved",`Task "${n}" in project ${t} has been approved by ${r}`):console.error(" Failed to send task approval email:",c.error)}catch(c){console.error(" Error sending task approval email:",c)}},vN=async(n,e,t,r,i="created")=>{if(!e||e.length===0){console.warn(` No attendees for meeting ${n.title}`);return}const c=`${typeof window<"u"?window.location.origin:Za.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${r}&meetingId=${n.id}&tab=meetings`,u=i==="created"?"New Meeting Scheduled":"Meeting Updated",p=i==="created"?"#0284c7":"#f59e0b",b=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: ${i==="created"?"#dbeafe":"#fef3c7"}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: ${p}; margin: 0;"> ${u}</h2>
      </div>
      
      <p>Hi <strong>Team</strong>,</p>
      
      <p>${i==="created"?"A new meeting has been scheduled":"A meeting has been updated"} for project <strong>${t}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid ${p}; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Meeting Title:</strong> ${n.title}</p>
        <p style="margin: 5px 0;"><strong>Type:</strong> ${n.type}</p>
        <p style="margin: 5px 0;"><strong>Date:</strong> ${dn(n.date)}</p>
        <p style="margin: 5px 0;"><strong>Project:</strong> ${t}</p>
        ${n.notes?`<p style="margin: 5px 0;"><strong>Notes:</strong> ${n.notes}</p>`:""}
      </div>
      
      <div style="background-color: #f5f5f5; padding: 15px; border-radius: 4px; margin: 20px 0;">
        <p style="margin: 5px 0; font-weight: bold;">Attendees:</p>
        <ul style="margin: 10px 0; padding-left: 20px;">
          ${e.map(w=>`<li>${w.name}${w.email?` (${w.email})`:""}</li>`).join("")}
        </ul>
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${c}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View Meeting Details
        </a>
      </div>
      
      <p>Click the button above to view the full meeting details and any additional information in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const w of e){if(!w.email){console.warn(` No email for attendee ${w.name}`);continue}try{const E=await Yr({to:w.email,recipientName:w.name,subject:`${u}: ${n.title} - ${t}`,htmlContent:b});E.success?await mi(w.id,u,`${i==="created"?"New meeting scheduled":"Meeting updated"}: ${n.title} in project ${t}`,c):console.error(` Failed to send meeting notification email to ${w.name}:`,E.error)}catch(E){console.error(` Error sending meeting notification email to ${w.name}:`,E)}}},bN=async(n,e,t,r,i="created")=>{if(!e.email){console.warn(` No email for assignee ${e.name}`);return}const c=`${typeof window<"u"?window.location.origin:Za.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${r}&taskId=${n.id}&tab=plan`,u=i==="created"?"New Task Assigned":"Task Updated",p=i==="created"?"#0284c7":"#f59e0b",b=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: ${i==="created"?"#dbeafe":"#fef3c7"}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: ${p}; margin: 0;"> ${u}</h2>
      </div>
      
      <p>Hi <strong>${e.name}</strong>,</p>
      
      <p>${i==="created"?"You have been assigned a new task":"A task you are assigned to has been updated"} in project <strong>${t}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid ${p}; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Task:</strong> ${n.title}</p>
        <p style="margin: 5px 0;"><strong>Category:</strong> ${n.category}</p>
        <p style="margin: 5px 0;"><strong>Priority:</strong> <span style="color: ${n.priority==="high"?"#dc2626":n.priority==="medium"?"#f59e0b":"#059669"}; font-weight: bold;">${n.priority.toUpperCase()}</span></p>
        <p style="margin: 5px 0;"><strong>Start Date:</strong> ${dn(n.startDate)}</p>
        <p style="margin: 5px 0;"><strong>Due Date:</strong> ${dn(n.dueDate)}</p>
        ${n.description?`<p style="margin: 5px 0;"><strong>Description:</strong> ${n.description}</p>`:""}
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${c}" style="display: inline-block; background-color: ${p}; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View Task Details
        </a>
      </div>
      
      <p>Click the button above to view the full task details and start working on it in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;try{const w=await Yr({to:e.email,recipientName:e.name,subject:`${u}: ${n.title} - ${t}`,htmlContent:b});w.success?await mi(e.id,u,`${i==="created"?"New task assigned":"Task updated"}: ${n.title} in project ${t}`,c):console.error(" Failed to send task assignment notification email:",w.error)}catch(w){console.error(" Error sending task assignment notification email:",w)}},eV=async(n,e,t,r)=>{if(!e||e.length===0){console.warn(" No recipients for task completion approval notification");return}const l=`${typeof window<"u"?window.location.origin:Za.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${r}&taskId=${n.id}&tab=plan`,c=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: #dbeafe; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: #0284c7; margin: 0;"> Task Completion Approval Pending</h2>
      </div>
      
      <p>Hi Team,</p>
      
      <p>A task has been completed and requires final approval in project <strong>${t}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Task:</strong> ${n.title}</p>
        <p style="margin: 5px 0;"><strong>Category:</strong> ${n.category}</p>
        <p style="margin: 5px 0;"><strong>Status:</strong> 100% Complete - Awaiting Final Approval</p>
        <p style="margin: 5px 0;"><strong>Due Date:</strong> ${dn(n.dueDate)}</p>
      </div>
      
      <div style="background-color: #f5f5f5; padding: 15px; border-radius: 4px; margin: 20px 0;">
        <p style="margin: 5px 0; font-weight: bold;">Approval Required From:</p>
        <ul style="margin: 10px 0; padding-left: 20px;">
          <li>Client</li>
          <li>Admin</li>
        </ul>
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${l}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          Review & Approve Completion
        </a>
      </div>
      
      <p>Click the button above to review the completed task and provide your final approval in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const u of e){if(!u.email){console.warn(` No email for recipient ${u.name}`);continue}try{const p=await Yr({to:u.email,recipientName:u.name,subject:`Task Completion Approval: ${n.title} - ${t}`,htmlContent:c});p.success?await mi(u.id,"Task Completion Approval Pending",`Task "${n.title}" in project ${t} requires completion approval`,l):console.error(` Failed to send task completion approval notification to ${u.name}:`,p.error)}catch(p){console.error(` Error sending task completion approval notification to ${u.name}:`,p)}}},tV=async(n,e,t,r,i,l)=>{if(!r||r.length===0){console.warn(" No recipients for task comment notification");return}const u=`${typeof window<"u"?window.location.origin:Za.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${l}&taskId=${n.id}&tab=plan`,p=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: #dbeafe; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: #0284c7; margin: 0;"> New Comment on Task</h2>
      </div>
      
      <p>Hi Team,</p>
      
      <p><strong>${t}</strong> added a comment to task <strong>"${n.title}"</strong> in project <strong>${i}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Task:</strong> ${n.title}</p>
        <p style="margin: 5px 0;"><strong>Category:</strong> ${n.category}</p>
        <p style="margin: 5px 0;"><strong>Status:</strong> ${n.status}</p>
        <p style="margin: 5px 0;"><strong>Commenter:</strong> ${t}</p>
      </div>
      
      <div style="background-color: #fff8f0; border-left: 4px solid #ea580c; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0 10px 0; font-weight: bold;">Comment:</p>
        <p style="margin: 0; white-space: pre-wrap; color: #333;">${e.text}</p>
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${u}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View Task & Comments
        </a>
      </div>
      
      <p>Click the button above to view the full task and all comments in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const g of r)if(g.id!==e.userId){if(!g.email){console.warn(` No email for recipient ${g.name}`);continue}try{const b=await Yr({to:g.email,recipientName:g.name,subject:`New Comment on Task: ${n.title} - ${i}`,htmlContent:p});b.success?await mi(g.id,`New Comment on Task - ${i}`,`${t} commented on "${n.title}": ${e.text.substring(0,80)}${e.text.length>80?"...":""}`,u):console.error(` Failed to send task comment notification to ${g.name}:`,b.error)}catch(b){console.error(` Error sending task comment notification to ${g.name}:`,b)}}},nV=async(n,e,t,r,i,l)=>{if(!r||r.length===0){console.warn(" No recipients for document comment notification");return}const u=`${typeof window<"u"?window.location.origin:Za.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${l}&tab=documents&docId=${n.id}`,p=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: #dbeafe; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: #0284c7; margin: 0;"> New Comment on Document</h2>
      </div>
      
      <p>Hi Team,</p>
      
      <p><strong>${t}</strong> added a comment to document <strong>"${n.name}"</strong> in project <strong>${i}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Document:</strong> ${n.name}</p>
        <p style="margin: 5px 0;"><strong>Type:</strong> ${n.type||"Not specified"}</p>
        <p style="margin: 5px 0;"><strong>Commenter:</strong> ${t}</p>
        <p style="margin: 5px 0;"><strong>Admin Approval:</strong> ${n.approvalStatus||"Pending"}</p>
      </div>
      
      <div style="background-color: #fff8f0; border-left: 4px solid #ea580c; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0 10px 0; font-weight: bold;">Comment:</p>
        <p style="margin: 0; white-space: pre-wrap; color: #333;">${e.text}</p>
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${u}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View Document & Comments
        </a>
      </div>
      
      <p>Click the button above to view the full document and all comments in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const g of r)if(g.id!==e.userId){if(!g.email){console.warn(` No email for recipient ${g.name}`);continue}try{const b=await Yr({to:g.email,recipientName:g.name,subject:`New Comment on Document: ${n.name} - ${i}`,htmlContent:p});b.success?await mi(g.id,"New Comment on Document",`${t} commented on document "${n.name}" in project ${i}: ${e.text.substring(0,50)}${e.text.length>50?"...":""}`,u):console.error(` Failed to send document comment notification to ${g.name}:`,b.error)}catch(b){console.error(` Error sending document comment notification to ${g.name}:`,b)}}},wN=async(n,e,t,r,i,l="approved")=>{if(!t||t.length===0){console.warn(" No recipients for document admin approval notification");return}const u=`${typeof window<"u"?window.location.origin:Za.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${i}&tab=documents&docId=${n.id}`,p=l==="approved",g=p?"#dcfce7":"#fee2e2",b=p?"#16a34a":"#dc2626",w=p?"Approved":"Rejected",C=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: ${g}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: ${b}; margin: 0;">${p?"":""} Document ${w} by Admin</h2>
      </div>
      
      <p>Hi Team,</p>
      
      <p>Document <strong>"${n.name}"</strong> has been <strong>${l}</strong> by admin <strong>${e}</strong> in project <strong>${r}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Document:</strong> ${n.name}</p>
        <p style="margin: 5px 0;"><strong>Type:</strong> ${n.type||"Not specified"}</p>
        <p style="margin: 5px 0;"><strong>Admin:</strong> ${e}</p>
        <p style="margin: 5px 0;"><strong>Status:</strong> ${w}</p>
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${u}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View All Documents
        </a>
      </div>
      
      <p>Click the button above to view all documents and their approval status in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const H of t){if(!H.email){console.warn(` No email for recipient ${H.name}`);continue}try{const F=await Yr({to:H.email,recipientName:H.name,subject:`Document ${w} by Admin: ${n.name} - ${r}`,htmlContent:C});F.success?await mi(H.id,`Document ${w} by Admin`,`Document "${n.name}" in project ${r} has been ${l} by ${e}`,u):console.error(` Failed to send document admin approval notification to ${H.name}:`,F.error)}catch(F){console.error(` Error sending document admin approval notification to ${H.name}:`,F)}}},_N=async(n,e,t,r,i,l="approved")=>{if(!t||t.length===0){console.warn(" No recipients for document client approval notification");return}const u=`${typeof window<"u"?window.location.origin:Za.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${i}&tab=documents`,p=l==="approved",g=p?"#dcfce7":"#fee2e2",b=p?"#16a34a":"#dc2626",w=p?"Approved":"Rejected",C=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: ${g}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: ${b}; margin: 0;">${p?"":""} Document ${w} by Client</h2>
      </div>
      
      <p>Hi Team,</p>
      
      <p>Document <strong>"${n.name}"</strong> has been <strong>${l}</strong> by client <strong>${e}</strong> in project <strong>${r}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Document:</strong> ${n.name}</p>
        <p style="margin: 5px 0;"><strong>Type:</strong> ${n.type||"Not specified"}</p>
        <p style="margin: 5px 0;"><strong>Client:</strong> ${e}</p>
        <p style="margin: 5px 0;"><strong>Status:</strong> ${w}</p>
      </div>
      
      <div style="margin: 20px 0;">
        <a href="${u}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View All Documents
        </a>
      </div>
      
      <p>Click the button above to view all documents and their approval status in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const H of t){if(!H.email){console.warn(` No email for recipient ${H.name}`);continue}try{const F=await Yr({to:H.email,recipientName:H.name,subject:`Document ${w} by Client: ${n.name} - ${r}`,htmlContent:C});F.success?await mi(H.id,`Document ${w} by Client`,`Document "${n.name}" in project ${r} has been ${l} by ${e}`,u):console.error(` Failed to send document client approval notification to ${H.name}:`,F.error)}catch(F){console.error(` Error sending document client approval notification to ${H.name}:`,F)}}},Lx=async(n,e,t,r,i,l="approved",c="admin",u="expense")=>{if(!t||t.length===0){console.warn(" No recipients for financial approval notification");return}const g=`${typeof window<"u"?window.location.origin:Za.REACT_APP_BASE_URL||"http://localhost:5173"}?projectId=${i}&tab=financials`,b=l==="approved",w=b?"#dcfce7":"#fee2e2",E=b?"#16a34a":"#dc2626",C=b?"":"";let H="Financial Record";u==="additional-budget"?H="Additional Budget":u==="expense"?H="Expense":u==="payment"&&(H="Payment");const F=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333;">
      <div style="background-color: ${w}; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h2 style="color: ${E}; margin: 0;">${C} ${H} ${l==="approved"?"Approved":"Rejected"}</h2>
      </div>
      
      <p>Hi Team,</p>
      
      <p>A ${H.toLowerCase()} has been <strong>${l}</strong> by <strong>${e}</strong> (${c}) in project <strong>${r}</strong>.</p>
      
      <div style="background-color: #f0f9ff; border-left: 4px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <p style="margin: 5px 0;"><strong>Type:</strong> ${H}</p>
        <p style="margin: 5px 0;"><strong>Description:</strong> ${n.description}</p>
        <p style="margin: 5px 0;"><strong>Amount:</strong> ${n.amount.toLocaleString()}</p>
        <p style="margin: 5px 0;"><strong>Status:</strong> ${n.status}</p>
        <p style="margin: 5px 0;"><strong>Approved By:</strong> ${e}</p>
        <p style="margin: 5px 0;"><strong>Approval Status:</strong> ${l==="approved"?"Approved ":"Rejected "}</p>
      </div>

      ${u==="additional-budget"?`
        <div style="background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 4px;">
          <p style="margin: 5px 0; font-weight: bold;"> Additional Budget</p>
          <p style="margin: 5px 0;">This is a request to increase the project budget by ${n.amount.toLocaleString()}. Approval from both Client and Admin is required.</p>
        </div>
      `:""}
      
      <div style="margin: 20px 0;">
        <a href="${g}" style="display: inline-block; background-color: #0284c7; color: white; padding: 12px 24px; border-radius: 4px; text-decoration: none; font-weight: bold;">
          View Financial Records
        </a>
      </div>
      
      <p>Click the button above to view all financial records and their approval status in the system.</p>
      
      <p style="margin-top: 30px; color: #666; font-size: 14px;">
        Regards,<br>
        <strong>ID ERP System</strong>
      </p>
    </div>
  `;for(const U of t){if(!U.email){console.warn(` No email for recipient ${U.name}`);continue}try{const ae=await Yr({to:U.email,recipientName:U.name,subject:`${H} ${l==="approved"?"Approved":"Rejected"}: ${n.description} - ${r}`,htmlContent:F});ae.success?await mi(U.id,`${H} ${l==="approved"?"Approved":"Rejected"}`,`${H} "${n.description}" in project ${r} has been ${l} by ${e}`,g):console.error(` Failed to send financial approval notification to ${U.name}:`,ae.error)}catch(ae){console.error(` Error sending financial approval notification to ${U.name}:`,ae)}}},rV=async(n,e,t,r,i)=>{const l=`/projects?projectId=${n.id}`;for(const c of i){if(!c.email){console.warn(` No email for recipient ${c.name}`);continue}try{const u=`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #1f2937;">New Comment on Meeting</h2>
          <p>Hi ${c.name},</p>
          <p><strong>${t}</strong> commented on a meeting in project <strong>${r}</strong>:</p>
          
          <div style="background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0;">
            <p style="margin: 0; color: #4b5563;"><strong>Meeting:</strong> ${n.title}</p>
            <p style="margin: 10px 0 0 0; color: #6b7280;">"${e.text}"</p>
          </div>
          
          <p style="margin-top: 20px;">
            <a href="${l}" style="background-color: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;">View Meeting</a>
          </p>
        </div>
      `,p=await Yr({to:c.email,recipientName:c.name,subject:`New Comment on Meeting: ${n.title} - ${r}`,htmlContent:u});p.success?await mi(c.id,`New Comment on Meeting - ${r}`,`${t} commented on "${n.title}": ${e.text.substring(0,100)}${e.text.length>100?"...":""}`,l):console.error(` Failed to send meeting comment notification to ${c.name}:`,p.error)}catch(u){console.error(` Error sending meeting comment notification to ${c.name}:`,u)}}},fp=({currentField:n,currentOrder:e,fields:t,onSort:r})=>a.jsxs("div",{className:"flex items-center gap-1 bg-white/50 rounded-lg px-2 py-1 border border-gray-100",children:[a.jsx("select",{value:n,onChange:i=>r(i.target.value,e),className:"text-[10px] font-bold bg-transparent border-none focus:ring-0 cursor-pointer text-gray-500 hover:text-gray-700 p-0","aria-label":"Sort field",title:"Sort field",children:t.map(i=>a.jsx("option",{value:i.value,children:i.label},i.value))}),a.jsx("button",{onClick:()=>r(n,e==="asc"?"desc":"asc"),className:"p-0.5 hover:bg-gray-200 rounded transition-colors text-gray-400 hover:text-gray-600",title:`Sort ${e==="asc"?"Descending":"Ascending"}`,children:e==="asc"?a.jsx(aA,{className:"w-3 h-3"}):a.jsx(rA,{className:"w-3 h-3"})})]}),sV=({projects:n,users:e,onSelectProject:t,onSelectTask:r})=>{const{user:i}=ha(),[l,c]=q.useState(new Map),[u,p]=q.useState(new Map),[g,b]=q.useState(new Map),[w,E]=q.useState({}),[C,H]=q.useState({}),[F,U]=q.useState(new Set),[ae,re]=q.useState({field:"activity",order:"desc"}),[J,he]=q.useState({field:"activity",order:"desc"}),[j,ce]=q.useState({field:"activity",order:"desc"});if(!i)return null;const D=async(P,W)=>{var we;const V=((we=P.subtasks)==null?void 0:we.map(fe=>({...fe,isCompleted:!0})))||[];let le=P.status;P.status===xe.REVIEW?le=xe.DONE:le=xe.REVIEW;try{await ii(W.id,P.id,{subtasks:V,status:le})}catch(fe){console.error("Error completing task:",fe)}};q.useEffect(()=>{if(n.length===0)return;const P=[];return n.forEach(W=>{const V=av(W.id,fe=>{c(Ce=>new Map(Ce).set(W.id,fe))});P.push(V);const le=nS(W.id,fe=>{p(Ce=>new Map(Ce).set(W.id,fe))});P.push(le);const we=rS(W.id,fe=>{b(Ce=>new Map(Ce).set(W.id,fe))});P.push(we)}),()=>{P.forEach(W=>W())}},[n]),q.useEffect(()=>{const P=async()=>{for(const fe of n){const Ce=l.get(fe.id)||fe.tasks||[];await X6(Ce,e,fe.name,F)}},W=new Date,V=new Date;V.setDate(V.getDate()+1),V.setHours(8,0,0,0);const le=V.getTime()-W.getTime(),we=setTimeout(()=>{P();const fe=setInterval(P,1440*60*1e3);return()=>clearInterval(fe)},Math.max(0,le));return()=>clearTimeout(we)},[n,l,e,F]);const k=P=>{var W;return l.get(P)||((W=n.find(V=>V.id===P))==null?void 0:W.tasks)||[]},O=P=>P?typeof P=="string"?new Date(P).getTime():P.toDate&&typeof P.toDate=="function"?P.toDate().getTime():P instanceof Date?P.getTime():new Date(P).getTime()||0:0,z=P=>{var fe,Ce,ge,$e,ht,ot,ct,On;const V=(k(P.id)||[]).reduce((nn,Ie)=>{var it,bt,wt,_t;const Ye=O((_t=(wt=(bt=(it=Ie.comments)==null?void 0:it.slice)==null?void 0:bt.call(it,-1))==null?void 0:wt[0])==null?void 0:_t.timestamp),un=O(Ie.completedAt||Ie.modifiedAt||Ie.lastModified||Ie.createdAt||Ie.timestamp),fn=Math.max(Ye||0,un||0);return Math.max(nn,fn||0)},0),le=O(($e=(ge=(Ce=(fe=P.documents)==null?void 0:fe.slice)==null?void 0:Ce.call(fe,-1))==null?void 0:ge[0])==null?void 0:$e.uploadDate),we=O(P.updatedAt||P.modifiedAt||P.lastModified||((On=(ct=(ot=(ht=P.activityLog)==null?void 0:ht.slice)==null?void 0:ot.call(ht,-1))==null?void 0:ct[0])==null?void 0:On.timestamp)||P.createdAt||le);return Math.max(we||0,V||0)},B=(P,W)=>{var fe,Ce,ge,$e;const V=O(($e=(ge=(Ce=(fe=P.comments)==null?void 0:fe.slice)==null?void 0:Ce.call(fe,-1))==null?void 0:ge[0])==null?void 0:$e.timestamp),le=O(P.completedAt||P.modifiedAt||P.createdAt||P.timestamp),we=W?z(W):0;return Math.max(V||0,le||0,we||0)},K=P=>{var W,V,le;try{const we=((le=(V=(W=P==null?void 0:P.approvals)==null?void 0:W.completion)==null?void 0:V.admin)==null?void 0:le.status)==="approved",fe=P.status===xe.DONE,Ce=P.status===xe.REVIEW;return we&&(fe||Ce)}catch{return!1}},M=P=>{var W;return u.get(P)||((W=n.find(V=>V.id===P))==null?void 0:W.documents)||[]},Ve=P=>{var W;return g.get(P)||((W=n.find(V=>V.id===P))==null?void 0:W.financials)||[]},me=P=>{const W=[],V=k(P.id),le=M(P.id),we=Ve(P.id);return V.forEach(fe=>{var Ce,ge;i.role===L.ADMIN?(fe.approvals.start.admin.status==="pending"&&W.push({label:`Start: ${fe.title}`,type:"task",projectName:P.name,projectId:P.id,task:fe}),fe.approvals.completion.admin.status==="pending"&&W.push({label:`End: ${fe.title}`,type:"task",projectName:P.name,projectId:P.id,task:fe})):i.role===L.CLIENT?(fe.approvals.start.client.status==="pending"&&W.push({label:`Start: ${fe.title}`,type:"task",projectName:P.name,projectId:P.id,task:fe}),fe.approvals.completion.client.status==="pending"&&W.push({label:`End: ${fe.title}`,type:"task",projectName:P.name,projectId:P.id,task:fe})):i.role===L.DESIGNER&&(((Ce=fe.approvals.start.designer)==null?void 0:Ce.status)==="pending"&&W.push({label:`Start: ${fe.title}`,type:"task",projectName:P.name,projectId:P.id,task:fe}),((ge=fe.approvals.completion.designer)==null?void 0:ge.status)==="pending"&&W.push({label:`End: ${fe.title}`,type:"task",projectName:P.name,projectId:P.id,task:fe}))}),le.forEach(fe=>{i.role===L.ADMIN?fe.approvalStatus==="pending"&&W.push({label:`Doc: ${fe.name}`,type:"doc",projectName:P.name,projectId:P.id}):i.role===L.CLIENT&&fe.approvalStatus==="approved"&&(fe.clientApprovalStatus==="pending"||!fe.clientApprovalStatus)&&(Array.isArray(fe.sharedWith)&&fe.sharedWith.includes(i.id)||P.clientId===i.id||(P.clientIds||[]).includes(i.id))&&W.push({label:`Doc: ${fe.name}`,type:"doc",projectName:P.name,projectId:P.id})}),we.forEach(fe=>{i.role===L.ADMIN?(fe.isAdditionalBudget&&fe.adminApprovalForAdditionalBudget==="pending"&&W.push({label:`Budget: ${fe.description}`,type:"fin",projectName:P.name,projectId:P.id}),fe.isClientPayment&&fe.adminApprovalForPayment==="pending"&&W.push({label:`Payment: ${fe.description}`,type:"fin",projectName:P.name,projectId:P.id})):i.role===L.CLIENT&&(fe.isAdditionalBudget&&fe.clientApprovalForAdditionalBudget==="pending"&&W.push({label:`Budget: ${fe.description}`,type:"fin",projectName:P.name,projectId:P.id}),fe.isClientPayment&&fe.clientApprovalForPayment==="pending"&&W.push({label:`Payment: ${fe.description}`,type:"fin",projectName:P.name,projectId:P.id}))}),W};let Te=n,Se=[];if(i.role===L.CLIENT)Te=n.filter(P=>[P.clientId,...P.clientIds||[]].filter(Boolean).includes(i.id));else if(i.role===L.DESIGNER){const P=new Set(n.filter(W=>W.leadDesignerId===i.id||(W.teamMembers||[]).includes(i.id)||(W.clientIds||[]).includes(i.id)).map(W=>W.id));Te=n.filter(W=>P.has(W.id)),Se=n.flatMap(W=>k(W.id).map(V=>({task:V,project:W}))).filter(W=>W.task.assigneeId===i.id)}else if(i.role===L.VENDOR){Se=n.flatMap(W=>k(W.id).map(V=>({task:V,project:W}))).filter(W=>W.task.assigneeId===i.id);const P=new Set(Se.map(W=>W.project.id));Te=n.filter(W=>P.has(W.id)||(W.vendorIds||[]).includes(i.id)||(W.teamMembers||[]).includes(i.id))}const pe=({title:P,value:W,icon:V,color:le,onClick:we})=>a.jsxs("div",{onClick:we,className:`bg-white p-5 md:p-6 rounded-xl border border-gray-100 flex items-center justify-between hover:shadow-sm transition-shadow ${we?"cursor-pointer hover:border-gray-300":""}`,children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wide mb-1",children:P}),a.jsx("h3",{className:"text-3xl font-bold text-gray-800",children:W})]}),a.jsx("div",{className:`p-3 rounded-lg ${le} bg-opacity-10`,children:a.jsx(V,{className:`w-6 h-6 ${le.replace("bg-","text-")}`})})]});return a.jsxs("div",{className:"space-y-2 animate-fade-in max-w-7xl pb-12",children:[a.jsxs("div",{className:"flex justify-between items-center mb-1 mt-4",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:(i.role===L.ADMIN,"Dashboard")}),a.jsx("div",{className:"flex items-center gap-3",children:a.jsx("span",{className:"text-sm text-gray-500 font-medium px-4 py-1.5 bg-white rounded-full border border-gray-200",children:new Date().toLocaleDateString("en-IN",{weekday:"short",year:"numeric",month:"short",day:"numeric"})})})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6",children:i.role===L.VENDOR?a.jsx(pe,{title:"My Tasks",value:Se.length,icon:ep,color:"bg-blue-500",onClick:()=>{const P=document.querySelector('[data-section="vendor-tasks"]');P==null||P.scrollIntoView({behavior:"smooth"})}}):i.role===L.CLIENT?a.jsx(pe,{title:"Completed Tasks",value:Te.flatMap(P=>k(P.id)).filter(P=>P.status===xe.DONE).length,icon:xp,color:"bg-green-500",onClick:()=>{const P=document.querySelector('[data-section="project-overview"]');P==null||P.scrollIntoView({behavior:"smooth"})}}):null}),(i.role===L.ADMIN||i.role===L.DESIGNER||i.role===L.CLIENT)&&a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm flex flex-col h-[600px]",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[a.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[a.jsx(Bx,{className:"w-4 h-4 text-blue-500"}),"Active Projects"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(fp,{currentField:ae.field,currentOrder:ae.order,onSort:(P,W)=>re({field:P,order:W}),fields:[{value:"activity",label:"Recent"},{value:"name",label:"Name"},{value:"progress",label:"Progress"}]}),a.jsx("span",{className:"text-sm font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full",children:Te.length})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:Te.length===0?a.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"No active projects"}):[...Te].sort((P,W)=>{let V=0;return ae.field==="activity"?V=z(P)-z(W):ae.field==="name"?V=P.name.localeCompare(W.name):ae.field==="progress"&&(V=vh(k(P.id))-vh(k(W.id))),ae.order==="desc"?-V:V}).map(P=>{var fe,Ce;const W=vh(k(P.id)),le=k(P.id).filter(ge=>ge.status!==xe.DONE&&!K(ge)),we=C[P.id];return a.jsxs("div",{className:"rounded-lg border border-gray-50 hover:border-blue-200 hover:bg-blue-50/30 transition-all",children:[a.jsxs("div",{onClick:()=>t==null?void 0:t(P),className:"p-3 cursor-pointer group",children:[a.jsxs("div",{className:"flex justify-between items-start gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-bold text-gray-900 truncate group-hover:text-blue-600",children:P.name}),a.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:((fe=P.clientIds)==null?void 0:fe.map(ge=>{var $e;return($e=e.find(ht=>ht.id===ge))==null?void 0:$e.name}).filter(Boolean).join(", "))||((Ce=e.find(ge=>ge.id===P.clientId))==null?void 0:Ce.name)||"No Client"})]}),a.jsx($a,{className:"w-4 h-4 text-gray-300 group-hover:text-blue-400"})]}),a.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[a.jsx("div",{className:"flex-1 bg-gray-100 rounded-full h-1",children:a.jsx("div",{className:"bg-blue-500 h-1 rounded-full",style:{width:`${W}%`}})}),a.jsxs("span",{className:"text-xs font-bold text-gray-400",children:[W,"%"]})]})]}),le.length>0&&a.jsxs("div",{className:"border-t border-gray-50",children:[a.jsxs("button",{onClick:ge=>{ge.stopPropagation(),H($e=>({...$e,[P.id]:!$e[P.id]}))},className:"w-full px-3 py-2 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[a.jsxs("span",{className:"text-xs font-semibold text-gray-600 flex items-center gap-1",children:[a.jsx(ep,{className:"w-3 h-3"}),"Pending Tasks (",le.length,")"]}),a.jsx(pA,{className:`w-3 h-3 text-gray-400 transition-transform ${we?"rotate-180":""}`})]}),we&&a.jsxs("div",{className:"px-3 py-2 space-y-1 bg-gray-50/50",children:[le.slice(0,5).map(ge=>a.jsxs("div",{className:"w-full flex items-center justify-between px-2 py-1.5 rounded text-xs hover:bg-white transition-colors group/task",children:[a.jsxs("button",{onClick:()=>r==null?void 0:r(ge,P),className:"flex-1 text-left flex items-start gap-2 min-w-0",children:[a.jsx("div",{className:`w-2 h-2 rounded-full mt-0.5 flex-shrink-0 ${ge.status===xe.DONE?"bg-green-500":ge.status===xe.IN_PROGRESS?"bg-blue-500":"bg-gray-300"}`}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-gray-700 truncate font-medium",children:ge.title}),ge.dueDate&&a.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:dn(ge.dueDate)})]})]}),ge.status!==xe.DONE&&a.jsx("button",{onClick:$e=>{$e.stopPropagation(),D(ge,P)},className:"ml-2 p-1 text-gray-300 hover:text-green-500 opacity-0 group-hover/task:opacity-100 transition-all",title:"Mark as Done",children:a.jsx(xp,{className:"w-4 h-4"})})]},ge.id)),le.length>5&&a.jsxs("p",{className:"text-xs text-gray-400 text-center py-1",children:["+",le.length-5," more tasks"]})]})]})]},P.id)})})]}),a.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm flex flex-col h-auto max-h-[500px] lg:h-[600px] lg:max-h-none",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[a.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[a.jsx(ep,{className:"w-4 h-4 text-amber-500"}),"Tasks"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(fp,{currentField:J.field,currentOrder:J.order,onSort:(P,W)=>he({field:P,order:W}),fields:[{value:"activity",label:"Recent"},{value:"dueDate",label:"Due Date"},{value:"title",label:"Title"}]}),a.jsx("span",{className:"text-sm font-bold text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full",children:i.role===L.DESIGNER?Se.filter(P=>P.task.status!==xe.DONE&&!K(P.task)).length:Te.reduce((P,W)=>P+k(W.id).filter(V=>V.status!==xe.DONE&&!K(V)).length,0)})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:(i.role===L.DESIGNER?Se.filter(P=>P.task.status!==xe.DONE&&!K(P.task)).length===0:Te.every(P=>k(P.id).filter(W=>W.status!==xe.DONE&&!K(W)).length===0))?a.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"All tasks completed! "}):(i.role===L.DESIGNER?Se.filter(P=>P.task.status!==xe.DONE&&!K(P.task)).map(({task:P,project:W})=>({...P,projectName:W.name,project:W})):Te.flatMap(P=>k(P.id).filter(W=>W.status!==xe.DONE&&!K(W)).map(W=>({...W,projectName:P.name,project:P})))).sort((P,W)=>{let V=0;return J.field==="activity"?V=B(P,P.project)-B(W,W.project):J.field==="dueDate"?V=new Date(P.dueDate).getTime()-new Date(W.dueDate).getTime():J.field==="title"&&(V=P.title.localeCompare(W.title)),J.order==="desc"?-V:V}).map(P=>{const W=e.find(V=>V.id===P.assigneeId);return a.jsx("div",{className:"p-3 rounded-lg border border-gray-50 hover:border-amber-200 hover:bg-amber-50/30 transition-all cursor-pointer group relative",children:a.jsxs("div",{onClick:()=>r==null?void 0:r(P,P.project),children:[a.jsxs("div",{className:"flex justify-between items-start gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-bold text-gray-900 truncate group-hover:text-amber-600",children:P.title}),a.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[a.jsx("p",{className:"text-xs text-gray-500 truncate",children:P.projectName}),a.jsx("span",{className:"text-xs text-gray-300",children:""}),a.jsx("p",{className:"text-xs text-blue-500 font-medium truncate",children:(W==null?void 0:W.name)||"Unassigned"})]})]}),a.jsx("span",{className:`text-xs font-bold px-1.5 py-0.5 rounded shrink-0 ${P.status===xe.IN_PROGRESS?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-700"}`,children:P.status})]}),a.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[a.jsxs("span",{className:"text-xs text-gray-400 font-medium",children:["Due: ",dn(P.dueDate)]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-400"}),a.jsxs("span",{className:"text-xs font-bold text-gray-500",children:[ra(P),"%"]})]})]})]})},P.id)})})]}),a.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm flex flex-col h-auto max-h-[500px] lg:h-[600px] lg:max-h-none",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[a.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[a.jsx(xp,{className:"w-4 h-4 text-rose-500"}),"Pending Approvals"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(fp,{currentField:"activity",currentOrder:ae.order,onSort:(P,W)=>re(V=>({...V,order:W})),fields:[{value:"activity",label:"Recent"}]}),a.jsx("span",{className:"text-sm font-bold text-rose-600 bg-rose-50 px-2 py-0.5 rounded-full",children:Te.reduce((P,W)=>P+me(W).length,0)})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:Te.every(P=>me(P).length===0)?a.jsx("div",{className:"text-center py-10 text-gray-400 text-sm",children:"No pending approvals"}):Te.flatMap(P=>me(P).map(W=>({...W,project:P}))).sort((P,W)=>{const V=z(P.project)-z(W.project);return ae.order==="desc"?-V:V}).map((P,W)=>a.jsx("div",{onClick:()=>{P.type==="task"&&P.task?r==null||r(P.task,P.project):t==null||t(P.project,{initialTab:"documents"})},className:"p-3 rounded-lg border border-gray-50 hover:border-rose-200 hover:bg-rose-50/30 transition-all cursor-pointer group",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:`shrink-0 mt-0.5 ${P.type==="task"?"text-blue-500":P.type==="doc"?"text-purple-500":"text-amber-500"}`,children:P.type==="task"?a.jsx(ep,{className:"w-4 h-4"}):P.type==="doc"?a.jsx(Va,{className:"w-4 h-4"}):a.jsx(SA,{className:"w-4 h-4"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-bold text-gray-900 truncate group-hover:text-rose-600",children:P.label}),a.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:P.projectName})]}),a.jsx(Xi,{className:"w-4 h-4 text-rose-400 shrink-0"})]})},W))})]})]}),i.role===L.VENDOR&&a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:a.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-100 lg:col-span-3","data-section":"vendor-tasks",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("h3",{className:"text-sm font-bold text-gray-800",children:["Your Active Tasks",a.jsx("span",{className:"ml-2 text-sm text-gray-400 font-normal",children:"Real-time synced"})]}),a.jsx(fp,{currentField:j.field,currentOrder:j.order,onSort:(P,W)=>ce({field:P,order:W}),fields:[{value:"activity",label:"Recent"},{value:"dueDate",label:"Due Date"},{value:"title",label:"Title"}]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm text-left",children:[a.jsx("thead",{className:"bg-gray-50 text-gray-500 text-sm font-semibold",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 rounded-l-lg",children:"Task"}),a.jsx("th",{className:"px-4 py-3",children:"Project"}),a.jsx("th",{className:"px-4 py-3",children:"Due"}),a.jsx("th",{className:"px-4 py-3 rounded-r-lg",children:"Status"})]})}),a.jsxs("tbody",{className:"divide-y divide-gray-50",children:[Se.filter(P=>P.task.status!==xe.DONE).sort((P,W)=>{let V=0;if(j.field==="activity"){const le=B(P.task,P.project),we=B(W.task,W.project);V=le-we}else j.field==="dueDate"?V=new Date(P.task.dueDate).getTime()-new Date(W.task.dueDate).getTime():j.field==="title"&&(V=P.task.title.localeCompare(W.task.title));return j.order==="desc"?-V:V}).map(({task:P,project:W})=>a.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer group",children:[a.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",onClick:()=>r==null?void 0:r(P,W),children:P.title}),a.jsx("td",{className:"px-4 py-3 text-gray-600 text-sm",onClick:()=>r==null?void 0:r(P,W),children:W.name}),a.jsx("td",{className:"px-4 py-3 text-gray-500 text-sm",onClick:()=>r==null?void 0:r(P,W),children:dn(P.dueDate)}),a.jsx("td",{className:"px-4 py-3 flex items-center justify-between",children:a.jsx("span",{className:`px-2.5 py-1 rounded-md text-sm font-semibold uppercase transition-colors
                          ${P.status===xe.IN_PROGRESS?"bg-blue-100 text-blue-700":P.status===xe.TODO?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600"}`,onClick:()=>r==null?void 0:r(P,W),children:P.status})})]},P.id)),Se.filter(P=>P.task.status!==xe.DONE).length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:4,className:"text-center py-8 text-gray-400 text-sm",children:"All caught up! "})})]})]})})]})})]})};var kn=TN();const xf=["General","Design and Planning","Execution"],iS=()=>{const[n,e]=q.useState({loading:!1,error:null,success:!1});return{...n,createNewProject:async l=>{e({loading:!0,error:null,success:!1});try{const c=await YM(l);return e({loading:!1,error:null,success:!0}),c}catch(c){throw e({loading:!1,error:c.message,success:!1}),c}},updateExistingProject:async(l,c)=>{e({loading:!0,error:null,success:!1});try{await rv(l,c),e({loading:!1,error:null,success:!0})}catch(u){throw e({loading:!1,error:u.message,success:!1}),u}},deleteExistingProject:async l=>{e({loading:!0,error:null,success:!1});try{await HT(l),e({loading:!1,error:null,success:!0})}catch(c){throw e({loading:!1,error:c.message,success:!1}),c}}}},iV=n=>{const[e,t]=q.useState({loading:!1,error:null,success:!1});return{...e,createNewRecord:async c=>{t({loading:!0,error:null,success:!1});try{const u=await Oy(n,c);return t({loading:!1,error:null,success:!0}),u}catch(u){throw t({loading:!1,error:u.message,success:!1}),u}},updateExistingRecord:async(c,u)=>{t({loading:!0,error:null,success:!1});try{await xd(n,c,u),t({loading:!1,error:null,success:!0})}catch(p){throw t({loading:!1,error:p.message,success:!1}),p}},deleteExistingRecord:async c=>{t({loading:!0,error:null,success:!1});try{await K6(n,c),t({loading:!1,error:null,success:!0})}catch(u){throw t({loading:!1,error:u.message,success:!1}),u}}}},aV=async(n,e)=>{try{const t=nh(rh,e),r=await eh(t,n);return await th(r.ref)}catch(t){throw console.error("Error uploading file:",t),t}},oV=[{id:xe.TODO,label:"Scheduled Tasks",color:"border-t-4 border-gray-400"},{id:xe.IN_PROGRESS,label:"In Process",color:"border-t-4 border-blue-500"},{id:xe.REVIEW,label:"In Review",color:"border-t-4 border-purple-500"},{id:xe.ON_HOLD,label:"On Hold",color:"border-t-4 border-yellow-500"},{id:xe.DONE,label:"Completed",color:"border-t-4 border-green-500"}],lV=({tasks:n,users:e,onUpdateTaskStatus:t,onUpdateTaskPriority:r,onEditTask:i,onCompleteTask:l})=>{const{user:c}=ha(),{addNotification:u}=sl(),[p,g]=q.useState(null),b=J=>J===xe.ABORTED||J===xe.ON_HOLD,w=(J,he)=>{const j=n.find(ce=>ce.id===he);if(j&&b(j.status)){J.preventDefault();return}g(he),J.dataTransfer.effectAllowed="move"},E=J=>{J.preventDefault()},C=(J,he)=>{J.preventDefault(),!(!p||!t)&&(t(p,he),g(null))},H=(J,he)=>{if(J.stopPropagation(),b(he.status))return;if(U(he)&&he.status!==xe.DONE){u("Locked","Cannot update task. Dependencies not met.","error");return}let j=he.status;he.status===xe.TODO?j=xe.IN_PROGRESS:he.status===xe.IN_PROGRESS?j=xe.REVIEW:he.status===xe.REVIEW&&(j=xe.DONE),t(he.id,j)},F=J=>{const he=e.find(j=>j.id===J);return he?a.jsx(za,{avatar:he.avatar,name:he.name,size:"sm",role:String(he.role).toLowerCase()}):a.jsx(za,{avatar:"",name:"Unassigned",size:"sm"})},U=J=>J.status===xe.DONE||!J.dependencies||J.dependencies.length===0?!1:n.filter(j=>{var ce;return(ce=J.dependencies)==null?void 0:ce.includes(j.id)}).some(j=>j.status!==xe.DONE),ae=J=>{switch(J){case xe.TODO:return"bg-gray-100 text-gray-600";case xe.IN_PROGRESS:return"bg-blue-100 text-blue-600";case xe.REVIEW:return"bg-purple-100 text-purple-600";case xe.DONE:return"bg-green-100 text-green-600";case xe.OVERDUE:return"bg-red-100 text-red-600";case xe.ABORTED:return"bg-black text-white";case xe.ON_HOLD:return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100"}},re=J=>J.sort((he,j)=>{var ce,D;return(ce=he.dependencies)!=null&&ce.includes(j.id)?1:(D=j.dependencies)!=null&&D.includes(he.id)?-1:new Date(he.dueDate).getTime()-new Date(j.dueDate).getTime()});return a.jsx("div",{className:"flex h-full overflow-x-auto gap-4 p-3 pb-6 items-start",children:oV.map(J=>{let he;J.id===xe.IN_PROGRESS?he=n.filter(ce=>ce.status===xe.IN_PROGRESS||ce.status===xe.OVERDUE||ce.status===xe.ABORTED):he=n.filter(ce=>ce.status===J.id);const j=re(he);return a.jsxs("div",{className:`flex-shrink-0 w-80 bg-gray-50 rounded-lg p-4 flex flex-col h-full max-h-[calc(100vh-250px)] border border-gray-200 ${J.color}`,onDragOver:E,onDrop:ce=>C(ce,J.id),children:[a.jsx("div",{className:"flex justify-between items-center mb-3 px-1",children:a.jsxs("h3",{className:"font-bold text-gray-900 text-sm flex items-center gap-2",children:[J.label,a.jsx("span",{className:"bg-white border border-gray-200 text-gray-600 text-xs px-2.5 py-0.5 rounded-full",children:j.length})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 pr-1",children:[j.map(ce=>{const D=U(ce)&&ce.status!==xe.DONE,k=b(ce.status),O=ra(ce),z=(c==null?void 0:c.id)===ce.assigneeId;return a.jsxs("div",{draggable:!D&&!k&&(c==null?void 0:c.role)!==L.CLIENT,onDragStart:B=>!D&&!k&&(c==null?void 0:c.role)!==L.CLIENT&&w(B,ce.id),onClick:()=>i(ce),className:`bg-white p-3 md:p-4 rounded-lg shadow-sm border cursor-grab active:cursor-grabbing hover:shadow-md transition-all group relative
                       ${D?"border-red-200 bg-red-50/50 cursor-not-allowed opacity-75":"border-gray-200"}
                       ${k?"border-gray-300 bg-gray-100 opacity-80 cursor-not-allowed":""}
                       ${ce.status===xe.DONE?"opacity-70 bg-gray-50":""}
                    `,children:[k&&a.jsx("div",{className:"absolute top-1 right-1 text-gray-500",title:`Frozen: ${ce.status}`,children:ce.status===xe.ABORTED?a.jsx(Ma,{className:"w-3 h-3"}):a.jsx(Ux,{className:"w-3 h-3"})}),a.jsxs("div",{className:"flex justify-between items-center gap-1 mb-2",children:[a.jsxs("div",{className:"flex items-center gap-0.5",children:[D&&a.jsx("span",{title:"Locked by dependencies",className:"flex items-center",children:a.jsx(bh,{className:"w-3 h-3 text-red-400 flex-shrink-0"})}),a.jsx("span",{className:"text-xs font-medium text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded border border-gray-200 flex-shrink-0",children:ce.category})]}),a.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs font-bold uppercase flex-shrink-0 ${ae(ce.status)}`,children:ce.status})]}),a.jsxs("div",{className:"flex justify-between items-start gap-0.5 mb-2",children:[a.jsx("h4",{className:`font-bold text-sm group-hover:text-blue-600 transition-colors line-clamp-2 ${D||k?"text-gray-500":"text-gray-900"}`,children:ce.title}),(z||(c==null?void 0:c.role)===L.ADMIN)&&!D&&!k&&ce.status!==xe.DONE&&(c==null?void 0:c.role)!==L.CLIENT&&a.jsxs("div",{className:"flex items-center",children:[a.jsx("button",{onClick:B=>{B.stopPropagation(),l(ce)},className:"text-gray-300 hover:text-green-500 transition-colors p-0.5 flex-shrink-0 mr-1",title:"Mark as Done",children:a.jsx(Ed,{className:"w-4 h-4 text-green-500"})}),a.jsx("button",{onClick:B=>H(B,ce),className:"text-gray-300 hover:text-blue-500 transition-colors p-0.5 flex-shrink-0",title:"Advance Status",children:a.jsx(Jl,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{className:"flex justify-between items-center mb-1 text-xs",children:[a.jsx("span",{className:"text-gray-400 font-medium",children:"Progress"}),a.jsxs("span",{className:"text-gray-600 font-bold",children:[O,"%"]})]}),a.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1.5 mb-3",children:a.jsx("div",{className:`h-1.5 rounded-full transition-all duration-500 ${ce.status===xe.DONE?"bg-green-500":k?"bg-gray-400":"bg-blue-500"}`,style:{width:`${O}%`}})}),a.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-50",children:[a.jsx("div",{className:"flex items-center gap-1",children:F(ce.assigneeId)}),a.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[a.jsx(Mp,{className:"w-3 h-3"}),a.jsx("span",{children:dn(ce.dueDate)})]})]})]},ce.id)}),j.length===0&&a.jsx("div",{className:"h-16 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-sm text-gray-400 italic bg-white",children:"Drop items here"})]})]},J.id)})})},cV=({isOpen:n,onClose:e,onSubmit:t,onUpdate:r,teamMembers:i,isLoading:l=!1,editingMeeting:c=null})=>{const[u,p]=q.useState({date:new Date().toISOString().split("T")[0],title:"",type:"",attendees:[],notes:""}),[g,b]=q.useState(!1),[w,E]=q.useState(!1);q.useEffect(()=>{p(c?{date:c.date,title:c.title,type:c.type,attendees:c.attendees,notes:c.notes}:{date:new Date().toISOString().split("T")[0],title:"",type:"",attendees:[],notes:""}),b(!1)},[c,n]);const C=()=>!u.date||!u.title||!u.type?(b(!0),!1):!0,H=async U=>{if(U.preventDefault(),!!C())try{E(!0),c&&r?await r({...c,...u}):await t(u),c||p({date:new Date().toISOString().split("T")[0],title:"",type:"",attendees:[],notes:""}),b(!1),e()}catch(ae){console.error("Error saving meeting:",ae)}finally{E(!1)}},F=U=>{p(ae=>({...ae,attendees:ae.attendees.includes(U)?ae.attendees.filter(re=>re!==U):[...ae.attendees,U]}))};return n?kn.createPortal(a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[9998]",onClick:e}),a.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[9999] p-2 md:p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-lg w-full max-h-[95vh] md:max-h-[90vh] overflow-y-auto animate-fade-in",onClick:U=>U.stopPropagation(),children:[a.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-4 md:px-6 py-3 md:py-4 flex justify-between items-center flex-shrink-0",children:[a.jsx("h2",{className:"text-2xl md:text-xl font-bold text-gray-800",children:c?"Edit Meeting":"Add Meeting"}),a.jsx("button",{onClick:e,title:"Close modal",className:"p-1 hover:bg-gray-100 rounded-md transition-colors flex-shrink-0",children:a.jsx(mn,{className:"w-5 h-5 md:w-4 md:h-4 text-gray-500"})})]}),a.jsxs("form",{onSubmit:H,className:"p-3 md:p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"meeting-date",className:"block text-base md:text-sm font-semibold text-gray-700 mb-1",children:["Meeting Date ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{id:"meeting-date",type:"date",title:"Select meeting date",value:u.date||"",onChange:U=>p(ae=>({...ae,date:U.target.value})),className:`w-full px-3 md:px-2 py-2 md:py-1.5 text-base md:text-sm border rounded-md focus:outline-none focus:ring-1 focus:border-gray-800
                  ${g&&!u.date?"border-red-500":"border-gray-200"}`}),g&&!u.date&&a.jsx("p",{className:"text-red-500 text-base md:text-sm mt-0.5",children:"Meeting date is required"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-base md:text-sm font-semibold text-gray-700 mb-1",children:["Meeting Title ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",placeholder:"e.g., Client Kickoff, Site Visit Review",value:u.title,onChange:U=>p(ae=>({...ae,title:U.target.value})),className:`w-full px-3 md:px-2 py-2 md:py-1.5 text-base md:text-sm border rounded-md focus:outline-none focus:ring-1 focus:border-gray-800
                  ${g&&!u.title?"border-red-500":"border-gray-200"}`}),g&&!u.title&&a.jsx("p",{className:"text-red-500 text-base md:text-sm mt-0.5",children:"Meeting title is required"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-base md:text-sm font-semibold text-gray-700 mb-1",children:["Meeting Type ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",placeholder:"e.g., Discovery, Progress Review, Site Visit, Vendor Meet, Design Presentation",value:u.type,onChange:U=>p(ae=>({...ae,type:U.target.value})),className:`w-full px-3 md:px-2 py-2 md:py-1.5 text-base md:text-sm border rounded-md focus:outline-none focus:ring-1 focus:border-gray-800
                  ${g&&!u.type?"border-red-500":"border-gray-200"}`}),g&&!u.type&&a.jsx("p",{className:"text-red-500 text-base md:text-sm mt-0.5",children:"Meeting type is required"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-base md:text-sm font-semibold text-gray-700 mb-2",children:[a.jsx(Fp,{className:"w-4 h-4 inline mr-1"}),"Add Attendees"]}),i.length===0?a.jsx("p",{className:"text-base md:text-base text-gray-500 bg-gray-50 p-2 rounded-md",children:"No team members available. Add members to the project first."}):a.jsx("div",{className:"grid grid-cols-2 gap-1.5 max-h-[200px] overflow-y-auto border border-gray-200 rounded-md p-2 bg-gray-50",children:i.map(U=>a.jsxs("label",{className:"flex items-center gap-2 p-2 rounded-md transition-colors text-left cursor-pointer bg-white border border-gray-200 hover:border-gray-300",children:[a.jsx("input",{type:"checkbox",checked:u.attendees.includes(U.id),onChange:()=>F(U.id),title:`Add ${U.name} to meeting`,className:"w-4 h-4 rounded cursor-pointer"}),a.jsx(za,{name:U.name,avatar:U.avatar,size:"sm",role:String(U.role).toLowerCase()}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"text-base md:text-sm font-medium text-gray-800 truncate",children:U.name}),a.jsx("div",{className:"text-base md:text-sm text-gray-500 truncate",children:U.role})]})]},U.id))}),u.attendees.length>0&&a.jsxs("div",{className:"mt-3",children:[a.jsxs("p",{className:"text-base md:text-sm font-semibold text-gray-700 mb-2",children:["Selected Attendees (",u.attendees.length,"):"]}),a.jsx("div",{className:"bg-white border border-gray-200 rounded-md p-2 space-y-1.5",children:u.attendees.map(U=>{const ae=i.find(re=>re.id===U);return ae?a.jsxs("div",{className:"flex items-center justify-between bg-gray-50 px-2 py-1.5 rounded border border-gray-100",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(za,{name:ae.name,avatar:ae.avatar,size:"sm",role:String(ae.role).toLowerCase()}),a.jsxs("div",{children:[a.jsx("div",{className:"text-base md:text-sm font-medium text-gray-800",children:ae.name}),a.jsx("div",{className:"text-base md:text-sm text-gray-500",children:ae.role})]})]}),a.jsx("button",{type:"button",onClick:()=>F(ae.id),className:"text-red-500 hover:text-red-700 p-0.5",title:`Remove ${ae.name} from meeting`,children:a.jsx(mn,{className:"w-2.5 h-2.5"})})]},U):null})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-base md:text-sm font-semibold text-gray-700 mb-1",children:"Notes"}),a.jsx("textarea",{placeholder:"Add any notes, decisions, or action items from the meeting",value:u.notes,onChange:U=>p(ae=>({...ae,notes:U.target.value})),rows:3,className:"w-full px-2 py-1.5 text-base md:text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:border-gray-800 resize-none"})]}),a.jsxs("div",{className:"flex gap-2 justify-end pt-3 border-t border-gray-200",children:[a.jsx("button",{type:"button",onClick:e,disabled:w||l,className:"px-3 py-1.5 border border-gray-300 rounded-md text-gray-700 font-medium text-base md:text-xs hover:bg-gray-50 transition-colors disabled:opacity-50 focus:outline-none focus:ring-1 focus:ring-gray-800",children:"Cancel"}),a.jsxs("button",{type:"submit",disabled:w||l,className:"px-3 py-1.5 bg-gray-800 text-white rounded-md font-medium text-base md:text-xs hover:bg-gray-900 transition-colors disabled:opacity-50 flex items-center gap-1.5 focus:outline-none focus:ring-1 focus:ring-gray-800",children:[c?a.jsx(CN,{className:"w-4 h-4 md:w-3 md:h-3"}):a.jsx(Oi,{className:"w-4 h-4 md:w-3 md:h-3"}),w||l?"Saving...":c?"Update Meeting":"Add Meeting"]})]})]})]})})]}),document.body):null},Rt=({size:n="md",color:e="currentColor",className:t=""})=>{const r={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"};return console.log("Spinner rendered:",{size:n,color:e,className:t,sizeClass:r[n]}),a.jsx("div",{className:`spinner ${r[n]} ${t}`,style:{display:"inline-block",width:n==="sm"?"12px":n==="lg"?"20px":"16px",height:n==="sm"?"12px":n==="lg"?"20px":"16px",border:"2px solid",borderColor:`${e}40`,borderTopColor:e,borderRightColor:e,borderRadius:"50%",animation:"spin 0.6s linear infinite"}})},qu=48,$x='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"%3E%3Ccircle cx="12" cy="12" r="12" fill="%23e5e7eb"/%3E%3C/svg%3E',dV=({project:n,users:e,onUpdateProject:t,onBack:r,initialTab:i,initialTask:l,onCloseTask:c})=>{var cm,is,po,Yd,Jd,Xd,Zd,Oc,dm,um,_a,Mc,fo,Vc,eu,vl,Na,Lc,tu,bl,nu,ru,su,iu,au,ou,Ti,$c,Fc,hm,mm,go,pm,lu,cu,sn,Bc,wl,xo,du,Uc,yo,_l,Ia,uu,fm,gm,hu,Nl,Il,zc,qc,Wc,Hc,xm,mu,ym,vm,Gc,Si,pu,Ea,As,vo,Xs,Kc,bm,wm,Gi,bo,Ta,El,Qc,Sa,Ai,an,Jt,ji,Qn,cr,Ki,Aa,dr,Tl,fu,gu,Sl,xu,Zs,Al,Yc,yu,_m,ki,ja,ka;const{user:u}=ha(),{addNotification:p}=sl(),{updateExistingProject:g,deleteExistingProject:b}=iS(),{updateExistingRecord:w,deleteExistingRecord:E}=iV(n.id),{showLoading:C,hideLoading:H}=tm(),[F,U]=q.useState(()=>{const h=localStorage.getItem("lastProjectTab");return i||h||"meetings"});q.useEffect(()=>{localStorage.setItem("lastProjectTab",F)},[F]);const[ae,re]=q.useState("list"),[J,he]=q.useState(!!l),[j,ce]=q.useState(l||null),[D,k]=q.useState(!0),O=q.useRef(J);q.useEffect(()=>{O.current&&!J&&c&&c(),O.current=J},[J,c]);const[z,B]=q.useState(!1),[K,M]=q.useState("details"),[Ve,me]=q.useState(null),[Te,Se]=q.useState(!1),[pe,P]=q.useState(""),[W,V]=q.useState(new Set),le=q.useRef(null),we=q.useRef(null),[fe,Ce]=q.useState(null),[ge,$e]=q.useState(null),[ht,ot]=q.useState(!1),[ct,On]=q.useState({name:"",type:"other",sharedWith:[]}),[nn,Ie]=q.useState([]),[Ye,un]=q.useState(!1),fn=q.useRef(null),[it,bt]=q.useState(null),[wt,_t]=q.useState(!1),[Gt,cn]=q.useState(""),[yr,pi]=q.useState(!1),[Fs,fi]=q.useState(!1),[Bs,Jr]=q.useState(null),[ma,ar]=q.useState([]),[gs,gi]=q.useState(!1),[ie,_e]=q.useState(!1),[Be,We]=q.useState(null),[X,He]=q.useState({date:new Date().toISOString().split("T")[0],type:"expense",status:"pending",amount:void 0}),[Vt,at]=q.useState(""),[xt,Me]=q.useState(""),[ve,Ze]=q.useState(""),[ln,En]=q.useState(""),[vr,Ln]=q.useState(!1),[Pr,mt]=q.useState(!1),[Kt,$i]=q.useState("all"),[il,xs]=q.useState(!1),[Us,xi]=q.useState(!1),[Hn,ys]=q.useState(""),[vs,eo]=q.useState("member"),[bs,yi]=q.useState(!1),[Tc,to]=q.useState(null),[Sc,zs]=q.useState(!1),[no,pa]=q.useState({}),[Fi,qs]=q.useState({}),[qt,Ac]=q.useState({}),[ro,Bi]=q.useState(!1),[or,Ui]=q.useState(null),[so,vi]=q.useState(!1),[Or,io]=q.useState(!1),[br,Xr]=q.useState(null),[Zr,bi]=q.useState(!1),[wr,Ws]=q.useState(null),[$t,ws]=q.useState(!1),[Hs,wi]=q.useState(null),[al,fa]=q.useState(!1),[Ot,zi]=q.useState(null),[_s,ao]=q.useState(null),[ft,es]=q.useState(n.designerChargePercentage??0),[oo,ga]=q.useState(!1);q.useEffect(()=>{es(n.designerChargePercentage??0)},[n.designerChargePercentage]);const ol=()=>{Mt&&ft!==(n.designerChargePercentage??0)&&(t({...n,designerChargePercentage:ft}),p("Designer Charges Updated","Designer Charges percent saved.","success",void 0,n.id,n.name))},[ll,xa]=q.useState(!1),[er,_i]=q.useState(""),[Mr,Vr]=q.useState(""),[rn,ya]=q.useState([]),[_r,Lr]=q.useState([]),[qi,Wi]=q.useState([]),[$r,jc]=q.useState([]),[Gs,Qt]=q.useState([]),kt=Gs,Nt=$r,Ns=q.useMemo(()=>(u==null?void 0:u.role)===L.VENDOR?Nt.filter(_=>_.assigneeId===u.id):Nt,[Nt,u==null?void 0:u.id,u==null?void 0:u.role]);if(q.useEffect(()=>{const _=new URLSearchParams(window.location.search).get("taskId");if(_&&Nt.length>0){const N=Nt.find(S=>S.id===_);N&&(ce(N),he(!0),window.history.replaceState({},document.title,window.location.pathname))}},[Nt]),q.useEffect(()=>{const _=new URLSearchParams(window.location.search).get("meetingId");if(_&&rn.length>0){const N=rn.find(S=>S.id===_);N&&(U("meetings"),to(N),yi(!0),window.history.replaceState({},document.title,window.location.pathname))}},[rn]),q.useEffect(()=>{const h=async()=>{const _=new Date().toISOString().split("T")[0],N=Nt.filter(A=>A.dueDate<_&&A.status!==xe.DONE&&A.status!==xe.OVERDUE&&A.status!==xe.ABORTED&&A.status!==xe.ON_HOLD&&A.status!==xe.REVIEW);if(N.length>0)for(const A of N)await ii(n.id,A.id,{status:xe.OVERDUE});const S=kt.filter(A=>A.status==="pending"&&A.date<_);if(S.length>0)for(const A of S)await w(A.id,{...A,status:"overdue"})};n&&(Nt.length>0||kt.length>0)&&h()},[Nt,kt,n.id]),q.useEffect(()=>{le.current&&le.current.scrollIntoView({behavior:"smooth"})},[j==null?void 0:j.comments]),q.useEffect(()=>{const h=T6(n.id,_=>{ya(_),_.forEach(N=>{A6(n.id,N.id,S=>{pa(A=>({...A,[N.id]:S}))})})});return()=>h()},[n.id]),q.useEffect(()=>{const h=nS(n.id,_=>{Lr(_)});return()=>h()},[n.id]),q.useEffect(()=>{const h=R6(n.id,_=>{Wi(_)});return()=>h()},[n.id]),q.useEffect(()=>{if(wt&&it){const h=_r.find(_=>_.id===it.id);h&&bt(h)}},[_r,wt,it==null?void 0:it.id]),q.useEffect(()=>{const h=av(n.id,_=>{jc(_)});return()=>h()},[n.id]),q.useEffect(()=>{if(J&&j&&j.id){const h=$r.find(_=>_.id===j.id);h&&ce(h)}},[$r,J,j==null?void 0:j.id]),q.useEffect(()=>{const h=rS(n.id,_=>{Qt(_)});return()=>h()},[n.id]),q.useEffect(()=>{const h=async()=>{try{const _=kt.filter(S=>S.type==="income"&&S.category==="Additional Budget").reduce((S,A)=>S+A.amount,0),N=(n.initialBudget||n.budget)+_;await Rr(It(st,"projects",n.id),{budget:N}),t({...n,budget:N})}catch(_){console.error(" Error syncing project budget in real-time:",_)}};(kt.length>0||n.financials.length>0)&&h()},[kt,n.id]),q.useEffect(()=>{i&&U(i)},[i]),q.useEffect(()=>{if(we.current){const h=we.current.querySelector(`[data-tab-id="${F}"]`);h&&h.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}},[F]),q.useEffect(()=>{(u==null?void 0:u.role)===L.VENDOR&&(F==="discovery"||F==="timeline"||F==="financials")&&U("plan")},[u==null?void 0:u.role,F]),!u)return null;const Is=u.role===L.CLIENT,gn=u.role===L.VENDOR,Mt=u.role===L.ADMIN,Es=u.role===L.DESIGNER&&n.leadDesignerId===u.id,Ft=Mt,cl=!0,Ts=!gn,[dl,ul]=q.useState(null),[ts,hl]=q.useState(null),Tn=(h,_)=>{if(!h)return"Unknown User";if(h===u.id)return u.name||"You";if(_&&_.trim())return _;const N=e.find(S=>S.id===h);if(N!=null&&N.name)return N.name;if(h===n.leadDesignerId){const S=e.find(A=>A.id===h);if(S!=null&&S.name)return S.name}if(h===n.clientId){const S=e.find(A=>A.id===h);if(S!=null&&S.name)return S.name}return"Unknown User"},hn=q.useMemo(()=>{const h=new Set;return n.clientId&&h.add(n.clientId),n.clientIds&&n.clientIds.forEach(_=>h.add(_)),n.leadDesignerId&&h.add(n.leadDesignerId),n.vendorIds&&n.vendorIds.forEach(_=>h.add(_)),n.hiddenVendors&&n.hiddenVendors.forEach(_=>h.add(_)),e.filter(_=>_.role===L.ADMIN).forEach(_=>h.add(_.id)),n.tasks.forEach(_=>{_.assigneeId&&h.add(_.assigneeId)}),n.teamMembers&&n.teamMembers.forEach(_=>h.add(_)),e.filter(_=>h.has(_.id))},[n,e]),va=async h=>{try{zs(!0);const _=await N6(n.id,h);if(h.attendees&&h.attendees.length>0){const N=hn.filter(A=>h.attendees.includes(A.id)),S={...h,id:_};await vN(S,N,n.name,n.id,"created")}p("Success","Meeting added successfully","success")}catch(_){throw console.error("Error creating meeting:",_),p("Error","Failed to add meeting","error"),_}finally{zs(!1)}},Ks=h=>{try{Jr(h),ar(h.sharedWith||[]),fi(!0)}catch(_){console.error("Error opening share edit modal:",_)}},ml=async h=>{try{if(zs(!0),await I6(n.id,h.id,h),h.attendees&&h.attendees.length>0){const _=hn.filter(N=>h.attendees.includes(N.id));await vN(h,_,n.name,n.id,"updated")}p("Success","Meeting updated successfully","success")}catch(_){throw console.error("Error updating meeting:",_),p("Error","Failed to update meeting","error"),_}finally{zs(!1)}},Gn=async h=>{const _=Fi[h];if(!_||!_.trim()){p("Validation Error","Please enter a comment","error");return}if(!qt[h])try{Ac(Y=>({...Y,[h]:!0}));let N=u.name||"Unknown User";const S=e.find(Y=>Y.id===u.id);S!=null&&S.name&&(N=S.name);const A={userId:u.id,userName:N,text:_,timestamp:new Date().toISOString()};await S6(n.id,h,A);const oe=rn.find(Y=>Y.id===h);if(oe){const Y=[],Z=e.filter(Je=>Je.role===L.ADMIN&&Je.tenantId===u.tenantId&&Je.id!==u.id);if(Y.push(...Z),oe.attendees&&oe.attendees.length>0){const Je=e.filter(je=>oe.attendees.includes(je.id)&&je.id!==u.id);Y.push(...Je)}const De=Y.filter((Je,je,Fe)=>Fe.findIndex(et=>et.id===Je.id)===je);De.length>0&&await rV(oe,{...A,id:"temp"},N,n.name,De)}qs(Y=>({...Y,[h]:""})),p("Success","Comment added successfully","success")}catch(N){console.error("Error adding meeting comment:",N),p("Error","Failed to add comment","error")}finally{Ac(N=>({...N,[h]:!1}))}},Qs=async(h,_)=>{try{await E6(n.id,h),p("Success",`Meeting "${_}" deleted successfully`,"success")}catch(N){console.error("Error deleting meeting:",N),p("Error","Failed to delete meeting","error")}},ba=async()=>{vi(!1);try{await b(n.id),p("Success","Project deleted successfully","success"),r()}catch(h){console.error("Error deleting project:",h),p("Error","Failed to delete project","error")}},Ni=()=>{vi(!0)},ns=(h,_,N,S)=>{const A=e.filter(je=>je.role===L.ADMIN),oe=e.find(je=>je.id===n.leadDesignerId),Z=Array.from(new Set([n.clientId,...n.clientIds||[]].filter(Boolean))).map(je=>e.find(Fe=>Fe.id===je)).filter(je=>!!je),De=[...A,oe,...Z];n.teamMembers&&n.teamMembers.forEach(je=>{const Fe=e.find(et=>et.id===je);Fe&&Fe.role!==L.VENDOR&&De.push(Fe)}),Array.from(new Set(De.filter(je=>!!je&&je.id!==N&&je.role!==L.VENDOR))).forEach(je=>{p(h,_,"info",je.id,n.id,n.name,S)})},Ss=(h,_,N,S="info",A)=>{h&&h!==u.id&&p(_,N,S,h,n.id,n.name,A)},tr=(h,_,N="info")=>({id:Math.random().toString(36).substr(2,9),userId:u.id,action:h,details:_,timestamp:new Date().toISOString(),type:N}),Yt=h=>h===xe.ABORTED||h===xe.ON_HOLD,Fr=h=>Yt(h.status)?!0:!h.dependencies||h.dependencies.length===0?!1:Nt.filter(N=>{var S;return(S=h.dependencies)==null?void 0:S.includes(N.id)}).some(N=>N.status!==xe.DONE),wa=h=>h.dependencies?Nt.filter(_=>{var N;return((N=h.dependencies)==null?void 0:N.includes(_.id))&&_.status!==xe.DONE}):[],kc=h=>h?typeof h=="string"?new Date(h).getTime():h.toDate&&typeof h.toDate=="function"?h.toDate().getTime():h instanceof Date?h.getTime():new Date(h).getTime()||0:0,pl=h=>kc(h.approvalDate||h.clientApprovedDate||h.uploadDate||h.approvalDate||h.rejectionDate||h.uploadDate),At=(h,_=!1)=>`
    w-full p-2 border rounded-lg transition-all focus:outline-none placeholder-gray-400
    ${_?"bg-gray-100 text-gray-500 cursor-not-allowed":"bg-white text-gray-900"}
    ${h?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}
  `,xn=h=>{if(u.role===L.VENDOR&&h.assigneeId!==u.id){p("Access Restricted","You can only view details of tasks assigned to you.","warning");return}const _={start:{client:{status:"pending"},admin:{status:"pending"}},completion:{client:{status:"pending"},admin:{status:"pending"}}};ce({...h,approvals:h.approvals||_}),he(!0),B(!1)},Cc=async()=>{if(!Hn){p("Validation Error","Please select at least one user","error");return}const h=Hn.split(",").filter(Boolean);try{if(vs==="client"){const _=h.filter(S=>S!==n.clientId&&!(n.clientIds||[]).includes(S));if(_.length===0){p("Info","All selected clients are already added","info");return}const N=[...n.clientIds||[],..._];_.forEach(S=>{const A=e.find(Y=>Y.id===S),oe=tr("Client Added",`${A==null?void 0:A.name} added as client to project`);Ss(S,"Added to Project",`You have been added as a client to "${n.name}"`,"success","dashboard")}),t({...n,clientIds:N}),p("Success",`${_.length} client${_.length!==1?"s":""} added`,"success")}else if(vs==="member"){const _=h.filter(S=>!(n.teamMembers||[]).includes(S));if(_.length===0){p("Info","All selected members are already added","info");return}const N=[...n.teamMembers||[],..._];_.forEach(S=>{const A=e.find(Y=>Y.id===S),oe=tr("Team Member Added",`${A==null?void 0:A.name} added as team member to project`);Ss(S,"Added to Project",`You have been added to "${n.name}"`,"success","dashboard")}),t({...n,teamMembers:N}),p("Success",`${_.length} member${_.length!==1?"s":""} added`,"success")}xi(!1),ys("")}catch(_){console.error("Error adding member:",_),p("Error","Failed to add member.","error")}},[fl,Ii]=q.useState(!1),m=async()=>{var h;if(nn.length===0&&!ct.name){un(!0),p("Validation Error",`Please select files or enter a name for "${n.name}".`,"error",void 0,n.id,n.name);return}Ii(!0);try{const _=nn.length>0?nn:[{name:ct.name}],N=[];for(const A of _){const oe=A.name||ct.name;let Y="other";A.type&&(A.type.startsWith("image/")?Y="image":A.type==="application/pdf"&&(Y="pdf"));let Z="";if(A instanceof File&&A.size)try{const et=`projects/${n.id}/documents/${Date.now()}_${A.name}`;Z=await aV(A,et)}catch(et){console.error("Upload failed, falling back to local preview:",et),Z=URL.createObjectURL(A),p("Warning",`Failed to upload "${oe}" to storage. Using local preview.`,"warning")}else Z="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iI2VmZWZlZiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjI0IiBmaWxsPSIjYWFhIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5QbGFjZWhvbGRlcjwvdGV4dD48L3N2Zz4=";const De={name:oe,type:Y,url:Z,uploadedBy:u.id,uploadDate:new Date().toISOString(),sharedWith:ct.sharedWith.length>0?ct.sharedWith:[L.ADMIN,L.DESIGNER,L.CLIENT],approvalStatus:"pending"},Je=await Py(n.id,De);N.push(Je);const je=ct.sharedWith.length>0?ct.sharedWith.map(et=>{if(et===L.ADMIN||et===L.DESIGNER||et===L.CLIENT)return et;const tt=e.find(St=>St.id===et);return(tt==null?void 0:tt.name)||et}).join(", "):"Admin, Designer, Client",Fe=new Date().toISOString();await si(n.id,`Document Uploaded: ${oe}`,`${oe} (${Y}) uploaded by ${u.name}. Shared with: ${je}`,"completed",Fe,Fe)}if(ct.attachToTaskId&&N.length>0){const A=Nt.find(oe=>oe.id===ct.attachToTaskId);if(A){const oe=A.documents||[],Y=N.filter(Z=>!oe.includes(Z));if(Y.length>0){const Z=[...oe,...Y];await ii(n.id,A.id,{...A,documents:Z}),(j==null?void 0:j.id)===A.id&&ce({...j,documents:Z});const De=Nt.map(Je=>Je.id===A.id?{...Je,documents:Z}:Je);t({...n,tasks:De})}}}const S=tr("Document Uploaded",`Uploaded ${N.length} document(s)`);t({...n,activityLog:[S,...n.activityLog||[]]});for(let A=0;A<N.length;A++){const oe={id:N[A],name:((h=nn[A])==null?void 0:h.name)||ct.name,type:ct.type,url:"",uploadedBy:u.id,uploadDate:new Date().toISOString(),sharedWith:ct.sharedWith.length>0?ct.sharedWith:[L.ADMIN,L.DESIGNER,L.CLIENT],approvalStatus:"pending"},Y=[],Z=e.filter(Fe=>Fe.role===L.ADMIN&&Fe.tenantId===u.tenantId);Y.push(...Z);const De=ct.sharedWith.filter(Fe=>Fe!==L.ADMIN&&Fe!==L.DESIGNER&&Fe!==L.CLIENT),Je=e.filter(Fe=>De.includes(Fe.id));Y.push(...Je);const je=Y.filter((Fe,et,tt)=>tt.findIndex(St=>St.id===Fe.id)===et&&Fe.id!==u.id);je.length>0&&await Z6(oe,u.name,n.name,je,n.id)}ns("Files Added",`${u.name} uploaded ${N.length} document(s) to "${n.name}"`,u.id,"documents"),ot(!1),On({name:"",type:"other",sharedWith:[]}),Ie([]),un(!1),p("Success",`${N.length} document(s) uploaded successfully to "${n.name}"`,"success",void 0,n.id,n.name)}catch(_){console.error("Document upload error:",_),p("Error","Unable to upload document(s). Please check file size and try again.","error",void 0,n.id,n.name)}finally{Ii(!1)}},y=h=>{const _=document.createElement("a");_.href=h.url,_.download=h.name,document.body.appendChild(_),_.click(),document.body.removeChild(_),p("Download Started",`Downloading ${h.name}...`,"success")},I=h=>{wi(h),ws(!0)},R=async()=>{var _;if(!Hs)return;const h=Hs;try{await j6(n.id,h.id);const N=Nt.map(A=>{var oe;return(oe=A.documents)!=null&&oe.includes(h.id)?{...A,documents:A.documents.filter(Y=>Y!==h.id)}:A});(_=j==null?void 0:j.documents)!=null&&_.includes(h.id)&&ce({...j,documents:j.documents.filter(A=>A!==h.id)});const S=N.filter(A=>{var oe,Y;return A.documents&&A.documents.length!==((Y=(oe=Nt.find(Z=>Z.id===A.id))==null?void 0:oe.documents)==null?void 0:Y.length)});for(const A of S)await ii(n.id,A.id,{documents:A.documents});t({...n,tasks:N}),p("Success",`Document "${h.name}" deleted successfully`,"success"),_t(!1)}catch(N){console.error("Error deleting document:",N),p("Error","Failed to delete document","error")}finally{ws(!1),wi(null)}},ee=h=>{const _=_r.find(N=>N.id===h.id)||h;bt(_),_t(!0)},de=async h=>{var _;if(!ge){$e(`approve-doc-${h.id}`);try{await zu(n.id,h.id,{approvalStatus:"approved",approvedBy:u.id,approvalDate:new Date().toISOString()}),await new Promise(A=>setTimeout(A,500));const N=new Set;n.leadDesignerId&&N.add(n.leadDesignerId),h.uploadedBy&&N.add(h.uploadedBy),(h.sharedWith||[]).forEach(A=>N.add(A)),n.clientId&&((_=h.sharedWith)!=null&&_.includes(n.clientId))&&N.add(n.clientId),e.filter(A=>A.role===L.ADMIN&&A.tenantId===u.tenantId).forEach(A=>N.add(A.id));const S=e.filter(A=>N.has(A.id));S.length>0&&await wN(h,u.name||"Unknown User",S,n.name,n.id,"approved"),p("Success",`Document "${h.name}" approved`,"success")}catch(N){console.error("Error approving document:",N),p("Error","Failed to approve document","error")}finally{$e(null)}}},Re=async h=>{if(!ge){$e(`reject-doc-${h.id}`);try{await zu(n.id,h.id,{approvalStatus:"rejected",rejectedBy:u.id,rejectionDate:new Date().toISOString()}),await new Promise(S=>setTimeout(S,500));const _=new Set;e.filter(S=>S.role===L.ADMIN).forEach(S=>_.add(S.id)),n.leadDesignerId&&_.add(n.leadDesignerId),h.uploadedBy&&_.add(h.uploadedBy),(h.sharedWith||[]).forEach(S=>{S!==u.id&&_.add(S)});const N=e.filter(S=>_.has(S.id));N.length>0&&await wN(h,u.name||"Unknown User",N,n.name,n.id,"rejected"),p("Success",`Document "${h.name}" rejected`,"success")}catch(_){console.error("Error rejecting document:",_),p("Error","Failed to reject document","error")}finally{$e(null)}}},gt=async h=>{if(!ge){$e(`client-approve-doc-${h.id}`);try{await zu(n.id,h.id,{clientApprovalStatus:"approved",clientApprovedBy:u.id,clientApprovedDate:new Date().toISOString()}),await new Promise(N=>setTimeout(N,500));const _=e.filter(N=>{var S;return!!(N.id===n.leadDesignerId||(S=h.sharedWith)!=null&&S.includes(N.id)&&N.id!==u.id)});_.length>0&&await _N(h,u.name||"Unknown User",_,n.name,n.id,"approved"),p("Success",`Document "${h.name}" approved by you`,"success")}catch(_){console.error("Error approving document as client:",_),p("Error","Failed to approve document","error")}finally{$e(null)}}},wn=async h=>{if(!ge){$e(`client-reject-doc-${h.id}`);try{await zu(n.id,h.id,{clientApprovalStatus:"rejected",clientApprovedBy:u.id,clientApprovedDate:new Date().toISOString()}),await new Promise(N=>setTimeout(N,500));const _=e.filter(N=>{var S;return!!(N.id===n.leadDesignerId||(S=h.sharedWith)!=null&&S.includes(N.id)&&N.id!==u.id)});_.length>0&&await _N(h,u.name||"Unknown User",_,n.name,n.id,"rejected"),p("Success",`Document "${h.name}" rejected by you`,"success")}catch(_){console.error("Error rejecting document as client:",_),p("Error","Failed to reject document","error")}finally{$e(null)}}},Ut=async()=>{if(!(!Gt.trim()||!it)&&!yr)try{pi(!0);const h={userId:u.id,userName:u.name||"Unknown User",text:Gt,timestamp:new Date().toISOString()};await k6(n.id,it.id,h);const _={...h,id:Math.random().toString(36).substr(2,9)},N=e.filter(oe=>{var Y;return!!(oe.id===n.leadDesignerId||oe.role===L.ADMIN&&oe.tenantId===u.tenantId||oe.id===n.clientId||(Y=it.sharedWith)!=null&&Y.includes(oe.id))});N.length>0&&await nV(it,_,u.name||"Unknown User",N,n.name,n.id),cn("");const S=new Date().toISOString();await si(n.id,`Document Comment: ${it.name}`,`${u.name} commented: "${Gt.substring(0,100)}..."`,"completed",S,S);const A=tr("Document Comment",`Added comment to "${it.name}"`);t({...n,activityLog:[A,...n.activityLog||[]]}),p("Success",`Comment added to "${it.name}"`,"success")}catch(h){console.error("Document comment error:",h),p("Error","Unable to add comment. Please try again.","error")}finally{pi(!1)}},yn=h=>{if(h){const _=kt.find(N=>N.id===h);if(_){if(He(_),We(h),_.category==="Others"?at(_.description||""):at(""),_.type==="income"){if(_.paidByRole)Ze(_.paidByRole),En(_.paidTo||"");else if(_.paidByOther)Ze("other"),En(_.paidByOther||"");else if(_.paidTo){const N=e.find(S=>S.name===_.paidTo);N?N.role===L.CLIENT?Ze("client"):N.role===L.VENDOR?Ze("vendor"):N.role===L.DESIGNER?Ze("designer"):N.role===L.ADMIN&&Ze("admin"):Ze("other"),En(_.paidTo||"")}if(_.receivedByRole)Ze(_.receivedByRole),Me(_.receivedBy||_.receivedByName||"");else if(_.receivedBy){const N=e.find(S=>S.name===_.receivedBy);N?N.role===L.VENDOR?Ze("vendor-received"):N.role===L.DESIGNER?Ze("designer-received"):N.role===L.ADMIN&&Ze("admin-received"):Ze("other-received"),Me(_.receivedBy||"")}}else if(_.type==="expense"){if(_.paidByOther&&He({..._,paidBy:"other"}),_.receivedByRole)Ze(_.receivedByRole),Me(_.receivedByName||_.receivedBy||"");else if(_.receivedBy){const N=e.find(S=>S.name===_.receivedBy);N?N.role===L.CLIENT?Ze("client"):N.role===L.VENDOR?Ze("vendor"):N.role===L.DESIGNER?Ze("designer"):N.role===L.ADMIN&&Ze("admin"):Ze("other"),Me(_.receivedBy||"")}}}}else He({date:new Date().toISOString().split("T")[0],type:"expense",status:"pending",amount:void 0,paymentMode:void 0}),We(null),En(""),Me(""),Ze(""),at("");_e(!0),Ln(!1)},Br=async()=>{var _;const h=X.category==="Others"?Vt:X.category;if(!X.amount||!X.description||!h||!X.date){Ln(!0),p("Validation Error",`Please fill all required fields for "${n.name}"`,"error",void 0,n.id,n.name);return}if(!Pr){if(!Be&&kt.some(S=>S.vendorName===X.vendorName&&S.amount===Number(X.amount)&&S.type===X.type&&S.date===X.date&&S.description===X.description)){p("Duplicate Detected","This transaction already exists. Please check the records above.","warning",void 0,n.id,n.name);return}mt(!0);try{let N=[...kt],S;if(Be){let A={...kt.find(Z=>Z.id===Be),...X,amount:Number(X.amount),paidBy:X.type==="income"?ve==="other"?"other":ve==="client"?"client":ve==="vendor"?"vendor":ve==="designer"?"designer":ve==="admin"?"admin":X.paidBy:X.paidBy,paidByRole:X.type==="income"?ve==="other"?"other":ve==="client"?"client":ve==="vendor"?"vendor":ve==="designer"?"designer":ve==="admin"?"admin":void 0:void 0,paidTo:X.type==="income"?X.vendorName||ln:ln||X.paidTo,paidByOther:X.type==="income"&&ve==="other"?ln:X.paidByOther,receivedBy:X.type==="income"?ve==="vendor-received"||ve==="designer-received"||ve==="admin-received"||ve==="other-received"||ve==="admin"||ve==="client"||ve==="vendor"||ve==="designer"?xt:X.receivedBy:xt||X.receivedBy,receivedByRole:ve==="client-received"?"client-received":ve==="vendor-received"?"vendor-received":ve==="designer-received"?"designer-received":ve==="admin-received"?"admin-received":ve==="other-received"?"other-received":ve==="client"?"client-received":ve==="vendor"?"vendor-received":ve==="designer"?"designer-received":ve==="admin"?"admin-received":ve==="other"?"other-received":void 0,receivedByName:X.type==="expense"||X.type==="income"?xt:X.receivedByName};(A.type==="income"&&A.status==="paid"||A.type==="expense"&&A.status==="paid")&&(A.status="paid");let oe="in-progress";A.status==="paid"?oe="completed":A.status==="overdue"&&(oe="in-progress");const Y=`Type: ${A.type} | Amount: ${A.amount.toLocaleString()} | Category: ${A.category} | Mode: ${A.paymentMode||"N/A"} | Status: ${A.status}${A.vendorName?` | Vendor: ${A.vendorName}`:""}`;await si(n.id,`Transaction Updated: ${A.description}`,Y,oe,A.date,A.date),N=N.map(Z=>Z.id===Be?A:Z),S=tr("Financial",`Updated transaction: ${A.description} (${A.type} - ${A.amount.toLocaleString()})`)}else{const A={id:Math.random().toString(36).substr(2,9),date:X.date,timestamp:new Date().toISOString(),description:X.description,amount:Number(X.amount),type:X.type,status:X.status||"pending",category:h,vendorName:X.vendorName,paidBy:X.type==="income"?ve==="other"?"other":ve==="client"?"client":ve==="vendor"?"vendor":ve==="designer"?"designer":ve==="admin"?"admin":void 0:X.paidBy,paidByRole:X.type==="income"?ve==="other"?"other":ve==="client"?"client":ve==="vendor"?"vendor":ve==="designer"?"designer":ve==="admin"?"admin":void 0:void 0,paidTo:X.type==="income"?X.vendorName||ln:X.paidTo,paidByOther:X.type==="income"&&ve==="other"?ln:X.paidByOther,receivedBy:X.type==="income"?ve==="vendor-received"||ve==="designer-received"||ve==="admin-received"||ve==="other-received"||ve==="admin"||ve==="client"||ve==="vendor"||ve==="designer"?xt:void 0:xt||X.receivedBy,receivedByRole:ve==="client-received"?"client-received":ve==="vendor-received"?"vendor-received":ve==="designer-received"?"designer-received":ve==="admin-received"?"admin-received":ve==="other-received"?"other-received":ve==="client"?"client-received":ve==="vendor"?"vendor-received":ve==="designer"?"designer-received":ve==="admin"?"admin-received":ve==="other"?"other-received":void 0,receivedByName:X.type==="expense"||X.type==="income"?xt:void 0,paymentMode:X.paymentMode,adminApproved:X.adminApproved,clientApproved:X.clientApproved,isAdditionalBudget:X.type==="income"&&h==="Additional Budget",clientApprovalForAdditionalBudget:X.type==="income"&&h==="Additional Budget"?X.clientApprovalForAdditionalBudget||"pending":void 0,adminApprovalForAdditionalBudget:X.type==="income"&&h==="Additional Budget"?X.adminApprovalForAdditionalBudget||"pending":void 0,isClientPayment:X.type==="income"&&h!=="Additional Budget",clientApprovalForPayment:X.type==="income"&&h!=="Additional Budget"?X.clientApprovalForPayment||"pending":void 0,adminApprovalForPayment:X.type==="income"&&h!=="Additional Budget"?X.adminApprovalForPayment||"pending":void 0};let oe="planned";A.status==="paid"?oe="completed":(A.status==="pending"||A.status==="overdue")&&(oe="in-progress");const Y=`Type: ${A.type} | Amount: ${A.amount.toLocaleString()} | Category: ${A.category} | Mode: ${A.paymentMode||"N/A"} | Status: ${A.status} | Paid By: ${A.paidBy||"N/A"}${A.vendorName?` | Vendor: ${A.vendorName}`:""}`;await si(n.id,`Financial: ${A.type==="income"?"Income":"Expense"} - ${A.description}`,Y,oe,A.date,A.date),N.push(A),S=tr("Financial",`Added ${A.type}: ${A.amount.toLocaleString()} for ${A.description}`)}try{if(Be){const A=N.find(oe=>oe.id===Be);A&&await xd(n.id,Be,A)}else{const A=N[N.length-1],oe=await Oy(n.id,{date:A.date,timestamp:A.timestamp,description:A.description,amount:A.amount,type:A.type,status:A.status,category:A.category,vendorName:A.vendorName,paidBy:A.paidBy,paidByRole:A.paidByRole,paidTo:A.paidTo,paidByOther:A.paidByOther,receivedBy:A.receivedBy,receivedByRole:A.receivedByRole,receivedByName:A.receivedByName,paymentMode:A.paymentMode,adminApproved:A.adminApproved,clientApproved:A.clientApproved,isAdditionalBudget:A.isAdditionalBudget,clientApprovalForAdditionalBudget:A.clientApprovalForAdditionalBudget,adminApprovalForAdditionalBudget:A.adminApprovalForAdditionalBudget,isClientPayment:A.isClientPayment,clientApprovalForPayment:A.clientApprovalForPayment,adminApprovalForPayment:A.adminApprovalForPayment});A.id=oe}}catch(A){throw console.error("Database save error:",A),new Error("Failed to save transaction to database")}t({...n,financials:Be?n.financials:N,activityLog:[S,...n.activityLog||[]]}),ns("Budget Update",`${Be?"Updated":"New"} transaction "${X.description}" in "${n.name}"`,u.id,"financials"),He({date:new Date().toISOString().split("T")[0],type:"expense",status:"pending",amount:void 0}),_e(!1),We(null),Ln(!1),mt(!1),En(""),Me(""),Ze(""),at(""),p("Success",`Transaction ${Be?"updated":"added"} and saved to database.`,"success",void 0,n.id,n.name)}catch(N){const S=(_=N.message)!=null&&_.includes("database")?"Failed to save transaction. Please try again.":"Transaction saved locally. Please refresh the page or contact support if changes don't appear.";p("Error",S,"error",void 0,n.id,n.name),_e(!1),We(null),mt(!1),En(""),Me(""),Ze(""),at(""),console.error("Transaction save error:",N)}}},rs=async(h,_,N)=>{if(!ge){$e(`approve-budget-${h}-${_}-${N}`);try{const S=_==="client"?"clientApprovalForAdditionalBudget":"adminApprovalForAdditionalBudget",A=Gs.some(Y=>Y.id===h);A&&await xd(n.id,h,{[S]:N});const oe=kt.find(Y=>Y.id===h);if(oe){const Y={...oe,[S]:N},Z=N==="approved"?"Approved":"Rejected",De=_==="client"?"Client":"Admin",Je=_==="client"?N==="approved":Y.clientApprovalForAdditionalBudget==="approved",je=_==="admin"?N==="approved":Y.adminApprovalForAdditionalBudget==="approved",Fe=Je&&je;if(Fe&&oe.status!=="paid"){const tt=n.budget+oe.amount;let St={...n,budget:tt,initialBudget:n.initialBudget||n.budget};t(St),A&&await xd(n.id,h,{status:"paid"})}await si(n.id,Fe?`Additional Budget Approved: ${oe.amount.toLocaleString()}`:`Additional Budget ${Z}`,Fe?`Budget increased by ${oe.amount.toLocaleString()}. Both Client and Admin have approved. New Total: ${(n.budget+oe.amount).toLocaleString()}`:`${De} ${N==="approved"?"approved":"rejected"} additional budget of ${oe.amount.toLocaleString()}`,Fe?"completed":"in-progress",new Date().toISOString(),new Date().toISOString());const et=e.filter(tt=>tt.id===n.leadDesignerId||tt.id===n.clientId||tt.role===L.ADMIN&&tt.tenantId===u.tenantId);et.length>0&&await Lx(oe,u.name||"Unknown User",et,n.name,n.id,N,_,"additional-budget")}p("Success",`Additional budget ${N==="approved"?"approved":"rejected"} by ${_==="client"?"Client":"Admin"}`,"success",void 0,n.id,n.name)}catch(S){console.error("Approval error:",S),p("Error","Unable to process approval. Please try again.","error",void 0,n.id,n.name)}finally{$e(null)}}},Kn=async(h,_,N)=>{if(!ge){$e(`approve-payment-${h}-${_}-${N}`);try{const S=_==="client"?"clientApprovalForPayment":"adminApprovalForPayment";Gs.some(Y=>Y.id===h)&&await xd(n.id,h,{[S]:N});const oe=kt.find(Y=>Y.id===h);if(oe){const Y=N==="approved"?"Confirmed":"Disputed",Z=_==="client"?"Client":"Admin",De=new Date().toISOString();await si(n.id,`Payment ${Y}`,`${Z} ${N==="approved"?"confirmed":"disputed"} payment of ${oe.amount.toLocaleString()} for ${oe.description}`,N==="approved"?"completed":"in-progress",De,De);const Je=e.filter(je=>je.id===n.leadDesignerId||je.id===n.clientId||je.role===L.ADMIN&&je.tenantId===u.tenantId);Je.length>0&&await Lx(oe,u.name||"Unknown User",Je,n.name,n.id,N,_,"payment")}p("Success",`Payment ${N==="approved"?"confirmed":"disputed"} by ${_==="client"?"Client":"Admin"}`,"success",void 0,n.id,n.name)}catch(S){console.error("Approval error:",S),p("Error","Unable to process approval. Please try again.","error",void 0,n.id,n.name)}finally{$e(null)}}},Mn=q.useCallback(async(h,_,N)=>{if(ge)return;$e(`approve-expense-${h}-${_}-${N}`);const S=_==="client"?"clientApproved":"adminApproved";try{Gs.some(De=>De.id===h)&&await xd(n.id,h,{[S]:N});const oe=kt.find(De=>De.id===h);if(oe){const De=e.filter(Je=>Je.id===n.leadDesignerId||Je.id===n.clientId||Je.role===L.ADMIN&&Je.tenantId===u.tenantId);De.length>0&&await Lx(oe,u.name||"Unknown User",De,n.name,n.id,N?"approved":"rejected",_,"expense")}p("Success",`Expense ${N?"approved":"rejected"} by ${_==="client"?"client":"admin"}`,"success",void 0,n.id,n.name)}catch(A){console.error("Approval error:",A),p("Error","Unable to process approval. Please try again.","error",void 0,n.id,n.name)}finally{$e(null)}},[n.id,p,Gs,kt,n.leadDesignerId,n.clientId,e,u.name,ge]),lo=(h,_)=>{var A;if(!j||Yt(j.status))return;let N=j.dependencies||[];_?N=[...N,h]:N=N.filter(oe=>oe!==h);let S=j.startDate;if(N.length>0){const oe=Nt.filter(Z=>N.includes(Z.id)),Y=oe.reduce((Z,De)=>new Date(De.dueDate)>new Date(Z)?De.dueDate:Z,((A=oe[0])==null?void 0:A.dueDate)||"");Y&&(S=Y)}ce({...j,dependencies:N,startDate:S})},gl=async()=>{var h,_,N,S,A,oe,Y,Z,De,Je,je,Fe,et;if(!(j!=null&&j.title)||!j.startDate||!j.dueDate){B(!0),p("Validation Error",`Please complete all required fields for "${n.name}"`,"error",void 0,n.id,n.name);return}if(Yt(j.status)&&!Mt){p("Action Denied","This task is frozen and cannot be modified.","error");return}Se(!0);try{const tt={start:{client:{status:"pending"},admin:{status:"pending"}},completion:{client:{status:"pending"},admin:{status:"pending"}}};let St=j.status||xe.TODO;Yt(St)||(St=pp(j,St));const ur=!j.id,Ge={id:j.id||Math.random().toString(36).substr(2,9),title:j.title,description:j.description,status:St,category:j.category||"General",assigneeId:j.assigneeId||"",startDate:j.startDate,dueDate:j.dueDate,priority:j.priority||"medium",dependencies:j.dependencies||[],subtasks:j.subtasks||[],comments:j.comments||[],approvals:j.approvals||tt};if((h=Ge.dependencies)!=null&&h.includes(Ge.id)){p("Dependency Error","A task cannot depend on itself.","error");return}if(Ge.status!==xe.TODO&&!Yt(Ge.status)&&!(((S=(N=(_=Ge.approvals)==null?void 0:_.start)==null?void 0:N.client)==null?void 0:S.status)==="approved"&&((Y=(oe=(A=Ge.approvals)==null?void 0:A.start)==null?void 0:oe.admin)==null?void 0:Y.status)==="approved"&&((Je=(De=(Z=Ge.approvals)==null?void 0:Z.completion)==null?void 0:De.client)==null?void 0:Je.status)==="approved"&&((et=(Fe=(je=Ge.approvals)==null?void 0:je.completion)==null?void 0:Fe.admin)==null?void 0:et.status)==="approved")){const Xt=wa(Ge);if(Xt.length>0){p("Blocked",`Cannot start task. Blocked by: ${Xt.map(Fn=>Fn.title).join(", ")}.`,"error");return}}let $n=[...Nt];const Ur=$n.findIndex(on=>on.id===Ge.id);let as;const Et=Nt.find(on=>on.id===Ge.id);if(ur){$n.push(Ge),as=tr("Task Created",`Created new task "${Ge.title}"`,"creation"),await w6(n.id,Ge);const on=Ge.assigneeId?Tn(Ge.assigneeId):"Unassigned",Xt=new Date().toISOString();if(await si(n.id,`Task Created: ${Ge.title}`,`Assigned to ${on}. Priority: ${Ge.priority}, Due: ${Ge.dueDate}`,"planned",Xt,Xt),Ge.assigneeId){const Fn=e.find(hr=>hr.id===Ge.assigneeId);Fn&&await bN(Ge,Fn,n.name,n.id,"created"),Ss(Ge.assigneeId,"New Task Assignment",`You have been assigned to task "${Ge.title}" in "${n.name}"`,"info","plan")}}else{Ur>=0&&($n[Ur]=Ge);const on=[];(Et==null?void 0:Et.status)!==Ge.status&&on.push(`Status: ${Et==null?void 0:Et.status}  ${Ge.status}`),(Et==null?void 0:Et.priority)!==Ge.priority&&on.push(`Priority: ${Et==null?void 0:Et.priority}  ${Ge.priority}`),(Et==null?void 0:Et.assigneeId)!==Ge.assigneeId&&on.push(`Assigned to: ${Tn((Et==null?void 0:Et.assigneeId)||"")}  ${Tn(Ge.assigneeId)}`),(Et==null?void 0:Et.title)!==Ge.title&&on.push("Title changed"),(Et==null?void 0:Et.description)!==Ge.description&&on.push("Description updated");const Xt=on.length>0?` (${on.join(", ")})`:"";as=tr("Task Updated",`Updated task details for "${Ge.title}"${Xt}`),await ii(n.id,Ge.id,Ge);const Fn=ra(Ge),hr=Ge.assigneeId?Tn(Ge.assigneeId):"Unassigned",mr=`Priority: ${Ge.priority} | Status: ${Ge.status} | Assigned to: ${hr} | Progress: ${Fn}% | Due: ${Ge.dueDate}${Xt?" | Changes: "+Xt:""}`,Sn=new Date().toISOString();if(await si(n.id,`Task Updated: ${Ge.title}`,mr,Ge.status===xe.DONE?"completed":"in-progress",Sn,Sn),Et&&Et.assigneeId!==Ge.assigneeId&&Ge.assigneeId){const os=e.find(jl=>jl.id===Ge.assigneeId);os&&await bN(Ge,os,n.name,n.id,"updated"),Ss(Ge.assigneeId,"Task Reassignment",`You have been assigned to task "${Ge.title}" in "${n.name}"`,"info","plan")}}ns("Task Update",`Task "${Ge.title}" ${ur?"created":"updated"} in "${n.name}"`,u.id,"plan"),t(ur?{...n,activityLog:[as,...n.activityLog||[]]}:{...n,tasks:$n,activityLog:[as,...n.activityLog||[]]}),p("Task Saved",`Task "${Ge.title}" has been saved in "${n.name}".`,"success",void 0,n.id,n.name),he(!1),ce(null),B(!1),await new Promise(on=>setTimeout(on,500))}catch(tt){console.error("Error saving task:",tt),p("Error","Unable to save task. Please check your input and try again.","error",void 0,n.id,n.name)}finally{Se(!1)}},eg=async()=>{if(!(or!=null&&or.id)){p("Error","Cannot delete a task that has not been saved yet.","error");return}try{await _6(n.id,or.id);const h=Nt.filter(N=>N.id!==or.id),_=tr("Task Deleted",`Deleted task "${or.title}"`);t({...n,tasks:h,activityLog:[_,...n.activityLog||[]]}),p("Task Deleted",`Task "${or.title}" has been deleted from "${n.name}".`,"success",void 0,n.id,n.name),he(!1),ce(null),Bi(!1),Ui(null)}catch(h){console.error("Error deleting task:",h),p("Error","Unable to delete task. Please try again.","error",void 0,n.id,n.name),Bi(!1),Ui(null)}},tg=()=>{if(!(j!=null&&j.id)){p("Error","Cannot delete a task that has not been saved yet.","error");return}Ui(j),Bi(!0)},Hd=async h=>{const _=e.find(N=>N.id===h.assigneeId);if(!_){p("Error","Assignee not found","error");return}if(!_.email||!_.email.trim()){p("Error",`Email not found for ${_.name}`,"error");return}Ce(h.id),C("Sending reminder...");try{const N=await sS(_.email,_.name,h.title,n.name,h.dueDate);N.success?p("Success",`Email reminder sent to ${_.name}`,"success"):p("Error",N.error||"Failed to send email","error")}catch(N){console.error("Error sending reminder:",N),p("Error","Failed to send email reminder","error")}finally{Ce(null),H()}},co=(h,_)=>{if(!h.phone||!h.phone.trim()){p("Error",`WhatsApp number not found for ${h.name}`,"error");return}const N=h.phone.replace(/\D/g,"");if(N.length<10){p("Error",`Invalid WhatsApp number for ${h.name}`,"error");return}const S=`https://wa.me/${N}?text=${encodeURIComponent(_)}`;window.open(S,"_blank")},rm=h=>{const _=`${window.location.origin}${window.location.pathname}?taskId=${h}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(_).then(()=>{p("Success","Task link copied to clipboard!","success",u==null?void 0:u.id,n.id,n.name)}).catch(()=>{Gd(_)}):Gd(_)},Gd=h=>{const _=document.createElement("textarea");_.value=h,_.style.position="fixed",_.style.opacity="0",document.body.appendChild(_),_.select();try{document.execCommand("copy"),p("Success","Task link copied to clipboard!","success",u==null?void 0:u.id,n.id,n.name)}catch{p("Error","Failed to copy task link","error",u==null?void 0:u.id,n.id,n.name)}document.body.removeChild(_)},sm=async h=>{if(!h.email||!h.email.trim()){p("Error",`Email not found for ${h.name}`,"error");return}C("Sending payment reminder...");try{const _=await J6(h.email,h.name,n.name);_.success?p("Success",`Payment reminder sent to ${h.name}`,"success"):p("Error",_.error||"Failed to send email","error")}catch(_){console.error("Error sending payment reminder:",_),p("Error","Failed to send payment reminder","error")}finally{H()}},Rc=async h=>{var S;if(Yt(h.status)){p("Action Blocked","Task is frozen.","error");return}const _=((S=h.subtasks)==null?void 0:S.map(A=>({...A,isCompleted:!0})))||[];let N=h.status;h.status===xe.REVIEW?N=xe.DONE:N=xe.REVIEW;try{await ii(n.id,h.id,{subtasks:_,status:N}),p("Success",`Task marked as ${N}`,"success")}catch(A){console.error("Error completing task:",A),p("Error","Failed to complete task","error")}},im=async(h,_)=>{console.log(" handleKanbanStatusUpdate called for task:",h,"new status:",_);const N=Nt.find(Y=>Y.id===h);if(!N){console.log(" Task not found:",h);return}if(console.log(" Found task:",N.title,"current status:",N.status),Yt(N.status)){console.log(" Task is frozen, cannot update"),p("Action Blocked","Task is frozen (Aborted or On Hold).","error");return}if(_!==xe.TODO&&!Yt(_)){const Y=wa(N);if(Y.length>0){const Z=Y.map(De=>De.title).join(", ");p("Action Blocked",`Waiting for dependencies: ${Z}`,"error");return}}const S=Nt.map(Y=>Y.id===h?{...Y,status:_}:Y),A=tr("Status Changed",`Task "${N.title}" moved from ${N.status} to ${_}`);try{const Y={...N,status:_},Z=ra(Y);let De="in-progress";_===xe.DONE?De="completed":_===xe.TODO&&(De="planned");const Je=N.assigneeId?Tn(N.assigneeId):"Unassigned",je=`Status: ${N.status}  ${_} | Progress: ${Z}% | Priority: ${N.priority} | Assigned to: ${Je} | Changed by: ${u.name}`,Fe=new Date().toISOString();if(await si(n.id,`Task Status: ${N.title}`,je,De,Fe,Fe),await ii(n.id,h,{status:_}),_===xe.REVIEW||_===xe.DONE&&N.status!==xe.DONE){const tt=e.filter(St=>St.role===L.CLIENT||St.role===L.ADMIN);tt.length>0&&await eV(N,tt,n.name,n.id)}let et=n.status;_===xe.IN_PROGRESS&&(N.category==="Design and Planning"&&n.status===jn.DISCOVERY?et=jn.PLANNING:N.category==="Execution"&&(n.status===jn.DISCOVERY||n.status===jn.PLANNING)&&(et=jn.EXECUTION),et!==n.status&&(await g(n.id,{status:et}),p("Phase Updated",`Project automatically moved to ${et}`,"success")))}catch(Y){console.error("Error updating task status:",Y),p("Error","Failed to update task status. Please try again.","error")}_===xe.DONE&&u.role===L.VENDOR?ns("Task Completed",`"${N.title}" marked as DONE by ${u.name} in "${n.name}"`,u.id,"plan"):_===xe.REVIEW&&u.role===L.VENDOR?ns("Review Request",`"${N.title}" submitted for review by ${u.name} in "${n.name}"`,u.id,"plan"):_!==N.status&&ns("Status Update",`"${N.title}" moved to ${_} in "${n.name}"`,u.id,"plan");let oe=n.status;_===xe.IN_PROGRESS&&(N.category==="Design and Planning"&&n.status===jn.DISCOVERY?oe=jn.PLANNING:N.category==="Execution"&&(n.status===jn.DISCOVERY||n.status===jn.PLANNING)&&(oe=jn.EXECUTION)),t({...n,status:oe,tasks:S,activityLog:[A,...n.activityLog||[]]})},am=async(h,_)=>{const N=Nt.find(A=>A.id===h);if(N&&Yt(N.status))return;const S=Nt.map(A=>A.id===h?{...A,priority:_}:A);try{await ii(n.id,h,{priority:_}),t({...n,tasks:S})}catch(A){console.error("Error updating task priority:",A),p("Error","Failed to update task priority.","error")}},uo=async(h,_)=>{const N=Nt.find(Z=>Z.id===h);if(!N)return;if(Yt(N.status)){p("Frozen","Task is frozen. Cannot update checklist.","error");return}if(Fr(N)){p("Locked","Cannot check off items. This task is blocked by pending dependencies.","warning");return}const S=N.subtasks.map(Z=>Z.id===_?{...Z,isCompleted:!Z.isCompleted}:Z),A={...N,subtasks:S},oe=pp(A,N.status),Y=Nt.map(Z=>Z.id===h?{...Z,subtasks:S,status:oe}:Z);try{await ii(n.id,h,{subtasks:S,status:oe}),oe!==N.status&&oe===xe.REVIEW&&u.role===L.VENDOR&&ns("Review Ready",`All items checked for "${N.title}" by ${u.name} in "${n.name}"`,u.id,"plan"),t({...n,tasks:Y})}catch(Z){console.error("Error updating subtask:",Z),p("Error","Failed to update checklist.","error")}},om=async()=>{if(!pe.trim()||!j)return;if(Yt(j.status)){p("Frozen","Cannot comment on frozen tasks.","error");return}const h={id:Math.random().toString(36).substr(2,9),userId:u.id,userName:u.name||"Unknown User",text:pe,timestamp:new Date().toISOString()},_=[...j.comments||[],h];if(ce({...j,comments:_}),P(""),j.id)try{await ii(n.id,j.id,{comments:_});const N=e.filter(S=>S.id===j.assigneeId||S.id===n.leadDesignerId||S.role===L.ADMIN&&S.tenantId===u.tenantId||S.id===n.clientId);N.length>0&&await tV(j,h,u.name||"Unknown User",N,n.name,n.id)}catch(N){console.error("Failed to save comment",N)}},ss=async(h,_,N)=>{var A,oe,Y,Z,De,Je,je,Fe,et,tt,St,ur,Ge,$n;if(!j||!j.approvals||Yt(j.status))return;const S=`${h}-${_}-${N||(Is?"client":"admin")}`;if(!Ve){me(S);try{if(_==="revoke"){if(!Mt){p("Access Denied","Only admins can revoke approvals","error");return}if(!N)return;const Xt=((Y=(oe=(A=j.approvals)==null?void 0:A[h])==null?void 0:oe.client)==null?void 0:Y.status)==="approved",Fn=((Je=(De=(Z=j.approvals)==null?void 0:Z[h])==null?void 0:De.admin)==null?void 0:Je.status)==="approved";if(Xt&&Fn){p("Locked","Cannot revoke approvals once both parties have approved.","error");return}const hr={...j.approvals,[h]:{...j.approvals[h],[N]:{status:"pending",updatedBy:u.id,timestamp:new Date().toISOString()}}};if(ce({...j,approvals:hr}),j.id)try{await ii(n.id,j.id,{approvals:hr});const mr=new Date().toISOString();await si(n.id,`Approval Revoked: ${j.title}`,`${h} approval revoked for ${N} by ${u.name}`,"in-progress",mr,mr),p("Approval Revoked",`${N} approval for ${h} stage revoked.`,"info")}catch(mr){console.error("Failed to revoke approval",mr),p("Error","Failed to revoke approval","error")}return}const Ur=u.role===L.CLIENT?"client":u.role===L.ADMIN?"admin":null;if(!Ur)return;const as=_==="approve"?"approved":"rejected";let Et={...j.approvals,[h]:{...j.approvals[h],[Ur]:{status:as,updatedBy:u.id,timestamp:new Date().toISOString()}}},on=j.status;if(_==="reject")on=h==="start"?xe.TODO:xe.IN_PROGRESS,p("Task Rejected","Status has been reset. Please review comments.","warning"),j.assigneeId&&Ss(j.assigneeId,"Work Rejected",`${u.name} rejected ${h} approval for "${j.title}".`,"warning","plan");else{const Xt=((Fe=(je=Et.start)==null?void 0:je.client)==null?void 0:Fe.status)==="approved",Fn=((tt=(et=Et.start)==null?void 0:et.admin)==null?void 0:tt.status)==="approved",hr=((ur=(St=Et.completion)==null?void 0:St.client)==null?void 0:ur.status)==="approved",mr=(($n=(Ge=Et.completion)==null?void 0:Ge.admin)==null?void 0:$n.status)==="approved";if(Xt&&Fn&&hr&&mr){if(on=xe.DONE,p("Task Approved","Task fully approved and marked as DONE.","success"),j.assigneeId){Ss(j.assigneeId,"Work Approved",`Great job! "${j.title}" is officially approved and done in "${n.name}".`,"success","plan");const Sn=hn.find(os=>os.id===j.assigneeId);Sn&&Sn.email&&j.title&&await Vx(j.title,Sn,n.name,u.name,"completion")}}else if(h==="completion"){if(p("Approved",`Task completion approved by ${Ur}. Waiting for others.`,"success"),j.assigneeId){const Sn=hn.find(os=>os.id===j.assigneeId);Sn&&Sn.email&&j.title&&await Vx(j.title,Sn,n.name,u.name,"completion")}}else if(p("Approved",`Task ${h} approved.`,"success"),j.assigneeId){const Sn=hn.find(os=>os.id===j.assigneeId);Sn&&Sn.email&&j.title&&await Vx(j.title,Sn,n.name,u.name,h)}}if(ce({...j,approvals:Et,status:on}),j.id)try{await ii(n.id,j.id,{approvals:Et,status:on});const Xt=Nt.map(hr=>hr.id===j.id?{...hr,approvals:Et,status:on}:hr);t({...n,tasks:Xt});const Fn=new Date().toISOString();await si(n.id,`Approval: ${j.title}`,`${h} approval ${_}ed by ${u.name}`,"completed",Fn,Fn)}catch(Xt){console.error("Failed to save approval",Xt),p("Error","Failed to save approval status","error")}await new Promise(Xt=>setTimeout(Xt,500))}finally{me(null)}}},ng=()=>{const h=kt.filter(Y=>Y.type==="income"&&Y.status==="paid").reduce((Y,Z)=>Y+Z.amount,0),_=kt.filter(Y=>Y.type==="income"&&(Y.status==="pending"||Y.status==="overdue")).reduce((Y,Z)=>Y+Z.amount,0),N=kt.filter(Y=>Y.type==="expense"&&Y.status==="paid").reduce((Y,Z)=>Y+Z.amount,0),S=kt.filter(Y=>Y.type==="expense"&&(Y.status==="pending"||Y.status==="overdue")).reduce((Y,Z)=>Y+Z.amount,0),A=kt.filter(Y=>Y.type==="income"&&Y.category==="Additional Budget"&&Y.status==="paid").reduce((Y,Z)=>Y+Z.amount,0),oe=kt.filter(Y=>Y.type==="income"&&Y.category==="Additional Budget").reduce((Y,Z)=>Y+Z.amount,0);return{received:h,pendingIncome:_,paidOut:N,pendingExpenses:S,additionalBudgetReceived:A,totalAdditionalBudget:oe}},{received:Ys,paidOut:Js,pendingExpenses:ho,totalAdditionalBudget:lr}=ng(),lm=q.useMemo(()=>kt.filter(h=>Kt==="all"?!0:Kt==="income"?h.type==="income":Kt==="expense"?h.type==="expense":Kt==="pending"?h.status==="pending":Kt==="overdue"?h.status==="overdue":!0).sort((h,_)=>{const N=h.timestamp?new Date(h.timestamp).getTime():new Date(h.date).getTime();return(_.timestamp?new Date(_.timestamp).getTime():new Date(_.date).getTime())-N}),[kt,Kt]),Ei=h=>{const _=xf.indexOf(h);return _===-1?999:_},Hi=q.useMemo(()=>{if(Nt.length===0)return null;const h=Nt.flatMap(Y=>[new Date(Y.startDate).getTime(),new Date(Y.dueDate).getTime()]);h.push(new Date(n.startDate).getTime()),h.push(new Date(n.deadline).getTime());const _=Math.min(...h),N=Math.max(...h),S=N-_,A=1e3*60*60*24,oe=Math.ceil(S/A)+5;return{minDate:_,maxDate:N,totalDays:oe,dayMs:A}},[n,Nt]),mo=q.useMemo(()=>{if(!Hi)return[];const h=Ns.reduce((S,A)=>(S[A.category]=S[A.category]||[],S[A.category].push(A),S),{}),_=[];return Object.keys(h).sort((S,A)=>Ei(S)-Ei(A)).forEach(S=>{const A=h[S].sort((oe,Y)=>new Date(oe.startDate).getTime()-new Date(Y.startDate).getTime());_.push(...A)}),_.map((S,A)=>{const oe=new Date(S.startDate).getTime(),Y=new Date(S.dueDate).getTime(),Z=Hi.maxDate-Hi.minDate,De=(oe-Hi.minDate)/Z*100,Je=(Y-oe)/Z*100;return{...S,left:De,width:Math.max(Je,.5),index:A}})},[Ns,Hi]),Dc=q.useMemo(()=>{const h=new Set(Nt.map(_=>_.assigneeId));return e.filter(_=>_.role===L.VENDOR&&h.has(_.id))},[Nt,e]),xl=q.useMemo(()=>{const h=new Map;return Dc.forEach(_=>h.set(_.id,_)),n.teamMembers&&n.teamMembers.forEach(_=>{const N=e.find(S=>S.id===_);N&&N.role===L.VENDOR&&h.set(N.id,N)}),Array.from(h.values())},[Dc,n.teamMembers,e]),Kd=q.useMemo(()=>{if(Mt||Es)return xl;const h=n.hiddenVendors||[];return xl.filter(_=>!h.includes(_.id))},[xl,n.hiddenVendors,Mt,Es]),Pc=q.useMemo(()=>{const h={};return Kd.forEach(_=>{const N=_.specialty||"General";h[N]||(h[N]=[]),h[N].push(_)}),h},[Kd]),Qd=q.useMemo(()=>Object.keys(Pc).sort((h,_)=>Ei(h)-Ei(_)),[Pc]);q.useEffect(()=>{if(j&&j.id){const h=Nt.find(_=>_.id===j.id);h&&JSON.stringify(h.documents)!==JSON.stringify(j.documents)&&ce(_=>_&&_.id===j.id?{..._,documents:h.documents}:_)}},[Nt,j==null?void 0:j.id]);const yl=h=>!h||h.length===0?0:h.filter(_=>_r.some(N=>N.id===_)).length,rg=h=>!h||h.length===0?[]:_r.filter(_=>h.includes(_.id)),Tt=j?Yt(j.status):!1,sg=async()=>{if(n.status===jn.ON_HOLD){const _=Nt.some(N=>N.category==="Execution"&&(N.status===xe.IN_PROGRESS||N.status===xe.DONE))?jn.EXECUTION:jn.PLANNING;if(window.confirm(`Resume project to ${_}?`))try{await g(n.id,{status:_}),p("Project Resumed",`Project resumed to ${_}`,"success")}catch(N){console.error(N),p("Error","Failed to resume project","error")}}else if(window.confirm("Are you sure you want to put this project ON HOLD?"))try{await g(n.id,{status:jn.ON_HOLD}),p("Project On Hold","Project status set to On Hold","warning")}catch(h){console.error(h),p("Error","Failed to update status","error")}};return a.jsxs("div",{className:"h-full flex flex-col animate-fade-in relative",children:[a.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 md:px-6 py-3 md:py-2 flex flex-col md:flex-row items-start md:items-center justify-between sticky top-0 z-10 shadow-sm gap-3 md:gap-0",children:[!D&&a.jsxs("div",{className:"w-full space-y-3",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 animate-pulse"}),a.jsx("div",{className:"h-4 bg-gray-100 rounded w-1/2 animate-pulse"})]}),D&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-start gap-3 md:gap-4 w-full md:w-auto flex-1",children:[a.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-800 transition-colors flex-shrink-0 mt-1",title:"Go back to project list",children:a.jsx($a,{className:"w-5 h-5 rotate-180"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900 truncate",children:n.name}),Mt&&a.jsx("button",{onClick:Ni,className:"md:hidden flex items-center gap-2 px-2 py-1.5 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-xs font-medium whitespace-nowrap flex-shrink-0",title:"Delete Project",children:a.jsx(ks,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"flex flex-wrap items-center gap-3 md:gap-4 text-sm md:text-xs text-gray-500 mt-4 md:mt-3",children:Mt&&a.jsxs("button",{onClick:sg,className:`text-sm md:text-xs font-bold flex items-center gap-1 px-2 py-0.5 rounded-md border transition-colors whitespace-nowrap ${n.status===jn.ON_HOLD?"text-green-600 bg-green-50 border-green-100 hover:bg-green-100":"text-orange-600 bg-orange-50 border-orange-100 hover:bg-orange-100"}`,title:n.status===jn.ON_HOLD?"Resume Project":"Put Project On Hold",children:[n.status===jn.ON_HOLD?a.jsx(Lb,{className:"w-3 h-3"}):a.jsx(Ux,{className:"w-3 h-3"}),n.status===jn.ON_HOLD?"Resume":"Hold"]})}),a.jsxs("div",{className:"flex flex-wrap items-center gap-3 md:gap-4 text-base md:text-sm text-gray-600 mt-3 md:mt-3",children:[a.jsxs("span",{className:"flex items-center gap-1 whitespace-nowrap",children:[a.jsx(sh,{className:"w-4 h-4 flex-shrink-0"})," Due: ",dn(n.deadline)]}),!gn&&a.jsxs("span",{className:"flex items-center gap-1 whitespace-nowrap",children:[a.jsx(Mj,{className:"w-4 h-4 flex-shrink-0"})," Budget: ",n.budget.toLocaleString()]})]})]})]}),a.jsxs("div",{className:"flex gap-2 md:gap-3 w-full md:w-auto flex-shrink-0",children:[Mt&&a.jsxs("button",{onClick:Ni,className:"hidden md:flex items-center gap-2 px-3 md:px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-sm md:text-xs font-medium whitespace-nowrap",title:"Delete Project",children:[a.jsx(ks,{className:"w-5 h-5 flex-shrink-0"}),a.jsx("span",{className:"hidden md:inline",children:"Delete"})]}),Ft&&F!=="timeline"&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>{if(F==="plan"){const h=new Date().toISOString().split("T")[0];ce({startDate:h,dueDate:h}),he(!0),B(!1)}F==="documents"&&(ot(!0),Ie([])),F==="financials"&&yn(),F==="team"&&(xi(!0),ys("")),F==="discovery"&&yi(!0)},className:"hidden md:flex items-center gap-2 px-3 md:px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors text-sm md:text-xs font-medium whitespace-nowrap flex-1 md:flex-none justify-center md:justify-start",children:[a.jsx(Oi,{className:"w-4 h-4 flex-shrink-0"}),a.jsx("span",{children:F==="plan"?"Add Task":F==="documents"?"Add Document":F==="financials"?"Add Transaction":F==="team"?"Add Member":F==="discovery"?"Add Meeting":"Add Item"})]}),a.jsx("button",{onClick:()=>{if(F==="plan"){const h=new Date().toISOString().split("T")[0];ce({startDate:h,dueDate:h}),he(!0),B(!1)}F==="documents"&&(ot(!0),Ie([])),F==="financials"&&yn(),F==="team"&&(xi(!0),ys("")),F==="discovery"&&yi(!0)},className:"md:hidden fixed bottom-6 right-6 z-40 w-14 h-14 bg-gray-900 text-white rounded-full shadow-xl flex items-center justify-center hover:bg-gray-800 transition-transform active:scale-95","aria-label":"Add Item",children:a.jsx(Oi,{className:"w-6 h-6"})})]}),!Ft&&F==="documents"&&cl&&a.jsxs("button",{onClick:()=>{ot(!0),Ie([])},className:"flex items-center gap-2 px-3 md:px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors text-sm md:text-xs font-medium whitespace-nowrap flex-1 md:flex-none justify-center md:justify-start",children:[a.jsx(Wu,{className:"w-4 h-4 flex-shrink-0"}),a.jsx("span",{className:"hidden md:inline",children:"Upload"})]})]})]})]}),a.jsx("div",{ref:we,className:"bg-gray-50 overflow-x-auto md:overflow-hidden [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-track]:bg-transparent [&::-webkit-scrollbar-thumb]:bg-gray-300 [&::-webkit-scrollbar-thumb]:rounded [&:hover::-webkit-scrollbar-thumb]:bg-gray-400 hover:[scrollbar-color:rgb(107_114_128)_transparent]",style:{scrollbarWidth:"thin",scrollbarColor:"transparent transparent"},children:a.jsx("div",{className:"flex gap-1 md:gap-6 px-4 md:px-6 min-w-max md:min-w-0 md:w-full md:justify-center",children:[{id:"discovery",label:"Meetings",icon:Va,hidden:gn},{id:"plan",label:"WIP",icon:lj},{id:"documents",label:"Documents",icon:Pu},{id:"financials",label:"Financials",icon:yp,hidden:!Ts},{id:"timeline",label:"Timeline",icon:Fb,hidden:gn},{id:"team",label:"Team",icon:Fp}].map(h=>h.hidden?null:a.jsx("button",{"data-tab-id":h.id,onClick:()=>U(h.id),className:`flex items-center gap-1 md:gap-1 pt-1 pb-0.5 md:pt-2 md:pb-1 px-3 md:px-5 text-base md:text-sm font-medium transition-all whitespace-nowrap flex-shrink-0 md:flex-shrink ${F===h.id?"text-gray-900":"text-gray-500 hover:text-gray-700"}`,children:a.jsxs("span",{className:`inline-flex items-center gap-1 pb-1 ${F===h.id?"border-b-2 border-gray-900":""}`,children:[a.jsx(h.icon,{className:"w-4 h-4 md:w-4 md:h-4 flex-shrink-0"}),h.label]})},h.id))})}),a.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 border-t border-gray-200",children:[F==="discovery"&&!gn&&a.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-lg md:text-xl font-bold text-gray-800 mb-2",children:"Meetings"}),a.jsxs("div",{className:"flex items-center gap-3 text-base md:text-sm text-gray-600",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Mp,{className:"w-5 h-5 md:w-4 md:h-4 flex-shrink-0"}),a.jsxs("span",{className:"font-medium",children:[rn.length," Meeting",rn.length!==1?"s":""," Held"]})]}),rn.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-gray-400",children:""}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(sh,{className:"w-3.5 h-3.5 flex-shrink-0"}),a.jsxs("span",{className:"whitespace-nowrap",children:["Latest: ",dn(((cm=rn[0])==null?void 0:cm.date)||"")]})]})]})]})]}),a.jsx("div",{className:"space-y-3 md:space-y-4",children:rn.length===0?a.jsx("div",{className:"text-center py-8 md:py-10 border-2 border-dashed border-gray-100 rounded-lg",children:a.jsx("p",{className:"text-base md:text-sm text-gray-400",children:"No meetings recorded yet."})}):rn.map(h=>a.jsxs("div",{className:"border border-gray-100 rounded-lg hover:shadow-md transition-shadow bg-white overflow-hidden",children:[a.jsx("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 p-3 md:p-5",children:a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2",children:[a.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[a.jsx("h4",{className:"font-bold text-lg md:text-base text-gray-800 break-words",children:h.title}),a.jsx("span",{className:"bg-gray-100 text-gray-600 text-sm md:text-xs px-2 py-1 rounded whitespace-nowrap",children:dn(h.date)})]}),a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.jsx("span",{className:"bg-purple-100 text-purple-700 text-sm md:text-xs px-2 py-0.5 rounded-full whitespace-nowrap",children:h.type}),Ft&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>{to(h),yi(!0)},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-colors flex-shrink-0",title:"Edit meeting",children:a.jsx(CN,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>{Ws(h),bi(!0)},className:"p-2 text-gray-400 hover:text-red-600 hover:bg-gray-100 rounded transition-colors flex-shrink-0",title:"Delete meeting",children:a.jsx(ks,{className:"w-4 h-4"})})]})]})]}),a.jsx("p",{className:"text-base md:text-sm text-gray-600 mt-2 whitespace-pre-wrap bg-gray-50 p-3 md:p-4 rounded overflow-hidden",children:h.notes}),a.jsx("div",{className:"mt-3 md:mt-4 flex gap-2 flex-wrap",children:(h.attendees||[]).map(_=>{const N=e.find(S=>S.id===_)||hn.find(S=>S.id===_);return a.jsx("span",{className:"text-sm md:text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-medium whitespace-nowrap",children:(N==null?void 0:N.name)||"Unknown"},_)})})]})}),a.jsxs("div",{className:"border-t border-gray-100 p-3 md:p-4 bg-gray-50",children:[a.jsxs("button",{onClick:()=>{V(_=>{const N=new Set(_);return N.has(h.id)?N.delete(h.id):N.add(h.id),N})},className:"flex items-center gap-2 w-full hover:bg-gray-100 p-2 rounded transition-colors",children:[a.jsx("span",{className:`transform transition-transform ${W.has(h.id)?"rotate-90":""}`,children:a.jsx($a,{className:"w-4 h-4 text-gray-600"})}),a.jsxs("h5",{className:"text-sm md:text-xs font-bold text-gray-700",children:["Comments (",(no[h.id]||[]).length,")"]})]}),W.has(h.id)&&a.jsx("div",{className:"mt-2 md:mt-3",children:a.jsx("div",{className:"space-y-3 mb-3 max-h-60 overflow-y-auto",children:(no[h.id]||[]).map(_=>{let N="Unknown User";if(_.userName&&_.userName.trim()&&_.userName!=="Unknown User")N=_.userName;else if(_.userId===u.id&&u.name)N=u.name;else if(_.userId){const A=e.find(oe=>oe.id===_.userId);if(A!=null&&A.name)N=A.name;else{const oe=hn.find(Y=>Y.id===_.userId);oe!=null&&oe.name&&(N=oe.name)}}const S=_.status==="done";return a.jsxs("div",{className:`p-3 ${S?"opacity-60":""}`,children:[a.jsxs("div",{className:"flex justify-between items-start gap-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:`text-sm md:text-xs font-semibold text-gray-800 ${S?"line-through":""}`,children:N}),a.jsx("p",{className:`text-sm md:text-xs text-gray-700 mt-1 ${S?"line-through text-gray-500":""}`,children:_.text})]}),(u.id===_.userId||Ft)&&a.jsx("button",{onClick:()=>{const oe={..._,status:S?"pending":"done"};pa(Y=>({...Y,[h.id]:(Y[h.id]||[]).map(Z=>Z.id===_.id?oe:Z)}))},className:`p-1 flex-shrink-0 rounded transition-colors ${S?"text-green-600 hover:text-green-700 bg-green-50":"text-gray-400 hover:text-green-600"}`,title:S?"Mark as pending":"Mark as done",children:a.jsx(Fl,{className:"w-4 h-4"})})]}),a.jsx("p",{className:`text-sm md:text-xs text-gray-500 mt-2 ${S?"line-through":""}`,children:Mx(_.timestamp)})]},_.id)})})}),a.jsxs("div",{className:"flex gap-1 mt-2 md:mt-3",children:[a.jsx("input",{type:"text",placeholder:"Add a comment...",value:Fi[h.id]||"",onChange:_=>qs(N=>({...N,[h.id]:_.target.value})),onKeyPress:_=>{_.key==="Enter"&&!qt[h.id]&&Gn(h.id)},disabled:!!qt[h.id],className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none"}),a.jsx("button",{onClick:()=>Gn(h.id),className:"p-2 text-gray-500 hover:text-purple-600 transition-colors",title:"Post comment",disabled:!!qt[h.id],children:qt[h.id]?a.jsx(Rt,{size:"sm",className:"text-gray-700"}):a.jsx(ox,{className:"w-4 h-4"})})]})]})]},h.id))})]}),F==="plan"&&a.jsxs("div",{className:"space-y-6 h-full flex flex-col p-4 md:p-6",children:[a.jsx("div",{className:"flex bg-white rounded-lg border border-gray-200 p-1.5 w-fit shadow-sm",children:[{id:"list",label:"List View",icon:GA},{id:"kanban",label:"Priority Board",icon:UA},{id:"gantt",label:"Gantt Chart",icon:sh}].map(h=>a.jsxs("button",{onClick:()=>re(h.id),className:`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all
                    ${ae===h.id?"bg-gray-900 text-white shadow-sm":"text-gray-500 hover:text-gray-900"}`,children:[a.jsx(h.icon,{className:"w-4 h-4"}),h.label]},h.id))}),ae==="kanban"&&a.jsx("div",{className:"flex-1 overflow-x-auto min-h-[500px]",children:a.jsx(lV,{tasks:Ns,users:e,onUpdateTaskStatus:im,onUpdateTaskPriority:am,onEditTask:xn,onCompleteTask:Rc})}),ae==="gantt"&&Hi&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden flex-1 flex flex-col min-h-[600px]",children:[a.jsxs("div",{className:"p-4 md:p-5 bg-gray-50 flex justify-between items-center",children:[a.jsx("h3",{className:"font-bold text-base md:text-lg text-gray-800",children:"Timeline & Dependencies"}),a.jsxs("div",{className:"flex items-center gap-6 text-sm md:text-xs text-gray-500",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"})," Task"]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," Done"]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-3 h-0.5 bg-gray-300"})," Dependency"]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-3 h-0.5 bg-red-400"})," Conflict"]})]})]}),a.jsx("div",{className:"flex-1 overflow-auto relative",children:(()=>{const h=[],_=new Date(Hi.minDate),N=new Date(Hi.maxDate);for(;_<=N;)h.push(new Date(_)),_.setDate(_.getDate()+1);const S=40,A=250,oe=h.length*S,Y=A+oe,Z=[];let De=null,Je=0;return h.forEach((je,Fe)=>{const et=je.toLocaleDateString("en-IN",{month:"short",year:"2-digit"});et!==De&&(De&&Z.push({label:De,startIdx:Je,dayCount:Fe-Je}),De=et,Je=Fe)}),De&&Z.push({label:De,startIdx:Je,dayCount:h.length-Je}),a.jsxs("div",{style:{minWidth:`${Y}px`},className:"p-6 relative",children:[a.jsx("div",{className:"absolute inset-0 pointer-events-none pt-[60px] pb-6 flex",style:{paddingLeft:`${A}px`,paddingRight:"24px"},children:h.map((je,Fe)=>a.jsx("div",{style:{width:`${S}px`,flexShrink:0},className:"border-r border-gray-100 h-full"},Fe))}),a.jsxs("div",{className:"sticky top-0 bg-white z-20",children:[a.jsxs("div",{className:"flex pb-1 mb-2",children:[a.jsx("div",{style:{width:`${A}px`,flexShrink:0},className:"font-semibold text-sm text-gray-700 pl-2",children:"Task Details"}),a.jsxs("div",{style:{width:`${oe}px`},className:"relative",children:[a.jsx("div",{className:"flex w-full text-xs font-bold text-gray-600 mb-2 h-5 border-b border-gray-200",children:Z.map((je,Fe)=>a.jsx("div",{style:{width:`${je.dayCount*S}px`,flexShrink:0},className:"text-left px-2 bg-gray-50 border-r border-gray-200",children:je.label},Fe))}),a.jsx("div",{className:"flex w-full",children:h.map((je,Fe)=>a.jsxs("div",{style:{width:`${S}px`,flexShrink:0},className:`text-center text-xs py-1 ${je.getDay()===0||je.getDay()===6?"bg-red-50":""} ${je.getDate()===1?"border-l-2 border-gray-300":""}`,children:[a.jsx("div",{className:`font-semibold ${je.getDay()===0||je.getDay()===6?"text-red-400":"text-gray-600"}`,children:je.getDate()}),a.jsx("div",{className:"text-[10px] text-gray-400",children:je.toLocaleDateString("en-IN",{weekday:"short"}).substring(0,2)})]},Fe))})]})]}),a.jsx("div",{className:"flex pb-2 border-b border-gray-100",children:a.jsx("div",{style:{width:`${A}px`},className:"pl-2"})})]}),a.jsxs("div",{className:"relative mt-2",children:[a.jsx("svg",{className:"absolute top-0 pointer-events-none z-0",style:{left:`${A}px`,width:`${oe}px`},viewBox:`0 0 ${oe} ${mo.length*qu}`,preserveAspectRatio:"none",children:mo.flatMap(je=>(je.dependencies||[]).map(Fe=>{const et=mo.find(as=>as.id===Fe);if(!et)return null;const tt=(et.left+et.width)*oe/100,St=et.index*qu+qu/2,ur=je.left*oe/100,Ge=je.index*qu+qu/2,$n=tt>ur,Ur=`M ${tt} ${St} C ${tt+20} ${St}, ${ur-20} ${Ge}, ${ur} ${Ge}`;return a.jsxs("g",{children:[a.jsx("path",{d:Ur,stroke:$n?"#ef4444":"#9CA3AF",strokeWidth:$n?"2":"1.5",fill:"none",className:$n?"opacity-80":"opacity-30",strokeDasharray:$n?"4 2":"none"}),a.jsx("circle",{cx:ur,cy:Ge,r:"3",fill:$n?"#ef4444":"#9CA3AF"})]},`${et.id}-${je.id}`)}))}),a.jsx("div",{className:"relative z-10 space-y-0",children:mo.map((je,Fe)=>{const et=Fe===0||mo[Fe-1].category!==je.category,tt=ra(je),St=Yt(je.status);return a.jsxs(li.Fragment,{children:[et&&a.jsx("div",{className:"bg-gray-100/50 px-2 py-1 text-xs font-bold text-gray-500 uppercase tracking-wider sticky left-0 mb-1 mt-2",style:{width:`${Y}px`},children:je.category}),a.jsxs("div",{className:"flex items-center group hover:bg-gray-50/50 rounded min-h-[56px]",children:[a.jsxs("div",{style:{width:`${A}px`,flexShrink:0},className:"pr-4 pl-2 flex flex-col justify-center border-r border-gray-100",children:[a.jsxs("div",{onClick:()=>xn(je),className:"text-base font-medium text-gray-800 truncate cursor-pointer hover:text-blue-600 flex items-center gap-1",children:[je.title,Fr(je)&&a.jsx(bh,{className:"w-3 h-3 text-red-400"}),St&&a.jsx(Ma,{className:"w-3 h-3 text-red-600"})]}),a.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400 mt-1",children:[a.jsx("span",{children:Tn(je.assigneeId)}),a.jsxs("span",{className:"font-mono",children:[tt,"%"]})]})]}),a.jsx("div",{style:{width:`${oe}px`},className:"relative h-6 rounded-md",children:a.jsxs("div",{className:`absolute h-full rounded shadow-sm flex items-center px-2 cursor-pointer
                                           ${je.status==="Done"?"bg-green-500 opacity-80":"bg-blue-500 opacity-80"}
                                           ${je.status==="Review"?"bg-purple-500 opacity-80":""}
                                           ${Fr(je)?"bg-gray-400 opacity-50":""}
                                           ${St?"bg-gray-800 opacity-70":""}
                                        hover:opacity-100 transition-opacity z-20
                                      `,style:{left:`${je.left}%`,width:`${je.width}%`},role:"button",tabIndex:0,title:"Click to edit task",onClick:()=>xn(je),children:[je.status===xe.OVERDUE&&a.jsx("div",{className:"absolute top-0 bottom-0 bg-red-500 opacity-80 rounded",style:{width:"100%"},"aria-label":"Overdue indicator"}),a.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-white/20",style:{width:`${tt}%`},"aria-label":"Progress indicator"}),a.jsx("span",{className:"relative text-[9px] text-white truncate font-medium w-full",children:je.width>10?je.title:""})]})})]})]},je.id)})})]})]})})()})]}),ae==="list"&&a.jsx("div",{className:"space-y-8",children:Object.entries(Ns.reduce((h,_)=>(h[_.category]=h[_.category]||[],h[_.category].push(_),h),{})).sort((h,_)=>Ei(h[0])-Ei(_[0])).map(([h,_])=>a.jsxs("div",{children:[a.jsxs("h3",{className:"text-base font-bold text-gray-500 uppercase tracking-wide mb-4 pl-1 flex items-center gap-1",children:[a.jsx($p,{className:"w-4 h-4"})," ",h]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:_.map(N=>{const S=Fr(N)&&N.status!==xe.DONE,A=Yt(N.status),oe=ra(N),Y=u.id===N.assigneeId;return console.log(` Task "${N.title}": isMyTask=${Y}, blocked=${S}, frozen=${A}, status=${N.status}, assigneeId=${N.assigneeId}, userId=${u.id}`),a.jsxs("div",{className:`bg-white p-4 md:p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all ${S||A?"opacity-75 bg-gray-50":""}`,children:[a.jsxs("div",{className:"flex justify-between items-start mb-3",children:[a.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs font-medium uppercase
                                ${N.priority==="high"?"bg-red-100 text-red-600":N.priority==="medium"?"bg-yellow-100 text-yellow-600":"bg-green-100 text-green-600"}`,children:N.priority}),a.jsx("div",{className:"flex items-center gap-1",children:A?a.jsxs("span",{title:"Frozen by Admin",className:"flex items-center gap-1 text-xs text-red-600 font-bold bg-red-50 px-2 py-0.5 rounded border border-red-100",children:[a.jsx(Ma,{className:"w-3 h-3"})," ",N.status]}):a.jsxs(a.Fragment,{children:[S&&a.jsx("span",{title:"Blocked by dependency",children:a.jsx(bh,{className:"w-4 h-4 text-red-400"})}),a.jsx("button",{onClick:()=>xn(N),className:"text-xs text-gray-400 hover:text-gray-900 ml-2",children:"View"})]})})]}),a.jsxs("div",{className:"mt-3",children:[a.jsxs("div",{className:"flex justify-between items-center mb-1",children:[a.jsx("span",{className:"text-sm md:text-xs text-gray-400 font-medium",children:"Progress"}),a.jsxs("span",{className:"text-sm md:text-xs text-gray-600 font-bold",children:[oe,"%"]})]}),a.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1.5",children:a.jsx("div",{className:`h-1.5 rounded-full transition-all duration-500 ${N.status===xe.DONE?"bg-green-500":A?"bg-gray-400":"bg-blue-500"}`,style:{width:`${oe}%`}})})]}),a.jsx("h4",{className:"font-bold text-lg text-gray-800 mb-1 cursor-pointer hover:text-blue-600",onClick:()=>xn(N),children:N.title}),a.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:[dn(N.startDate)," - ",dn(N.dueDate)]}),a.jsx("div",{className:"flex gap-2 mb-3 flex-wrap",children:(()=>{var tt,St,ur,Ge,$n,Ur,as,Et,on,Xt,Fn,hr,mr,Sn,os,jl,Ca,vu,kl;const Z=((ur=(St=(tt=N.approvals)==null?void 0:tt.completion)==null?void 0:St.client)==null?void 0:ur.status)==="approved",De=((Ur=($n=(Ge=N.approvals)==null?void 0:Ge.completion)==null?void 0:$n.admin)==null?void 0:Ur.status)==="approved",Je=((on=(Et=(as=N.approvals)==null?void 0:as.completion)==null?void 0:Et.client)==null?void 0:on.status)==="rejected",je=((hr=(Fn=(Xt=N.approvals)==null?void 0:Xt.completion)==null?void 0:Fn.admin)==null?void 0:hr.status)==="rejected",Fe=((os=(Sn=(mr=N.approvals)==null?void 0:mr.completion)==null?void 0:Sn.designer)==null?void 0:os.status)==="rejected",et=((Ca=(jl=N.approvals)==null?void 0:jl.completion)==null?void 0:Ca.client)||((kl=(vu=N.approvals)==null?void 0:vu.completion)==null?void 0:kl.admin);return a.jsxs(a.Fragment,{children:[Z&&De&&a.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded",children:"Approved by Both"}),Z&&!De&&!je&&N.status===xe.REVIEW&&a.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded",children:"Waiting for Admin Approval"}),De&&!Z&&!Je&&a.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded",children:N.status===xe.REVIEW?"Waiting for Client Approval":"Client Approval Pending"}),!Z&&!De&&!Je&&!je&&N.status===xe.REVIEW&&et&&a.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded",children:N.status===xe.REVIEW?"Under Review":"Waiting for Review"}),Je&&a.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded",children:"Rejected by Client"}),je&&a.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded",children:"Rejected by Admin"}),Fe&&a.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded",children:"Rejected by Designer"}),N.status===xe.OVERDUE&&a.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded",children:"Overdue"})]})})()}),a.jsx("div",{className:"space-y-2 mb-4 max-h-[80px] overflow-y-auto pr-2",children:N.subtasks.map(Z=>a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 transition-opacity",style:{opacity:S||A||!Ft&&!Y?.5:1},children:[a.jsx("button",{type:"button",onClick:()=>(Ft||Y)&&uo(N.id,Z.id),disabled:S||A||!Ft&&!Y,className:`flex-shrink-0 w-4 h-4 rounded-full border flex items-center justify-center transition-all duration-200 ${Z.isCompleted?"bg-green-500 border-green-500 hover:bg-green-600 hover:border-green-600":"border-gray-400 hover:border-green-400 hover:bg-green-50"} disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent disabled:hover:border-gray-300`,children:Z.isCompleted&&a.jsx(Fl,{className:"w-2.5 h-2.5 text-white"})}),a.jsx("span",{className:Z.isCompleted?"line-through text-gray-400":"",children:Z.title})]},Z.id))}),a.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("span",{className:"text-sm md:text-xs text-gray-500",children:Tn(N.assigneeId)})}),a.jsxs("div",{className:"flex items-center gap-2",children:[u.role===L.ADMIN&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:Z=>{Z.stopPropagation(),Hd(N)},disabled:fe===N.id,className:`p-1 rounded-full transition-all ${fe===N.id?"text-blue-500 bg-blue-50 cursor-wait":"text-gray-400 hover:text-blue-600 hover:bg-blue-50"}`,title:fe===N.id?"Sending email...":"Send Email Reminder",children:fe===N.id?a.jsx("span",{className:"inline-block animate-spin w-4 h-4",children:""}):a.jsx(Op,{className:"w-4 h-4"})}),a.jsx("button",{onClick:Z=>{Z.stopPropagation(),rm(N.id)},className:"text-gray-400 hover:text-blue-600 p-1 rounded-full hover:bg-blue-50 transition-colors",title:"Copy task link",children:a.jsx(Ou,{className:"w-4 h-4"})}),(()=>{const Z=e.find(De=>De.id===N.assigneeId);return Z&&Z.phone?a.jsx("button",{onClick:De=>{De.stopPropagation();const Je=`Hi ${Z.name},

Task: "${N.title}"
Project: "${n.name}"
Due: ${dn(N.dueDate)}

Please update the status.`;co(Z,Je)},className:"text-gray-400 hover:text-green-600 p-1 rounded-full hover:bg-green-50 transition-colors",title:`Chat on WhatsApp: ${Z.phone}`,children:a.jsx(zx,{className:"w-4 h-4"})}):null})()]}),(u.role===L.VENDOR||u.role===L.DESIGNER)&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:Z=>{Z.stopPropagation(),rm(N.id)},className:"text-gray-400 hover:text-blue-600 p-1 rounded-full hover:bg-blue-50 transition-colors",title:"Copy task link",children:a.jsx(Ou,{className:"w-4 h-4"})}),(()=>{const Z=e.find(De=>De.id===N.assigneeId);return Z&&Z.phone?a.jsx("button",{onClick:De=>{De.stopPropagation();const Je=`Hi ${Z.name},

Task: "${N.title}"
Project: "${n.name}"
Due: ${dn(N.dueDate)}

Please check the task details and update the status.`;co(Z,Je)},className:"text-gray-400 hover:text-green-600 p-1 rounded-full hover:bg-green-50 transition-colors",title:`Share on WhatsApp: ${Z.phone}`,children:a.jsx(zx,{className:"w-4 h-4"})}):null})()]}),N.comments.length>0&&a.jsxs("button",{onClick:Z=>{Z.stopPropagation(),xn(N)},className:"text-gray-400 hover:text-gray-700 p-0.5 rounded-full hover:bg-gray-100 transition-colors flex items-center gap-0.5",title:`${N.comments.length} comment${N.comments.length!==1?"s":""}`,children:[a.jsx(tp,{className:"w-3 h-3"}),a.jsx("span",{className:"text-[10px] font-medium",children:N.comments.length})]})]})]})]},N.id)})})]},h))})]}),F==="documents"&&a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 p-4 md:p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl md:text-lg font-bold text-gray-800",children:"Project Documents"}),a.jsx("p",{className:"text-base md:text-sm text-gray-500",children:"Shared files, layouts, and contracts."})]}),!Ft&&a.jsxs("span",{className:"text-sm md:text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:["Viewing as ",u.role]})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[u.role!==L.VENDOR&&a.jsxs("button",{onClick:()=>{ot(!0),Ie([])},className:"border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center p-6 hover:bg-gray-50 hover:border-gray-400 transition-all text-gray-400 hover:text-gray-600 bg-white",children:[a.jsx(Wu,{className:"w-8 h-8 mb-2"}),a.jsx("span",{className:"text-base md:text-sm font-bold",children:"Upload File"})]}),(_r||[]).filter(h=>h.approvalStatus==="pending"?u.role===L.ADMIN||u.role===L.DESIGNER||h.uploadedBy===u.id:h.approvalStatus==="approved"?Array.isArray(h.sharedWith)&&h.sharedWith.includes(u.id)||u.role===L.ADMIN||h.uploadedBy===u.id:h.approvalStatus==="rejected"?u.role===L.ADMIN||u.role===L.DESIGNER||h.uploadedBy===u.id:u.role===L.ADMIN).sort((h,_)=>pl(_)-pl(h)).map(h=>{var _;return a.jsxs("div",{className:"group relative bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-shadow",children:[a.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2 z-10 pointer-events-none group-hover:pointer-events-auto",children:[a.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Comments",onClick:()=>ee(h),children:a.jsx(tp,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"View",onClick:()=>window.open(h.url,"_blank"),children:a.jsx(ax,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Download",onClick:()=>y(h),children:a.jsx($b,{className:"w-4 h-4"})}),(h.uploadedBy===u.id||Ft)&&a.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Delete",onClick:()=>I(h),children:a.jsx(ks,{className:"w-4 h-4"})}),u.role===L.ADMIN&&a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Edit Share",onClick:N=>{N.stopPropagation(),Ks(h)},children:a.jsx(Fp,{className:"w-4 h-4"})})]}),u.role===L.ADMIN&&h.approvalStatus==="pending"&&a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("button",{className:"p-2 bg-white rounded-full text-green-600 hover:bg-green-50",title:"Approve",onClick:()=>de(h),disabled:ge===`approve-doc-${h.id}`,children:ge===`approve-doc-${h.id}`?a.jsx(Rt,{size:"md",color:"currentColor"}):a.jsx(Fl,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Reject",onClick:()=>Re(h),disabled:ge===`reject-doc-${h.id}`,children:ge===`reject-doc-${h.id}`?a.jsx(Rt,{size:"md",color:"currentColor"}):a.jsx(mn,{className:"w-4 h-4"})})]}),u.role===L.CLIENT&&h.approvalStatus==="approved"&&h.clientApprovalStatus!=="approved"&&a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("button",{className:"p-2 bg-white rounded-full text-green-600 hover:bg-green-50",title:"Approve as Client",onClick:()=>gt(h),disabled:ge===`client-approve-doc-${h.id}`,children:ge===`client-approve-doc-${h.id}`?a.jsx(Rt,{size:"md",color:"currentColor"}):a.jsx(Fl,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Reject as Client",onClick:()=>wn(h),disabled:ge===`client-reject-doc-${h.id}`,children:ge===`client-reject-doc-${h.id}`?a.jsx(Rt,{size:"md",color:"currentColor"}):a.jsx(mn,{className:"w-4 h-4"})})]})]}),a.jsx("div",{className:"h-32 bg-gray-100 flex items-center justify-center overflow-hidden relative group",children:h.type==="image"?a.jsx("img",{src:h.url||$x,alt:h.name,className:"w-full h-full object-cover",onError:N=>{var S;N.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNjY2MiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiI+PC9yZWN0PjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ij48L2NpcmNsZT48cG9seWxpbmUgcG9pbnRzPSIyMSAxNSAxNiAxMCA1IDIxIj48L3BvbHlsaW5lPjwvc3ZnPg==",N.currentTarget.className="w-12 h-12 opacity-50",(S=N.currentTarget.parentElement)==null||S.classList.add("flex","items-center","justify-center")}}):h.type==="pdf"?a.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-red-50 to-red-100",children:[a.jsx(Va,{className:"w-12 h-12 text-red-400 mb-2"}),a.jsx("span",{className:"text-sm font-bold text-red-600 uppercase",children:"PDF"})]}):a.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100",children:[a.jsx(Va,{className:"w-12 h-12 text-blue-400 mb-2"}),a.jsx("span",{className:"text-sm font-bold text-blue-600 uppercase",children:h.type})]})}),a.jsxs("div",{className:"p-3",children:[a.jsxs("div",{className:"flex justify-between items-start gap-2",children:[a.jsx("p",{className:"text-lg md:text-sm font-bold text-gray-800 flex-1 truncate",title:h.name,children:h.name}),a.jsx("span",{className:"text-sm md:text-xs text-gray-400 whitespace-nowrap",children:dn(h.uploadDate)})]}),a.jsx("div",{className:"mt-2 flex gap-1 flex-wrap",children:(Array.isArray(h.sharedWith)?h.sharedWith:[]).map(N=>{const S=e.find(A=>A.id===N);return S!=null&&S.name?a.jsx("span",{className:"text-xs bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded font-semibold",title:S.name,children:S.name.split(" ")[0]},N):null})}),a.jsxs("div",{className:"flex flex-col gap-1 mt-2",children:[a.jsx("div",{className:"flex-none w-auto",children:a.jsxs("span",{className:`inline-block text-xs font-bold px-2 py-0.5 rounded ${h.approvalStatus==="pending"?"bg-yellow-100 text-yellow-700":h.approvalStatus==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:["Admin: ",h.approvalStatus==="pending"?"Pending":h.approvalStatus==="approved"?"Approved":"Rejected"]})}),h.approvalStatus==="approved"&&h.clientApprovalStatus&&a.jsx("div",{className:"flex-none w-auto",children:a.jsxs("span",{className:`inline-block text-xs font-bold px-2 py-0.5 rounded ${h.clientApprovalStatus==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[h.clientApprovedBy&&((_=e.find(N=>N.id===h.clientApprovedBy))==null?void 0:_.name)||"Client",": ",h.clientApprovalStatus==="approved"?"Approved":"Rejected"]})})]}),h.comments&&h.comments.length>0&&a.jsxs("div",{className:"mt-2 text-xs text-blue-600 font-medium",children:[h.comments.length," ",h.comments.length===1?"comment":"comments"]})]})]},h.id)})]})]}),F==="financials"&&Ts&&a.jsxs("div",{className:"w-full mx-auto space-y-8 p-4 md:p-6",children:[a.jsx("h3",{className:"text-lg md:text-base font-bold text-gray-800",children:"Financial Management"}),a.jsxs("div",{className:"bg-gray-900 text-white p-4 md:p-8 rounded-xl shadow-lg flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:"text-gray-400 text-sm md:text-xs font-bold uppercase mb-1",children:"Total Project Budget"}),Ft&&a.jsxs("button",{onClick:()=>{xa(!0),_i(""),Vr("")},className:"text-xs bg-gray-800 hover:bg-gray-700 text-emerald-400 px-3 py-1 rounded border border-gray-700 transition-colors flex items-center gap-1",title:"Add to Project Budget",children:[a.jsx(Oi,{className:"w-3.5 h-3.5"})," Add Funds"]})]}),a.jsxs("h2",{className:"text-3xl md:text-2xl font-bold tracking-tight",children:["",((n.initialBudget||n.budget)+lr).toLocaleString()]}),lr>0&&a.jsxs("div",{className:"mt-3 space-y-1",children:[a.jsxs("p",{className:"text-sm md:text-xs text-gray-400",children:["Initial Budget: ",(n.initialBudget||n.budget).toLocaleString()]}),a.jsxs("p",{className:"text-sm md:text-xs text-emerald-400 font-medium",children:["Additional Budget: ",lr.toLocaleString()]})]})]}),a.jsxs("div",{className:"text-left md:text-right",children:[a.jsx("p",{className:"text-gray-400 text-sm md:text-xs font-bold uppercase mb-1",children:"Remaining Budget"}),a.jsxs("h2",{className:`text-2xl md:text-xl font-bold ${(n.initialBudget||n.budget)+lr-(Js+ho)<0?"text-red-400":"text-emerald-400"}`,children:["",((n.initialBudget||n.budget)+lr-(Js+ho)).toLocaleString()]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Budget - (Paid + Pending Expenses)"})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[a.jsx("div",{className:"px-4 py-3 md:px-6 md:py-5 border-b border-gray-200 bg-gray-50",children:a.jsx("h3",{className:"font-semibold text-base md:text-sm text-gray-800",children:"Financial Summary & Analysis"})}),a.jsx("div",{className:"p-4 md:p-6 space-y-6",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("h4",{className:"text-base md:text-sm font-bold text-gray-700 flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),"Income Breakdown"]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:[a.jsxs("div",{className:"p-4 md:p-6 bg-blue-50 rounded-lg border border-blue-100",children:[a.jsx("p",{className:"text-sm md:text-xs text-blue-600 font-bold uppercase mb-1",children:"Estimated"}),a.jsxs("p",{className:"text-xl md:text-lg font-bold text-blue-700",children:["",(n.initialBudget||n.budget).toLocaleString()]})]}),a.jsxs("div",{className:"p-4 md:p-6 bg-purple-50 rounded-lg border border-purple-100",children:[a.jsx("p",{className:"text-sm md:text-xs text-purple-600 font-bold uppercase mb-1",children:"Additional"}),a.jsxs("p",{className:"text-xl md:text-lg font-bold text-purple-700",children:["",lr.toLocaleString()]})]}),a.jsxs("div",{className:"p-4 md:p-6 bg-green-50 rounded-lg border border-green-100",children:[a.jsx("p",{className:"text-sm md:text-xs text-green-600 font-bold uppercase mb-1",children:"Received"}),a.jsxs("p",{className:"text-xl md:text-lg font-bold text-green-700",children:["",Ys.toLocaleString()]}),a.jsxs("p",{className:"text-sm md:text-xs text-green-600 mt-1",children:[Math.round(Ys/((n.initialBudget||n.budget)+lr)*100)||0,"% of budget"]})]}),a.jsxs("div",{className:"p-4 md:p-6 bg-red-50 rounded-lg border border-red-100",children:[a.jsx("p",{className:"text-sm md:text-xs text-red-600 font-bold uppercase mb-1",children:"Expense"}),a.jsxs("p",{className:"text-xl md:text-lg font-bold text-red-700",children:["",Js.toLocaleString()]}),a.jsxs("p",{className:"text-sm md:text-xs text-red-600 mt-1",children:[Math.round(Js/((n.initialBudget||n.budget)+lr)*100)||0,"% of budget"]})]}),a.jsxs("div",{className:`p-4 md:p-6 rounded-lg border ${Ys-Js>=0?"bg-green-50 border-green-100":"bg-red-50 border-red-100"}`,children:[a.jsx("p",{className:`text-sm md:text-xs font-bold uppercase mb-1 ${Ys-Js>=0?"text-green-600":"text-red-600"}`,children:"Profit/Loss"}),a.jsxs("p",{className:`text-xl md:text-lg font-bold ${Ys-Js>=0?"text-green-700":"text-red-700"}`,children:[Ys-Js>=0?"+":"","",(Ys-Js).toLocaleString()]})]}),a.jsxs("div",{className:"p-4 md:p-6 bg-orange-50 rounded-lg border border-orange-100",children:[a.jsx("p",{className:"text-sm md:text-xs text-orange-600 font-bold uppercase mb-1",children:"Not Received"}),a.jsxs("p",{className:`text-xl md:text-lg font-bold ${(n.initialBudget||n.budget)+lr-Ys<0?"text-red-700":"text-orange-700"}`,children:["",((n.initialBudget||n.budget)+lr-Ys).toLocaleString()]})]}),a.jsxs("div",{className:"p-4 md:p-6 bg-gray-50 rounded-lg border border-gray-200",children:[a.jsx("p",{className:"text-sm md:text-xs text-gray-600 font-bold uppercase mb-1",children:"Total"}),a.jsxs("p",{className:"text-xl md:text-lg font-bold text-gray-700",children:["",((n.initialBudget||n.budget)+lr).toLocaleString()]})]})]})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden min-h-[300px]",children:[a.jsxs("div",{className:"px-4 py-3 md:px-5 md:py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50",children:[a.jsx("h3",{className:"font-semibold text-gray-800 text-lg md:text-base",children:"Transaction Ledger"}),a.jsxs("div",{className:"flex gap-2 relative",children:[a.jsxs("button",{onClick:()=>xs(!il),className:`text-sm md:text-xs border px-3 py-1.5 rounded-lg hover:bg-white text-gray-700 flex items-center gap-1.5 font-medium transition-colors ${Kt!=="all"?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-300"}`,children:[a.jsx(MA,{className:"w-3.5 h-3.5"}),a.jsx("span",{className:"capitalize hidden sm:inline",children:Kt==="all"?"Filter":Kt})]}),il&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>xs(!1)}),a.jsx("div",{className:"absolute right-0 top-9 bg-white shadow-xl border border-gray-100 rounded-lg p-1 z-20 w-32 flex flex-col gap-0.5 animate-fade-in",children:["all","income","expense","pending","overdue"].map(h=>a.jsx("button",{onClick:()=>{$i(h),xs(!1)},className:`text-left text-xs px-2.5 py-1.5 rounded capitalize font-medium ${Kt===h?"bg-gray-100 text-gray-900":"text-gray-600 hover:bg-gray-50"}`,children:h},h))})]})]})]}),a.jsx("div",{className:"overflow-x-auto scrollbar-thin",children:a.jsxs("table",{className:"w-full text-sm text-left",children:[a.jsx("thead",{className:"bg-white text-gray-600 border-b border-gray-100 sticky top-0 z-10",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-left",children:"Date"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap",children:"Paid By"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-left",children:"Received By"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Type"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Mode"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Status"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Amount"}),a.jsx("th",{className:"px-4 py-2 font-semibold whitespace-nowrap text-center",children:"Approvals"}),a.jsx("th",{className:"px-2 py-2 font-semibold text-center w-8"})]})}),a.jsxs("tbody",{className:"divide-y divide-gray-50",children:[lm.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:9,className:"text-center py-8 text-gray-400 text-sm",children:kt.length===0?"No transactions recorded.":"No transactions match filters."})}),lm.map(h=>{var _,N;return a.jsxs("tr",{className:"hover:bg-gray-50 group transition-colors",children:[a.jsxs("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap text-sm md:text-xs text-left",children:[h.date,h.timestamp&&a.jsx("div",{className:"text-gray-400 text-xs mt-0.5",children:new Date(h.timestamp).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),a.jsx("td",{className:"px-4 py-2",style:{maxWidth:"150px"},children:a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"font-bold text-gray-900 text-sm md:text-xs",children:h.paidByOther?h.paidByOther.includes("(")?h.paidByOther.split("(")[0].trim():h.paidByOther:h.paidBy==="admin"?h.vendorName?h.vendorName:"-":h.type==="income"?h.paidTo?h.paidTo:"-":h.vendorName?h.vendorName:"-"}),h.type==="expense"&&a.jsx("span",{className:"text-gray-600 break-words text-sm md:text-xs",children:h.description}),a.jsxs("div",{className:"flex items-center gap-1 text-sm md:text-xs",children:[a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx("span",{className:`flex-shrink-0 font-medium ${h.paidBy==="client"?"text-blue-700":h.paidBy==="vendor"?"text-purple-700":h.paidBy==="designer"?"text-orange-700":h.paidBy==="admin"?"text-red-700":h.paidBy==="other"?"text-gray-700":h.type==="income"?"text-green-700":"text-gray-700"}`,children:h.paidBy==="client"?"Client":h.paidBy==="vendor"?"Vendor":h.paidBy==="designer"?"Designer":h.paidBy==="admin"?"Admin":h.paidBy==="other"?h.paidByOther&&h.paidByOther.includes("(")?h.paidByOther.split("(")[1].replace(")","").trim():"Other":h.type==="income"?"Client":h.type==="expense"?"Proj":"N/A"})]})]})}),a.jsx("td",{className:"px-2 py-2",style:{maxWidth:"150px"},children:a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"font-bold text-gray-900 text-sm md:text-xs",children:h.receivedByRole==="admin-received"?h.receivedByName?h.receivedByName:"-":h.receivedBy?h.receivedBy.includes("(")?h.receivedBy.split("(")[0].trim():h.receivedBy:h.paidTo?h.paidTo:h.vendorName?h.vendorName:"-"}),a.jsxs("div",{className:"flex flex-col gap-1 text-sm md:text-xs",children:[h.type!=="expense"&&a.jsx("span",{className:"text-gray-600 break-words text-sm md:text-xs",children:h.description}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx("span",{className:`flex-shrink-0 font-medium text-sm md:text-xs ${h.receivedByRole==="admin-received"?"text-red-700":h.receivedByRole==="vendor-received"?"text-purple-700":h.receivedByRole==="designer-received"?"text-orange-700":h.receivedByRole==="client-received"?"text-blue-700":h.receivedByRole==="other-received"?"text-gray-700":h.receivedBy?(()=>{var oe;const S=e.find(Y=>{var Z;return Y.name===((Z=h.receivedBy)!=null&&Z.includes("(")?h.receivedBy.split("(")[0].trim():h.receivedBy)}),A=(S==null?void 0:S.role)||((oe=h.receivedBy)!=null&&oe.includes("(")?h.receivedBy.split("(")[1].replace(")","").trim():"");return A===L.CLIENT||A==="Client"?"text-blue-700":A===L.VENDOR||A==="Vendor"?"text-purple-700":A===L.DESIGNER||A==="Designer"?"text-orange-700":A===L.ADMIN||A==="Admin"?"text-red-700":h.type==="income"?"text-green-700":"text-gray-700"})():h.type==="income"?"text-green-700":"text-gray-700"}`,children:h.receivedByRole==="admin-received"?"Admin":h.receivedByRole==="vendor-received"?"Vendor":h.receivedByRole==="designer-received"?"Designer":h.receivedByRole==="client-received"?"Client":h.receivedByRole==="other-received"?"Other":h.receivedBy&&h.receivedBy.includes("(")?h.receivedBy.split("(")[1].replace(")","").trim():h.type==="income"?((_=hn.find(S=>S.name===h.receivedBy))==null?void 0:_.role)||"Team Member":((N=hn.find(S=>S.name===h.receivedBy))==null?void 0:N.role)||"-"})]})]})]})}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-center",children:h.type==="income"?a.jsxs("span",{className:"flex items-center justify-center gap-0.5 text-green-600 text-sm md:text-xs font-bold",children:[a.jsx(Jl,{className:"w-2.5 h-2.5 rotate-180"})," Received"]}):h.type==="expense"?a.jsxs("span",{className:"flex items-center justify-center gap-0.5 text-red-600 text-sm md:text-xs font-bold",children:[a.jsx(Jl,{className:"w-2.5 h-2.5"})," Paid"]}):a.jsx("span",{className:"text-purple-600 text-sm md:text-xs font-bold",children:"Design"})}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-center text-sm md:text-xs text-gray-600 capitalize",children:h.paymentMode?h.paymentMode.replace("_"," "):"-"}),a.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-center",children:a.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-sm md:text-xs font-bold capitalize
                          ${h.status==="paid"?"bg-green-100 text-green-700":h.status==="overdue"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:h.status==="paid"?"Paid":h.status==="overdue"?"Overdue":"Pending"})}),a.jsxs("td",{className:`px-4 py-2 font-semibold whitespace-nowrap text-sm md:text-xs text-center ${h.type==="income"?"text-green-600":"text-gray-900"}`,children:["",h.amount.toLocaleString()]}),a.jsxs("td",{className:"px-4 py-2 whitespace-nowrap",children:[(h.isAdditionalBudget||h.type==="income"&&h.category==="Additional Budget")&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),(h.clientApprovalForAdditionalBudget==="approved"||h.clientApproved===!0)&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.clientApprovalForAdditionalBudget==="rejected"&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.clientApprovalForAdditionalBudget==="pending"||!h.clientApprovalForAdditionalBudget&&!h.clientApproved)&&(u==null?void 0:u.role)===L.CLIENT&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>rs(h.id,"client","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve",disabled:ge===`approve-budget-${h.id}-client-approved`,children:ge===`approve-budget-${h.id}-client-approved`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>rs(h.id,"client","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject",disabled:ge===`approve-budget-${h.id}-client-rejected`,children:ge===`approve-budget-${h.id}-client-rejected`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""})]}),(h.clientApprovalForAdditionalBudget==="pending"||!h.clientApprovalForAdditionalBudget&&!h.clientApproved)&&(u==null?void 0:u.role)!==L.CLIENT&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),(h.adminApprovalForAdditionalBudget==="approved"||h.adminApproved===!0)&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.adminApprovalForAdditionalBudget==="rejected"&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.adminApprovalForAdditionalBudget==="pending"||!h.adminApprovalForAdditionalBudget&&!h.adminApproved)&&(u==null?void 0:u.role)===L.ADMIN&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>rs(h.id,"admin","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve",disabled:ge===`approve-budget-${h.id}-admin-approved`,children:ge===`approve-budget-${h.id}-admin-approved`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>rs(h.id,"admin","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject",disabled:ge===`approve-budget-${h.id}-admin-rejected`,children:ge===`approve-budget-${h.id}-admin-rejected`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""})]}),(h.adminApprovalForAdditionalBudget==="pending"||!h.adminApprovalForAdditionalBudget&&!h.adminApproved)&&(u==null?void 0:u.role)!==L.ADMIN&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),(h.isClientPayment||h.type==="income"&&h.category!=="Additional Budget")&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),(h.clientApprovalForPayment==="approved"||h.clientApproved===!0)&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.clientApprovalForPayment==="rejected"&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.clientApprovalForPayment==="pending"||!h.clientApprovalForPayment&&!h.clientApproved)&&(u==null?void 0:u.role)===L.CLIENT&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>Kn(h.id,"client","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Confirm payment",disabled:ge===`approve-payment-${h.id}-client-approved`,children:ge===`approve-payment-${h.id}-client-approved`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>Kn(h.id,"client","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Dispute payment",disabled:ge===`approve-payment-${h.id}-client-rejected`,children:ge===`approve-payment-${h.id}-client-rejected`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""})]}),(h.clientApprovalForPayment==="pending"||!h.clientApprovalForPayment&&!h.clientApproved)&&(u==null?void 0:u.role)!==L.CLIENT&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),(h.adminApprovalForPayment==="approved"||h.adminApproved===!0)&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.adminApprovalForPayment==="rejected"&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.adminApprovalForPayment==="pending"||!h.adminApprovalForPayment&&!h.adminApproved)&&(u==null?void 0:u.role)===L.ADMIN&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>Kn(h.id,"admin","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve payment",disabled:ge===`approve-payment-${h.id}-admin-approved`,children:ge===`approve-payment-${h.id}-admin-approved`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>Kn(h.id,"admin","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject payment",disabled:ge===`approve-payment-${h.id}-admin-rejected`,children:ge===`approve-payment-${h.id}-admin-rejected`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""})]}),(h.adminApprovalForPayment==="pending"||!h.adminApprovalForPayment&&!h.adminApproved)&&(u==null?void 0:u.role)!==L.ADMIN&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),h.type==="expense"&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),h.clientApproved===!0&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.clientApproved===!1&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.clientApproved===void 0&&(u==null?void 0:u.role)===L.CLIENT&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>Mn(h.id,"client",!0),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve expense",disabled:ge===`approve-expense-${h.id}-client-true`,children:ge===`approve-expense-${h.id}-client-true`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>Mn(h.id,"client",!1),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject expense",disabled:ge===`approve-expense-${h.id}-client-false`,children:ge===`approve-expense-${h.id}-client-false`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""})]}),h.clientApproved===void 0&&(u==null?void 0:u.role)!==L.CLIENT&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),h.adminApproved===!0&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.adminApproved===!1&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.adminApproved===void 0&&(u==null?void 0:u.role)===L.ADMIN&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>Mn(h.id,"admin",!0),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve expense",disabled:ge===`approve-expense-${h.id}-admin-true`,children:ge===`approve-expense-${h.id}-admin-true`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>Mn(h.id,"admin",!1),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject expense",disabled:ge===`approve-expense-${h.id}-admin-false`,children:ge===`approve-expense-${h.id}-admin-false`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""})]}),h.adminApproved===void 0&&(u==null?void 0:u.role)!==L.ADMIN&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),!h.isAdditionalBudget&&!h.isClientPayment&&h.type!=="expense"&&a.jsx("span",{className:"text-xs text-gray-300",children:"-"})]}),a.jsx("td",{className:"px-2 py-2 text-center",children:a.jsxs("div",{className:"flex items-center justify-center gap-1",children:[Ft&&a.jsx("button",{onClick:()=>yn(h.id),className:"text-gray-400 hover:text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-blue-50 rounded",title:"Edit Transaction",children:a.jsx(uj,{className:"w-3.5 h-3.5"})}),Mt&&a.jsx("button",{onClick:()=>{Xr(h.id),io(!0)},className:"text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-red-50 rounded",title:"Delete Transaction",children:a.jsx(ks,{className:"w-3.5 h-3.5"})})]})})]},h.id)})]})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:a.jsx("h3",{className:"font-semibold text-gray-800 text-lg md:text-base",children:gn?"My Payment Records":"Vendor Billing Report"})}),kt.filter(h=>{const _=e.filter(Z=>Z.role===L.VENDOR),N=new Set(_.map(Z=>Z.name)),S=Z=>Z?Z.includes("(")?Z.split("(")[0].trim():Z.trim():"";if(gn)return h.vendorName===u.name||S(h.receivedByName)===u.name||S(h.paidByOther)===u.name||h.paidTo===u.name||h.receivedBy===u.name;const A=h.receivedByName&&N.has(S(h.receivedByName)),oe=h.paidByOther&&N.has(S(h.paidByOther)),Y=h.receivedByRole==="vendor-received";return!!h.vendorName&&N.has(h.vendorName)||h.paidBy==="vendor"||A||oe||Y}).length===0?a.jsx("div",{className:"px-6 py-10 text-center text-gray-400",children:gn?"No payment records for you yet.":"No vendor transactions recorded yet."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left font-bold text-gray-700 text-sm md:text-sm",children:"Date"}),a.jsx("th",{className:"px-4 py-2 font-bold text-gray-700 text-sm md:text-sm",children:"Paid By"}),a.jsx("th",{className:"px-4 py-2 font-bold text-gray-700 text-left text-sm md:text-sm",children:"Received By (Vendor)"}),a.jsx("th",{className:"px-4 py-2 text-left font-bold text-gray-700 text-sm md:text-sm",children:"Description"}),a.jsx("th",{className:"px-4 py-2 text-right font-bold text-gray-700 text-sm md:text-sm",children:"Amount"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700 text-sm md:text-sm",children:"Admin Approval"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700 text-sm md:text-sm",children:"Client Approval"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700 text-sm md:text-sm",children:"Status"})]})}),a.jsx("tbody",{children:kt.filter(h=>{const _=e.filter(Z=>Z.role===L.VENDOR),N=new Set(_.map(Z=>Z.name)),S=Z=>Z?Z.includes("(")?Z.split("(")[0].trim():Z.trim():"";if(gn)return h.vendorName===u.name||S(h.receivedByName)===u.name||S(h.paidByOther)===u.name||h.paidTo===u.name||h.receivedBy===u.name;const A=h.receivedByName&&N.has(S(h.receivedByName)),oe=h.paidByOther&&N.has(S(h.paidByOther)),Y=h.receivedByRole==="vendor-received";return!!h.vendorName&&N.has(h.vendorName)||h.paidBy==="vendor"||A||oe||Y}).sort((h,_)=>new Date(_.date).getTime()-new Date(h.date).getTime()).map((h,_)=>{var N;return a.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${_%2===0?"bg-white":"bg-gray-50/50"}`,children:[a.jsx("td",{className:"px-4 py-3 text-gray-600 whitespace-nowrap text-sm md:text-xs text-left",children:h.date}),a.jsx("td",{className:"px-4 py-2",children:a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"font-bold text-gray-900 text-sm md:text-xs",children:h.type==="income"?h.paidTo||h.paidByOther||"-":h.vendorName||"-"}),a.jsxs("div",{className:"flex items-center gap-1 text-sm md:text-xs",children:[a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx("span",{className:`flex-shrink-0 font-medium text-sm md:text-xs ${h.paidBy==="client"?"text-blue-700":h.paidBy==="vendor"?"text-purple-700":h.paidBy==="designer"?"text-orange-700":h.paidBy==="admin"?"text-red-700":"text-gray-700"}`,children:h.type==="income"?(()=>{const S=e.find(A=>A.name===(h.paidTo||h.paidByOther));return(S==null?void 0:S.role)===L.CLIENT?"Client":(S==null?void 0:S.role)===L.VENDOR?"Vendor":(S==null?void 0:S.role)===L.DESIGNER?"Designer":(S==null?void 0:S.role)===L.ADMIN?"Admin":h.paidBy==="client"?"Client":h.paidBy==="vendor"?"Vendor":h.paidBy==="designer"?"Designer":h.paidBy==="admin"?"Admin":"N/A"})():h.paidBy==="client"?"Client":h.paidBy==="vendor"?"Vendor":h.paidBy==="designer"?"Designer":h.paidBy==="admin"?"Admin":"N/A"})]})]})}),a.jsx("td",{className:"px-2 py-2",style:{maxWidth:"150px"},children:a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"font-bold text-gray-900 text-sm md:text-xs",children:h.receivedBy?h.receivedBy.includes("(")?h.receivedBy.split("(")[0].trim():h.receivedBy:"-"}),a.jsx("div",{className:"flex flex-col gap-1 text-sm md:text-xs",children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx("span",{className:`flex-shrink-0 font-medium text-sm md:text-xs ${h.receivedBy?(()=>{var oe;const S=e.find(Y=>{var Z;return Y.name===((Z=h.receivedBy)!=null&&Z.includes("(")?h.receivedBy.split("(")[0].trim():h.receivedBy)}),A=(S==null?void 0:S.role)||((oe=h.receivedBy)!=null&&oe.includes("(")?h.receivedBy.split("(")[1].replace(")","").trim():"");return A===L.CLIENT||A==="Client"?"text-blue-700":A===L.VENDOR||A==="Vendor"?"text-purple-700":A===L.DESIGNER||A==="Designer"?"text-orange-700":A===L.ADMIN||A==="Admin"?"text-red-700":"text-gray-700"})():"text-gray-700"}`,children:h.receivedBy&&h.receivedBy.includes("(")?h.receivedBy.split("(")[1].replace(")","").trim():((N=e.find(S=>S.name===h.receivedBy))==null?void 0:N.role)||"Vendor"})]})})]})}),a.jsx("td",{className:"px-4 py-3 text-left text-gray-700 text-sm md:text-xs",children:h.description}),a.jsxs("td",{className:"px-4 py-3 text-right text-gray-700 font-bold text-sm md:text-xs",children:["",h.amount.toLocaleString()]}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("div",{className:"flex justify-center",children:a.jsx("input",{type:"checkbox",checked:h.adminApproved===!0,disabled:!Mt,title:h.adminApproved?"Click to revoke admin approval":"Admin approval checkbox","aria-label":"Approve or revoke as admin",onChange:S=>Mn(h.id,"admin",S.target.checked),className:"w-4 h-4 rounded border-gray-300 cursor-pointer hover:border-gray-400 disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-gray-100"})})}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("div",{className:"flex justify-center",children:a.jsx("input",{type:"checkbox",checked:h.clientApproved===!0,disabled:!Is,title:h.clientApproved?"Click to revoke client approval":"Client approval checkbox","aria-label":"Approve or revoke as client",onChange:S=>Mn(h.id,"client",S.target.checked),className:"w-4 h-4 rounded border-gray-300 cursor-pointer hover:border-gray-400 disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-gray-100"})})}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("span",{className:`inline-block px-2 py-1 rounded text-sm md:text-xs font-medium ${h.adminApproved&&h.clientApproved?"bg-green-100 text-green-700":h.adminApproved?"bg-blue-100 text-blue-700":h.clientApproved?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:h.adminApproved&&h.clientApproved?"Approved":h.adminApproved?"Admin OK":h.clientApproved?"Client OK":"Pending"})})]},h.id)})})]})}),n.type==="Designing"&&kt.filter(h=>{const _=e.filter(A=>A.role===L.VENDOR),N=new Set(_.map(A=>A.name)),S=A=>A?A.includes("(")?A.split("(")[0].trim():A.trim():"";return!!h.vendorName&&N.has(h.vendorName)||h.paidBy==="vendor"||h.receivedByName&&N.has(S(h.receivedByName))||h.paidByOther&&N.has(S(h.paidByOther))||h.receivedByRole==="vendor-received"}).length>0&&a.jsx("div",{className:"px-6 py-4 bg-gray-100 border-t border-gray-200",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm md:text-xs font-semibold text-gray-700",children:"Total Vendor Transactions"}),(()=>{const _=kt.filter(N=>{const S=e.filter(Z=>Z.role===L.VENDOR),A=new Set(S.map(Z=>Z.name)),oe=Z=>Z?Z.includes("(")?Z.split("(")[0].trim():Z.trim():"";return(!!N.vendorName&&A.has(N.vendorName)||N.paidBy==="vendor"||N.receivedByName&&A.has(oe(N.receivedByName))||N.paidByOther&&A.has(oe(N.paidByOther))||N.receivedByRole==="vendor-received")&&N.clientApproved===!0&&N.adminApproved===!0}).reduce((N,S)=>N+S.amount,0);return a.jsxs("span",{className:"font-semibold text-gray-900 text-lg md:text-sm",children:["",_.toLocaleString()]})})()]}),a.jsx("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200 bg-gray-100 rounded-md px-3 py-2",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-base md:text-xs font-semibold text-gray-700",children:"Designer Charges"}),Mt&&!oo&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"text-base md:text-xs text-gray-700",children:["(",ft,"%)"]}),a.jsx("button",{className:"ml-1 p-1 rounded hover:bg-gray-200",title:"Edit Designer Charges Percentage",onClick:()=>ga(!0),children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536M9 13h3l8-8a2.828 2.828 0 10-4-4l-8 8v3h3z"})})})]}),Mt&&oo&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"number",min:"0",max:"100",value:ft,onChange:h=>es(parseFloat(h.target.value)||0),className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:border-gray-500 bg-white","aria-label":"Designer Charges Percentage",title:"Enter designer charges percentage for vendor payments",placeholder:"0"}),a.jsx("span",{className:"text-sm md:text-xs text-gray-700",children:"%"}),a.jsx("button",{className:"ml-2 px-2 py-1 text-xs font-semibold rounded bg-gray-700 text-white hover:bg-gray-800 focus:outline-none border border-gray-700",onClick:()=>{ol(),ga(!1)},title:"Save Designer Charges Percentage",children:"Save"})]}),!Mt&&a.jsxs("span",{className:"text-sm md:text-xs text-gray-700",children:["(",ft,"%)"]})]})}),(()=>{const _=kt.filter(A=>{const oe=e.filter(De=>De.role===L.VENDOR),Y=new Set(oe.map(De=>De.name)),Z=De=>De?De.includes("(")?De.split("(")[0].trim():De.trim():"";return!!A.vendorName&&Y.has(A.vendorName)||A.paidBy==="vendor"||A.receivedByName&&Y.has(Z(A.receivedByName))||A.paidByOther&&Y.has(Z(A.paidByOther))||A.receivedByRole==="vendor-received"}).reduce((A,oe)=>A+oe.amount,0),N=_*(ft/100),S=_+N;return a.jsx("div",{className:"w-full mt-2 bg-gray-100 rounded px-3 py-2 text-sm md:text-xs",children:a.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4 sm:items-center sm:justify-between",children:[a.jsxs("span",{className:"block min-w-[140px] mb-1 sm:mb-0",children:["Total Vendor Amount: ",a.jsxs("span",{className:"font-semibold text-gray-900",children:["",_.toLocaleString()]})]}),a.jsxs("span",{className:"block min-w-[120px] mb-1 sm:mb-0",children:["Designer Charges: ",a.jsxs("span",{className:"font-semibold text-gray-700",children:[ft,"%"]})]}),a.jsxs("span",{className:"block min-w-[150px] mb-1 sm:mb-0",children:["Calculated Charges: ",a.jsxs("span",{className:"font-semibold text-gray-700",children:["",N.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),a.jsxs("span",{className:"block min-w-[130px]",children:["Final Amount: ",a.jsxs("span",{className:"font-semibold text-green-700",children:["",S.toLocaleString(void 0,{maximumFractionDigits:2})]})]})]})})})()]})})]})]}),F==="timeline"&&!gn&&a.jsx("div",{className:"max-w-3xl mx-auto p-4 md:p-8",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-8 overflow-hidden",children:[a.jsx("h3",{className:"text-xl md:text-lg font-bold text-gray-800 mb-6",children:"Project Timeline"}),a.jsxs("div",{className:"relative border-l-2 border-gray-100 ml-3 space-y-8",children:[(!qi||qi.length===0)&&a.jsx("div",{className:"pl-6 text-gray-400 italic",children:"No timeline events yet. Add milestones to track project progress."}),qi==null?void 0:qi.sort((h,_)=>{const N=new Date(h.endDate||h.startDate).getTime();return new Date(_.endDate||_.startDate).getTime()-N}).map(h=>a.jsxs("div",{className:"relative pl-8",children:[a.jsx("span",{className:`absolute -left-[9px] top-1 w-4 h-4 rounded-full border-2 border-white shadow-sm
                        ${h.status==="completed"?"bg-green-500":h.status==="in-progress"?"bg-blue-500":"bg-gray-400"}`}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-bold text-gray-800 text-lg md:text-base",children:h.title||h.milestone}),a.jsx("p",{className:"text-gray-600 text-base md:text-sm mt-0.5",children:h.description}),a.jsx("div",{className:"flex items-center gap-2 mt-2",children:a.jsx("span",{className:`text-sm md:text-xs px-2.5 py-1.5 rounded-full font-medium
                                 ${h.status==="completed"?"bg-green-100 text-green-700":h.status==="in-progress"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:h.status})})]}),a.jsxs("div",{className:"text-sm md:text-xs text-gray-400 mt-2 sm:mt-0 font-mono whitespace-nowrap",children:[a.jsx("div",{children:dn(h.endDate||h.startDate)}),a.jsx("div",{className:"text-gray-300",children:new Date(h.endDate||h.startDate).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})})]})]})]},h.id))]})]})}),F==="team"&&a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4 md:p-8",children:a.jsxs("div",{className:"bg-white p-4 md:p-8 rounded-xl border border-gray-200",children:[a.jsx("h3",{className:"font-bold text-lg md:text-base text-gray-800 mb-4",children:"Project Clients"}),a.jsx("div",{className:"space-y-2",children:(()=>{const h=Array.from(new Set([n.clientId,...n.clientIds||[]].filter(Boolean)));return h.length===0?a.jsx("p",{className:"text-gray-500 text-sm",children:"No clients assigned"}):h.map(_=>{const N=e.find(S=>S.id===_);return N?a.jsxs("div",{className:"flex items-center justify-between border-b border-gray-50 pb-2",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs("div",{children:[a.jsx("p",{className:"text-base md:text-sm font-bold text-gray-900",children:N.name}),a.jsx("p",{className:"text-xs text-gray-500",children:"Client"})]})}),u.role===L.ADMIN&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{onClick:()=>sm(N),className:"text-gray-400 hover:text-green-600 p-2.5 rounded-full hover:bg-green-50 transition-colors",title:"Send Payment Reminder Email",children:a.jsx(yp,{className:"w-5 h-5"})}),a.jsx("button",{onClick:()=>{const S=`${window.location.origin}${window.location.pathname}?projectId=${n.id}`;navigator.clipboard.writeText(S).then(()=>{p("Success","Project link copied to clipboard","success",u==null?void 0:u.id,n.id,n.name)}).catch(()=>{p("Error","Failed to copy link","error",u==null?void 0:u.id,n.id,n.name)})},className:"text-gray-400 hover:text-blue-600 p-2.5 rounded-full hover:bg-blue-50 transition-colors",title:"Copy project link",children:a.jsx(Ou,{className:"w-5 h-5"})})]})]},_):null})})()}),a.jsxs("div",{className:"flex items-center justify-between border-b border-gray-50 pb-2",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs("div",{children:[a.jsx("p",{className:"text-base md:text-sm font-bold text-gray-900",children:Tn(n.leadDesignerId)}),a.jsx("p",{className:"text-sm text-gray-500",children:"Lead Designer"})]})}),u.role===L.ADMIN&&n.leadDesignerId&&a.jsx("button",{onClick:()=>fa(!0),className:"text-red-400 hover:text-red-600 p-1.5 hover:bg-red-50 rounded transition-colors",title:"Remove Lead Designer",children:a.jsx(mn,{className:"w-4 h-4"})})]}),(()=>{const h=n.teamMembers?n.teamMembers.map(_=>e.find(N=>N.id===_)).filter(_=>_!==void 0&&_.role===L.DESIGNER):[];return h.length===0?null:a.jsxs(a.Fragment,{children:[a.jsx("h4",{className:"text-sm font-bold text-gray-500 uppercase mb-2",children:"Designers"}),h.map(_=>a.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors border border-transparent hover:border-gray-100",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-bold text-gray-800 text-base md:text-sm",children:_.name}),a.jsx("p",{className:"text-sm text-gray-500",children:_.role})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>ao(_),className:"text-blue-500 hover:text-blue-700 text-sm font-medium px-2 py-1 hover:bg-blue-50 rounded transition-colors",title:"View designer details and projects",children:"View Details"}),Ft&&a.jsx("button",{onClick:()=>{const N={...n,teamMembers:(n.teamMembers||[]).filter(S=>S!==_.id)};t(N),p("Success",`${_.name} removed from team`,"success")},className:"text-red-400 hover:text-red-600 p-1.5 hover:bg-red-50 rounded transition-colors",title:"Remove Member",children:a.jsx(mn,{className:"w-4 h-4"})})]})]},_.id))]})})(),Qd.length>0&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"pt-4 space-y-6",children:Qd.map(h=>a.jsxs("div",{children:[a.jsxs("h4",{className:"text-sm font-bold text-gray-500 uppercase mb-3 border-b border-gray-100 pb-1 flex items-center gap-2",children:[a.jsx($p,{className:"w-4 h-4"})," ",h]}),a.jsx("div",{className:"grid grid-cols-1 gap-3",children:Pc[h].map(_=>(kt.filter(S=>{const A=S.adminApproved&&S.clientApproved,oe=Y=>Y?Y.includes("(")?Y.split("(")[0].trim():Y.trim():"";return A&&(S.vendorName===_.name||oe(S.receivedByName)===_.name||oe(S.paidByOther)===_.name||S.paidTo===_.name||S.receivedBy===_.name)}).reduce((S,A)=>S+(A.amount||0),0),a.jsxs("div",{onClick:()=>{(!gn||_.id===u.id)&&zi(_)},className:`flex items-center gap-3 p-3 rounded-lg transition-colors border border-transparent ${gn&&_.id!==u.id?"opacity-60 cursor-default":"hover:bg-gray-50 hover:border-gray-100 cursor-pointer group"}`,title:gn&&_.id!==u.id?"You can only view your own billing report":"Click to view billing report",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-bold text-gray-800 text-base md:text-sm",children:_.name}),a.jsx("p",{className:"text-sm text-gray-500",children:_.company||"Independent"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"text-xs bg-gray-100 text-gray-600 px-2.5 py-1.5 rounded-full font-medium",children:[n.tasks.filter(S=>S.assigneeId===_.id).length," Tasks"]}),Mt&&a.jsx("button",{onClick:S=>{S.stopPropagation();const A=(n.hiddenVendors||[]).includes(_.id),oe={...n,hiddenVendors:A?(n.hiddenVendors||[]).filter(Z=>Z!==_.id):[...n.hiddenVendors||[],_.id]};t(oe);const Y=A?"shown":"hidden";p("Success",`${_.name} ${Y} from clients`,"success")},className:`p-1.5 rounded transition-colors ${(n.hiddenVendors||[]).includes(_.id)?"text-gray-400 hover:text-gray-600 hover:bg-gray-100":"text-blue-500 hover:text-blue-700 hover:bg-blue-50"}`,title:(n.hiddenVendors||[]).includes(_.id)?"Show to clients":"Hide from clients",children:(n.hiddenVendors||[]).includes(_.id)?a.jsx(kA,{className:"w-4 h-4"}):a.jsx(ax,{className:"w-4 h-4"})}),!gn||_.id===u.id?a.jsx($a,{className:"w-4 h-4 text-gray-300 group-hover:text-gray-500"}):null]})]},_.id)))})]},h))})})]})})]}),F==="team"&&Ot&&a.jsxs("div",{className:"max-w-3xl mx-auto bg-white rounded-xl shadow-lg border border-gray-200 mt-8 mb-8 p-4 md:p-6",children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:["Vendor Financials: ",a.jsx("span",{className:"text-purple-700",children:Ot.name})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left font-bold text-gray-700",children:"Date"}),a.jsx("th",{className:"px-4 py-2 font-bold text-gray-700",children:"Description"}),a.jsx("th",{className:"px-4 py-2 font-bold text-gray-700",children:"Amount"}),a.jsx("th",{className:"px-4 py-2 font-bold text-gray-700",children:"Designer Charge"}),a.jsx("th",{className:"px-4 py-2 font-bold text-gray-700",children:"Status"})]})}),a.jsx("tbody",{children:kt.filter(h=>{const _=h.adminApproved&&h.clientApproved,N=S=>S?S.includes("(")?S.split("(")[0].trim():S.trim():"";return _&&(h.vendorName===Ot.name||N(h.receivedByName)===Ot.name||N(h.paidByOther)===Ot.name||h.paidTo===Ot.name||h.receivedBy===Ot.name)}).sort((h,_)=>new Date(_.date).getTime()-new Date(h.date).getTime()).map((h,_)=>{var A;const N=n.designerChargePercentage||0,S=Math.round((h.amount||0)*N/100);return a.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${_%2===0?"bg-white":"bg-gray-50/50"}`,children:[a.jsx("td",{className:"px-4 py-3 text-gray-600 whitespace-nowrap text-xs text-left",children:h.date}),a.jsx("td",{className:"px-4 py-3 text-gray-700",children:h.description||"-"}),a.jsxs("td",{className:"px-4 py-3 text-right text-gray-900 font-bold",children:["",(A=h.amount)==null?void 0:A.toLocaleString()]}),a.jsxs("td",{className:"px-4 py-3 text-right text-orange-700 font-bold",children:["",S.toLocaleString()," ",a.jsxs("span",{className:"text-xs text-gray-400",children:["(",N,"%)"]})]}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700",children:"Approved"})})]},h.id)})})]})})]}),Us&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-sm max-h-[90vh] flex flex-col animate-fade-in",children:[a.jsx("div",{className:"p-4 md:p-6 border-b border-gray-100 flex-shrink-0",children:a.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(RN,{className:"w-5 h-5"})," Add to Project"]})}),a.jsxs("div",{className:"p-4 md:p-6 space-y-4 flex-1 overflow-y-auto scrollbar-thin",children:[a.jsxs("div",{className:"flex gap-2 bg-gray-100 p-1 rounded-lg",children:[a.jsx("button",{onClick:()=>{eo("client"),ys("")},className:`flex-1 py-2 rounded font-medium text-sm transition-colors ${vs==="client"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Add Client"}),a.jsx("button",{onClick:()=>{eo("member"),ys("")},className:`flex-1 py-2 rounded font-medium text-sm transition-colors ${vs==="member"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Add Vendor"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"text-sm font-bold text-gray-500 uppercase",children:["Select ",vs==="client"?"Clients":"Vendors"]}),a.jsx("div",{className:"border rounded-lg p-3 space-y-2 max-h-48 overflow-y-auto mt-2 border-gray-300",children:vs==="client"?e.filter(h=>h.role===L.CLIENT&&h.id!==n.clientId&&!(n.clientIds||[]).includes(h.id)).length===0?a.jsx("p",{className:"text-gray-500 text-sm",children:"No clients available to add"}):e.filter(h=>h.role===L.CLIENT&&h.id!==n.clientId&&!(n.clientIds||[]).includes(h.id)).map(h=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors",children:[a.jsx("input",{type:"checkbox",checked:Hn.includes(h.id),onChange:_=>{const N=Hn.split(",").filter(Boolean),S=_.target.checked?[...N,h.id]:N.filter(A=>A!==h.id);ys(S.join(","))},className:"w-4 h-4 rounded border-gray-300 cursor-pointer"}),a.jsx("span",{className:"text-sm text-gray-700",children:h.name})]},h.id)):e.filter(h=>h.role===L.VENDOR&&!(n.teamMembers||[]).includes(h.id)).length===0?a.jsx("p",{className:"text-gray-500 text-sm",children:"No vendors available to add"}):e.filter(h=>h.role===L.VENDOR&&!(n.teamMembers||[]).includes(h.id)).map(h=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors",children:[a.jsx("input",{type:"checkbox",checked:Hn.includes(h.id),onChange:_=>{const N=Hn.split(",").filter(Boolean),S=_.target.checked?[...N,h.id]:N.filter(A=>A!==h.id);ys(S.join(","))},className:"w-4 h-4 rounded border-gray-300 cursor-pointer"}),a.jsx("span",{className:"text-sm text-gray-700",children:h.name})]},h.id))}),a.jsx("p",{className:"text-xs text-gray-400 mt-2",children:vs==="client"?"Select clients to add as additional contacts for this project.":"Select vendors to add to this project."})]}),a.jsxs("div",{className:"flex gap-3 pt-2",children:[a.jsx("button",{onClick:()=>{xi(!1),ys("")},className:"flex-1 py-2 text-gray-500 hover:bg-gray-100 rounded",children:"Cancel"}),a.jsxs("button",{onClick:Cc,className:"flex-1 py-2 bg-gray-900 text-white rounded font-bold hover:bg-gray-800",children:["Add ",vs==="client"?"Clients":"Vendors"]})]})]})]})}),document.body),ie&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col animate-fade-in",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 flex-shrink-0",children:[a.jsxs("h3",{className:"text-2xl md:text-lg font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(yp,{className:"w-5 h-5"})," ",Be?"Edit Transaction":"Record Transaction"]}),a.jsx("button",{onClick:()=>{_e(!1),Ln(!1),We(null),En(""),Me(""),Ze("")},className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Close modal",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-6 scrollbar-thin space-y-3",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:["Amount ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"relative mt-1",children:[a.jsx("span",{className:"absolute left-3 top-2 text-gray-400",children:""}),a.jsx("input",{type:"number",className:`${At(vr&&!X.amount)} pl-7`,placeholder:"0.00",title:"Enter transaction amount",value:X.amount||"",onChange:h=>He({...X,amount:parseFloat(h.target.value)})})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:["Description ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",className:`${At(vr&&!X.description)} mt-1`,placeholder:"e.g. Initial Deposit, Paint Supplies",title:"Enter transaction description",value:X.description||"",onChange:h=>He({...X,description:h.target.value})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Type"}),a.jsxs("div",{className:"flex gap-2 mt-1",children:[a.jsx("button",{onClick:()=>He({...X,type:"income"}),className:`flex-1 py-2 text-base md:text-xs font-bold rounded ${X.type==="income"?"bg-green-100 text-green-700 ring-2 ring-green-500":"bg-gray-50 text-gray-500"}`,children:"Income"}),a.jsx("button",{onClick:()=>He({...X,type:"expense"}),className:`flex-1 py-2 text-base md:text-xs font-bold rounded ${X.type==="expense"?"bg-red-100 text-red-700 ring-2 ring-red-500":"bg-gray-50 text-gray-500"}`,children:"Expense"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Date"}),a.jsx("input",{type:"date",className:`${At(vr&&!X.date)} mt-1 text-base md:text-xs`,title:"Select transaction date",value:X.date||"",onChange:h=>He({...X,date:h.target.value})})]})]}),X.type==="expense"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Paid By"}),a.jsxs("div",{className:"flex gap-2 mt-1 flex-wrap",children:[a.jsx("button",{onClick:()=>He({...X,paidBy:"client"}),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${X.paidBy==="client"?"bg-blue-100 text-blue-700":"bg-gray-50 text-gray-500"}`,children:"Client"}),a.jsx("button",{onClick:()=>He({...X,paidBy:"vendor"}),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${X.paidBy==="vendor"?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-500"}`,children:"Vendor"}),a.jsx("button",{onClick:()=>He({...X,paidBy:"designer"}),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${X.paidBy==="designer"?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"}`,children:"Designer"}),a.jsx("button",{onClick:()=>He({...X,paidBy:"admin"}),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${X.paidBy==="admin"?"bg-red-100 text-red-700":"bg-gray-50 text-gray-500"}`,children:"Admin"}),a.jsx("button",{onClick:()=>He({...X,paidBy:"other"}),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${X.paidBy==="other"?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"}`,children:"Other"})]})]}),X.paidBy==="client"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Client"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:X.vendorName||"",onChange:h=>He({...X,vendorName:h.target.value}),title:"Select a client from the list",children:[a.jsx("option",{value:"",children:"Select a client..."}),e.filter(h=>h.role===L.CLIENT).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),X.paidBy==="vendor"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Vendor"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:X.vendorName||"",onChange:h=>He({...X,vendorName:h.target.value}),title:"Select a vendor from the list",children:[a.jsx("option",{value:"",children:"Select a vendor..."}),e.filter(h=>h.role===L.VENDOR).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),X.paidBy==="designer"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Designer"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:X.vendorName||"",onChange:h=>He({...X,vendorName:h.target.value}),title:"Select a designer from the list",children:[a.jsx("option",{value:"",children:"Select a designer..."}),e.filter(h=>h.role===L.DESIGNER).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),X.paidBy==="admin"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Admin"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:X.vendorName||"",onChange:h=>He({...X,vendorName:h.target.value}),title:"Select an admin from the list",children:[a.jsx("option",{value:"",children:"Select an admin..."}),e.filter(h=>h.role===L.ADMIN).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),X.paidBy==="other"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Paid By (Name & Role)"}),a.jsx("input",{type:"text",className:`${At(!1)} mt-1`,placeholder:"e.g. John Smith (Partner) or Supplier (Vendor)",title:"Enter who paid (name and role in parentheses)",value:X.paidByOther||"",onChange:h=>He({...X,paidByOther:h.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Received By"}),a.jsxs("div",{className:"flex gap-2 mt-1 flex-wrap",children:[a.jsx("button",{onClick:()=>Ze("client"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="client"?"bg-blue-100 text-blue-700":"bg-gray-50 text-gray-500"}`,children:"Client"}),a.jsx("button",{onClick:()=>Ze("vendor"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="vendor"?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-500"}`,children:"Vendor"}),a.jsx("button",{onClick:()=>Ze("designer"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="designer"?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"}`,children:"Designer"}),a.jsx("button",{onClick:()=>Ze("admin"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="admin"?"bg-red-100 text-red-700":"bg-gray-50 text-gray-500"}`,children:"Admin"}),a.jsx("button",{onClick:()=>Ze("other"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="other"?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"}`,children:"Other"})]})]}),ve==="client"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Client"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:xt||"",onChange:h=>Me(h.target.value),title:"Select a client from the project",children:[a.jsx("option",{value:"",children:"Select a client..."}),hn.filter(h=>h.role===L.CLIENT).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="vendor"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Vendor"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:xt||"",onChange:h=>Me(h.target.value),title:"Select a vendor from the project",children:[a.jsx("option",{value:"",children:"Select a vendor..."}),hn.filter(h=>h.role===L.VENDOR).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="designer"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Designer"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:xt||"",onChange:h=>Me(h.target.value),title:"Select a designer from the project",children:[a.jsx("option",{value:"",children:"Select a designer..."}),hn.filter(h=>h.role===L.DESIGNER).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="admin"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Admin"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:xt||"",onChange:h=>Me(h.target.value),title:"Select an admin from the list",children:[a.jsx("option",{value:"",children:"Select an admin..."}),e.filter(h=>h.role===L.ADMIN).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="other"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Received By (Name & Role)"}),a.jsx("input",{type:"text",className:`${At(!1)} mt-1`,placeholder:"e.g. John Smith (Contractor) or Supplier (Vendor)",title:"Enter who received (name and role in parentheses)",value:xt||"",onChange:h=>Me(h.target.value)})]})]}),X.type==="income"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Paid By"}),a.jsxs("div",{className:"flex gap-2 mt-1 flex-wrap",children:[a.jsx("button",{onClick:()=>Ze("client"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="client"?"bg-blue-100 text-blue-700":"bg-gray-50 text-gray-500"}`,children:"Client"}),a.jsx("button",{onClick:()=>Ze("vendor"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="vendor"?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-500"}`,children:"Vendor"}),a.jsx("button",{onClick:()=>Ze("designer"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="designer"?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"}`,children:"Designer"}),a.jsx("button",{onClick:()=>Ze("admin"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="admin"?"bg-red-100 text-red-700":"bg-gray-50 text-gray-500"}`,children:"Admin"}),a.jsx("button",{onClick:()=>Ze("other"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="other"?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"}`,children:"Other"})]})]}),ve==="client"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Client"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:ln||"",onChange:h=>En(h.target.value),title:"Select a client from the project",children:[a.jsx("option",{value:"",children:"Select a client..."}),hn.filter(h=>h.role===L.CLIENT).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="vendor"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Vendor"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:ln||"",onChange:h=>En(h.target.value),title:"Select a vendor from the project",children:[a.jsx("option",{value:"",children:"Select a vendor..."}),hn.filter(h=>h.role===L.VENDOR).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="designer"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Designer"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:ln||"",onChange:h=>En(h.target.value),title:"Select a designer from the project",children:[a.jsx("option",{value:"",children:"Select a designer..."}),hn.filter(h=>h.role===L.DESIGNER).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="admin"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Admin"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:ln||"",onChange:h=>En(h.target.value),title:"Select an admin from the list",children:[a.jsx("option",{value:"",children:"Select an admin..."}),e.filter(h=>h.role===L.ADMIN).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="other"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Paid By (Name & Role)"}),a.jsx("input",{type:"text",className:`${At(!1)} mt-1`,placeholder:"e.g. John Smith (Partner) or Supplier (Vendor)",title:"Enter who paid (name and role in parentheses)",value:ln||"",onChange:h=>En(h.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Received By"}),a.jsxs("div",{className:"flex gap-2 mt-1 flex-wrap",children:[a.jsx("button",{onClick:()=>Ze(""),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve===""?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"}`,children:"Project"}),a.jsx("button",{onClick:()=>Ze("vendor-received"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="vendor-received"?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-500"}`,children:"Vendor"}),a.jsx("button",{onClick:()=>Ze("designer-received"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="designer-received"?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-500"}`,children:"Designer"}),a.jsx("button",{onClick:()=>Ze("admin-received"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="admin-received"?"bg-red-100 text-red-700":"bg-gray-50 text-gray-500"}`,children:"Admin"}),a.jsx("button",{onClick:()=>Ze("other-received"),className:`py-2 px-2 text-base md:text-xs font-bold rounded ${ve==="other-received"?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-500"}`,children:"Other"})]})]}),ve==="vendor-received"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Vendor"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:xt||"",onChange:h=>Me(h.target.value),title:"Select a vendor from the project",children:[a.jsx("option",{value:"",children:"Select a vendor..."}),hn.filter(h=>h.role===L.VENDOR).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="designer-received"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Designer"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:xt||"",onChange:h=>Me(h.target.value),title:"Select a designer from the project",children:[a.jsx("option",{value:"",children:"Select a designer..."}),hn.filter(h=>h.role===L.DESIGNER).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="admin-received"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Select Admin"}),a.jsxs("select",{className:`${At(!1)} mt-1`,value:xt||"",onChange:h=>Me(h.target.value),title:"Select an admin from the list",children:[a.jsx("option",{value:"",children:"Select an admin..."}),e.filter(h=>h.role===L.ADMIN).map(h=>a.jsx("option",{value:h.name,children:h.name},h.id))]})]}),ve==="other-received"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Received By (Name & Role)"}),a.jsx("input",{type:"text",className:`${At(!1)} mt-1`,placeholder:"e.g. John Smith (Contractor) or Supplier (Vendor)",title:"Enter who received (name and role in parentheses)",value:xt||"",onChange:h=>Me(h.target.value)})]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Category"}),a.jsxs("select",{className:`${At(vr&&!X.category)} mt-1 text-base md:text-xs`,value:X.category||"",onChange:h=>{He({...X,category:h.target.value}),h.target.value!=="Others"&&at("")},"aria-label":"Transaction category",children:[a.jsx("option",{value:"",children:"Select..."}),X.type==="income"?a.jsxs(a.Fragment,{children:[a.jsx("option",{value:"Advance",children:"Advance"}),a.jsx("option",{value:"Milestone 1",children:"Milestone 1"}),a.jsx("option",{value:"Milestone 2",children:"Milestone 2"}),a.jsx("option",{value:"Final Payment",children:"Final Payment"}),a.jsx("option",{value:"Additional Budget",children:"Additional Budget"}),a.jsx("option",{value:"Others",children:"Others (please specify)"})]}):a.jsxs(a.Fragment,{children:[a.jsx("option",{value:"Materials",children:"Materials"}),a.jsx("option",{value:"Labor",children:"Labor"}),a.jsx("option",{value:"Permits/Fees",children:"Permits/Fees"}),a.jsx("option",{value:"Furniture",children:"Furniture"}),a.jsx("option",{value:"Misc",children:"Misc"})]})]})]}),X.type==="income"&&X.category==="Others"&&a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Specify Category"}),a.jsx("input",{type:"text",className:`${At(vr&&!Vt)} mt-1 text-base md:text-xs`,placeholder:"Enter custom category",value:Vt,onChange:h=>at(h.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Mode"}),a.jsxs("select",{className:`${At(!1)} mt-1 text-base md:text-xs`,value:X.paymentMode||"",onChange:h=>He({...X,paymentMode:h.target.value}),"aria-label":"Payment mode",children:[a.jsx("option",{value:"",children:"Select..."}),a.jsx("option",{value:"cash",children:"Cash"}),a.jsx("option",{value:"upi",children:"UPI"}),a.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),a.jsx("option",{value:"cheque",children:"Cheque"}),a.jsx("option",{value:"credit_card",children:"Credit Card"}),a.jsx("option",{value:"other",children:"Other"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase",children:"Status"}),a.jsxs("select",{className:`${At(!1)} mt-1 text-base md:text-xs`,value:X.status||"pending",onChange:h=>He({...X,status:h.target.value}),"aria-label":"Transaction status",children:[a.jsx("option",{value:"pending",children:"Pending"}),a.jsx("option",{value:"paid",children:"Paid"}),a.jsx("option",{value:"overdue",children:"Overdue"})]})]})]}),X.type==="income"&&X.category==="Additional Budget"&&a.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3",children:[a.jsx("p",{className:"text-base md:text-xs font-bold text-gray-700 uppercase mb-3",children:"Approvals Required"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:(u==null?void 0:u.role)!==L.CLIENT?.5:1,pointerEvents:(u==null?void 0:u.role)!==L.CLIENT?"none":"auto"},children:[a.jsx("input",{type:"checkbox",checked:X.clientApprovalForAdditionalBudget==="approved",onChange:h=>He({...X,clientApprovalForAdditionalBudget:h.target.checked?"approved":"pending"}),disabled:(u==null?void 0:u.role)!==L.CLIENT,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Client approval for additional budget"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Client Approval",X.clientApprovalForAdditionalBudget==="approved"&&a.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),X.clientApprovalForAdditionalBudget==="rejected"&&a.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:(u==null?void 0:u.role)!==L.ADMIN?.5:1,pointerEvents:(u==null?void 0:u.role)!==L.ADMIN?"none":"auto"},children:[a.jsx("input",{type:"checkbox",checked:X.adminApprovalForAdditionalBudget==="approved",onChange:h=>He({...X,adminApprovalForAdditionalBudget:h.target.checked?"approved":"pending"}),disabled:(u==null?void 0:u.role)!==L.ADMIN,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Admin approval for additional budget"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Admin Approval",X.adminApprovalForAdditionalBudget==="approved"&&a.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),X.adminApprovalForAdditionalBudget==="rejected"&&a.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]})]})]}),X.type==="income"&&X.category!=="Additional Budget"&&a.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3",children:[a.jsx("p",{className:"text-base md:text-xs font-bold text-gray-700 uppercase mb-3",children:"Payment Approvals"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:(u==null?void 0:u.role)!==L.CLIENT?.5:1,pointerEvents:(u==null?void 0:u.role)!==L.CLIENT?"none":"auto"},children:[a.jsx("input",{type:"checkbox",checked:X.clientApprovalForPayment==="approved",onChange:h=>He({...X,clientApprovalForPayment:h.target.checked?"approved":"pending"}),disabled:(u==null?void 0:u.role)!==L.CLIENT,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Client confirmation of payment"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Client Confirmation",X.clientApprovalForPayment==="approved"&&a.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),X.clientApprovalForPayment==="rejected"&&a.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:(u==null?void 0:u.role)!==L.ADMIN?.5:1,pointerEvents:(u==null?void 0:u.role)!==L.ADMIN?"none":"auto"},children:[a.jsx("input",{type:"checkbox",checked:X.adminApprovalForPayment==="approved",onChange:h=>He({...X,adminApprovalForPayment:h.target.checked?"approved":"pending"}),disabled:(u==null?void 0:u.role)!==L.ADMIN,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Admin approval of payment"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Admin Approval",X.adminApprovalForPayment==="approved"&&a.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),X.adminApprovalForPayment==="rejected"&&a.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]})]})]}),X.type==="expense"&&a.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3",children:[a.jsx("p",{className:"text-base md:text-xs font-bold text-gray-700 uppercase mb-3",children:"Payment Approvals"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:(u==null?void 0:u.role)!==L.CLIENT?.5:1,pointerEvents:(u==null?void 0:u.role)!==L.CLIENT?"none":"auto"},children:[a.jsx("input",{type:"checkbox",checked:X.clientApprovalForPayment==="approved",onChange:h=>He({...X,clientApprovalForPayment:h.target.checked?"approved":"pending"}),disabled:(u==null?void 0:u.role)!==L.CLIENT,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Client approval of expense"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Client Approval",X.clientApprovalForPayment==="approved"&&a.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),X.clientApprovalForPayment==="rejected"&&a.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-50 transition-all",style:{opacity:(u==null?void 0:u.role)!==L.ADMIN?.5:1,pointerEvents:(u==null?void 0:u.role)!==L.ADMIN?"none":"auto"},children:[a.jsx("input",{type:"checkbox",checked:X.adminApprovalForPayment==="approved",onChange:h=>He({...X,adminApprovalForPayment:h.target.checked?"approved":"pending"}),disabled:(u==null?void 0:u.role)!==L.ADMIN,className:"w-4 h-4 disabled:opacity-50 disabled:cursor-not-allowed",title:"Admin approval of expense"}),a.jsxs("span",{className:"text-sm text-gray-700",children:["Admin Approval",X.adminApprovalForPayment==="approved"&&a.jsx("span",{className:"ml-1 text-green-600 font-bold",children:""}),X.adminApprovalForPayment==="rejected"&&a.jsx("span",{className:"ml-1 text-red-600 font-bold",children:""})]})]})]})]}),a.jsxs("div",{className:"pt-2 flex gap-3",children:[a.jsx("button",{onClick:()=>{_e(!1),Ln(!1),We(null),En(""),Me(""),Ze(""),at("")},className:"flex-1 py-2 text-base md:text-xs text-gray-500 hover:bg-gray-100 rounded font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:Pr,title:"Close transaction modal",children:"Cancel"}),a.jsx("button",{onClick:Br,disabled:Pr,className:"flex-1 py-2 text-base md:text-xs bg-gray-900 text-white rounded font-bold hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all",title:"Save transaction entry",children:Pr?"Saving...":Be?"Update Entry":"Add Entry"})]})]})]})}),document.body),ht&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col animate-fade-in",children:[a.jsx("div",{className:"p-4 md:p-6 border-b border-gray-100 flex-shrink-0",children:a.jsxs("h3",{className:"text-xl md:text-lg font-bold flex items-center gap-2 text-gray-900",children:[a.jsx(Wu,{className:"w-5 h-5 md:w-4 md:h-4"})," Upload Document"]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 scrollbar-thin space-y-4",children:[a.jsx("input",{type:"text",placeholder:"Document Name (e.g. FloorPlan.pdf) - optional when uploading files",className:`${At(Ye&&!ct.name&&nn.length===0)} text-base md:text-sm`,value:ct.name,onChange:h=>On({...ct,name:h.target.value})}),a.jsxs("div",{children:[a.jsx("label",{className:"text-base md:text-xs font-bold text-gray-500 uppercase mb-2 block",children:"Share With Project Team:"}),a.jsx("div",{className:"space-y-3 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50",children:[L.CLIENT,L.VENDOR,L.DESIGNER].map(h=>{const _=hn.filter(N=>N.role===h);return _.length===0?null:a.jsxs("div",{children:[a.jsxs("p",{className:"text-base md:text-xs font-bold text-gray-600 uppercase mb-2",children:[h,"s"]}),a.jsx("div",{className:"space-y-1 ml-2",children:_.map(N=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-white p-1.5 rounded border border-transparent hover:border-gray-200",children:[a.jsx("input",{type:"checkbox",checked:ct.sharedWith.includes(N.id),onChange:S=>{S.target.checked?On({...ct,sharedWith:[...ct.sharedWith,N.id]}):On({...ct,sharedWith:ct.sharedWith.filter(A=>A!==N.id)})}}),a.jsx("span",{className:"text-base md:text-sm text-gray-800",children:N.name})]},N.id))})]},h)})})]}),Nt.length>0&&a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[a.jsx("label",{htmlFor:"attach-task-select",className:"text-base md:text-xs font-bold text-blue-600 uppercase mb-2 block",children:"Attach to Task (Optional):"}),a.jsxs("select",{id:"attach-task-select",title:"Select a task to attach documents to","aria-label":"Select a task to attach documents to",value:ct.attachToTaskId||"",onChange:h=>{On({...ct,attachToTaskId:h.target.value||void 0})},className:"w-full p-2 border border-blue-300 rounded bg-white text-base md:text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"-- Don't attach to any task --"}),Nt.map(h=>a.jsxs("option",{value:h.id,children:[h.title," (",h.status,")"]},h.id))]})]}),a.jsxs("div",{className:"bg-gray-50 p-4 md:p-6 rounded-lg border-2 border-dashed border-gray-300 text-base md:text-sm text-gray-500 hover:bg-gray-100 hover:border-gray-400 transition-colors cursor-pointer relative",onClick:()=>{var h;return(h=fn.current)==null?void 0:h.click()},children:[nn.length>0?a.jsxs("div",{className:"flex flex-col items-start gap-2",children:[a.jsxs("div",{className:"w-full flex items-center gap-2",children:[a.jsx(Pu,{className:"w-8 h-8 text-blue-500 flex-shrink-0"}),a.jsxs("div",{className:"flex-1 text-left",children:[a.jsxs("p",{className:"font-bold text-base md:text-sm text-gray-800",children:[nn.length," file(s) selected"]}),a.jsxs("p",{className:"text-sm md:text-xs text-gray-400",children:["Total size: ",(nn.reduce((h,_)=>h+_.size,0)/1024).toFixed(1)," KB"]})]})]}),a.jsx("div",{className:"w-full mt-2 max-h-32 overflow-y-auto border-t border-gray-200 pt-2",children:nn.map((h,_)=>a.jsxs("div",{className:"flex items-center justify-between text-sm md:text-xs text-gray-600 bg-white p-1.5 rounded mb-1",children:[a.jsx("span",{className:"truncate flex-1",children:h.name}),a.jsx("button",{type:"button",onClick:N=>{N.stopPropagation(),Ie(nn.filter((S,A)=>A!==_))},className:"ml-2 text-gray-400 hover:text-red-500 flex-shrink-0 text-lg md:text-base",title:"Remove file",children:""})]},_))})]}):a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx(Wu,{className:"w-8 h-8 text-gray-300 mb-2"}),a.jsx("p",{className:"text-base md:text-sm",children:"Click to select files"}),a.jsx("p",{className:"text-sm md:text-xs text-gray-400 mt-1",children:"or drag and drop here (multiple files supported)"})]}),a.jsx("input",{type:"file",multiple:!0,ref:fn,onChange:h=>{const _=Array.from(h.target.files||[]);Ie(_)},className:"hidden",title:"Select files to upload"})]}),a.jsxs("div",{className:"flex gap-2 pt-2",children:[a.jsx("button",{onClick:()=>ot(!1),className:"flex-1 py-2 md:py-1.5 text-base md:text-xs text-gray-500 hover:bg-gray-100 rounded",children:"Cancel"}),a.jsx("button",{onClick:m,className:"flex-1 py-2 md:py-1.5 text-base md:text-xs bg-gray-900 text-white rounded font-bold hover:bg-gray-800",disabled:fl,children:fl?a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"Uploading..."]}):"Upload"})]})]})]})}),document.body),Fs&&Bs&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col animate-fade-in",children:[a.jsxs("div",{className:"p-4 md:p-6 border-b border-gray-100 flex-shrink-0",children:[a.jsx("h3",{className:"text-lg font-bold",children:"Edit Shared Users"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Modify who can access this document after approval."})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-4",children:a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-semibold",children:"Select Users"}),a.jsx("div",{className:"mt-2 space-y-2 max-h-56 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50",children:hn.map(h=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-white p-1.5 rounded border border-transparent hover:border-gray-200",children:[a.jsx("input",{type:"checkbox",checked:ma.includes(h.id),onChange:_=>{_.target.checked?ar(N=>Array.from(new Set([...N,h.id]))):ar(N=>N.filter(S=>S!==h.id))}}),a.jsxs("span",{className:"text-sm text-gray-800",children:[h.name," (",h.role,")"]})]},h.id))})]})}),a.jsxs("div",{className:"p-4 md:p-6 border-t border-gray-100 flex gap-3",children:[a.jsx("button",{onClick:()=>{fi(!1),Jr(null),ar([])},className:"flex-1 py-2 text-base text-gray-500 hover:bg-gray-100 rounded font-medium",children:"Cancel"}),a.jsx("button",{onClick:async()=>{try{await zu(n.id,Bs.id,{sharedWith:ma}),p("Shared Users Updated",`Shared list updated for ${Bs.name}`,"success",void 0,n.id,n.name)}catch(h){console.error("Error updating sharedWith:",h),p("Update Failed","Could not update shared users","error")}finally{fi(!1),Jr(null),ar([])}},className:"flex-1 py-2 bg-blue-600 text-white rounded font-bold hover:bg-blue-700",children:"Save"})]})]})}),document.body),J&&j&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[9999] flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:j.id?"Edit Task Details":"Create New Task"}),a.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 font-medium mt-0.5",children:[a.jsx(jN,{className:"w-3 h-3"}),a.jsx("span",{children:n.name})]})]})}),a.jsx("button",{onClick:()=>he(!1),className:"text-gray-400 hover:text-gray-600",title:"Close task modal",children:a.jsx(mn,{})})]}),Fr(j)&&a.jsxs("div",{className:"bg-red-50 border-b border-red-100 px-4 py-2 flex items-center gap-2 text-red-700 text-sm",children:[a.jsx(Xi,{className:"w-4 h-4"}),a.jsx("span",{className:"font-bold",children:"Dependency Locked:"}),a.jsxs("span",{children:["This task is blocked by pending dependencies: ",wa(j).map(h=>h.title).join(", "),"."]})]}),Tt&&a.jsxs("div",{className:"bg-gray-800 text-white px-4 py-3 flex items-center justify-between shadow-md",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ma,{className:"w-5 h-5 text-red-400"}),a.jsxs("span",{className:"font-bold uppercase tracking-wide",children:["Task Frozen: ",j.status]})]}),a.jsx("span",{className:"text-xs opacity-70",children:"Interaction disabled by Admin."})]}),a.jsxs("div",{className:"flex md:hidden border-b border-gray-200 bg-white flex-shrink-0",children:[a.jsx("button",{onClick:()=>M("details"),className:`flex-1 py-3 text-sm font-bold text-center ${K==="details"?"text-gray-900 border-b-2 border-gray-900":"text-gray-500"}`,children:"Details"}),a.jsx("button",{onClick:()=>M("activity"),className:`flex-1 py-3 text-sm font-bold text-center ${K==="activity"?"text-gray-900 border-b-2 border-gray-900":"text-gray-500"}`,children:"Activity"})]}),a.jsxs("div",{className:`flex-1 flex flex-col md:flex-row overflow-hidden ${Tt?"pointer-events-none opacity-80 bg-gray-50":""}`,children:[a.jsx("div",{className:`w-full md:w-1/2 p-6 overflow-y-auto border-r border-gray-100 bg-white ${K==="activity"?"hidden md:block":"block"}`,children:a.jsxs("div",{className:"space-y-4",children:[Mt&&a.jsxs("div",{className:"bg-gray-900 p-3 rounded-lg pointer-events-auto",children:[a.jsxs("p",{className:"text-xs font-bold text-gray-400 uppercase mb-2 flex items-center gap-1",children:[a.jsx(qx,{className:"w-3 h-3"})," Admin Actions"]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:()=>Rc(j),className:"flex-1 bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",disabled:j.status===xe.DONE,children:[a.jsx(Ed,{className:"w-3 h-3"})," Mark Done"]}),j.status===xe.ON_HOLD?a.jsxs("button",{onClick:()=>ce({...j,status:pp(j,xe.IN_PROGRESS)}),className:"flex-1 bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1",children:[a.jsx(Lb,{className:"w-3 h-3"})," Resume"]}):a.jsxs("button",{onClick:()=>ce({...j,status:xe.ON_HOLD}),className:"flex-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1",children:[a.jsx(Ux,{className:"w-3 h-3"})," Hold"]}),j.status===xe.ABORTED?a.jsxs("button",{onClick:()=>ce({...j,status:pp(j,xe.IN_PROGRESS)}),className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1",children:[a.jsx(Fb,{className:"w-3 h-3"})," Restore"]}):a.jsxs("button",{onClick:()=>ce({...j,status:xe.ABORTED}),className:"flex-1 bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-1",children:[a.jsx(Ma,{className:"w-3 h-3"})," Abort"]})]})]}),j.id&&j.status!==xe.DONE&&!Mt&&(u==null?void 0:u.id)===j.assigneeId&&!Tt&&a.jsxs("div",{className:"bg-green-50 border border-green-100 p-3 rounded-lg mb-4 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[a.jsx(Ed,{className:"w-5 h-5"}),a.jsx("span",{className:"font-bold text-sm",children:"Complete this task?"})]}),a.jsx("button",{onClick:()=>Rc(j),className:"bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-2 px-4 rounded flex items-center gap-1 transition-colors",children:"Mark as Done"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Title ",a.jsx("span",{className:"text-red-500",children:"*"})]}),Ft?a.jsx("input",{type:"text",className:`${At(z&&!j.title,Tt)} font-semibold mt-1`,placeholder:"Task title",value:j.title||"",onChange:h=>ce({...j,title:h.target.value}),disabled:Tt}):a.jsx("p",{className:"font-bold text-gray-800 mt-1",children:j.title})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Category"}),Ft?a.jsx("select",{className:`${At(!1,Tt)} mt-1`,value:j.category||"General",onChange:h=>ce({...j,category:h.target.value}),disabled:Tt,"aria-label":"Task category",children:xf.map(h=>a.jsx("option",{value:h,children:h},h))}):a.jsx("span",{className:"block mt-1 text-sm bg-gray-100 w-fit px-2 py-1 rounded text-gray-800",children:j.category||"General"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Start Date ",a.jsx("span",{className:"text-red-500",children:"*"})]}),Ft?a.jsx("input",{type:"date",className:`${At(z&&!j.startDate,Tt)} mt-1`,title:"Select start date",value:j.startDate||"",onChange:h=>ce({...j,startDate:h.target.value}),disabled:Tt}):a.jsx("p",{className:"text-sm mt-1 text-gray-800",children:dn(j.startDate)})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase",children:["Due Date ",a.jsx("span",{className:"text-red-500",children:"*"})]}),Ft?a.jsx("input",{type:"date",className:`${At(z&&!j.dueDate,Tt)} mt-1`,title:"Select due date",value:j.dueDate||"",onChange:h=>ce({...j,dueDate:h.target.value}),disabled:Tt}):a.jsx("p",{className:"text-sm mt-1 text-gray-800",children:dn(j.dueDate)})]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(Ou,{className:"w-3 h-3 text-gray-400"}),a.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Dependencies"})]}),Ft?a.jsx("div",{className:`mt-1 p-2 border rounded max-h-24 overflow-y-auto bg-white border-gray-200 ${Tt?"opacity-50":""}`,children:Nt.filter(h=>h.id!==j.id).length>0?Nt.filter(h=>h.id!==j.id).map(h=>a.jsxs("label",{className:"flex items-center gap-2 mb-1 cursor-pointer hover:bg-gray-50 p-1 rounded",children:[a.jsx("input",{type:"checkbox",checked:(j.dependencies||[]).includes(h.id),onChange:_=>lo(h.id,_.target.checked),disabled:Tt,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"text-sm text-gray-700 truncate",children:h.title}),a.jsxs("span",{className:"text-xs text-gray-400 ml-auto",children:["Ends: ",h.dueDate]})]},h.id)):a.jsx("p",{className:"text-xs text-gray-400 italic",children:"No other tasks available"})}):a.jsx("div",{className:"mt-1 text-sm text-gray-600",children:(j.dependencies||[]).length>0?Nt.filter(h=>(j.dependencies||[]).includes(h.id)).map(h=>a.jsxs("div",{className:"flex items-center gap-1 text-xs bg-gray-50 border border-gray-200 rounded px-2 py-1 mb-1",children:[a.jsx(Ou,{className:"w-3 h-3 text-gray-400"})," ",h.title,h.status!==xe.DONE&&a.jsx("span",{className:"text-red-500 font-bold ml-1",children:"(Pending)"})]},h.id)):a.jsx("span",{className:"text-gray-400 italic text-xs",children:"No dependencies"})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Assignee & Priority"}),a.jsxs("div",{className:"flex gap-4 mt-1",children:[Ft?a.jsxs("select",{className:`${At(!1,Tt)} flex-1`,value:j.assigneeId||"",onChange:h=>ce({...j,assigneeId:h.target.value}),disabled:Tt,"aria-label":"Task assignee",children:[a.jsx("option",{value:"",children:"Unassigned"}),e.filter(h=>h.role===L.DESIGNER||h.role===L.VENDOR).map(h=>a.jsx("option",{value:h.id,children:h.name},h.id))]}):a.jsx("p",{className:"flex-1 text-sm bg-gray-50 p-2 rounded text-gray-800",children:Tn(j.assigneeId||"")}),Ft?a.jsxs("select",{className:`w-32 p-2 border rounded border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-900 ${Tt?"bg-gray-100 text-gray-500":"bg-white text-gray-900"}`,value:j.priority||"medium",onChange:h=>ce({...j,priority:h.target.value}),disabled:Tt,"aria-label":"Task priority",children:[a.jsx("option",{value:"low",children:"Low"}),a.jsx("option",{value:"medium",children:"Medium"}),a.jsx("option",{value:"high",children:"High"})]}):a.jsx("span",{className:"p-2 border rounded bg-gray-50 uppercase text-xs font-bold flex items-center text-gray-800",children:j.priority})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Current Status"}),a.jsxs("div",{className:`mt-1 w-full p-2 border rounded bg-gray-50 text-gray-700 font-bold flex justify-between items-center flex-wrap gap-2 ${Tt?"border-red-300 bg-red-50":"border-gray-200"}`,children:[a.jsx("span",{children:j.status||xe.TODO}),j.status===xe.REVIEW&&a.jsxs("div",{className:"flex gap-1 flex-wrap",children:[((Yd=(po=(is=j.approvals)==null?void 0:is.completion)==null?void 0:po.client)==null?void 0:Yd.status)==="approved"&&((Zd=(Xd=(Jd=j.approvals)==null?void 0:Jd.completion)==null?void 0:Xd.admin)==null?void 0:Zd.status)==="approved"&&a.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded font-normal",children:"Approved by Both"}),((um=(dm=(Oc=j.approvals)==null?void 0:Oc.completion)==null?void 0:dm.client)==null?void 0:um.status)==="approved"&&!((fo=(Mc=(_a=j.approvals)==null?void 0:_a.completion)==null?void 0:Mc.admin)!=null&&fo.status)&&a.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded font-normal",children:"Waiting for Admin Approval"}),((vl=(eu=(Vc=j.approvals)==null?void 0:Vc.completion)==null?void 0:eu.admin)==null?void 0:vl.status)==="approved"&&!((tu=(Lc=(Na=j.approvals)==null?void 0:Na.completion)==null?void 0:Lc.client)!=null&&tu.status)&&a.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded font-normal",children:"Waiting for Client Approval"}),!((ru=(nu=(bl=j.approvals)==null?void 0:bl.completion)==null?void 0:nu.client)!=null&&ru.status)&&!((au=(iu=(su=j.approvals)==null?void 0:su.completion)==null?void 0:iu.admin)!=null&&au.status)&&a.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded font-normal",children:"Under Review"}),(($c=(Ti=(ou=j.approvals)==null?void 0:ou.completion)==null?void 0:Ti.client)==null?void 0:$c.status)==="rejected"&&a.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded font-normal",children:"Rejected by Client"}),((mm=(hm=(Fc=j.approvals)==null?void 0:Fc.completion)==null?void 0:hm.designer)==null?void 0:mm.status)==="rejected"&&a.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded font-normal",children:"Rejected by Designer"})]}),a.jsx("span",{className:"text-xs font-normal text-gray-400 italic",children:Tt?"Frozen by Admin":"Auto-updated via progress"})]})]}),a.jsxs("div",{className:`pt-4 border-t border-gray-100 flex flex-col ${j.subtasks&&j.subtasks.length>0?"h-64 max-h-[400px]":""}`,children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("label",{className:"text-xs font-bold text-gray-700 uppercase block",children:"Checklist"}),Ft&&!Tt&&(!j.subtasks||j.subtasks.length===0)&&a.jsxs("button",{onClick:()=>{const h={id:Math.random().toString(),title:"New Item",isCompleted:!1};ce({...j,subtasks:[...j.subtasks||[],h]}),setTimeout(()=>{const _=document.getElementById("checklist-container");_&&(_.scrollTop=_.scrollHeight)},100)},className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[a.jsx(Oi,{className:"w-3 h-3"})," Add"]})]}),a.jsxs("div",{className:`space-y-2 pr-2 custom-scrollbar ${j.subtasks&&j.subtasks.length>0?"flex-1 overflow-y-auto min-h-[200px] border border-gray-200 rounded-lg p-3":""}`,id:"checklist-container",children:[(go=j.subtasks)==null?void 0:go.map((h,_)=>a.jsxs("div",{className:"flex items-center gap-2 p-2 rounded transition-opacity",style:{opacity:!Ft&&u.id!==j.assigneeId||Fr(j)||Tt?.5:1},children:[a.jsx("button",{type:"button",onClick:()=>{const N=[...j.subtasks||[]];N[_].isCompleted=!N[_].isCompleted,ce({...j,subtasks:N})},disabled:!Ft&&u.id!==j.assigneeId||Fr(j)||Tt,title:"Toggle subtask completion","aria-label":"Toggle subtask completion",className:`flex-shrink-0 w-4 h-4 rounded-full border flex items-center justify-center transition-all duration-200 ${h.isCompleted?"bg-green-500 border-green-500 hover:bg-green-600 hover:border-green-600":"border-gray-400 hover:border-green-400 hover:bg-green-50"} disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent disabled:hover:border-gray-300`,children:h.isCompleted&&a.jsx(Fl,{className:"w-3 h-3 text-white"})}),Ft?a.jsx("input",{type:"text",value:h.title,placeholder:"New Item",disabled:Tt,onFocus:N=>{if(h.title==="New Item"){const S=[...j.subtasks||[]];S[_].title="",ce({...j,subtasks:S})}},onChange:N=>{const S=[...j.subtasks||[]];S[_].title=N.target.value,ce({...j,subtasks:S})},className:"flex-1 p-1 border-b border-transparent focus:border-gray-300 outline-none text-sm bg-white text-gray-900 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"}):a.jsx("span",{className:`flex-1 text-sm pointer-events-none ${h.isCompleted?"line-through text-gray-400":"text-gray-800"}`,children:h.title}),Ft&&!Tt&&a.jsx("button",{onClick:()=>{var S;const N=(S=j.subtasks)==null?void 0:S.filter(A=>A.id!==h.id);ce({...j,subtasks:N})},className:"text-gray-300 hover:text-red-500",title:"Delete subtask","aria-label":"Delete subtask",children:a.jsx(mn,{className:"w-4 h-4"})})]},h.id)),(!j.subtasks||j.subtasks.length===0)&&a.jsx("p",{className:"text-xs text-gray-400 italic",children:"No checklist items"}),Ft&&!Tt&&j.subtasks&&j.subtasks.length>0&&a.jsxs("button",{id:"add-checklist-btn",onClick:h=>{const _={id:Math.random().toString(),title:"New Item",isCompleted:!1};ce({...j,subtasks:[...j.subtasks||[],_]}),setTimeout(()=>{const N=document.getElementById("checklist-container");N&&(N.scrollTop=N.scrollHeight)},100)},className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1 mt-2 pt-2",children:[a.jsx(Oi,{className:"w-3 h-3"})," Add Item"]})]})]})]})}),a.jsxs("div",{className:`w-full md:w-1/2 flex flex-col bg-gray-50/50 ${K==="details"?"hidden md:flex":"flex"}`,children:[j.approvals&&a.jsxs("div",{className:"p-4 border-b border-gray-200 bg-white",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(qx,{className:"w-4 h-4 text-gray-500"}),a.jsx("h4",{className:"text-sm font-bold text-gray-700 uppercase",children:"Approvals"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-100",children:[a.jsx("p",{className:"text-sm font-bold text-gray-500 mb-2",children:"1. Start Approval"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Client"}),((cu=(lu=(pm=j.approvals)==null?void 0:pm.start)==null?void 0:lu.client)==null?void 0:cu.status)==="pending"?Is&&!Tt?a.jsxs("div",{className:"flex gap-1 pointer-events-auto",children:[a.jsx("button",{onClick:()=>ss("start","approve"),disabled:Ve==="start-approve-client",className:"p-1 hover:bg-green-100 text-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve start",children:Ve==="start-approve-client"?a.jsx(Rt,{size:"sm",color:"currentColor"}):a.jsx(rp,{className:"w-3 h-3"})}),a.jsx("button",{onClick:()=>ss("start","reject"),disabled:Ve==="start-reject-client",className:"p-1 hover:bg-red-100 text-red-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Reject start",children:Ve==="start-reject-client"?a.jsx(Rt,{size:"sm",color:"currentColor"}):a.jsx(np,{className:"w-3 h-3"})})]}):a.jsx("span",{className:"text-xs text-gray-400 italic",children:"Pending"}):a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:`text-sm font-bold px-1.5 py-0.5 rounded capitalize ${((wl=(Bc=(sn=j.approvals)==null?void 0:sn.start)==null?void 0:Bc.client)==null?void 0:wl.status)==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:(Uc=(du=(xo=j.approvals)==null?void 0:xo.start)==null?void 0:du.client)==null?void 0:Uc.status}),Mt&&!Tt&&!(((Ia=(_l=(yo=j.approvals)==null?void 0:yo.start)==null?void 0:_l.client)==null?void 0:Ia.status)==="approved"&&((gm=(fm=(uu=j.approvals)==null?void 0:uu.start)==null?void 0:fm.admin)==null?void 0:gm.status)==="approved")&&a.jsx("button",{onClick:()=>ss("start","revoke","client"),disabled:Ve==="start-revoke-client",className:"p-1 hover:bg-gray-100 text-gray-600 rounded text-[10px] font-bold disabled:opacity-50 disabled:cursor-not-allowed",title:"Revoke approval",children:""})]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Admin"}),((Il=(Nl=(hu=j.approvals)==null?void 0:hu.start)==null?void 0:Nl.admin)==null?void 0:Il.status)==="pending"?Mt&&!Tt?a.jsxs("div",{className:"flex gap-1 pointer-events-auto",children:[a.jsx("button",{onClick:()=>ss("start","approve"),disabled:Ve==="start-approve-admin",className:"p-1 hover:bg-green-100 text-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve start",children:Ve==="start-approve-admin"?a.jsx(Rt,{size:"sm",color:"currentColor"}):a.jsx(rp,{className:"w-3 h-3"})}),a.jsx("button",{onClick:()=>ss("start","reject"),disabled:Ve==="start-reject-admin",className:"p-1 hover:bg-red-100 text-red-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Reject start",children:Ve==="start-reject-admin"?a.jsx(Rt,{size:"sm",color:"currentColor"}):a.jsx(np,{className:"w-3 h-3"})})]}):a.jsx("span",{className:"text-xs text-gray-400 italic",children:"Pending"}):a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:`text-sm font-bold px-1.5 py-0.5 rounded capitalize ${((Wc=(qc=(zc=j.approvals)==null?void 0:zc.start)==null?void 0:qc.admin)==null?void 0:Wc.status)==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:(mu=(xm=(Hc=j.approvals)==null?void 0:Hc.start)==null?void 0:xm.admin)==null?void 0:mu.status}),Mt&&!Tt&&!(((Gc=(vm=(ym=j.approvals)==null?void 0:ym.start)==null?void 0:vm.client)==null?void 0:Gc.status)==="approved"&&((Ea=(pu=(Si=j.approvals)==null?void 0:Si.start)==null?void 0:pu.admin)==null?void 0:Ea.status)==="approved")&&a.jsx("button",{onClick:()=>ss("start","revoke","admin"),disabled:Ve==="start-revoke-admin",className:"p-1 hover:bg-gray-100 text-gray-600 rounded text-[10px] font-bold disabled:opacity-50 disabled:cursor-not-allowed",title:"Revoke approval",children:""})]})]})]})]}),a.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-100",children:[a.jsx("p",{className:"text-sm font-bold text-gray-500 mb-2",children:"2. End Approval"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Client"}),((Xs=(vo=(As=j.approvals)==null?void 0:As.completion)==null?void 0:vo.client)==null?void 0:Xs.status)==="pending"?Is&&!Tt?a.jsxs("div",{className:"flex gap-1 pointer-events-auto",children:[a.jsx("button",{onClick:()=>ss("completion","approve"),disabled:Ve==="completion-approve-client",className:"p-1 hover:bg-green-100 text-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve completion",children:Ve==="completion-approve-client"?a.jsx(Rt,{size:"sm",color:"currentColor"}):a.jsx(rp,{className:"w-3 h-3"})}),a.jsx("button",{onClick:()=>ss("completion","reject"),disabled:Ve==="completion-reject-client",className:"p-1 hover:bg-red-100 text-red-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Reject completion",children:Ve==="completion-reject-client"?a.jsx(Rt,{size:"sm",color:"currentColor"}):a.jsx(np,{className:"w-3 h-3"})})]}):a.jsx("span",{className:"text-xs text-gray-400 italic",children:"Pending"}):a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:`text-xs font-bold px-1.5 py-0.5 rounded capitalize ${((wm=(bm=(Kc=j.approvals)==null?void 0:Kc.completion)==null?void 0:bm.client)==null?void 0:wm.status)==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:(Ta=(bo=(Gi=j.approvals)==null?void 0:Gi.completion)==null?void 0:bo.client)==null?void 0:Ta.status}),Mt&&!Tt&&!(((Sa=(Qc=(El=j.approvals)==null?void 0:El.completion)==null?void 0:Qc.client)==null?void 0:Sa.status)==="approved"&&((Jt=(an=(Ai=j.approvals)==null?void 0:Ai.completion)==null?void 0:an.admin)==null?void 0:Jt.status)==="approved")&&a.jsx("button",{onClick:()=>ss("completion","revoke","client"),disabled:Ve==="completion-revoke-client",className:"p-1 hover:bg-gray-100 text-gray-600 rounded text-[10px] font-bold disabled:opacity-50 disabled:cursor-not-allowed",title:"Revoke approval",children:""})]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Admin"}),((cr=(Qn=(ji=j.approvals)==null?void 0:ji.completion)==null?void 0:Qn.admin)==null?void 0:cr.status)==="pending"?Mt&&!Tt?a.jsxs("div",{className:"flex gap-1 pointer-events-auto",children:[a.jsx("button",{onClick:()=>ss("completion","approve"),disabled:Ve==="completion-approve-admin",className:"p-1 hover:bg-green-100 text-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Approve completion",children:Ve==="completion-approve-admin"?a.jsx(Rt,{size:"sm",color:"currentColor"}):a.jsx(rp,{className:"w-3 h-3"})}),a.jsx("button",{onClick:()=>ss("completion","reject"),disabled:Ve==="completion-reject-admin",className:"p-1 hover:bg-red-100 text-red-600 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Reject completion",children:Ve==="completion-reject-admin"?a.jsx(Rt,{size:"sm",color:"currentColor"}):a.jsx(np,{className:"w-3 h-3"})})]}):a.jsx("span",{className:"text-xs text-gray-400 italic",children:"Pending"}):a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:`text-xs font-bold px-1.5 py-0.5 rounded capitalize ${((dr=(Aa=(Ki=j.approvals)==null?void 0:Ki.completion)==null?void 0:Aa.admin)==null?void 0:dr.status)==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:(gu=(fu=(Tl=j.approvals)==null?void 0:Tl.completion)==null?void 0:fu.admin)==null?void 0:gu.status}),Mt&&!Tt&&!(((Zs=(xu=(Sl=j.approvals)==null?void 0:Sl.completion)==null?void 0:xu.client)==null?void 0:Zs.status)==="approved"&&((yu=(Yc=(Al=j.approvals)==null?void 0:Al.completion)==null?void 0:Yc.admin)==null?void 0:yu.status)==="approved")&&a.jsx("button",{onClick:()=>ss("completion","revoke","admin"),disabled:Ve==="completion-revoke-admin",className:"p-1 hover:bg-gray-100 text-gray-600 rounded text-[10px] font-bold disabled:opacity-50 disabled:cursor-not-allowed",title:"Revoke approval",children:""})]})]})]})]})]})]}),a.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:a.jsxs("button",{onClick:()=>{bt(null),gi(!0)},className:"w-full flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors group",title:"View task documents",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Pu,{className:"w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-xs font-bold text-blue-900 uppercase",children:"Task Documents"}),j.documents&&yl(j.documents)>0&&a.jsx("span",{className:"bg-blue-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full",children:yl(j.documents)})]}),a.jsx($a,{className:"w-4 h-4 text-blue-600 group-hover:translate-x-0.5 transition-transform"})]})}),a.jsxs("div",{className:"flex-1 flex flex-col p-4 overflow-hidden",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(tp,{className:"w-4 h-4 text-gray-500"}),a.jsx("h4",{className:"text-sm font-bold text-gray-700 uppercase",children:"Comments"})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 mb-4 pr-1",children:[((_m=j.comments)==null?void 0:_m.length)===0&&a.jsx("p",{className:"text-center text-sm text-gray-400 py-4",children:"No comments yet. Start the discussion!"}),(ki=j.comments)==null?void 0:ki.map(h=>{const _=h.userId===u.id;return a.jsx("div",{className:`flex gap-2 ${_?"flex-row-reverse":""}`,children:a.jsxs("div",{className:`p-2 rounded-lg max-w-[85%] text-sm ${_?"bg-blue-100 text-blue-900":"bg-white border border-gray-200 text-gray-700"}`,children:[a.jsx("p",{className:"text-xs font-bold opacity-70 mb-1",children:Tn(h.userId,h.userName)}),a.jsx("p",{children:h.text}),a.jsx("p",{className:"text-xs opacity-60 mt-1 text-right",children:Mx(h.timestamp)})]})},h.id)}),a.jsx("div",{ref:le})]}),a.jsxs("div",{className:`relative ${Tt?"opacity-50 pointer-events-none":""}`,children:[a.jsx("input",{type:"text",className:"w-full p-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm bg-white text-gray-900",placeholder:"Type a message...",value:pe,onChange:h=>P(h.target.value),onKeyDown:h=>h.key==="Enter"&&om(),disabled:Tt}),a.jsx("button",{onClick:om,disabled:Tt,className:"absolute right-2 top-1/2 -translate-y-1/2 text-blue-600 hover:text-blue-800",title:"Send comment",children:a.jsx(ox,{className:"w-4 h-4"})})]})]})]})]}),a.jsxs("div",{className:"p-4 border-t border-gray-100 flex justify-between items-center bg-white",children:[a.jsx("div",{children:Mt&&j.id&&a.jsxs("button",{onClick:tg,className:"px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center gap-2",title:"Delete this task permanently",children:[a.jsx(Ma,{className:"w-4 h-4"})," Delete Task"]})}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>he(!1),className:"px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 rounded-lg",title:"Cancel",children:"Cancel"}),(!Tt||Mt)&&a.jsx("button",{onClick:gl,disabled:Te,className:"px-6 py-2 text-sm font-bold bg-gray-900 text-white rounded-lg hover:bg-gray-800 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",title:"Save task",children:Te?a.jsxs(a.Fragment,{children:[a.jsx(Rt,{size:"sm",color:"currentColor"}),j.id?"Saving...":"Creating..."]}):a.jsx(a.Fragment,{children:j.id?"Save Changes":"Create Task"})})]})]})]})}),document.body),wt&&it&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Va,{className:"w-5 h-5 text-gray-400"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-bold text-gray-900",children:it.name}),a.jsxs("p",{className:"text-xs text-gray-500",children:["Uploaded ",dn(it.uploadDate)]})]})]}),a.jsx("button",{onClick:()=>_t(!1),className:"text-gray-400 hover:text-gray-600",title:"Close document modal",children:a.jsx(mn,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"flex-1 max-h-[45%] overflow-hidden bg-gray-50 flex items-center justify-center",children:it.type==="image"?a.jsx("img",{src:it.url||$x,alt:it.name,className:"max-h-full max-w-full object-contain"}):it.type==="pdf"?a.jsxs("div",{className:"text-center space-y-4",children:[a.jsxs("div",{className:"w-24 h-32 mx-auto bg-gradient-to-br from-red-50 to-red-100 rounded-lg flex flex-col items-center justify-center border-2 border-red-200",children:[a.jsx(Va,{className:"w-12 h-12 text-red-500 mb-2"}),a.jsx("span",{className:"text-xs font-bold text-red-600 uppercase",children:"PDF"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-700 font-medium mb-2",children:it.name}),a.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"PDF documents cannot be previewed in-browser"})]}),a.jsx("button",{onClick:()=>window.open(it.url,"_blank"),className:"px-4 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800",children:"Open PDF in New Tab"})]}):a.jsxs("div",{className:"text-center space-y-4",children:[a.jsxs("div",{className:"w-24 h-32 mx-auto bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg flex flex-col items-center justify-center border-2 border-blue-200",children:[a.jsx(Va,{className:"w-12 h-12 text-blue-500 mb-2"}),a.jsx("span",{className:"text-xs font-bold text-blue-600 uppercase",children:it.type})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-700 font-medium mb-2",children:it.name}),a.jsxs("p",{className:"text-gray-500 text-sm mb-4",children:[it.type.toUpperCase()," files cannot be previewed in-browser"]})]}),a.jsx("button",{onClick:()=>window.open(it.url,"_blank"),className:"px-4 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800",children:"Open in New Tab"})]})}),a.jsxs("div",{className:"border-t border-gray-100 flex flex-col flex-1 min-h-[45%] bg-white",children:[a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[a.jsxs("h4",{className:"text-xs font-bold text-gray-700 uppercase mb-3",children:["Comments (",((ja=it.comments)==null?void 0:ja.length)||0,")"]}),it.comments&&it.comments.length===0?a.jsx("p",{className:"text-center text-xs text-gray-400 py-4",children:"No comments yet. Start discussing!"}):(ka=it.comments)==null?void 0:ka.map(h=>a.jsx("div",{className:"flex gap-2",children:a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-[10px] font-bold text-gray-700",children:Tn(h.userId,h.userName)}),a.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:h.text}),a.jsx("p",{className:"text-[9px] text-gray-400 mt-1",children:Mx(h.timestamp)})]})},h.id))]}),a.jsxs("div",{className:"p-3 border-t border-gray-100 flex gap-2",children:[a.jsx("input",{type:"text",placeholder:"Add a comment...",value:Gt,onChange:h=>cn(h.target.value),onKeyDown:h=>h.key==="Enter"&&!yr&&Ut(),disabled:yr,className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-900 disabled:opacity-50"}),a.jsx("button",{onClick:Ut,disabled:!Gt.trim()||yr,className:"px-3 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800 disabled:opacity-50",title:"Send comment",children:yr?a.jsx(Rt,{size:"sm",className:"text-white"}):a.jsx(ox,{className:"w-4 h-4"})})]})]})]})}),document.body),ro&&or&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[10000] flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200 overflow-hidden",children:[a.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(Xi,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Task?"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete the task ",a.jsxs("span",{className:"font-bold text-gray-900",children:['"',or.title,'"']}),"?"]}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-xs text-red-700",children:[a.jsx("span",{className:"font-bold",children:" Warning:"})," This task will be removed from the project immediately. All associated data will be lost."]})})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[a.jsx("button",{onClick:()=>{Bi(!1),Ui(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),a.jsxs("button",{onClick:eg,className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm task deletion",children:[a.jsx(Ma,{className:"w-4 h-4"})," Delete Task"]})]})]})}),document.body),Zr&&wr&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[10000] flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200",children:[a.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(Xi,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Meeting?"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete the meeting ",a.jsxs("span",{className:"font-bold text-gray-900",children:['"',wr.title,'"']}),"?"]}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-xs text-red-700",children:[a.jsx("span",{className:"font-bold",children:" Warning:"})," This meeting and all associated comments will be removed from the project immediately."]})})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[a.jsx("button",{onClick:()=>{bi(!1),Ws(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),a.jsxs("button",{onClick:()=>{wr&&(Qs(wr.id,wr.title),bi(!1),Ws(null))},className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm meeting deletion",children:[a.jsx(Ma,{className:"w-4 h-4"})," Delete Meeting"]})]})]})}),document.body),$t&&Hs&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[10000] flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200",children:[a.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(Xi,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Document?"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete the document ",a.jsxs("span",{className:"font-bold text-gray-900",children:['"',Hs.name,'"']}),"?"]}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-xs text-red-700",children:[a.jsx("span",{className:"font-bold",children:"Warning:"})," This document will be permanently removed from the project and any tasks it is attached to."]})})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[a.jsx("button",{onClick:()=>{ws(!1),wi(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),a.jsxs("button",{onClick:R,className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm document deletion",children:[a.jsx(ks,{className:"w-4 h-4"})," Delete Document"]})]})]})}),document.body),al&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[10000] flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200 overflow-hidden",children:[a.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(Xi,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Remove Lead Designer?"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This will unassign the primary designer."})]})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to remove ",a.jsxs("span",{className:"font-bold text-gray-900",children:['"',Tn(n.leadDesignerId),'"']})," as the Lead Designer of this project?"]}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-xs text-red-700",children:[a.jsx("span",{className:"font-bold",children:" Warning:"})," This designer will no longer be the primary contact for this project. They can still be added as a team member."]})})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[a.jsx("button",{onClick:()=>fa(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel removal",children:"Cancel"}),a.jsxs("button",{onClick:async()=>{try{fa(!1),C("Updating Project...");const h={...n,leadDesignerId:""};await g(n.id,{leadDesignerId:""}),t(h),p("Success","Lead Designer removed from project","success")}catch(h){p("Error",h.message||"Failed to remove lead designer","error")}finally{H()}},className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm removal",children:[a.jsx(Ma,{className:"w-4 h-4"})," Remove Designer"]})]})]})}),document.body),Ot&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:Ot.name}),a.jsx("p",{className:"text-sm text-gray-500",children:"Billing Report"})]})}),a.jsx("button",{onClick:()=>zi(null),className:"text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-full transition-colors",title:"Close vendor billing panel",children:a.jsx(mn,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:kt.filter(h=>{const _=h.adminApproved&&h.clientApproved,N=S=>S?S.includes("(")?S.split("(")[0].trim():S.trim():"";return _&&(h.vendorName===Ot.name||N(h.receivedByName)===Ot.name||N(h.paidByOther)===Ot.name||h.paidTo===Ot.name||h.receivedBy===Ot.name)}).length===0?a.jsx("div",{className:"text-center py-10 text-gray-400 border-2 border-dashed border-gray-100 rounded-xl",children:"No approved billing records found for this vendor."}):a.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:a.jsxs("table",{className:"w-full text-sm text-left",children:[a.jsx("thead",{className:"bg-gray-50 border-b border-gray-200 text-gray-600 font-semibold",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3",children:"Date"}),a.jsx("th",{className:"px-4 py-3",children:"Paid By"}),a.jsx("th",{className:"px-4 py-3",children:"Received By"}),a.jsx("th",{className:"px-4 py-3",children:"Description"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"Amount"}),a.jsx("th",{className:"px-4 py-3 text-center",children:"Approvals"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-100",children:kt.filter(h=>{const _=h.adminApproved&&h.clientApproved,N=S=>S?S.includes("(")?S.split("(")[0].trim():S.trim():"";return _&&(h.vendorName===Ot.name||N(h.receivedByName)===Ot.name||N(h.paidByOther)===Ot.name||h.paidTo===Ot.name||h.receivedBy===Ot.name)}).sort((h,_)=>new Date(_.date).getTime()-new Date(h.date).getTime()).map(h=>{var _;return a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-gray-600 whitespace-nowrap",children:h.date}),a.jsx("td",{className:"px-4 py-3",children:a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"font-bold text-gray-900 text-xs",children:h.type==="income"?h.paidTo||h.paidByOther||"-":h.vendorName||"-"}),a.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx("span",{className:`flex-shrink-0 font-medium text-sm md:text-xs ${h.paidBy==="client"?"text-blue-700":h.paidBy==="vendor"?"text-purple-700":h.paidBy==="designer"?"text-orange-700":h.paidBy==="admin"?"text-red-700":"text-gray-700"}`,children:h.type==="income"?(()=>{const N=e.find(S=>S.name===(h.paidTo||h.paidByOther));return(N==null?void 0:N.role)===L.CLIENT?"Client":(N==null?void 0:N.role)===L.VENDOR?"Vendor":(N==null?void 0:N.role)===L.DESIGNER?"Designer":(N==null?void 0:N.role)===L.ADMIN?"Admin":h.paidBy==="client"?"Client":h.paidBy==="vendor"?"Vendor":h.paidBy==="designer"?"Designer":h.paidBy==="admin"?"Admin":"N/A"})():h.paidBy==="client"?"Client":h.paidBy==="vendor"?"Vendor":h.paidBy==="designer"?"Designer":h.paidBy==="admin"?"Admin":"N/A"})]})]})}),a.jsx("td",{className:"px-4 py-3",children:a.jsxs("div",{className:"flex flex-col gap-0.5",children:[a.jsx("div",{className:"font-bold text-gray-900 text-xs",children:h.receivedBy?h.receivedBy.includes("(")?h.receivedBy.split("(")[0].trim():h.receivedBy:"-"}),a.jsx("div",{className:"flex flex-col gap-1 text-xs",children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx("span",{className:`flex-shrink-0 font-medium text-xs ${h.receivedBy?(()=>{var A;const N=e.find(oe=>{var Y;return oe.name===((Y=h.receivedBy)!=null&&Y.includes("(")?h.receivedBy.split("(")[0].trim():h.receivedBy)}),S=(N==null?void 0:N.role)||((A=h.receivedBy)!=null&&A.includes("(")?h.receivedBy.split("(")[1].replace(")","").trim():"");return S===L.CLIENT||S==="Client"?"text-blue-700":S===L.VENDOR||S==="Vendor"?"text-purple-700":S===L.DESIGNER||S==="Designer"?"text-orange-700":S===L.ADMIN||S==="Admin"?"text-red-700":"text-gray-700"})():"text-gray-700"}`,children:h.receivedBy&&h.receivedBy.includes("(")?h.receivedBy.split("(")[1].replace(")","").trim():((_=e.find(N=>N.name===h.receivedBy))==null?void 0:_.role)||"Vendor"})]})})]})}),a.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:h.description}),a.jsxs("td",{className:"px-4 py-3 text-right font-bold text-gray-800",children:["",h.amount.toLocaleString()]}),a.jsxs("td",{className:"px-4 py-3 text-center",children:[(h.isClientPayment||h.type==="income")&&a.jsxs("div",{className:"flex items-center gap-3 justify-center",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),(h.clientApprovalForPayment==="approved"||h.clientApproved===!0)&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.clientApprovalForPayment==="rejected"&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.clientApprovalForPayment==="pending"||h.clientApprovalForPayment===void 0||h.clientApprovalForPayment===null)&&!h.clientApproved&&(u==null?void 0:u.role)===L.CLIENT&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>Kn(h.id,"client","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Confirm payment",disabled:ge===`approve-payment-${h.id}-client-approved`,children:ge===`approve-payment-${h.id}-client-approved`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>Kn(h.id,"client","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Dispute payment",disabled:ge===`approve-payment-${h.id}-client-rejected`,children:ge===`approve-payment-${h.id}-client-rejected`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""})]}),(h.clientApprovalForPayment==="pending"||h.clientApprovalForPayment===void 0||h.clientApprovalForPayment===null)&&!h.clientApproved&&(u==null?void 0:u.role)!==L.CLIENT&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),(h.adminApprovalForPayment==="approved"||h.adminApproved===!0)&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.adminApprovalForPayment==="rejected"&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.adminApprovalForPayment==="pending"||h.adminApprovalForPayment===void 0||h.adminApprovalForPayment===null)&&!h.adminApproved&&(u==null?void 0:u.role)===L.ADMIN&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>Kn(h.id,"admin","approved"),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve payment",disabled:ge===`approve-payment-${h.id}-admin-approved`,children:ge===`approve-payment-${h.id}-admin-approved`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>Kn(h.id,"admin","rejected"),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject payment",disabled:ge===`approve-payment-${h.id}-admin-rejected`,children:ge===`approve-payment-${h.id}-admin-rejected`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""})]}),(h.adminApprovalForPayment==="pending"||h.adminApprovalForPayment===void 0||h.adminApprovalForPayment===null)&&!h.adminApproved&&(u==null?void 0:u.role)!==L.ADMIN&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),h.type==="expense"&&a.jsxs("div",{className:"flex items-center gap-3 justify-center",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"C:"}),h.clientApproved===!0&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.clientApproved===!1&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.clientApproved===void 0||h.clientApproved===null)&&(u==null?void 0:u.role)===L.CLIENT&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>Mn(h.id,"client",!0),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve expense",disabled:ge===`approve-expense-${h.id}-client-true`,children:ge===`approve-expense-${h.id}-client-true`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>Mn(h.id,"client",!1),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject expense",disabled:ge===`approve-expense-${h.id}-client-false`,children:ge===`approve-expense-${h.id}-client-false`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""})]}),(h.clientApproved===void 0||h.clientApproved===null)&&(u==null?void 0:u.role)!==L.CLIENT&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"A:"}),h.adminApproved===!0&&a.jsx("span",{className:"bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),h.adminApproved===!1&&a.jsx("span",{className:"bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold text-xs",children:""}),(h.adminApproved===void 0||h.adminApproved===null)&&(u==null?void 0:u.role)===L.ADMIN&&a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx("button",{onClick:()=>Mn(h.id,"admin",!0),className:"text-white bg-green-600 hover:bg-green-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Approve expense",disabled:ge===`approve-expense-${h.id}-admin-true`,children:ge===`approve-expense-${h.id}-admin-true`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""}),a.jsx("button",{onClick:()=>Mn(h.id,"admin",!1),className:"text-white bg-red-600 hover:bg-red-700 font-bold text-xs px-1.5 py-0.5 rounded transition-colors cursor-pointer flex items-center justify-center min-w-[20px]",title:"Reject expense",disabled:ge===`approve-expense-${h.id}-admin-false`,children:ge===`approve-expense-${h.id}-admin-false`?a.jsx(Rt,{size:"sm",color:"currentColor"}):""})]}),(h.adminApproved===void 0||h.adminApproved===null)&&(u==null?void 0:u.role)!==L.ADMIN&&a.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]})]}),!h.isAdditionalBudget&&!h.isClientPayment&&h.type!=="expense"&&a.jsx("span",{className:"text-xs text-gray-300",children:"-"})]})]},h.id)})})]})})}),a.jsx("div",{className:"p-6 border-t border-gray-100 bg-gray-50",children:(()=>{const h=kt.filter(Y=>{const Z=Y.adminApproved&&Y.clientApproved,De=Je=>Je?Je.includes("(")?Je.split("(")[0].trim():Je.trim():"";return Z&&(Y.vendorName===Ot.name||De(Y.receivedByName)===Ot.name||De(Y.paidByOther)===Ot.name||Y.paidTo===Ot.name||Y.receivedBy===Ot.name)}),_=h.filter(Y=>(De=>De?De.includes("(")?De.split("(")[0].trim():De.trim():"")(Y.receivedByName)===Ot.name||Y.receivedBy===Ot.name).reduce((Y,Z)=>Y+Z.amount,0),N=h.filter(Y=>{const Z=De=>De?De.includes("(")?De.split("(")[0].trim():De.trim():"";return Y.vendorName===Ot.name||Z(Y.paidByOther)===Ot.name||Y.paidTo===Ot.name}).reduce((Y,Z)=>Y+Z.amount,0),S=_-N,A=S*(ft/100),oe=S+A;return a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"Total Paid To Vendor (Received):"}),a.jsxs("span",{className:"font-medium text-gray-900",children:["",_.toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"Less: Paid By Vendor (Expenses):"}),a.jsxs("span",{className:"font-medium text-red-600",children:["- ",N.toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[a.jsx("span",{className:"font-bold text-gray-800",children:"Net Amount:"}),a.jsxs("span",{className:"font-bold text-gray-900",children:["",S.toLocaleString()]})]}),n.type==="Designing"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200 border-dashed",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-sm font-bold text-gray-700",children:"Designer Charges"}),u.role===L.ADMIN?a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("input",{type:"number",min:"0",max:"100",value:ft,onChange:Y=>es(parseFloat(Y.target.value)||0),className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:border-blue-500","aria-label":"Designer Charges Percentage",title:"Enter designer charges percentage",placeholder:"0"}),a.jsx("span",{className:"text-sm text-gray-500",children:"%"})]}):a.jsxs("span",{className:"text-sm text-gray-500",children:["(",ft,"%)"]})]}),a.jsxs("div",{className:"text-md font-semibold text-orange-700",children:["+ ",A.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),a.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-300",children:[a.jsx("div",{className:"text-base font-bold text-gray-800",children:"Final Payable"}),a.jsxs("div",{className:"text-xl font-bold text-gray-900",children:["",oe.toLocaleString(void 0,{maximumFractionDigits:2})]})]})]})]})})()})]})}),document.body),_s&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:_s.name}),a.jsx("p",{className:"text-sm text-gray-500",children:"Designer Details & Projects"})]})}),a.jsxs("div",{className:"flex items-center gap-2",children:[Ft&&a.jsx("button",{onClick:()=>{p("Info","Designer edit functionality coming soon","info")},className:"text-emerald-600 hover:text-emerald-700 text-sm font-medium px-3 py-1.5 hover:bg-emerald-50 rounded transition-colors",title:"Edit designer details",children:"Edit"}),a.jsx("button",{onClick:()=>ao(null),className:"text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-full transition-colors",title:"Close designer details",children:a.jsx(mn,{className:"w-5 h-5"})})]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[a.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 border border-gray-100",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 font-semibold uppercase",children:"Name"}),a.jsx("p",{className:"text-sm font-bold text-gray-900 mt-1",children:_s.name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 font-semibold uppercase",children:"Specialty"}),a.jsx("p",{className:"text-sm font-bold text-gray-900 mt-1",children:_s.specialty||"General Design"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 font-semibold uppercase",children:"Email"}),a.jsx("p",{className:"text-sm text-gray-700 mt-1",children:_s.email})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 font-semibold uppercase",children:"Phone"}),a.jsx("p",{className:"text-sm text-gray-700 mt-1",children:_s.phone||"N/A"})]})]})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-bold text-gray-800 mb-4",children:"Assigned Projects"}),n.tasks.filter(h=>h.assigneeId===_s.id).length===0?a.jsx("div",{className:"text-center py-8 text-gray-400 border-2 border-dashed border-gray-100 rounded-lg",children:"No tasks assigned to this designer in this project."}):a.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left font-bold text-gray-700 text-sm",children:"Project Name"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Work Progress"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Percentage"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Deadline"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Pending Tasks"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-sm",children:"Completed Tasks"})]})}),a.jsx("tbody",{children:(()=>{const h=n.tasks.filter(A=>A.assigneeId===_s.id),_=h.filter(A=>A.status===xe.DONE).length,N=h.filter(A=>{var Je,je,Fe,et,tt,St;const oe=((Fe=(je=(Je=A==null?void 0:A.approvals)==null?void 0:Je.completion)==null?void 0:je.admin)==null?void 0:Fe.status)==="approved",Y=(St=(tt=(et=A==null?void 0:A.approvals)==null?void 0:et.completion)==null?void 0:tt.client)==null?void 0:St.status,Z=!Y||Y==="pending";return A.status===xe.DONE&&oe&&Z?!1:A.status!==xe.DONE&&A.status!==xe.REVIEW}).length,S=h.length>0?Math.round(_/h.length*100):0;return a.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-left text-gray-900 font-medium text-xs",children:n.name}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 max-w-xs mx-auto",children:a.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all",style:{width:`${S}%`}})})}),a.jsxs("td",{className:"px-4 py-3 text-center font-semibold text-gray-900 text-xs",children:[S,"%"]}),a.jsx("td",{className:"px-4 py-3 text-center text-gray-600 text-xs whitespace-nowrap",children:dn(n.deadline)}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("span",{className:"inline-flex items-center justify-center px-2.5 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800",children:N})}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("span",{className:"inline-flex items-center justify-center px-2.5 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:_})})]})})()})]})})]})]}),a.jsx("div",{className:"p-6 border-t border-gray-100 bg-gray-50",children:(()=>{const h=n.tasks.filter(S=>S.assigneeId===_s.id),_=h.filter(S=>S.status===xe.DONE).length,N=h.length;return a.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Total Project Tasks"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:N})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Completed"}),a.jsx("p",{className:"text-2xl font-bold text-green-600 mt-1",children:_})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Remaining"}),a.jsx("p",{className:"text-2xl font-bold text-orange-600 mt-1",children:N-_})]})]})})()})]})}),document.body),ll&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col animate-fade-in overflow-hidden",children:[a.jsxs("div",{className:"p-4 md:p-6 border-b border-gray-200 bg-gradient-to-r from-emerald-50 to-green-50 flex-shrink-0",children:[a.jsxs("h3",{className:"text-xl md:text-lg font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(Oi,{className:"w-5 h-5 md:w-4 md:h-4 text-emerald-600"})," Add Additional Budget"]}),a.jsx("p",{className:"text-base md:text-sm text-gray-600 mt-1",children:"Increase the project budget with client approval"})]}),a.jsxs("div",{className:"p-4 md:p-6 space-y-4 flex-1 overflow-y-auto scrollbar-thin",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-base md:text-sm font-medium text-gray-700 mb-2",children:["Budget Amount ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 font-semibold text-lg md:text-base",children:""}),a.jsx("input",{type:"number",value:er,onChange:h=>_i(h.target.value),placeholder:"Enter amount",className:"w-full pl-7 pr-4 py-3 md:py-2 text-base md:text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none",min:"0"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-base md:text-sm font-medium text-gray-700 mb-2",children:"Reason/Description"}),a.jsx("textarea",{value:Mr,onChange:h=>Vr(h.target.value),placeholder:"Why is additional budget needed? (optional)",className:"w-full px-4 py-3 md:py-2 text-base md:text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none resize-none",rows:3})]}),er&&a.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4 md:p-3",children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-base md:text-sm text-gray-600",children:"Current Budget:"}),a.jsxs("span",{className:"text-base md:text-sm font-semibold text-gray-900",children:["",n.budget.toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-base md:text-sm text-gray-600",children:"Additional Amount:"}),a.jsxs("span",{className:"text-base md:text-sm font-semibold text-emerald-600",children:["+",parseFloat(er||"0").toLocaleString()]})]}),a.jsxs("div",{className:"border-t border-emerald-200 pt-2 flex justify-between",children:[a.jsx("span",{className:"text-base md:text-sm font-medium text-gray-900",children:"New Total:"}),a.jsxs("span",{className:"text-base md:text-sm font-bold text-emerald-700",children:["",(n.budget+parseFloat(er||"0")).toLocaleString()]})]})]})})]}),a.jsxs("div",{className:"p-4 md:p-6 border-t border-gray-200 bg-gray-50 flex gap-3 justify-end",children:[a.jsx("button",{onClick:()=>{xa(!1),_i(""),Vr("")},className:"px-4 py-2 md:py-1.5 text-base md:text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),a.jsxs("button",{onClick:async()=>{if(!er||isNaN(parseFloat(er))){p("Validation","Please enter a valid budget amount","error",n.clientId,n.id,n.name);return}const h=parseFloat(er);try{const _=e.find(Y=>Y.id===n.clientId),N=(_==null?void 0:_.name)||"Client",S=e.find(Y=>Y.role===L.ADMIN),A=(S==null?void 0:S.name)||"Admin",oe=await Oy(n.id,{date:new Date().toISOString().split("T")[0],timestamp:new Date().toISOString(),description:Mr||`Additional Budget Increase: ${h.toLocaleString()}`,amount:h,type:"income",category:"Additional Budget",status:"pending",paidBy:"client",paidByOther:N,receivedBy:A,receivedByName:A,receivedByRole:"admin-received",isAdditionalBudget:!0,clientApprovalForAdditionalBudget:"pending",adminApprovalForAdditionalBudget:"pending"});si(n.id,`Budget Increase Requested: ${h.toLocaleString()}`,`Budget increase of ${h.toLocaleString()} requested by ${u.name}. Reason: ${Mr||"Not specified"}. Awaiting Client and Admin approval.`,"in-progress",new Date().toISOString(),new Date().toISOString()),tr("Budget",`Budget increase of ${h.toLocaleString()} requested by ${u.name}. Awaiting approvals. Reason: ${Mr||"Not specified"}`),p("Request",`Budget increase of ${h.toLocaleString()} requested. Awaiting Client and Admin approval.`,"success",n.clientId,n.id,n.name),xa(!1),_i(""),Vr("")}catch(_){console.error("Error creating additional budget record:",_),p("Error","Failed to create additional budget record","error",n.clientId,n.id,n.name)}},className:"px-4 py-2 md:py-1.5 text-base md:text-xs font-bold text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2",children:[a.jsx(Oi,{className:"w-4 h-4 md:w-3 md:h-3"})," Add Budget"]})]})]})}),document.body),a.jsx(cV,{isOpen:bs,onClose:()=>{yi(!1),to(null)},onSubmit:va,onUpdate:ml,teamMembers:hn,isLoading:Sc,editingMeeting:Tc}),gs&&j&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10000] p-4",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-5xl h-[80vh] flex flex-col overflow-hidden",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Pu,{className:"w-5 h-5 text-blue-600"}),a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Task Documents"}),j.documents&&yl(j.documents)>0&&a.jsx("span",{className:"bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full",children:yl(j.documents)})]}),a.jsx("button",{type:"button",onClick:()=>gi(!1),className:"text-gray-500 hover:text-gray-700 p-1 hover:bg-gray-100 rounded transition-colors",title:"Close modal","aria-label":"Close documents modal",children:a.jsx(mn,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:yl(j.documents)>0?a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:rg(j.documents).filter(h=>h.approvalStatus==="pending"?u.role===L.ADMIN||u.role===L.DESIGNER||h.uploadedBy===u.id:h.approvalStatus==="approved"?Array.isArray(h.sharedWith)&&h.sharedWith.includes(u.id)||u.role===L.ADMIN||h.uploadedBy===u.id:h.approvalStatus==="rejected"?u.role===L.ADMIN||u.role===L.DESIGNER||h.uploadedBy===u.id:u.role===L.ADMIN).map(h=>a.jsxs("div",{className:"group relative bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-shadow",children:[a.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2 z-10",children:[a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Comments",onClick:()=>ee(h),children:a.jsx(tp,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"View",onClick:()=>window.open(h.url,"_blank"),children:a.jsx(ax,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-gray-900 hover:bg-gray-100",title:"Download",onClick:()=>y(h),children:a.jsx($b,{className:"w-4 h-4"})}),(h.uploadedBy===u.id||Ft)&&a.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Delete",onClick:()=>I(h),children:a.jsx(ks,{className:"w-4 h-4"})})]}),u.role===L.ADMIN&&h.approvalStatus==="pending"&&a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("button",{className:"p-2 bg-white rounded-full text-green-600 hover:bg-green-50",title:"Approve",onClick:()=>de(h),disabled:ge===`approve-doc-${h.id}`,children:ge===`approve-doc-${h.id}`?a.jsx(Rt,{size:"md",color:"currentColor"}):a.jsx(Fl,{className:"w-4 h-4"})}),a.jsx("button",{className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"Reject",onClick:()=>Re(h),disabled:ge===`reject-doc-${h.id}`,children:ge===`reject-doc-${h.id}`?a.jsx(Rt,{size:"md",color:"currentColor"}):a.jsx(mn,{className:"w-4 h-4"})})]})]}),a.jsx("div",{className:"h-32 bg-gray-100 flex items-center justify-center overflow-hidden relative group",children:h.type==="image"?a.jsx("img",{src:h.url||$x,alt:h.name,className:"w-full h-full object-cover",onError:_=>{var N;_.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNjY2MiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiI+PC9yZWN0PjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ij48L2NpcmNsZT48cG9seWxpbmUgcG9pbnRzPSIyMSAxNSAxNiAxMCA1IDIxIj48L3BvbHlsaW5lPjwvc3ZnPg==",_.currentTarget.className="w-12 h-12 opacity-50",(N=_.currentTarget.parentElement)==null||N.classList.add("flex","items-center","justify-center")}}):h.type==="pdf"?a.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-red-50 to-red-100",children:[a.jsx(Va,{className:"w-12 h-12 text-red-400 mb-2"}),a.jsx("span",{className:"text-xs font-bold text-red-600 uppercase",children:"PDF"})]}):a.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100",children:[a.jsx(Va,{className:"w-12 h-12 text-blue-400 mb-2"}),a.jsx("span",{className:"text-xs font-bold text-blue-600 uppercase",children:h.type})]})}),a.jsxs("div",{className:"p-3",children:[a.jsx("p",{className:"text-sm font-bold text-gray-800 truncate",title:h.name,children:h.name}),a.jsxs("div",{className:"flex justify-between items-center mt-2",children:[a.jsx("span",{className:"text-xs text-gray-400",children:dn(h.uploadDate)}),a.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded ${h.approvalStatus==="pending"?"bg-yellow-100 text-yellow-700":h.approvalStatus==="approved"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:h.approvalStatus==="pending"?"Approval Pending":h.approvalStatus==="approved"?"Approved":"Rejected"})]}),a.jsx("div",{className:"mt-2 flex gap-1 flex-wrap",children:(Array.isArray(h.sharedWith)?h.sharedWith:[]).map(_=>{var S;const N=e.find(A=>A.id===_);return a.jsx("span",{className:"text-[8px] bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded",title:N==null?void 0:N.name,children:((S=N==null?void 0:N.name)==null?void 0:S.split(" ")[0])||"Unknown"},_)})}),h.comments&&h.comments.length>0&&a.jsxs("div",{className:"mt-2 text-xs text-blue-600 font-medium",children:[h.comments.length," ",h.comments.length===1?"comment":"comments"]})]})]},h.id))}):a.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[a.jsx(Pu,{className:"w-16 h-16 text-gray-300 mb-3"}),a.jsx("p",{className:"text-gray-400 font-medium",children:"No documents attached to this task"}),a.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"Upload documents and attach them to this task"})]})}),Ft&&!Tt&&a.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50 flex justify-end",children:a.jsxs("button",{onClick:()=>{gi(!1),ot(!0),On({...ct,attachToTaskId:j.id})},className:"flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors font-semibold text-sm",title:"Add documents to task",children:[a.jsx(Oi,{className:"w-4 h-4"})," Add Documents"]})})]})}),document.body),so&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-start justify-center pt-20 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200",children:[a.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(Xi,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Project?"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Are you sure you want to delete the project ",a.jsxs("span",{className:"font-bold text-gray-900",children:['"',n.name,'"']}),"?"]}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-xs text-red-700",children:[a.jsx("span",{className:"font-bold",children:" Warning:"})," This project and all associated data (tasks, documents, meetings, financials) will be permanently deleted."]})})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[a.jsx("button",{onClick:()=>vi(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),a.jsxs("button",{onClick:ba,className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm project deletion",children:[a.jsx(ks,{className:"w-4 h-4"})," Delete Project"]})]})]})}),document.body),Or&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-start justify-center pt-20 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md animate-fade-in border border-gray-200",children:[a.jsx("div",{className:"p-6 border-b border-gray-100 bg-red-50",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(Xi,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Delete Transaction?"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action cannot be undone."})]})]})}),a.jsxs("div",{className:"p-6",children:[a.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"Are you sure you want to delete this transaction?"}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-xs text-red-700",children:[a.jsx("span",{className:"font-bold",children:" Warning:"})," This financial record will be permanently removed from the project ledger."]})})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-gray-50 rounded-b-xl",children:[a.jsx("button",{onClick:()=>{io(!1),Xr(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Cancel deletion",children:"Cancel"}),a.jsxs("button",{onClick:async()=>{if(br)try{await E(br),p("Transaction Deleted","The transaction was deleted successfully.","success"),io(!1),Xr(null)}catch{p("Error","Failed to delete transaction.","error")}},className:"px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",title:"Confirm transaction deletion",children:[a.jsx(ks,{className:"w-4 h-4"})," Delete Transaction"]})]})]})}),document.body)]})},uV=async n=>{try{const e=It(st,"users",n.id),t=n.role.toLowerCase()+"s",r=It(st,t,n.id),i={name:n.name,email:n.email,role:n.role,phone:n.phone||""};n.company&&(i.company=n.company),n.specialty&&(i.specialty=n.specialty),n.tenantId&&(i.tenantId=n.tenantId),n.tenantIds&&(i.tenantIds=n.tenantIds),await $s(e,i,{merge:!0}),await $s(r,i,{merge:!0})}catch(e){throw console.error("Error updating user in Firebase:",e),new Error(e.message||"Failed to update user")}},aS=async(n,e,t)=>{const r=Xb().find(c=>c.name==="SecondaryApp")||Uy(WT,"SecondaryApp"),i=Xb().find(c=>c.name==="SecondaryApp")?LI(r):wI(r,{persistence:ey}),l=BE(r);try{let c="";n.authMethod==="phone"?c=`phone_${(n.phone||"").replace(/\D/g,"")}`:c=(await IC(i,n.email,n.password)).user.uid;const u=(n.phone||"").replace(/\D/g,"");let p=n.tenantId;if(n.role===L.ADMIN&&!p)try{p=(await A5(pn(l,"tenants"),{name:n.company||`${n.name}'s Organization`,ownerId:c,createdAt:new Date().toISOString(),status:"active"})).id}catch(w){console.error("Error creating tenant document:",w),p=c}const g={id:c,name:n.name,email:n.email,role:n.role,phone:u||"",password:n.password,authMethod:n.authMethod||"email",tenantId:p||c};n.company&&(g.company=n.company),n.specialty&&(g.specialty=n.specialty),n.password&&(g.password=n.password),await $s(It(l,"users",c),g);const b=n.role.toLowerCase()+"s";if(await $s(It(l,b,c),g),n.authMethod==="phone")try{const w=`
          <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background-color: #f9fafb; padding: 20px;">
            <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">
              <h2 style="color: #fff; margin: 0; font-size: 24px;"> Welcome to Kydo Solutions!</h2>
            </div>
            
            <div style="background-color: white; padding: 30px; border-radius: 0 0 8px 8px;">
              <p style="color: #333; font-size: 16px;">Hi <strong>${n.name}</strong>,</p>
              
              <p style="color: #555; font-size: 14px;">Your account has been created on Kydo Solutions. You can now log in using your phone number with OTP (One-Time Password).</p>
              
              <div style="background-color: #f3f4f6; padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #ef4444;">
                <p style="margin: 0; color: #333; font-size: 14px;"><strong>Your Phone Number:</strong></p>
                <p style="margin: 5px 0 15px 0; color: #1f2937; font-size: 16px; font-family: monospace; background: white; padding: 8px; border-radius: 4px;">${n.phone}</p>
                
                <p style="margin: 0; color: #333; font-size: 14px;"><strong>How to Login:</strong></p>
                <ol style="margin: 5px 0 0 0; color: #1f2937; font-size: 14px;">
                  <li>Go to the Kydo Solutions login page</li>
                  <li>Click the "Phone" tab</li>
                  <li>Enter your phone number: ${n.phone}</li>
                  <li>Click "Send OTP"</li>
                  <li>You'll receive an SMS with a 6-digit OTP</li>
                  <li>Enter the OTP and click "Verify OTP"</li>
                </ol>
              </div>
              
              <p style="color: #555; font-size: 14px;">
                <strong>Important:</strong> Keep your phone number safe. You'll need it to log in.
              </p>

              
              <div style="margin-top: 30px; text-align: center;">
                <a href="https://btw-erp.web.app" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 12px 30px; border-radius: 6px; text-decoration: none; display: inline-block; font-weight: 600;">
                  Go to Kydo Solutions
                </a>
              </div>
              
              <p style="color: #9ca3af; font-size: 12px; margin-top: 30px; border-top: 1px solid #e5e7eb; padding-top: 20px;">
                If you have any questions, please contact the administrator.
              </p>
            </div>
          </div>
        `;await Yr({to:n.email,recipientName:n.name,subject:"Welcome to Kydo Solutions - Phone-Based Login Instructions",htmlContent:w})}catch(w){console.error(` Failed to send welcome email to ${n.email}:`,w.message)}else try{const w=`
          <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 600px; margin: 0 auto; background-color: #f9fafb; padding: 20px;">
            <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">
              <h2 style="color: #fff; margin: 0; font-size: 24px;"> Welcome to Kydo Solutions!</h2>
            </div>
            
            <div style="background-color: white; padding: 30px; border-radius: 0 0 8px 8px;">
              <p style="color: #333; font-size: 16px;">Hi <strong>${n.name}</strong>,</p>
              
              <p style="color: #555; font-size: 14px;">Your account has been created on Kydo Solutions. Here are your login credentials:</p>
              
              <div style="background-color: #f3f4f6; padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #ef4444;">
                <p style="margin: 0; color: #333; font-size: 14px;"><strong>Your ID (Email):</strong></p>
                <p style="margin: 5px 0 15px 0; color: #1f2937; font-size: 16px; font-family: monospace; background: white; padding: 8px; border-radius: 4px;">${n.email}</p>
                
                <p style="margin: 0; color: #333; font-size: 14px;"><strong>Your Password:</strong></p>
                <p style="margin: 5px 0 0 0; color: #1f2937; font-size: 16px; font-family: monospace; background: white; padding: 8px; border-radius: 4px;">${n.password}</p>
              </div>
              
              <p style="color: #555; font-size: 14px;">
                <strong>Keep these credentials safe!</strong> You can change your password after logging in for the first time.
              </p>
              
              <div style="margin-top: 30px; text-align: center;">
                <a href="https://btw-erp.web.app" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 12px 30px; border-radius: 6px; text-decoration: none; display: inline-block; font-weight: 600;">
                  Go to Kydo Solutions
                </a>
              </div>
              
              <p style="color: #9ca3af; font-size: 12px; margin-top: 30px; border-top: 1px solid #e5e7eb; padding-top: 20px;">
                If you have any questions, please contact the administrator.
              </p>
            </div>
          </div>
        `;await Yr({to:n.email,recipientName:n.name,subject:"Welcome to Kydo Solutions - Your Account Credentials",htmlContent:w})}catch(w){console.error(` Failed to send welcome email to ${n.email}:`,w.message)}return c}catch(c){throw console.error("Error creating user in Firebase:",c),c.code==="auth/email-already-in-use"?new Error("This email is already registered."):c.code==="auth/weak-password"?new Error("Password is too weak. Use at least 6 characters."):c.code==="auth/invalid-email"?new Error("Invalid email address."):new Error(c.message||"Failed to create user")}finally{try{await uk(r)}catch(c){console.warn("Error deleting secondary app:",c)}}},gp=({users:n,roleFilter:e,onAddUser:t,projects:r=[],onSelectProject:i,onSelectTask:l})=>{var gi;const{user:c,adminCredentials:u}=ha(),{addNotification:p}=sl(),{showLoading:g,hideLoading:b}=tm(),[w,E]=q.useState(!1),[C,H]=q.useState(null),[F,U]=q.useState(!1),[ae,re]=q.useState(null),[J,he]=q.useState(!1),[j,ce]=q.useState(!1),[D,k]=q.useState(null),[O,z]=q.useState(null),[B,K]=q.useState(!1),[M,Ve]=q.useState("email"),[me,Te]=q.useState({role:e==="All"?L.CLIENT:e}),[Se,pe]=q.useState(null),[P,W]=q.useState(!1),[V,le]=q.useState(!1),[we,fe]=q.useState(null),[Ce,ge]=q.useState("email"),[$e,ht]=q.useState({}),[ot,ct]=q.useState(null),[On,nn]=q.useState({}),Ie=r,[Ye,un]=q.useState(null),[fn,it]=q.useState(!1),[bt,wt]=q.useState({});q.useEffect(()=>{if(r.length===0){wt({});return}const ie=[];return r.forEach(_e=>{try{const Be=pn(st,"projects",_e.id,"finances"),We=hi(Be,X=>{const He=X.docs.map(Vt=>({...Vt.data(),id:Vt.id}));wt(Vt=>({...Vt,[_e.id]:He}))},X=>{console.error(`Error listening to financials for project ${_e.id}:`,X)});ie.push(We)}catch(Be){console.error(`Failed to set up listener for project ${_e.id}`,Be)}}),()=>{ie.forEach(_e=>_e())}},[r]),q.useEffect(()=>{},[r]),q.useEffect(()=>{},[bt]),q.useEffect(()=>{C&&(it(!0),da(It(st,"vendors",C.id)).then(ie=>{ie.exists()?un(ie.data()):un(null)}).finally(()=>it(!1)))},[C]);const _t=li.useMemo(()=>{let ie=e==="All"?n.filter(_e=>_e.role!==L.ADMIN):n.filter(_e=>_e.role===e);if((c==null?void 0:c.role)===L.VENDOR&&e===L.ADMIN){const _e=c.tenantIds||[];ie=ie.filter(Be=>_e.length===0||_e.includes(Be.tenantId))}return(c==null?void 0:c.role)===L.DESIGNER&&e===L.CLIENT&&(ie=n6(ie,c.id,r)),ie},[n,e,c,r]),Gt=li.useMemo(()=>{if(e!==L.VENDOR)return null;const ie={};return _t.forEach(_e=>{const Be=_e.specialty||"General";ie[Be]||(ie[Be]=[]),ie[Be].push(_e)}),ie},[_t,e]),cn=li.useMemo(()=>Gt?Object.keys(Gt).sort((ie,_e)=>{const Be=xf.indexOf(ie),We=xf.indexOf(_e);return(Be===-1?999:Be)-(We===-1?999:We)}):[],[Gt]),yr=ie=>ie.startsWith("+91")?"+91 "+ie.slice(3):ie,pi=ie=>{pe(ie);const _e=ie.email&&ie.email.endsWith("@kydo-phone-auth.local");Te({name:ie.name,email:_e?"":ie.email,role:ie.role,phone:ie.phone,company:ie.company,specialty:ie.specialty}),ge(_e?"phone":"email"),E(!0)},Fs=()=>{if(!me.name||!me.role||!me.phone)return W(!0),p("Missing Information","Please fill in all compulsory fields marked with *","error"),!1;if(Se){if(!me.email)return W(!0),p("Missing Information","Please fill in all compulsory fields marked with *","error"),!1}else{if(Ce==="email"&&!me.email)return W(!0),p("Missing Email","Email is required for email-based authentication","error"),!1;if(Ce==="phone"&&!me.phone)return W(!0),p("Missing Phone","Phone number is required for phone-based authentication","error"),!1}return(me.phone||"").replace(/\D/g,"").length<4?(W(!0),p("Invalid Phone","Phone number must have at least 4 digits","error"),!1):!0},fi=async ie=>{if(ie.preventDefault(),!!Fs())try{if(g(`Creating ${me.role}...`),Se){const Vt={...Se,...me};await uV(Vt),p("Success","User profile updated successfully","success"),E(!1),pe(null),Te({role:e==="All"?L.CLIENT:e}),W(!1);return}let _e=me.email;Ce==="phone"&&(_e="");const We=(me.phone||"").replace(/\D/g,"").slice(-6),X=await aS({id:"",name:me.name,email:_e||"",role:me.role,company:me.company||void 0,specialty:me.specialty||void 0,phone:me.phone||void 0,password:We,authMethod:Ce,tenantId:c==null?void 0:c.tenantId},c==null?void 0:c.email,u==null?void 0:u.password),He={id:X,name:me.name,email:Ce==="phone"?"":me.email,role:me.role,company:me.company||void 0,specialty:me.specialty||void 0,phone:me.phone||void 0,password:We,authMethod:Ce};if(p("Success",`${me.role} ${me.name} created successfully!`,"success"),Ce==="phone"){const Vt={id:X,name:me.name,email:"",role:me.role,company:me.company||void 0,specialty:me.specialty||void 0,phone:me.phone||void 0,password:We,authMethod:"phone"};ct(Vt)}E(!1),pe(null),Te({role:e==="All"?L.CLIENT:e}),W(!1)}catch(_e){console.error("Failed to create user:",_e),p("Error",_e.message||"Failed to create user. Please try again.","error")}finally{b()}},Bs=ie=>{H(ie),U(!0)},Jr=ie=>{fe(ie),le(!0)},ma=async ie=>{if(we)try{const _e={...ie};let Be=!1;if(we.role===L.CLIENT){const We=ie.clientIds||[];if(!We.includes(we.id)&&ie.clientId!==we.id)_e.clientIds=[...We,we.id],Be=!0;else{p("Info","User is already a client on this project","info");return}}else{const We=ie.teamMembers||[];if(!We.includes(we.id)&&ie.leadDesignerId!==we.id)_e.teamMembers=[...We,we.id],Be=!0;else{p("Info","User is already in the team","info");return}}if(Be){const We={};we.role===L.CLIENT?We.clientIds=_e.clientIds:We.teamMembers=_e.teamMembers,await rv(ie.id,We),p("Success",`Added ${we.name} to ${ie.name}`,"success"),le(!1),fe(null)}}catch(_e){console.error("Error assigning user:",_e),p("Error","Failed to assign user","error")}},ar=ie=>`
    w-full px-3 py-2 border rounded-lg focus:outline-none transition-all
    bg-white text-gray-900 placeholder-gray-400
    ${P&&!ie?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}
  `,gs=({user:ie,hideRole:_e=!1,hideSpecialty:Be=!1,isVendor:We=!1})=>a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow h-full flex flex-col",children:[a.jsxs("div",{className:"p-6 flex-1",children:[a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[a.jsx(za,{avatar:ie.avatar,name:ie.name,size:"md",role:String(ie.role).toLowerCase()}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-base md:text-sm font-bold text-gray-900",children:ie.name}),ie.company&&a.jsxs("p",{className:"text-xs md:text-xs font-medium text-gray-500 flex items-center gap-1",children:[a.jsx(AN,{className:"w-3 h-3"})," ",ie.company]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[We&&a.jsx("button",{onClick:()=>{k(ie),ce(!0)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View Accounts",children:a.jsx(EA,{className:"w-5 h-5"})}),!_e&&a.jsx("span",{className:`px-2 py-1 rounded text-xs md:text-xs font-bold uppercase tracking-wide
                  ${ie.role===L.CLIENT?"bg-blue-100 text-blue-700":ie.role===L.VENDOR?"bg-orange-100 text-orange-700":"bg-purple-100 text-purple-700"}`,children:ie.role})]})]}),a.jsx("div",{className:"mt-2",children:!Be&&ie.specialty&&a.jsx("p",{className:"text-xs md:text-xs text-gray-400 mt-1",children:ie.specialty})}),a.jsxs("div",{className:"mt-4 space-y-2 border-t border-gray-100 pt-4",children:[ie.email&&!ie.email.endsWith("@kydo-phone-auth.local")&&a.jsxs("a",{href:`mailto:${ie.email}`,className:"flex items-center gap-2 text-base md:text-sm text-gray-600 hover:text-blue-600 group transition-colors",children:[a.jsx(Vp,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"}),a.jsx("span",{className:"truncate",children:ie.email})]}),ie.phone&&a.jsxs("a",{href:`tel:${ie.phone}`,className:"flex items-center gap-2 text-base md:text-sm text-gray-600 hover:text-blue-600 group transition-colors",children:[a.jsx(Lp,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"}),a.jsx("span",{className:"text-base md:text-sm",children:yr(ie.phone)})]})]})]}),a.jsxs("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-100 flex justify-between items-center mt-auto",children:[We?a.jsxs("button",{onClick:()=>Bs(ie),className:"text-base md:text-sm font-medium text-blue-600 hover:text-blue-800 flex items-center gap-1",children:["View Details ",a.jsx($a,{className:"w-3 h-3"})]}):ie.role===L.DESIGNER?a.jsxs("button",{onClick:()=>{re(ie),he(!0)},className:"text-base md:text-sm font-medium text-blue-600 hover:text-blue-800 flex items-center gap-1",children:["View Details ",a.jsx($a,{className:"w-3 h-3"})]}):(c==null?void 0:c.role)===L.DESIGNER&&ie.role===L.CLIENT?a.jsx("button",{className:"text-base md:text-sm font-medium text-gray-400 cursor-not-allowed",title:"Designers cannot edit client profiles",children:"View Profile"}):a.jsx("button",{onClick:()=>pi(ie),className:"text-base md:text-sm font-medium text-gray-500 hover:text-gray-900",children:"View Profile"}),(c==null?void 0:c.role)===L.DESIGNER?a.jsx("button",{className:"text-base md:text-sm font-medium text-gray-400 cursor-not-allowed",title:"Designers cannot assign users to projects",disabled:!0,children:"Assign to Project"}):a.jsx("button",{onClick:()=>Jr(ie),className:"text-base md:text-sm font-medium text-blue-600 hover:text-blue-800",children:"Assign to Project"})]})]});return a.jsxs("div",{className:"animate-fade-in pb-12",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:e==="All"?"Directory":`${e}s`}),a.jsx("div",{className:"flex items-center gap-3",children:!((c==null?void 0:c.role)===L.DESIGNER&&e===L.CLIENT)&&a.jsxs("button",{onClick:()=>{pe(null),Te({role:e==="All"?L.CLIENT:e,phone:"+91 "}),E(!0)},className:"bg-gray-900 text-white px-4 py-2.5 md:px-4 md:py-2 rounded-lg text-base md:text-sm font-medium hover:bg-gray-800 transition-colors flex items-center gap-2",children:[a.jsx(Oi,{className:"w-4 h-4 md:w-4 md:h-4"}),"Add ",e==="All"?"Person":e]})})]}),Gt?a.jsx("div",{className:"space-y-8",children:cn.length>0?cn.map(ie=>a.jsxs("div",{children:[a.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wide mb-4 flex items-center gap-2 border-b border-gray-200 pb-2",children:[a.jsx($p,{className:"w-4 h-4"})," ",ie]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Gt[ie].map(_e=>a.jsx("div",{children:a.jsx(gs,{user:_e,hideRole:!0,hideSpecialty:!0,isVendor:!0})},_e.id))})]},ie)):a.jsx("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Bx,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No vendors yet"}),a.jsx("p",{className:"text-gray-500",children:'No vendors have been added yet. Click "Add Vendor" to create one.'})]})})}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:_t.length>0?_t.map(ie=>a.jsx("div",{children:a.jsx(gs,{user:ie,isVendor:e===L.VENDOR,hideRole:e===L.CLIENT||e===L.DESIGNER})},ie.id)):a.jsx("div",{className:"col-span-full flex flex-col items-center justify-center py-20 px-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Bx,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),a.jsxs("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:["No ",e==="All"?"team members":e.toLowerCase()+"s"," yet"]}),a.jsx("p",{className:"text-gray-500",children:e==="All"?"Team members will appear here once they are added.":`${e}s will appear here once they are added.`})]})})}),w&&a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[9999] flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[75vh] overflow-hidden animate-fade-in flex flex-col",children:[a.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-gray-100 bg-gray-50 flex-shrink-0",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:Se?"Edit Profile":`Add New ${e==="All"?"Person":e}`}),a.jsx("button",{onClick:()=>{E(!1),pe(null)},className:"text-gray-400 hover:text-gray-600",title:"Close add person dialog",children:a.jsx(mn,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:fi,className:"overflow-y-auto flex-1",children:[a.jsxs("div",{className:"p-5 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:["Full Name ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",className:ar(me.name),placeholder:"e.g. John Doe",value:me.name||"",onChange:ie=>Te({...me,name:ie.target.value})})]}),a.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:["Role ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{title:"Select user role",className:`w-full px-3 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 text-sm ${P&&!me.role?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}`,value:me.role||"",onChange:ie=>{const _e=ie.target.value;Te({...me,role:_e})},children:[a.jsx("option",{value:"",children:"Select Role"}),(c==null?void 0:c.role)!==L.DESIGNER&&a.jsx("option",{value:L.CLIENT,children:"Client"}),a.jsx("option",{value:L.DESIGNER,children:"Designer"}),a.jsx("option",{value:L.VENDOR,children:"Vendor"}),(c==null?void 0:c.role)===L.ADMIN&&a.jsx("option",{value:L.ADMIN,children:"Admin"})]})]})}),!Se&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Authentication Method ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:()=>ge("email"),className:`flex-1 py-2 px-3 rounded-lg border-2 transition-colors font-medium text-sm ${Ce==="email"?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,title:"User will log in with email and password",children:"Email"}),a.jsx("button",{type:"button",onClick:()=>{ge("phone"),Te(ie=>({...ie,email:""}))},className:`flex-1 py-2 px-3 rounded-lg border-2 transition-colors font-medium text-sm ${Ce==="phone"?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,title:"User will log in with phone number and OTP",children:"Phone"})]})]}),Ce==="email"&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:["Email Id ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"email",className:ar(me.email),placeholder:"john@example.com",value:me.email||"",onChange:ie=>Te({...me,email:ie.target.value})})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:[Ce==="phone"?"Phone Number (Login ID)":"Phone Number"," ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"tel",className:ar(me.phone),placeholder:"+91 98765 43210",value:me.phone||"",onChange:ie=>Te({...me,phone:ie.target.value})}),Ce==="email"&&a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Last 6 digits will automatically become their initial password."})]}),me.role===L.VENDOR&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:"Company Name"}),a.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent bg-white text-gray-900 text-sm",placeholder:"e.g. ABC Construction",value:me.company||"",onChange:ie=>Te({...me,company:ie.target.value})})]}),me.role===L.VENDOR&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-1.5",children:"Specialty"}),a.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent bg-white text-gray-900 text-sm",placeholder:"e.g. Flooring",value:me.specialty||"",onChange:ie=>Te({...me,specialty:ie.target.value})})]})]}),a.jsx("div",{className:"p-5 border-t border-gray-100 bg-gray-50 flex-shrink-0 sticky bottom-0",children:a.jsx("button",{type:"submit",className:"w-full bg-gray-900 text-white font-bold py-2.5 rounded-lg hover:bg-gray-800 transition-colors text-sm",children:Se?"Save Changes":"Create Account"})})]})]})}),F&&C&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-fade-in",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 sticky top-0 flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(za,{avatar:C.avatar,name:C.name,size:"md",role:String(C.role).toLowerCase()}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl sm:text-lg font-bold text-gray-900",children:C.name}),a.jsxs("p",{className:"text-sm sm:text-xs text-gray-500",children:[C.specialty,"  ",C.company]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{U(!1),pi(C)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Vendor Profile",children:a.jsx(Wx,{className:"w-6 h-6 sm:w-5 sm:h-5"})}),a.jsx("button",{onClick:()=>U(!1),className:"text-gray-400 hover:text-gray-600",title:"Close vendor detail panel",children:a.jsx(mn,{className:"w-6 h-6 sm:w-5 sm:h-5"})})]})]}),a.jsx("div",{className:"p-6 space-y-6",children:(()=>{const ie=Ie.filter(_e=>{var Be;return(Be=_e.tasks)==null?void 0:Be.some(We=>We.assigneeId===(C==null?void 0:C.id))}).map(_e=>{var Vt;const Be=((Vt=_e.tasks)==null?void 0:Vt.filter(at=>at.assigneeId===(C==null?void 0:C.id)))||[],We=Be.reduce((at,xt)=>at+ra(xt),0),X=Be.length>0?Math.round(We/Be.length):0,He=Be.filter(at=>at.status===xe.DONE).length;return{project:_e,tasks:Be,totalTasks:Be.length,completedTasks:He,progressPercentage:X}});return a.jsxs("div",{children:[a.jsx("h4",{className:"text-base sm:text-sm font-bold text-gray-800 mb-4",children:"Project-wise Tasks & Progress"}),ie.length===0?a.jsx("p",{className:"text-base sm:text-sm text-gray-500 text-center py-6",children:"No tasks assigned"}):a.jsx("div",{className:"space-y-6",children:ie.map(({project:_e,tasks:Be,totalTasks:We,completedTasks:X,progressPercentage:He})=>{const Vt=$e[_e.id]!==!1,at=()=>{ht(ve=>({...ve,[_e.id]:!ve[_e.id]}))},xt=Be.length>0?Be.reduce((ve,Ze)=>Ze.dueDate?ve?new Date(Ze.dueDate)>new Date(ve)?Ze.dueDate:ve:Ze.dueDate:ve,null):null,Me=xt?dn(xt):"N/A";return a.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[a.jsxs("button",{onClick:at,className:"w-full bg-gray-50 p-4 border-b border-gray-200 hover:bg-gray-100 transition-colors flex justify-between items-start",children:[a.jsxs("div",{className:"flex justify-between items-start flex-1 gap-4",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h5",{className:"font-semibold text-gray-900 text-base sm:text-sm text-left cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>i==null?void 0:i(_e),children:_e.name}),a.jsxs("p",{className:"text-sm sm:text-xs text-gray-500 mt-1 text-left",children:["DueDate: ",Me]})]}),a.jsxs("span",{className:"text-sm sm:text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-md font-medium whitespace-nowrap",children:[X,"/",We," Completed"]})]}),a.jsx($a,{className:`w-5 h-5 text-gray-600 ml-4 transition-transform flex-shrink-0 ${Vt?"rotate-90":""}`})]}),a.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("span",{className:"text-sm sm:text-xs font-medium text-gray-600",children:"Work Completed"}),a.jsxs("span",{className:"text-base sm:text-sm font-bold text-gray-900",children:[He,"%"]})]}),a.jsx("div",{className:"w-full bg-gray-300 rounded-full h-2",children:a.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${He}%`}})})]}),Vt&&a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsxs("colgroup",{children:[a.jsx("col",{style:{width:"30%"}}),a.jsx("col",{style:{width:"20%"}}),a.jsx("col",{style:{width:"30%"}}),a.jsx("col",{style:{width:"20%"}})]}),a.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left px-2 sm:px-4 py-3 text-sm sm:text-xs font-semibold text-gray-700",children:"Task Title"}),a.jsx("th",{className:"text-center px-2 sm:px-4 py-3 text-sm sm:text-xs font-semibold text-gray-700",children:"Status"}),a.jsx("th",{className:"text-center px-2 sm:px-4 py-3 text-sm sm:text-xs font-semibold text-gray-700",children:"Progress"}),a.jsx("th",{className:"text-left px-2 sm:px-4 py-3 text-sm sm:text-xs font-semibold text-gray-700",children:"Deadline"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200",children:Be.map(ve=>{const Ze=ra(ve),ln=ve.dueDate?dn(ve.dueDate):"No deadline",En=ve.dependencies&&ve.dependencies.length>0&&ve.dependencies.some(Ln=>{var mt;const Pr=(mt=_e.tasks)==null?void 0:mt.find(Kt=>Kt.id===Ln);return Pr&&Pr.status!==xe.DONE}),vr=ve.status===xe.DONE?"bg-green-100 text-green-800":ve.status===xe.IN_PROGRESS?"bg-blue-100 text-blue-800":ve.status===xe.REVIEW?"bg-purple-100 text-purple-800":ve.status===xe.TODO?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800";return a.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[a.jsx("td",{className:"px-2 sm:px-4 py-3 text-base sm:text-sm text-gray-700",children:a.jsxs("div",{className:"flex items-center gap-2 min-w-0 cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>l==null?void 0:l(ve,_e),children:[a.jsx("span",{className:"truncate",children:ve.title}),En&&a.jsx(bh,{className:"w-3 h-3 text-red-400 flex-shrink-0","aria-label":"Task blocked - waiting for dependencies"})]})}),a.jsx("td",{className:"px-2 sm:px-4 py-3 text-center",children:a.jsx("span",{className:`px-2 py-1 rounded-md text-sm sm:text-xs font-medium whitespace-nowrap ${vr}`,children:ve.status===xe.DONE?"Completed":ve.status})}),a.jsx("td",{className:"px-2 sm:px-4 py-3 text-center",children:a.jsxs("div",{className:"flex items-center gap-0.5 justify-center",children:[a.jsx("div",{className:"bg-gray-200 rounded-full h-2",style:{width:"50px"},children:a.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${Ze===100?"bg-green-500":"bg-blue-500"}`,style:{width:`${Ze}%`}})}),a.jsxs("span",{className:"text-sm sm:text-xs font-medium text-gray-700 min-w-[30px]",children:[Ze,"%"]})]})}),a.jsx("td",{className:"px-2 sm:px-4 py-3 text-base sm:text-sm text-gray-700 whitespace-nowrap",children:ln})]},ve.id)})})]})})]},_e.id)})})]})})()})]})}),document.body),V&&we&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md animate-fade-in max-h-[80vh] flex flex-col",children:[a.jsxs("div",{className:"p-5 border-b border-gray-100 bg-gray-50 flex justify-between items-center flex-shrink-0",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Assign to Project"}),a.jsxs("p",{className:"text-xs text-gray-500",children:["Add ",we.name," to a project team"]})]}),a.jsx("button",{onClick:()=>le(!1),className:"text-gray-400 hover:text-gray-600",children:a.jsx(mn,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-2 overflow-y-auto flex-1",children:r.length===0?a.jsx("div",{className:"text-center py-8 text-gray-500",children:"No projects available"}):a.jsx("div",{className:"space-y-1",children:Ie.map(ie=>{const _e=ie.clientId===we.id||ie.leadDesignerId===we.id||(ie.clientIds||[]).includes(we.id)||(ie.teamMembers||[]).includes(we.id);return a.jsxs("button",{onClick:()=>!_e&&ma(ie),disabled:_e,className:`w-full text-left p-3 rounded-lg flex items-center justify-between transition-colors ${_e?"bg-gray-50 opacity-60 cursor-not-allowed":"hover:bg-blue-50 hover:border-blue-100 border border-transparent"}`,children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-bold text-gray-800 text-sm cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>i==null?void 0:i(ie),children:ie.name}),a.jsx("p",{className:"text-xs text-gray-500",children:ie.status})]}),_e?a.jsxs("span",{className:"text-xs font-medium text-green-600 bg-green-50 px-2 py-1 rounded-full flex items-center gap-1",children:[a.jsx(Ed,{className:"w-3 h-3"})," Added"]}):a.jsx(Oi,{className:"w-4 h-4 text-gray-400"})]},ie.id)})})})]})}),document.body),J&&ae&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-fade-in",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 sticky top-0 flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(za,{avatar:ae.avatar,name:ae.name,size:"md",role:String(ae.role).toLowerCase()}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-2xl sm:text-xl font-bold text-gray-900",children:ae.name}),a.jsx("p",{className:"text-base sm:text-sm text-gray-500",children:ae.specialty||"Designer"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{he(!1),pi(ae)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Designer Profile",children:a.jsx(Wx,{className:"w-6 h-6 sm:w-5 sm:h-5"})}),a.jsx("button",{onClick:()=>{he(!1),re(null)},className:"text-gray-400 hover:text-gray-600",title:"Close designer details",children:a.jsx(mn,{className:"w-6 h-6 sm:w-5 sm:h-5"})})]})]}),a.jsx("div",{className:"p-6 space-y-6",children:(()=>{const ie=Ie.filter(_e=>{var Be;return(Be=_e.tasks)==null?void 0:Be.some(We=>We.assigneeId===ae.id)}).map(_e=>({project:_e,tasks:_e.tasks.filter(Be=>Be.assigneeId===ae.id),projectFinancials:bt[_e.id]||[]}));return ie.length===0?a.jsx("p",{className:"text-lg sm:text-base text-gray-500 text-center py-6",children:"No tasks assigned"}):a.jsx("div",{className:"space-y-6",children:ie.map(({project:_e,tasks:Be,projectFinancials:We})=>{const X=We.filter(at=>at.adminApproved&&at.clientApproved&&at.type==="income").reduce((at,xt)=>at+(xt.amount||0),0),He=On[_e.id]===!0,Vt=()=>{nn(at=>({...at,[_e.id]:!at[_e.id]}))};return a.jsxs("div",{children:[a.jsxs("div",{className:"mb-3",children:[a.jsx("h4",{className:"text-lg sm:text-base font-bold text-gray-800 cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>i==null?void 0:i(_e),children:_e.name}),a.jsxs("p",{className:"text-base sm:text-sm text-gray-500 mt-1",children:["Total Payment Received: ",a.jsxs("span",{className:"font-semibold text-gray-900",children:["",X.toLocaleString()]})]})]}),a.jsxs("button",{onClick:Vt,className:"w-full px-4 py-2.5 bg-gradient-to-r from-blue-50 to-blue-100 flex justify-between items-center transition-colors text-left border border-blue-200 rounded-t-lg",children:[a.jsxs("span",{className:"text-sm font-semibold text-blue-900",children:["Tasks (",Be.length,")"]}),a.jsx($a,{className:`w-5 h-5 text-blue-600 transition-transform ${He?"rotate-90":""}`})]}),He&&a.jsx("div",{className:"overflow-x-auto border border-gray-200 border-t-0 rounded-b-lg",children:a.jsxs("table",{className:"w-full text-lg sm:text-base",children:[a.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left font-bold text-gray-700 text-base sm:text-sm",children:"Task Name"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-base sm:text-sm",children:"Progress"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-base sm:text-sm",children:"Status"}),a.jsx("th",{className:"px-4 py-3 text-center font-bold text-gray-700 text-base sm:text-sm",children:"Due Date"})]})}),a.jsx("tbody",{children:Be.map(at=>{const xt=ra(at),Me=at.dueDate?new Date(at.dueDate).toLocaleDateString("en-IN",{year:"numeric",month:"2-digit",day:"2-digit"}):"N/A",ve=at.status===xe.DONE?"bg-green-100 text-green-800":at.status===xe.IN_PROGRESS?"bg-blue-100 text-blue-800":at.status===xe.REVIEW?"bg-purple-100 text-purple-800":at.status===xe.OVERDUE?"bg-red-100 text-red-800":at.status===xe.TODO?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800";return a.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-left text-gray-900 font-medium text-base sm:text-sm cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>l==null?void 0:l(at,_e),children:at.title}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("div",{className:"w-12 bg-gray-200 rounded-full h-1.5",children:a.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full",style:{width:`${xt}%`}})}),a.jsxs("span",{className:"text-base sm:text-sm font-semibold text-gray-700",children:[xt,"%"]})]})}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("span",{className:`px-2 py-1 rounded text-base sm:text-sm font-medium whitespace-nowrap ${ve}`,children:at.status})}),a.jsx("td",{className:"px-4 py-3 text-center text-gray-600 text-base sm:text-sm",children:Me})]},at.id)})})]})})]},_e.id)})})})()})]})}),document.body),B&&C&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md animate-fade-in",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Share Vendor Report"}),a.jsx("button",{onClick:()=>K(!1),className:"text-gray-400 hover:text-gray-600",title:"Close share report dialog",children:a.jsx(mn,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Share ",a.jsx("span",{className:"font-semibold",children:C.name}),"'s billing report with:"]}),a.jsx("div",{className:"space-y-3",children:Ie.filter(ie=>ie.tasks.some(_e=>_e.assigneeId===(C==null?void 0:C.id))).map(ie=>{var _e;return a.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0,className:"w-4 h-4 rounded border-gray-300"}),a.jsxs("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>i==null?void 0:i(ie),children:ie.name}),a.jsxs("p",{className:"text-xs text-gray-500",children:[((_e=ie.team)==null?void 0:_e.length)||0," team members"]})]})]},ie.id)})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Share Method"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center p-3 border border-blue-200 bg-blue-50 rounded-lg cursor-pointer",children:[a.jsx("input",{type:"radio",name:"shareMethod",value:"email",checked:M==="email",onChange:ie=>Ve(ie.target.value),className:"w-4 h-4 border-gray-300"}),a.jsx("span",{className:"ml-3 text-sm font-medium text-gray-900",children:"Send via Email"})]}),a.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[a.jsx("input",{type:"radio",name:"shareMethod",value:"link",checked:M==="link",onChange:ie=>Ve(ie.target.value),className:"w-4 h-4 border-gray-300"}),a.jsx("span",{className:"ml-3 text-sm font-medium text-gray-900",children:"Create Shareable Link"})]})]})]})]}),a.jsxs("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end",children:[a.jsx("button",{onClick:()=>K(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),a.jsxs("button",{onClick:()=>{var ie,_e;if(M==="link"&&C){const Be=`${window.location.origin}${window.location.pathname}?vendorId=${C.id}`;navigator.clipboard.writeText(Be).then(()=>{var We,X;p("Success","Vendor link copied to clipboard","success",(c==null?void 0:c.id)||"",((We=r[0])==null?void 0:We.id)||"",((X=r[0])==null?void 0:X.name)||"Project"),K(!1)}).catch(()=>{var We,X;p("Error","Failed to copy link","error",(c==null?void 0:c.id)||"",((We=r[0])==null?void 0:We.id)||"",((X=r[0])==null?void 0:X.name)||"Project")})}else p("Success",`Vendor report for ${C==null?void 0:C.name} shared with client`,"success",(c==null?void 0:c.id)||"",((ie=r[0])==null?void 0:ie.id)||"",((_e=r[0])==null?void 0:_e.name)||"Project"),K(!1)},title:"Share vendor billing report",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[a.jsx(yj,{className:"w-4 h-4"}),"Share Report"]})]})]})}),document.body),j&&D&&kn.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto animate-fade-in",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50 sticky top-0 flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(za,{avatar:D.avatar,name:D.name,size:"md",role:String(D.role).toLowerCase()}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:D.name}),a.jsxs("p",{className:"text-xs text-gray-500",children:[D.specialty,"  ",D.company]})]})]}),a.jsx("button",{onClick:()=>ce(!1),className:"text-gray-400 hover:text-gray-600",title:"Close accounts panel",children:a.jsx(mn,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"p-6",children:[a.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-4",children:"Project & Billing Report"}),Ie.filter(ie=>{var at,xt;const _e=(at=ie.teamMembers)==null?void 0:at.includes((D==null?void 0:D.id)||""),Be=(xt=ie.tasks)==null?void 0:xt.some(Me=>Me.assigneeId===(D==null?void 0:D.id)),We=bt[ie.id]||[],X=(D==null?void 0:D.name)||"",He=Me=>Me?Me.includes("(")?Me.split("(")[0].trim():Me.trim():"",Vt=We.some(Me=>Me.vendorId===(D==null?void 0:D.id)||Me.vendorName===X||Me.paidTo===X||Me.receivedBy===X||He(Me.receivedByName)===X||He(Me.paidByOther)===X);return _e||Be||Vt}).length===0?a.jsx("p",{className:"text-xs text-gray-400 text-center py-4",children:"No projects assigned"}):a.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:a.jsxs("table",{className:"w-full text-xs",children:[a.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left font-bold text-gray-700",children:"Project"}),a.jsx("th",{className:"px-4 py-2 text-right font-bold text-gray-700",children:"Net Amount"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700",children:"Tasks"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700",children:"Admin Approval"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700",children:"Client Approval"}),a.jsx("th",{className:"px-4 py-2 text-center font-bold text-gray-700",children:"Status"})]})}),a.jsx("tbody",{children:Ie.filter(ie=>{var at,xt;const _e=(at=ie.teamMembers)==null?void 0:at.includes((D==null?void 0:D.id)||""),Be=(xt=ie.tasks)==null?void 0:xt.some(Me=>Me.assigneeId===(D==null?void 0:D.id)),We=bt[ie.id]||[],X=Me=>Me?Me.includes("(")?Me.split("(")[0].trim():Me.trim():"",He=(D==null?void 0:D.name)||"",Vt=We.some(Me=>Me.vendorId===(D==null?void 0:D.id)||Me.vendorName===He||Me.paidTo===He||Me.receivedBy===He||X(Me.receivedByName)===He||X(Me.paidByOther)===He);return _e||Be||Vt}).map((ie,_e)=>{const Be=bt[ie.id]||[],We=mt=>mt?mt.includes("(")?mt.split("(")[0].trim():mt.trim():"",X=(D==null?void 0:D.name)||"",He=Be.filter(mt=>mt.vendorId===(D==null?void 0:D.id)||mt.vendorName===X||mt.paidTo===X||mt.receivedBy===X||We(mt.receivedByName)===X||We(mt.paidByOther)===X),Vt=He.filter(mt=>mt.adminApproved&&mt.clientApproved),at=Vt.filter(mt=>We(mt.receivedByName)===X||mt.receivedBy===X).reduce((mt,Kt)=>mt+Kt.amount,0),xt=Vt.filter(mt=>mt.vendorName===X||We(mt.paidByOther)===X||mt.paidTo===X).reduce((mt,Kt)=>mt+Kt.amount,0),Me=at-xt;let ve=0;D!=null&&D.projectMetrics&&D.projectMetrics[ie.id]?ve=D.projectMetrics[ie.id].taskCount:ve=ie.tasks.filter(Kt=>Kt.assigneeId===(D==null?void 0:D.id)).length;const Ze=He.length>0,ln=Ze&&He.every(mt=>mt.adminApproved),En=Ze&&He.some(mt=>mt.adminApproved),vr=Ze&&He.every(mt=>mt.clientApproved),Ln=Ze&&He.some(mt=>mt.clientApproved),Pr=(mt,Kt)=>mt?a.jsx("div",{className:"flex justify-center text-green-500 font-bold text-lg",children:""}):Kt?a.jsx("span",{className:"text-orange-500 font-medium text-xs",children:"Partial"}):a.jsx("span",{className:"text-gray-400 text-xs",children:"-"});return a.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${_e%2===0?"bg-white":"bg-gray-50/50"}`,children:[a.jsx("td",{className:"px-4 py-3 font-medium text-gray-900 cursor-pointer hover:text-blue-600 transition-colors",onClick:()=>i==null?void 0:i(ie),children:ie.name}),a.jsxs("td",{className:"px-4 py-3 text-left text-gray-700",children:["",(Me/1e3).toFixed(1),"k"]}),a.jsx("td",{className:"px-4 py-3 text-center text-gray-700 font-medium",children:ve}),a.jsx("td",{className:"px-4 py-3 text-center",children:Pr(ln,En)}),a.jsx("td",{className:"px-4 py-3 text-center",children:Pr(vr,Ln)}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs font-medium ${ln&&vr?"bg-green-100 text-green-700":ln?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:ln&&vr?"Approved":ln?"Admin OK":"Pending"})})]},ie.id)})})]})})]})]})}),document.body),ot&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[9999] flex items-center justify-center p-4",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-8 text-center",style:{position:"relative",zIndex:1e4},children:[a.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:a.jsx(Ed,{className:"w-8 h-8 text-green-600"})}),a.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:" User Created Successfully!"}),a.jsxs("p",{className:"text-gray-700 mb-6 text-base font-medium",children:[a.jsx("strong",{children:ot.name})," has been created with phone authentication.",a.jsx("br",{}),a.jsxs("span",{className:"text-sm text-gray-600",children:["Phone: ",ot.phone]})]}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-left mb-6 border-l-4 border-blue-500",children:[a.jsx("p",{className:"text-xs text-blue-600 font-bold uppercase mb-2",children:" Welcome Message"}),a.jsxs("p",{className:"text-sm text-gray-800 italic",children:['"Hi ',ot.name,", welcome to Kydo Solutions! Your account has been created. Please login using your phone number: ",ot.phone,'."']})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("a",{href:`https://wa.me/+${(gi=ot.phone)==null?void 0:gi.replace(/\D/g,"")}?text=${encodeURIComponent(`Hi ${ot.name}, welcome to Kydo Solutions! Your account has been created. Please login using your phone number: ${ot.phone}.`)}`,target:"_blank",rel:"noopener noreferrer",className:"w-full bg-[#25D366] hover:bg-[#128C7E] text-white font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2 shadow-md",children:[a.jsx(zx,{className:"w-5 h-5"})," Send Welcome on WhatsApp"]}),a.jsxs("button",{onClick:()=>{const ie=`Hi ${ot.name}, welcome to Kydo Solutions! Your account has been created. Please login using your phone number: ${ot.phone}.`;navigator.clipboard.writeText(ie),p("Copied","Message copied to clipboard!","success")},className:"w-full bg-blue-100 border border-blue-300 hover:bg-blue-200 text-blue-700 font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2",children:[a.jsx(NA,{className:"w-5 h-5"})," Copy Message"]}),a.jsx("button",{onClick:()=>{ct(null),p("Done","Remember to send the message!","info")},className:"w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 rounded-lg transition-colors",children:"Done"})]})]})})})]})},oS=({message:n})=>{const{loading:e,message:t}=tm();return e?a.jsxs("div",{className:"loader-overlay",role:"status","aria-live":"polite",children:[a.jsx("div",{className:"loader-circle"}),a.jsx("div",{className:"loader-message",children:n||t||"Loading..."})]}):null};let Po=null;const hV=async(n,e)=>{try{console.log(" Initializing phone authentication...");let t=document.getElementById(e);if(t||(console.log(` Container ${e} not found, creating it`),t=document.createElement("div"),t.id=e,t.style.display="none",document.body.appendChild(t)),Po){try{Po.clear()}catch(l){console.warn("Failed to clear existing verifier:",l)}Po=null}const r=n.trim();console.log(" Sending OTP to:",r),Po=new QC(Ld,e,{size:"invisible",callback:()=>{console.log(" Invisible reCAPTCHA callback")}}),console.log(" Calling signInWithPhoneNumber...");const i=await XC(Ld,r,Po);return console.log(" OTP sent successfully!"),i}catch(t){if(console.error("Phone authentication error:",t),console.error("Error code:",t.code),console.error("Error message:",t.message),Po){try{Po.clear()}catch(r){console.warn("Failed to clear verifier:",r)}Po=null}throw t.code==="auth/invalid-app-credential"?new Error("Firebase app credential error. This usually means: 1) Phone authentication not properly enabled in Firebase Console, 2) API key restrictions, or 3) Enforcement mode not set correctly. Please verify Phone auth is enabled and set to AUDIT mode."):t.code==="auth/invalid-phone-number"?new Error("Invalid phone number format. Please use format like +911234567890"):t.message&&t.message.includes("400")?new Error("SMS delivery failed (400). Possible reasons: 1) Daily SMS quota exceeded (50/day free), 2) Too many requests from this number, 3) Billing issue."):t.code==="auth/quota-exceeded"?new Error("SMS quota exceeded. Daily limit reached."):t}},mV=async(n,e)=>{try{return(await n.confirm(e)).user}catch(t){throw console.error("Phone OTP verification error:",t),t}},pV={"auth/invalid-phone-number":"The phone number entered is invalid. Please check and try again.","auth/missing-phone-number":"Please enter your phone number.","auth/too-many-requests":"Too many attempts. Please try again later or contact support.","auth/quota-exceeded":"SMS quota exceeded. Please try again later.","auth/user-disabled":"This account has been disabled. Contact support for help.","auth/network-request-failed":"Network error. Please check your connection and try again.","auth/code-expired":"The verification code has expired. Please request a new one.","auth/invalid-verification-code":"The code you entered is incorrect. Please try again.","auth/session-expired":"Session expired. Please request a new verification code."};function NN(n){return pV[n]||"An unexpected error occurred. Please try again."}const fV=()=>{const{user:n,adminCredentials:e}=ha(),{addNotification:t}=sl(),{showLoading:r,hideLoading:i}=tm(),[l,c]=q.useState(""),[u,p]=q.useState(""),[g,b]=q.useState(""),[w,E]=q.useState(""),[C,H]=q.useState("email"),[F,U]=q.useState(!1),ae=async re=>{if(re.preventDefault(),!l)return t("Validation Error","Please enter a name","error");if(!w)return t("Validation Error","Please enter a business name","error");if(!g)return t("Validation Error","Please enter a phone number","error");if(C==="email"&&!u)return t("Validation Error","Please enter an email","error");U(!0),r("Creating admin...");try{const he=(g||"").replace(/\D/g,"").slice(-6)||"admin123",j={id:"",name:l,email:C==="email"?u:"",role:L.ADMIN,company:w||void 0,phone:g||void 0,password:he,authMethod:C};n&&n.tenantId&&(j.tenantId=n.tenantId);const ce=await aS(j,n==null?void 0:n.email,e==null?void 0:e.password);t("Success",`Admin account created. Password: last 6 digits of ${g}`,"success"),c(""),p(""),b(""),E("")}catch(J){console.error("Error creating admin:",J),t("Error",J.message||"Failed to create admin","error")}finally{U(!1),i()}};return a.jsxs("div",{className:"min-h-screen bg-gray-100 flex flex-col font-sans",children:[a.jsx("div",{className:"status-bar-spacer bg-gray-900 w-full fixed top-0 left-0 right-0 z-50"}),a.jsx("div",{className:"flex-1 flex items-center justify-center p-4 mt-[env(safe-area-inset-top,24px)]",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden max-w-5xl w-full flex flex-col md:flex-row min-h-[600px]",children:[a.jsxs("div",{className:"md:w-5/12 bg-gray-900 p-8 md:p-12 text-white flex flex-col justify-between relative overflow-hidden",children:[a.jsx("div",{className:"absolute top-0 left-0 w-64 h-64 bg-white opacity-5 rounded-full -translate-x-1/2 -translate-y-1/2"}),a.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-white opacity-5 rounded-full translate-x-1/3 translate-y-1/3"}),a.jsxs("div",{className:"relative z-10",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[a.jsx("img",{src:"/kydoicon.png",alt:"Kydo",className:"w-10 h-10 rounded-lg"}),a.jsx("span",{className:"text-2xl font-bold tracking-tight",children:"Kydo Solutions"})]}),a.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-6 leading-tight",children:"Manage your business with confidence."}),a.jsx("p",{className:"text-gray-400 text-lg mb-8",children:"Create your admin account to access powerful tools for project management, financial tracking, and team collaboration."})]}),a.jsxs("div",{className:"space-y-4 relative z-10",children:[a.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 rounded-xl backdrop-blur-sm border border-white/10",children:[a.jsx(bj,{className:"w-8 h-8 text-gray-300"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Enterprise Security"}),a.jsx("p",{className:"text-sm text-gray-400",children:"High-Level encryption for your data"})]})]}),a.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 rounded-xl backdrop-blur-sm border border-white/10",children:[a.jsx($j,{className:"w-8 h-8 text-gray-300"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Quick Setup"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Get started in less than 2 minutes"})]})]})]})]}),a.jsx("div",{className:"md:w-7/12 p-8 md:p-12 bg-white overflow-y-auto",children:a.jsxs("div",{className:"max-w-md mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Create Admin Account"}),a.jsx("p",{className:"text-gray-500",children:"Enter your details to set up your workspace."})]}),a.jsxs("form",{onSubmit:ae,className:"space-y-5",children:[a.jsxs("div",{className:"space-y-1.5",children:[a.jsx("label",{htmlFor:"fullName",className:"text-sm font-medium text-gray-700",children:"Full Name"}),a.jsxs("div",{className:"relative",children:[a.jsx(RN,{className:"absolute left-3.5 top-3.5 w-5 h-5 text-gray-400"}),a.jsx("input",{id:"fullName",placeholder:"e.g. Rajesh Kumar",value:l,onChange:re=>c(re.target.value),className:"w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"})]})]}),a.jsxs("div",{className:"space-y-1.5",children:[a.jsx("label",{htmlFor:"businessName",className:"text-sm font-medium text-gray-700",children:"Business Name"}),a.jsxs("div",{className:"relative",children:[a.jsx(AN,{className:"absolute left-3.5 top-3.5 w-5 h-5 text-gray-400"}),a.jsx("input",{id:"businessName",placeholder:"e.g. Kydo Interiors",value:w,onChange:re=>E(re.target.value),className:"w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"})]})]}),a.jsxs("div",{className:"space-y-1.5",children:[a.jsx("label",{htmlFor:"phone",className:"text-sm font-medium text-gray-700",children:"Phone Number"}),a.jsxs("div",{className:"relative",children:[a.jsx(Lp,{className:"absolute left-3.5 top-3.5 w-5 h-5 text-gray-400"}),a.jsx("input",{id:"phone",type:"tel",placeholder:"+91 9876543210",value:g,onChange:re=>b(re.target.value),title:"Include country code, e.g. +91 for India",className:"w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"})]}),a.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1 mt-1",children:[a.jsx(xp,{className:"w-3 h-3 text-green-500"}),"Last 6 digits will be your password"]})]}),a.jsxs("div",{className:"space-y-1.5",children:[a.jsx("label",{htmlFor:"adminEmail",className:"text-sm font-medium text-gray-700",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(Vp,{className:"absolute left-3.5 top-3.5 w-5 h-5 text-gray-400"}),a.jsx("input",{id:"adminEmail",placeholder:"admin@example.com",value:u,onChange:re=>p(re.target.value),type:"email",className:"w-full pl-11 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"})]})]}),a.jsxs("div",{className:"pt-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Preferred Login Method"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("button",{type:"button",onClick:()=>H("email"),className:`py-2.5 px-4 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2 border ${C==="email"?"bg-gray-900 border-gray-900 text-white ring-1 ring-gray-900":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:[a.jsx(Vp,{className:"w-4 h-4"}),"Email Login"]}),a.jsxs("button",{type:"button",onClick:()=>H("phone"),className:`py-2.5 px-4 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2 border ${C==="phone"?"bg-gray-900 border-gray-900 text-white ring-1 ring-gray-900":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:[a.jsx(Lp,{className:"w-4 h-4"}),"Phone Login"]})]})]}),a.jsx("div",{className:"flex justify-center pt-2",children:a.jsx("button",{type:"submit",disabled:F,className:"px-10 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-semibold py-2.5 rounded-xl transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-600/20",children:F?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Creating..."]}):a.jsxs(a.Fragment,{children:["Create Admin Account",a.jsx(Jl,{className:"w-4 h-4"})]})})}),a.jsx("div",{className:"text-center mt-6",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",a.jsx("a",{href:"/",className:"font-semibold text-blue-600 hover:text-blue-700 hover:underline transition-colors",children:"Sign In"})]})})]})]})})]})})]})},gV=({users:n=[]})=>{const{login:e,setAdminCredentials:t}=ha(),{addNotification:r}=sl(),{showLoading:i,hideLoading:l}=tm(),[c,u]=q.useState(""),[p,g]=q.useState(""),[b,w]=q.useState("+91 "),[E,C]=q.useState(""),[H,F]=q.useState(""),[U,ae]=q.useState(!1),[re,J]=q.useState(!1),[he,j]=q.useState("email"),[ce,D]=q.useState(!1),[k,O]=q.useState(null),[z,B]=q.useState(!0);if((typeof window<"u"?new URLSearchParams(window.location.search).get("open"):null)==="admins")return a.jsx(fV,{});const M=async Te=>{if(Te.preventDefault(),J(!0),F(""),!c||!p){r("Validation Error","Please fill in all required fields.","error");return}ae(!0),i("Signing in...");try{const Se=await EC(Ld,c,p);t({email:c,password:p}),sessionStorage.setItem("adminEmail",c),sessionStorage.setItem("adminPassword",p);let pe=null;try{pe=await Ry(Se.user.uid)}catch(P){console.warn("Could not fetch user profile:",P)}if(!pe){const P="Account not found. Please contact your administrator to set up your account.";F(P),r("Account Not Found",P,"error"),await AI(Ld),ae(!1),l();return}if(z){const P=i6();a6(P),r("Device Remembered","This device will be remembered for 30 days","success")}e(pe),F("")}catch(Se){console.error("Firebase login error:",Se);let pe="Invalid credentials.";Se.code==="auth/user-not-found"?pe="Email not found.":Se.code==="auth/wrong-password"?pe="Incorrect password.":Se.code==="auth/invalid-email"&&(pe="Invalid email format."),F(pe),r("Login Failed",pe,"error")}finally{ae(!1),l()}},Ve=async Te=>{if(Te.preventDefault(),J(!0),F(""),!b){r("Validation Error","Please enter your phone number.","error");return}ae(!0),i("Sending OTP...");try{let Se=b.replace(/[\s\-()]/g,"");Se.startsWith("+")||(Se=`+91${Se}`),l();const pe=await hV(Se,"recaptcha-container");O(pe),D(!0),r("Success","OTP sent to your phone number.","success"),F("")}catch(Se){console.error("Phone OTP error:",Se);let pe=NN(Se.code);Se.code==="auth/too-many-requests"&&(pe+=" You have reached the maximum number of attempts. Please wait a few minutes before trying again."),F(pe),r("Error",pe,"error")}finally{ae(!1),l()}},me=async Te=>{if(Te.preventDefault(),J(!0),F(""),!E){r("Validation Error","Please enter the OTP.","error");return}ae(!0),i("Verifying OTP...");try{const Se=await mV(k,E);let pe=null;try{pe=await Ry(Se.uid),!pe&&Se.phoneNumber&&(pe=await GT(Se.uid,Se.phoneNumber))}catch(P){console.warn("Could not fetch user profile:",P)}if(!pe){F("User profile not found. Please contact your administrator to set up your account."),r("Profile Not Found","Your profile has not been created yet. Please contact the administrator.","error"),D(!1),C("");return}e(pe),F("")}catch(Se){console.error("OTP verification error:",Se);let pe=NN(Se.code);F(pe),r("Verification Failed",pe,"error")}finally{ae(!1),l()}};return a.jsxs("div",{className:"min-h-screen bg-gray-100 flex flex-col",children:[a.jsx("div",{className:"status-bar-spacer bg-gray-900 w-full fixed top-0 left-0 right-0 z-50"}),a.jsxs("div",{className:"flex-1 flex items-center justify-center p-4 mt-[env(safe-area-inset-top,24px)]",children:[U&&a.jsx(oS,{message:"Signing in..."}),a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full overflow-hidden flex flex-col md:flex-row",children:[a.jsxs("div",{className:"md:w-1/2 bg-gray-900 p-12 text-white flex flex-col justify-between relative overflow-hidden",children:[a.jsx("div",{className:"absolute top-0 left-0 w-64 h-64 bg-white opacity-5 rounded-full -translate-x-1/2 -translate-y-1/2"}),a.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-white opacity-5 rounded-full translate-x-1/3 translate-y-1/3"}),a.jsxs("div",{className:"relative z-10",children:[a.jsx("img",{src:"/kydoicon.png",alt:"Kydo Solutions Logo",className:"h-12 w-12 mb-6 rounded-lg"}),a.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Kydo Solutions"}),a.jsx("p",{className:"text-gray-400 text-lg leading-relaxed",children:"Manage your interior design projects, clients, and vendors in one seamless platform."})]}),a.jsx("div",{className:"mt-12 relative z-10",children:a.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 rounded-xl backdrop-blur-sm border border-white/10",children:[a.jsx(bh,{className:"w-8 h-8 text-gray-300"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Secure Access"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Role-Based Access Control"})]})]})})]}),a.jsxs("div",{className:"md:w-1/2 p-12 bg-white flex flex-col justify-center",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Sign In"}),a.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[a.jsxs("button",{type:"button",onClick:()=>{j("email"),D(!1),F(""),J(!1),w("+91 "),C("")},className:`pb-3 px-4 font-medium border-b-2 transition-colors flex items-center gap-2 ${he==="email"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[a.jsx(Vp,{className:"w-4 h-4"}),"Email"]}),a.jsxs("button",{type:"button",onClick:()=>{j("phone"),D(!1),F(""),J(!1),u(""),g("")},className:`pb-3 px-4 font-medium border-b-2 transition-colors flex items-center gap-2 ${he==="phone"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[a.jsx(Lp,{className:"w-4 h-4"}),"Phone"]})]})]}),he==="email"&&a.jsxs("form",{onSubmit:M,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Email ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"email",className:`w-full px-4 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 placeholder-gray-400 ${re&&!c?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}`,placeholder:"Enter your email",value:c,onChange:Te=>u(Te.target.value),disabled:U})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Password ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"password",className:`w-full px-4 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 placeholder-gray-400 ${re&&!p?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}`,placeholder:"Enter password",value:p,onChange:Te=>g(Te.target.value),disabled:U})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:z,onChange:Te=>B(Te.target.checked),disabled:U,className:"w-4 h-4 rounded border-gray-300 cursor-pointer"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Remember this device for 30 days"})]}),H&&a.jsx("p",{className:"text-sm text-red-500 font-medium",children:H}),a.jsxs("button",{type:"submit",disabled:U,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-bold py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:[U?"Signing in...":"Login"," ",!U&&a.jsx(Jl,{className:"w-4 h-4"})]}),a.jsx("div",{className:"mt-3 text-center",children:a.jsx("a",{href:"?open=admins",className:"text-sm text-gray-600 hover:text-gray-900 underline",children:"Create Admin account"})})]}),he==="phone"&&a.jsx(a.Fragment,{children:ce?a.jsxs("form",{onSubmit:me,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Enter OTP ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["OTP sent to ",b]}),a.jsx("input",{type:"text",className:`w-full px-4 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 placeholder-gray-400 text-center tracking-widest ${re&&!E?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}`,placeholder:"000000",value:E,onChange:Te=>C(Te.target.value.replace(/\D/g,"").slice(0,6)),disabled:U,maxLength:6})]}),H&&a.jsx("p",{className:"text-sm text-red-500 font-medium",children:H}),a.jsxs("button",{type:"submit",disabled:U,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-bold py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:[U?"Verifying...":"Verify OTP"," ",!U&&a.jsx(Jl,{className:"w-4 h-4"})]}),a.jsx("button",{type:"button",onClick:()=>{D(!1),C(""),F("")},className:"w-full text-blue-600 hover:text-blue-700 font-medium py-2",children:"Send OTP Again"})]}):a.jsxs("form",{onSubmit:Ve,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone Number ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"tel",className:`w-full px-4 py-2 border rounded-lg focus:outline-none transition-all bg-white text-gray-900 placeholder-gray-400 ${re&&!b?"border-red-500 ring-1 ring-red-500":"border-gray-300 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}`,placeholder:"+91 9876543210",value:b,onChange:Te=>w(Te.target.value),disabled:U}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Include country code (e.g., +91 for India)"})]}),a.jsx("div",{id:"recaptcha-container"}),H&&a.jsx("p",{className:"text-sm text-red-500 font-medium",children:H}),a.jsxs("button",{type:"submit",disabled:U,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-bold py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:[U?"Sending OTP...":"Send OTP"," ",!U&&a.jsx(Jl,{className:"w-4 h-4"})]})]})})]})]})]})]})},xV=({isOpen:n,onClose:e,projects:t,onSelectProject:r,onDeepLink:i})=>{const{notifications:l,markAsRead:c,markAllAsRead:u,clearNotifications:p,handleNotificationDeepLink:g}=sl(),b=w=>{if(c(w.id),i){g(w),e();return}if(w.projectId&&r){const E=t.find(C=>C.id===w.projectId);E&&(r(E,{initialTab:w.targetTab,taskId:w.taskId,meetingId:w.meetingId}),e())}};return n?a.jsxs("div",{className:"fixed sm:absolute right-1/2 sm:right-0 sm:left-auto left-1/2 -translate-x-1/2 sm:translate-x-0 top-12 w-[calc(100%-2rem)] sm:w-80 md:w-96 bg-white rounded-xl shadow-2xl border border-gray-100 z-50 overflow-hidden animate-fade-in",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[a.jsx("h3",{className:"font-semibold text-gray-800",children:"Notifications"}),a.jsxs("div",{className:"flex items-center gap-2",children:[l.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:u,className:"text-xs text-blue-600 hover:text-blue-800 font-medium px-2 py-1 rounded hover:bg-blue-50",title:"Mark all as read",children:"Mark all read"}),a.jsx("button",{onClick:p,className:"text-gray-400 hover:text-red-600 p-1 rounded hover:bg-red-50",title:"Clear all",children:a.jsx(ks,{className:"w-4 h-4"})})]}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 p-1 rounded hover:bg-gray-100 transition-colors",title:"Close",children:a.jsx(mn,{className:"w-5 h-5"})})]})]}),a.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:l.length===0?a.jsxs("div",{className:"p-8 text-center text-gray-400 flex flex-col items-center",children:[a.jsx(Op,{className:"w-8 h-8 mb-2 opacity-20"}),a.jsx("p",{className:"text-sm",children:"No new notifications"})]}):a.jsx("div",{className:"divide-y divide-gray-50",children:l.map(w=>a.jsx("div",{onClick:()=>b(w),className:`p-4 hover:bg-gray-50 transition-colors relative group cursor-pointer ${w.read?"opacity-60":"bg-blue-50/30"}`,children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:`mt-1 w-2 h-2 rounded-full flex-shrink-0 ${w.type==="error"?"bg-red-500":w.type==="warning"?"bg-yellow-500":w.type==="success"?"bg-green-500":"bg-blue-500"}`}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:`text-sm font-medium ${w.read?"text-gray-700":"text-gray-900"}`,children:w.title}),a.jsx("p",{className:"text-xs text-gray-500 mt-0.5 leading-relaxed",children:w.message}),a.jsx("p",{className:"text-[10px] text-gray-400 mt-2",children:new Date(w.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),!w.read&&a.jsx("button",{onClick:E=>{E.stopPropagation(),c(w.id)},className:"absolute top-4 right-4 text-blue-400 hover:text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx(Fl,{className:"w-4 h-4"})})]})},w.id))})})]}):null},yV=({users:n,onClose:e,onSave:t,initialProject:r})=>{const{addNotification:i}=sl(),{user:l}=ha(),{createNewProject:c,updateExistingProject:u}=iS(),[p,g]=q.useState(!1),b=!!r,w=new Date().toISOString().split("T")[0],[E,C]=q.useState(r?{name:r.name,tenantId:r.tenantId,status:r.status,type:r.type,category:r.category,description:r.description,budget:r.budget,startDate:r.startDate,deadline:r.deadline,clientId:r.clientId,clientIds:r.clientIds||[r.clientId],leadDesignerId:r.leadDesignerId}:{name:"",tenantId:(l==null?void 0:l.tenantId)||(l==null?void 0:l.id)||"",status:jn.DISCOVERY,type:ql.DESIGNING,category:Oo.COMMERCIAL,description:"",budget:void 0,startDate:w,deadline:w,clientId:"",clientIds:[],leadDesignerId:""}),[H,F]=q.useState(!1),[U,ae]=q.useState(null),[re,J]=q.useState([]),he=q.useRef(null),j=q.useRef(null),ce=()=>{if(E.clientIds&&E.clientIds.length>0?E.clientIds:E.clientId&&E.clientId,!E.name||!E.leadDesignerId||!E.startDate||!E.deadline||!E.budget)return F(!0),i("Validation Error","Please complete all required fields marked in red.","error"),!1;if(!/^\d{4}-\d{2}-\d{2}$/.test(E.startDate||""))return i("Invalid Date","Start date must be in YYYY-MM-DD format.","error"),!1;if(!/^\d{4}-\d{2}-\d{2}$/.test(E.deadline||""))return i("Invalid Date","Deadline must be in YYYY-MM-DD format.","error"),!1;const me=new Date(E.startDate),Te=new Date(E.deadline);return isNaN(me.getTime())?(i("Invalid Date","Start date is not a valid date.","error"),!1):isNaN(Te.getTime())?(i("Invalid Date","Deadline is not a valid date.","error"),!1):Te<me?(i("Invalid Date Range","Deadline must be on or after the start date.","error"),!1):!0},D=async me=>{if(me.preventDefault(),!!ce()){g(!0);try{if(b&&r){const Te=E.clientIds&&E.clientIds.length>0?E.clientIds:E.clientId?[E.clientId]:[],Se={name:E.name,clientId:Te[0]||"",clientIds:Te,tenantId:r.tenantId||(l==null?void 0:l.tenantId)||(l==null?void 0:l.id)||"",leadDesignerId:E.leadDesignerId,status:E.status||jn.DISCOVERY,type:E.type,category:E.category,startDate:E.startDate,deadline:E.deadline,budget:Number(E.budget),description:E.description||""};if(Se.updatedBy=(l==null?void 0:l.id)||"",Se.updatedAt=new Date().toISOString(),U)try{const P=Date.now(),W=U.name.replace(/\s+/g,"_"),V=nh(rh,`thumbnails/${r.id}/${P}_${W}`);await eh(V,U),Se.thumbnail=await th(V)}catch(P){console.error("Cover image upload failed:",P),i("Warning","Project updated but cover image upload failed.","warning")}if(re.length>0){const P=[];for(let W=0;W<re.length;W++){const V=re[W];try{const le=Date.now(),we=V.file.name.replace(/\s+/g,"_"),fe=nh(rh,`documents/${r.id}/${le}_${we}`);await eh(fe,V.file);const Ce=await th(fe);let ge="other";V.file.type.startsWith("image/")?ge="image":V.file.type==="application/pdf"&&(ge="pdf");const $e={id:`doc_${le}_${W}`,name:V.name||V.file.name,type:ge,url:Ce,uploadedBy:(l==null?void 0:l.id)||"system",uploadDate:new Date().toISOString(),sharedWith:[L.ADMIN,L.DESIGNER,L.CLIENT],approvalStatus:"pending"};P.push($e),await Py(r.id,$e)}catch(le){console.error(`Document upload failed for ${V.name}:`,le),i("Warning",`Failed to upload document: ${V.name}`,"warning")}}Se.documents=[...r.documents||[],...P]}await u(r.id,Se);const pe={...r,...Se};t(pe),e(),i("Success",`Project "${E.name}" has been updated successfully.`,"success")}else{const Te=E.clientIds&&E.clientIds.length>0?E.clientIds:E.clientId?[E.clientId]:[],Se={name:E.name,clientId:Te[0]||"",clientIds:Te,tenantId:(l==null?void 0:l.tenantId)||(l==null?void 0:l.id)||"",leadDesignerId:E.leadDesignerId,status:E.status||jn.DISCOVERY,type:E.type,category:E.category,startDate:E.startDate,deadline:E.deadline,budget:Number(E.budget),initialBudget:Number(E.budget),thumbnail:"",description:E.description||"",tasks:[],financials:[],meetings:[],documents:[],activityLog:[{id:`log_${Date.now()}`,userId:(l==null?void 0:l.id)||"system",action:"Project Created",details:"Project initialized via Admin Dashboard",timestamp:new Date().toISOString(),type:"creation"}],createdBy:(l==null?void 0:l.id)||"",createdAt:new Date().toISOString()},pe=await c(Se);let P;if(U)try{const we=Date.now(),fe=U.name.replace(/\s+/g,"_"),Ce=nh(rh,`thumbnails/${pe}/${we}_${fe}`);await eh(Ce,U),P=await th(Ce)}catch(we){console.error("Cover image upload failed:",we),i("Warning","Project created but cover image upload failed. You can add it later.","warning")}const W=[];for(let we=0;we<re.length;we++){const fe=re[we];try{const Ce=Date.now(),ge=fe.file.name.replace(/\s+/g,"_"),$e=nh(rh,`documents/${pe}/${Ce}_${ge}`);await eh($e,fe.file);const ht=await th($e);let ot="other";fe.file.type.startsWith("image/")?ot="image":fe.file.type==="application/pdf"&&(ot="pdf");const ct={id:`doc_${Ce}_${we}`,name:fe.name||fe.file.name,type:ot,url:ht,uploadedBy:(l==null?void 0:l.id)||"system",uploadDate:new Date().toISOString(),sharedWith:[L.ADMIN,L.DESIGNER,L.CLIENT],approvalStatus:"pending"};W.push(ct),await Py(pe,ct)}catch(Ce){console.error(`Document upload failed for ${fe.name}:`,Ce),i("Warning",`Failed to upload document: ${fe.name}`,"warning")}}const V={};P&&(V.thumbnail=P),W.length>0&&(V.documents=W),Object.keys(V).length>0&&await u(pe,V);const le={...Se,id:pe,thumbnail:P,documents:W};t(le),e(),i("Success",`Project "${E.name}" has been created with ${W.length} document(s).`,"success")}}catch(Te){console.error("Project operation failed:",Te),i("Error",`Failed to ${b?"update":"create"} project: ${Te.message}`,"error")}finally{g(!1)}}},k=n.filter(me=>me.role===L.CLIENT),O=n.filter(me=>me.role===L.DESIGNER),[z,B]=q.useState(!1),K=q.useRef(null);q.useEffect(()=>{const me=Te=>{K.current&&!K.current.contains(Te.target)&&B(!1)};return document.addEventListener("mousedown",me),()=>document.removeEventListener("mousedown",me)},[]);const M=(me,Te)=>{if(!/^\d{4}-\d{2}-\d{2}$/.test(Te)&&Te!=="")return;const Se={...E,[me]:Te};me==="startDate"&&Se.deadline&&new Date(Te)>new Date(Se.deadline)&&(Se.deadline=Te),C(Se)},Ve=me=>`
    w-full px-4 py-2 border rounded-lg focus:outline-none transition-all
    bg-white text-gray-900 placeholder-gray-400 text-base md:text-sm
    ${H&&!me?"border-red-500 ring-1 ring-red-500":"border-gray-200 focus:ring-2 focus:ring-gray-900 focus:border-transparent"}
  `;return a.jsx("div",{className:"fixed inset-0 bg-black/60 z-[9999] flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-fade-in",children:[a.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-100 bg-white sticky top-0 z-10",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:b?"Edit Project":"Create New Project"}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Close modal",children:a.jsx(mn,{className:"w-6 h-6"})})]}),a.jsxs("form",{onSubmit:D,className:"p-8 space-y-6 bg-white",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Project Name ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",className:Ve(E.name),placeholder:"e.g. House Renovation",value:E.name,onChange:me=>C({...E,name:me.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Description"}),a.jsx("textarea",{className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-900 focus:border-transparent outline-none h-24 resize-none bg-white text-gray-900 placeholder-gray-400",placeholder:"Briefly describe the scope of work...",value:E.description,onChange:me=>C({...E,description:me.target.value})})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Clients"}),a.jsxs("div",{className:"relative",ref:K,children:[a.jsx("button",{type:"button",onClick:()=>B(me=>!me),className:"w-full text-left px-3 py-2 border rounded-lg bg-white border-gray-300",title:"Select clients",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-sm text-gray-700 truncate",children:E.clientIds&&E.clientIds.length>0?`${E.clientIds.length} client${E.clientIds.length!==1?"s":""} selected`:"Select clients..."}),a.jsx("div",{className:"text-gray-400",children:z?"":""})]})}),z&&a.jsx("div",{className:"absolute z-30 left-0 right-0 mt-2 bg-white border border-gray-200 rounded-md shadow-md max-h-48 overflow-y-auto",children:k.length===0?a.jsx("p",{className:"text-gray-500 text-sm p-3",children:"No clients available"}):k.map(me=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors",children:[a.jsx("input",{type:"checkbox",checked:(E.clientIds||[]).includes(me.id),onChange:Te=>{const Se=E.clientIds||[],pe=Te.target.checked?[...Se,me.id]:Se.filter(P=>P!==me.id);C({...E,clientIds:pe,clientId:pe[0]||""})},className:"w-4 h-4 rounded border-gray-300 cursor-pointer"}),a.jsx("span",{className:"text-sm text-gray-700",children:me.name})]},me.id))})]}),E.clientIds&&E.clientIds.length>0&&a.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[E.clientIds.length," client",E.clientIds.length!==1?"s":""," selected"]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Lead Designer ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{className:Ve(E.leadDesignerId),value:E.leadDesignerId,onChange:me=>C({...E,leadDesignerId:me.target.value}),title:"Select the lead designer for the project",children:[a.jsx("option",{value:"",children:"Select Designer..."}),O.map(me=>a.jsx("option",{value:me.id,children:me.name},me.id))]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Project Type ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{className:Ve(E.type),value:E.type||"",onChange:me=>C({...E,type:me.target.value}),title:"Select the project type (Designing or Turnkey)",children:[a.jsx("option",{value:"",children:"Select Type..."}),a.jsx("option",{value:ql.DESIGNING,children:ql.DESIGNING}),a.jsx("option",{value:ql.TURNKEY,children:ql.TURNKEY})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Category ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{className:Ve(E.category),value:E.category||"",onChange:me=>C({...E,category:me.target.value}),title:"Select the project category (Commercial or Residential)",children:[a.jsx("option",{value:"",children:"Select Category..."}),a.jsx("option",{value:Oo.COMMERCIAL,children:Oo.COMMERCIAL}),a.jsx("option",{value:Oo.RESIDENTIAL,children:Oo.RESIDENTIAL})]})]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1 flex items-center gap-0.5",children:[a.jsx(Mp,{className:"w-3 h-3 text-gray-400"})," Start Date ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"date",className:Ve(E.startDate),value:E.startDate||"",onChange:me=>M("startDate",me.target.value),title:"Select the project start date"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1 flex items-center gap-0.5",children:[a.jsx(Mp,{className:"w-3 h-3 text-gray-400"})," Deadline ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"date",className:Ve(E.deadline),value:E.deadline||"",onChange:me=>M("deadline",me.target.value),title:"Select the project deadline date"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1 flex items-center gap-0.5",children:[a.jsx(yp,{className:"w-3 h-3 text-gray-400"})," Budget ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"number",className:Ve(E.budget),placeholder:"0.00",value:E.budget||"",onChange:me=>C({...E,budget:Number(me.target.value)}),title:"Enter the total project budget"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"Cover Image (Optional)"}),a.jsxs("div",{className:"flex gap-2 items-start",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-2 text-center cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>{var me;return(me=he.current)==null?void 0:me.click()},children:[U?a.jsxs("div",{className:"flex items-center justify-center gap-1",children:[a.jsx(Bb,{className:"w-3 h-3 text-blue-500"}),a.jsx("span",{className:"text-base md:text-sm text-gray-700 truncate",children:U.name})]}):a.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[a.jsx(Bb,{className:"w-4 h-4 text-gray-300"}),a.jsx("p",{className:"text-base md:text-sm text-gray-500",children:"Upload image"})]}),a.jsx("input",{ref:he,type:"file",accept:"image/*",onChange:me=>{var Se;const Te=(Se=me.target.files)==null?void 0:Se[0];Te&&ae(Te)},className:"hidden",title:"Upload cover image"})]})}),U&&a.jsx("div",{className:"w-16 h-16 rounded-lg border border-gray-200 overflow-hidden bg-gray-50 flex-shrink-0",children:a.jsx("img",{src:URL.createObjectURL(U),alt:"Cover preview",className:"w-full h-full object-cover"})})]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700",children:"Attached Documents (Optional)"}),re.length>0&&a.jsxs("span",{className:"text-base md:text-sm text-gray-500",children:[re.length," file(s)"]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("button",{type:"button",onClick:()=>{var me;return(me=j.current)==null?void 0:me.click()},className:"w-full border-2 border-dashed border-gray-300 rounded-lg p-2 text-center cursor-pointer hover:bg-gray-50 transition-colors flex items-center justify-center gap-1",children:[a.jsx(Wu,{className:"w-3 h-3 text-gray-500"}),a.jsx("span",{className:"text-base md:text-sm text-gray-600",children:"Add documents"})]}),a.jsx("input",{ref:j,type:"file",multiple:!0,onChange:me=>{const Te=me.target.files;if(Te){const Se=Array.from(Te).map(pe=>({file:pe,name:pe.name}));J([...re,...Se])}},className:"hidden",title:"Upload documents"}),re.length>0&&a.jsx("div",{className:"space-y-0.5 max-h-24 overflow-y-auto bg-gray-50 p-1 rounded border border-gray-200",children:re.map((me,Te)=>a.jsxs("div",{className:"flex items-center justify-between bg-white p-1 rounded border border-gray-200 text-base md:text-sm",children:[a.jsx("span",{className:"text-gray-700 truncate flex-1",children:me.name}),a.jsx("button",{type:"button",onClick:()=>J(re.filter((Se,pe)=>pe!==Te)),className:"text-red-500 hover:text-red-700 transition-colors ml-1",title:"Remove document",children:a.jsx(ks,{className:"w-2.5 h-2.5"})})]},Te))})]})]}),a.jsxs("div",{className:"pt-2 border-t border-gray-100 flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:e,disabled:p,className:"px-4 py-1.5 rounded-lg text-base md:text-sm font-medium text-gray-600 hover:bg-gray-100 transition-colors disabled:opacity-50",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:p,className:"px-6 py-1.5 rounded-lg text-base md:text-sm font-bold text-white bg-gray-900 hover:bg-gray-800 shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:p?a.jsxs(a.Fragment,{children:[a.jsx(YA,{className:"w-3 h-3 animate-spin"}),b?"Updating...":"Saving..."]}):b?"Update Project":"Launch Project"})]})]})]})})},vV=()=>{const[n,e]=q.useState([]),[t,r]=q.useState("");q.useEffect(()=>{i()},[]);const i=()=>{const u=o6(),p=l6();e(u),r(p)},l=u=>{c6(u),e(n.filter(p=>p.id!==u))},c=u=>{const p=new Date(u),b=new Date().getTime()-p.getTime(),w=Math.floor(b/(1e3*60*60*24));if(w===0){const E=Math.floor(b/36e5);if(E===0){const C=Math.floor(b/6e4);return`${C} minute${C>1?"s":""} ago`}return`${E} hour${E>1?"s":""} ago`}return w===1?"Yesterday":w<7?`${w} days ago`:p.toLocaleDateString("en-IN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[a.jsx(lx,{className:"w-5 h-5"}),"Remembered Devices (",n.length,")"]}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Manage devices that have been remembered for automatic login"})]}),n.length===0?a.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[a.jsx(lx,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),a.jsx("p",{className:"text-gray-600",children:"No remembered devices"}),a.jsx("p",{className:"text-sm text-gray-500",children:'Next time you log in, check "Remember this device"'})]}):a.jsx("div",{className:"space-y-3",children:n.map(u=>{const p=u.id===t;return a.jsxs("div",{className:`border rounded-lg p-4 flex items-center justify-between ${p?"bg-blue-50 border-blue-200":"bg-white border-gray-200 hover:border-gray-300"}`,children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[a.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${p?"bg-blue-100":"bg-gray-100"}`,children:a.jsx(lx,{className:`w-5 h-5 ${p?"text-blue-600":"text-gray-600"}`})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:"font-semibold text-gray-900",children:u.name}),p&&a.jsx("span",{className:"bg-blue-100 text-blue-700 text-xs font-semibold px-2 py-1 rounded",children:"This Device"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-1",children:[a.jsx(sh,{className:"w-3 h-3"}),a.jsxs("span",{children:["Last login: ",c(u.lastLogin)]})]}),a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Added: ",c(u.createdAt)]})]})]}),a.jsx("button",{onClick:()=>l(u.id),className:"ml-4 p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:`Forget this device${p?" (will require login next time)":""}`,children:a.jsx(ks,{className:"w-4 h-4"})})]},u.id)})}),a.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 text-sm text-amber-900",children:[a.jsxs("p",{className:"font-semibold mb-1",children:[a.jsx(kN,{className:"w-4 h-4 inline-block mr-2"})," About Device Memory"]}),a.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[a.jsx("li",{children:"Devices are remembered for 30 days of inactivity"}),a.jsx("li",{children:"Each login extends the 30-day period"}),a.jsx("li",{children:"Forgetting a device requires manual login next time"}),a.jsx("li",{children:"Device fingerprints are stored locally in your browser"})]})]})]})},bV=()=>{const{extendSession:n}=ha(),[e,t]=q.useState(!1),[r,i]=q.useState("");return q.useEffect(()=>{const l=()=>{f6()&&(t(!0),i(p6()))};l();const c=setInterval(l,6e4);return()=>clearInterval(c)},[]),e?a.jsx("div",{className:"fixed bottom-4 right-4 z-50 animate-fade-in",children:a.jsx("div",{className:"bg-amber-50 border border-amber-300 rounded-lg shadow-lg p-4 max-w-sm",children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx(Xi,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-semibold text-amber-900 mb-1",children:"Session Expiring Soon"}),a.jsxs("p",{className:"text-sm text-amber-800 mb-3 flex items-center gap-1",children:[a.jsx(sh,{className:"w-3 h-3"}),r]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>{n(),t(!1)},className:"flex-1 bg-amber-600 hover:bg-amber-700 text-white text-sm font-medium py-2 rounded transition-colors",children:"Extend Session"}),a.jsx("button",{onClick:()=>t(!1),className:"px-3 py-2 text-amber-700 hover:bg-amber-100 rounded transition-colors",title:"Dismiss warning",children:a.jsx(mn,{className:"w-4 h-4"})})]}),a.jsx("p",{className:"text-xs text-amber-700 mt-2",children:"After expiry, you'll need to log in again."})]})]})})}):null},wV=({projects:n,onSelect:e,user:t,setEditingProject:r,setIsNewProjectModalOpen:i,onDeleteProject:l,realTimeTasks:c})=>{const[u,p]=q.useState({}),g=E=>E===ql.DESIGNING?"bg-indigo-100 text-indigo-700":"bg-amber-100 text-amber-700",b=n.reduce((E,C)=>{const H=C.category;return E[H]||(E[H]=[]),E[H].push(C),E},{}),w=Object.keys(b).sort((E,C)=>E===Oo.COMMERCIAL?-1:C===Oo.COMMERCIAL?1:0);return a.jsx("div",{className:"space-y-8 animate-fade-in",children:w.map(E=>a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx($p,{className:"w-5 h-5 text-gray-600"}),a.jsx("h2",{className:"text-lg font-bold text-gray-800",children:E}),a.jsxs("span",{className:"text-xs font-bold bg-gray-100 text-gray-600 px-2 py-1 rounded-full mobile-increase",children:[b[E].length," projects"]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b[E].map(C=>a.jsxs("div",{onClick:()=>e(C),className:"group bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all duration-300",children:[a.jsxs("div",{className:"h-40 overflow-hidden relative bg-gray-100",children:[u[C.id]&&a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-100 via-gray-50 to-gray-100 animate-pulse"}),a.jsx("img",{src:C.thumbnail,alt:C.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",onLoad:()=>p(H=>({...H,[C.id]:!1})),onLoadStart:()=>p(H=>({...H,[C.id]:!0}))}),a.jsx("div",{className:"absolute top-3 right-3 flex gap-2 items-center",children:a.jsx("div",{className:`backdrop-blur-md px-3 py-1 rounded text-sm font-bold md:px-2 md:text-xs md:font-bold shadow-sm border border-white/20 ${g(C.type)}`,children:C.type})}),C.activityLog&&C.activityLog.length>0&&new Date().getTime()-new Date(C.activityLog[0].timestamp).getTime()<864e5&&a.jsx("div",{className:"absolute bottom-3 right-3 w-3 h-3 bg-blue-500 rounded-full border-2 border-white animate-pulse",title:"New Activity"})]}),a.jsxs("div",{className:"p-5",children:[a.jsx("h3",{className:"font-bold text-gray-900 text-lg mb-1 mobile-increase",children:C.name}),a.jsx("p",{className:"text-base text-gray-600 md:text-sm md:text-gray-500 mb-4 line-clamp-2 mobile-increase",children:C.description}),a.jsxs("div",{className:"mt-2",children:[a.jsxs("div",{className:"flex justify-between mb-1",children:[a.jsx("span",{className:"text-gray-500 text-[10px]",children:"Progress"}),a.jsxs("span",{className:"text-gray-900 font-bold text-[10px]",children:[vh(c.get(C.id)||C.tasks),"%"]})]}),a.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1.5",children:a.jsx("div",{style:{width:`${vh(c.get(C.id)||C.tasks)}%`},className:"bg-gray-900 h-1.5 rounded-full transition-all duration-1000"})})]}),a.jsxs("div",{className:"flex justify-between items-center border-t border-gray-100 pt-4 mt-3",children:[a.jsx("div",{className:"flex items-center gap-2",children:(t==null?void 0:t.role)===L.ADMIN&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:H=>{H.stopPropagation(),r(C),i(!0)},className:"p-2 rounded text-xs font-bold shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors",title:"Edit project",children:a.jsx(Wx,{className:"w-4 h-4 text-gray-900"})}),a.jsx("button",{onClick:H=>{H.stopPropagation(),window.confirm(`Are you sure you want to delete project "${C.name}"? This action cannot be undone.`)&&l(C)},className:"p-2 rounded text-xs font-bold shadow-sm border border-gray-200 hover:bg-red-50 transition-colors",title:"Delete project",children:a.jsx(ks,{className:"w-4 h-4 text-red-600"})})]})}),a.jsxs("span",{className:"text-sm font-medium text-gray-600 md:text-xs md:text-gray-400 mobile-increase",children:["Due ",dn(C.deadline)]})]})]})]},C.id))})]},E))})};function _V(){const[n,e]=q.useState([]),[t,r]=q.useState([]);return a.jsx(x6,{children:a.jsx(v6,{projects:n,children:a.jsx(b6,{children:a.jsx(NV,{projects:n,setProjects:e,users:t,setUsers:r})})})})}function NV({projects:n,setProjects:e,users:t,setUsers:r}){const{user:i,logout:l,loading:c}=ha(),{unreadCount:u,addNotification:p,setDeepLinkHandler:g}=sl(),[b,w]=q.useState(()=>i&&i.role===L.CLIENT?"projects":"dashboard"),[E,C]=q.useState(null),[H,F]=q.useState(null),[U,ae]=q.useState(!1),[re,J]=q.useState(void 0),[he,j]=q.useState(null),[ce,D]=q.useState(!1),[k,O]=q.useState(!1),[z,B]=q.useState(!1),[K,M]=q.useState(!1),[Ve,me]=q.useState(null),[Te,Se]=q.useState(!0),[pe,P]=q.useState(new Map),[W,V]=q.useState(!1);q.useEffect(()=>{g(Ye=>{pN(Ye,{setCurrentView:w,setSelectedProject:C,setSelectedTask:F,setInitialProjectTab:J,projects:n,tasks:pe})})},[n,pe,g]),q.useEffect(()=>{i&&((async()=>{if(Ko.isNativePlatform())await Ox(i.id);else if("Notification"in window){const Ye=Notification.permission;Ye==="default"?V(!0):Ye==="granted"&&await Ox(i.id)}})(),z6(Ye=>{p({title:Ye.title,message:Ye.message||Ye.body,type:"info",projectId:Ye.projectId,taskId:Ye.taskId,meetingId:Ye.meetingId,targetTab:Ye.targetTab,deepLinkPath:Ye.deepLinkPath})}).catch(Ye=>console.log("failed: ",Ye)))},[i,p]);const le=async()=>{i&&await Ox(i.id)&&(V(!1),!Ko.isNativePlatform()&&Notification.permission==="granted"?new Notification("Notifications Enabled! ",{body:"You will now receive push notifications for project updates",icon:"/icons/icon-192x192.png",badge:"/icons/icon-192x192.png"}):Ko.isNativePlatform()&&p({title:"Notifications Enabled! ",message:"You will now receive push notifications for project updates",type:"success"}))};if(q.useEffect(()=>{try{if(typeof window<"u"){const bt=new URLSearchParams(window.location.search),wt=bt.get("projectId")||bt.get("project")||void 0,_t=bt.get("taskId")||bt.get("task")||void 0,Gt=bt.get("meetingId")||void 0,cn=bt.get("tab")||void 0,yr=bt.get("open")||void 0;(wt||_t||Gt||cn||yr)&&j({projectId:wt,taskId:_t,meetingId:Gt,tab:cn,open:yr})}}catch{}if(!i)return;Se(!1);let Ie;Ie=JM(bt=>{e(bt||[]),i.role!==L.VENDOR&&hN(i.tenantId).catch(wt=>{console.error("Failed to sync vendor metrics:",wt)})},i.tenantId);const Ye=XM(bt=>{r(bt||[])},i.tenantId),un=ZM(bt=>{r(wt=>{const _t=new Set(bt.map(cn=>cn.id));return[...wt.filter(cn=>!_t.has(cn.id)),...bt]})},i.tenantId),fn=e6(bt=>{r(wt=>{const _t=new Set(bt.map(cn=>cn.id));return[...wt.filter(cn=>!_t.has(cn.id)),...bt]})},i.tenantId),it=t6(bt=>{r(wt=>{const _t=new Set(bt.map(cn=>cn.id));return[...wt.filter(cn=>!_t.has(cn.id)),...bt]})},i.tenantId);return()=>{Ie(),Ye(),un(),fn(),it()}},[i,e,r]),q.useEffect(()=>{if(!he)return;const{projectId:Ie,taskId:Ye,meetingId:un,tab:fn}=he;if(!Ie)return;const it=n.find(bt=>bt.id===Ie);if(it){if(C(it),J(fn||void 0),Ye){const wt=(pe.get(Ie)||it.tasks||[]).find(_t=>_t.id===Ye)||null;wt&&(F(wt),ae(!0))}un&&!Ye&&J("meetings"),j(null);try{window.history.replaceState({},document.title,window.location.pathname)}catch{}}},[n,pe,he]),q.useEffect(()=>{if(n.length===0)return;const Ie=[];return n.forEach(Ye=>{const un=av(Ye.id,fn=>{P(it=>new Map(it).set(Ye.id,fn))});Ie.push(un)}),()=>{Ie.forEach(Ye=>Ye())}},[n]),q.useEffect(()=>{if(i){try{(he||{}).open==="admins"?w("admins"):w(i.role===L.CLIENT?"projects":"dashboard")}catch{w(i.role===L.CLIENT?"projects":"dashboard")}C(null)}},[i]),q.useEffect(()=>{if(E){const Ie=n.find(Ye=>Ye.id===E.id);Ie&&JSON.stringify(Ie)!==JSON.stringify(E)&&C(Ie)}},[n,E]),!i)return a.jsx(gV,{users:t});const we=i.role===L.ADMIN||i.role===L.DESIGNER,fe=i.role===L.ADMIN,Ce=i.role===L.ADMIN||i.role===L.DESIGNER,ge=i.role===L.ADMIN||i.role===L.VENDOR,$e=Ie=>{e(fn=>fn.map(it=>it.id===Ie.id?Ie:it)),C(Ie);const{id:Ye,...un}=Ie;rv(Ie.id,un).catch(fn=>{console.error("Failed to save project update to Firebase:",fn)}),hN(i.tenantId).catch(fn=>{console.error("Failed to sync vendor metrics:",fn)})},ht=Ie=>{r(Ye=>[...Ye,Ie])},ot=Ie=>{},ct=async Ie=>{try{await HT(Ie.id),p("Success",`Project "${Ie.name}" deleted successfully`,"success")}catch(Ye){console.error("Error deleting project:",Ye),p("Error",`Failed to delete project: ${Ye.message}`,"error")}},On=n.filter(Ie=>i.role===L.ADMIN?!0:i.role===L.DESIGNER?Ie.leadDesignerId===i.id||(Ie.teamMembers||[]).includes(i.id):i.role===L.CLIENT?Ie.clientId===i.id||(Ie.clientIds||[]).includes(i.id):i.role===L.VENDOR?(pe.get(Ie.id)||[]).some(un=>un.assigneeId===i.id)||(Ie.vendorIds||[]).includes(i.id)||(Ie.teamMembers||[]).includes(i.id):!1),nn=({view:Ie,icon:Ye,label:un})=>a.jsxs("button",{onClick:()=>{w(Ie),C(null),F(null),ae(!1),D(!1)},className:`w-full flex items-center gap-1 px-4 py-3 rounded-lg transition-colors mb-1 ${k?"justify-center":""}
        ${b===Ie&&!E?"bg-gray-900 text-white shadow-lg":"text-gray-500 hover:bg-gray-100 hover:text-gray-900"}`,title:k?un:"",children:[a.jsx(Ye,{className:"w-5 h-5 flex-shrink-0"}),!k&&a.jsx("span",{className:"font-medium",children:un})]});return a.jsxs("div",{className:"flex h-screen bg-gray-50 overflow-hidden",children:[a.jsx(oS,{}),a.jsx(bV,{}),a.jsx("div",{className:"status-bar-spacer bg-gray-900 w-full fixed top-0 left-0 right-0 z-50"}),ce&&a.jsx("div",{className:"fixed inset-0 bg-black/50 z-20 md:hidden",onClick:()=>D(!1)}),a.jsx("aside",{className:`
        fixed inset-y-0 left-0 z-30 bg-white transform transition-all duration-300 ease-in-out md:relative md:translate-x-0 md:border-r md:border-gray-200
        ${ce?"translate-x-0":"-translate-x-full"} md:translate-x-0
        ${k?"md:w-20":"md:w-64 w-64"}
      `,children:a.jsxs("div",{className:"h-full flex flex-col relative",children:[a.jsxs("div",{className:"p-6 flex items-center justify-between pt-[calc(0.5rem+env(safe-area-inset-top))]",children:[!k&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("img",{src:"/kydoicon.png",alt:"Kydo",className:"w-12 h-12 rounded-lg"}),a.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Kydo Solutions"})]}),k&&a.jsx("img",{src:"/kydoicon.png",alt:"Kydo",className:"w-12 h-12 rounded-lg"}),a.jsx("button",{className:"md:hidden",onClick:()=>D(!1),title:"Close sidebar",children:a.jsx(mn,{className:"w-5 h-5 text-gray-500"})})]}),a.jsx("button",{onClick:()=>O(!k),className:"hidden md:flex absolute -right-3 top-6 w-7 h-7 bg-white text-gray-900 rounded-full items-center justify-center hover:bg-gray-100 transition-colors shadow-md border border-gray-200 z-40",title:k?"Expand sidebar":"Collapse sidebar","aria-label":"Toggle sidebar",children:a.jsxs("span",{className:"relative w-4 h-4 block",children:[a.jsx("span",{className:`absolute left-1/2 top-1/2 w-4 h-0.5 bg-gray-900 rounded transition-all duration-300 ease-in-out
                  ${k?"-translate-x-1/2":"rotate-45 -translate-x-1/2 -translate-y-1/2"}
                `,style:{transform:k?"translate(-50%, -5px) rotate(0deg)":"translate(-50%, -50%) rotate(45deg)"}}),a.jsx("span",{className:`absolute left-1/2 top-1/2 w-4 h-0.5 bg-gray-900 rounded transition-all duration-300 ease-in-out
                  ${k?"-translate-x-1/2 translate-y-1/2":"-rotate-45 -translate-x-1/2 -translate-y-1/2"}
                `,style:{transform:k?"translate(-50%, 5px) rotate(0deg)":"translate(-50%, -50%) rotate(-45deg)"}}),a.jsx("span",{className:`absolute left-1/2 top-1/2 w-4 h-0.5 bg-gray-900 rounded transition-all duration-300 ease-in-out
                  ${k?"-translate-x-1/2 -translate-y-1/2":"opacity-0"}
                `,style:{opacity:k?1:0,transform:k?"translate(-50%, 0) scaleX(1)":"translate(-50%, -50%) scaleX(0)"}})]})}),a.jsxs("div",{className:"px-4 flex-1 overflow-y-auto",children:[a.jsxs("div",{className:"mb-6",children:[!k&&a.jsx("p",{className:"px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2",children:"Main"}),i.role!==L.CLIENT&&a.jsx(nn,{view:"dashboard",icon:qA,label:"Dashboard"}),a.jsx(nn,{view:"projects",icon:jN,label:"Projects"})]}),(we||fe||Ce||ge)&&a.jsxs("div",{className:"mb-6",children:[!k&&a.jsx("p",{className:"px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2",children:"People"}),we&&a.jsx(nn,{view:"clients",icon:zj,label:"Clients"}),fe&&a.jsx(nn,{view:"designers",icon:Fp,label:"Team"}),Ce&&a.jsx(nn,{view:"vendors",icon:Nj,label:"Vendors"}),ge&&a.jsx(nn,{view:"admins",icon:qx,label:"Admins"})]}),a.jsxs("div",{className:"mb-6",children:[!k&&a.jsx("p",{className:"px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2",children:"Account"}),a.jsx(nn,{view:"settings",icon:gj,label:"Settings"})]})]}),a.jsx("div",{className:"p-4 border-t border-gray-200",children:a.jsxs("button",{onClick:async()=>{try{await l()}catch(Ie){console.error("Logout failed:",Ie)}},className:"w-full flex items-center gap-3 px-4 py-3 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:k?"Sign Out":"",children:[a.jsx(ZA,{className:"w-5 h-5 flex-shrink-0"}),!k&&a.jsx("span",{className:"font-medium",children:"Sign Out"})]})})]})}),a.jsxs("div",{className:"flex-1 flex flex-col h-screen overflow-hidden relative",children:[a.jsx("div",{className:"status-bar-spacer bg-gray-900 w-full flex-shrink-0"}),W&&a.jsxs("div",{className:"bg-blue-50 border-b border-blue-200 px-4 py-3 flex items-center justify-between gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Op,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),a.jsx("p",{className:"text-sm text-blue-900",children:"Enable push notifications to stay updated on project activities"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:le,className:"bg-blue-600 text-white px-4 py-1.5 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:"Enable"}),a.jsx("button",{onClick:()=>V(!1),className:"text-blue-600 px-2 py-1.5 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors",children:a.jsx(mn,{className:"w-4 h-4"})})]})]}),a.jsxs("header",{className:"h-14 sm:h-20 bg-white border-b border-gray-200 flex items-center justify-between px-3 sm:px-6 relative z-20",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsx("button",{onClick:()=>D(!0),className:"md:hidden p-2 text-gray-500 hover:bg-gray-100 rounded-lg",title:"Toggle sidebar menu",children:a.jsx(nj,{className:"w-6 h-6"})})}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsxs("button",{onClick:()=>B(!z),className:"relative p-2 text-gray-500 hover:bg-gray-100 rounded-lg transition-colors",title:"Toggle notifications",children:[a.jsx(Op,{className:"w-5 h-5"}),u>0&&a.jsx("span",{className:"absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border border-white animate-pulse"})]}),a.jsx(xV,{isOpen:z,onClose:()=>B(!1),projects:n,onDeepLink:Ie=>{pN(Ie,{setCurrentView:w,setSelectedProject:C,setSelectedTask:F,setInitialProjectTab:J,projects:n,tasks:pe}),B(!1)}})]}),a.jsxs("div",{className:"flex items-center gap-3 pl-4 border-l border-gray-200",children:[a.jsxs("div",{className:"text-right hidden sm:block",children:[a.jsx("p",{className:"text-sm font-semibold text-gray-900",children:i.name}),a.jsx("p",{className:"text-xs text-gray-500 capitalize",children:i.role})]}),a.jsx(za,{avatar:i.avatar,name:i.name,size:"sm",role:String(i.role).toLowerCase()})]})]})]}),a.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto bg-gray-50 relative z-0",onClick:()=>z&&B(!1),children:a.jsxs("div",{className:"px-4 sm:px-6 py-2 sm:py-4 pb-12 sm:pb-16 h-full flex flex-col",children:[Te&&a.jsx("div",{className:"flex items-center justify-center h-full",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-gray-200 border-t-gray-900 animate-spin mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500 font-medium",children:"Loading data from Firebase..."})]})}),!Te&&a.jsx(a.Fragment,{children:E?a.jsx(dV,{project:E,users:t,onUpdateProject:$e,onBack:()=>{C(null),F(null),ae(!1),J(void 0)},initialTask:H||void 0,initialTab:re,onCloseTask:()=>{U&&(C(null),F(null),ae(!1))}}):a.jsxs(a.Fragment,{children:[b==="dashboard"&&a.jsx(sV,{projects:n,users:t,onSelectProject:(Ie,Ye)=>{C(Ie),F(null),ae(!1),J(Ye==null?void 0:Ye.initialTab)},onSelectTask:(Ie,Ye)=>{C(Ye),F(Ie),ae(!0)}}),b==="projects"&&a.jsxs("div",{className:"space-y-6 pb-12",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Projects"}),i.role===L.ADMIN&&a.jsxs("button",{onClick:()=>{me(null),M(!0)},className:"bg-gray-900 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-800 transition-colors shadow-sm flex items-center gap-2",children:[a.jsx(aj,{className:"w-4 h-4"})," New Project"]})]}),On.length>0?a.jsx(wV,{projects:On,onSelect:Ie=>{C(Ie),F(null),ae(!1),J(void 0)},user:i,setEditingProject:me,setIsNewProjectModalOpen:M,onDeleteProject:ct,realTimeTasks:pe}):a.jsx("div",{className:"text-center py-20 bg-white rounded-xl border border-dashed border-gray-300",children:a.jsx("p",{className:"text-gray-500",children:"No projects found for your account."})})]}),b==="clients"&&a.jsx(gp,{users:t,roleFilter:L.CLIENT,onAddUser:ht,projects:n,onSelectProject:Ie=>{C(Ie),F(null),ae(!1),J(void 0)},onSelectTask:(Ie,Ye)=>{C(Ye),F(Ie),ae(!0)}}),b==="vendors"&&a.jsx(gp,{users:t,roleFilter:L.VENDOR,onAddUser:ht,projects:n,onSelectProject:Ie=>{C(Ie),F(null),ae(!1),J(void 0)},onSelectTask:(Ie,Ye)=>{C(Ye),F(Ie),ae(!0)}}),b==="designers"&&a.jsx(gp,{users:t,roleFilter:L.DESIGNER,onAddUser:ht,projects:n,onSelectProject:Ie=>{C(Ie),F(null),ae(!1),J(void 0)},onSelectTask:(Ie,Ye)=>{C(Ye),F(Ie),ae(!0)}}),b==="admins"&&a.jsx(gp,{users:t,roleFilter:L.ADMIN,onAddUser:ht,projects:n,onSelectProject:Ie=>{C(Ie),F(null),ae(!1),J(void 0)},onSelectTask:(Ie,Ye)=>{C(Ye),F(Ie),ae(!0)}}),b==="settings"&&a.jsxs("div",{className:"max-w-3xl mx-auto space-y-8 pb-12",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Settings"}),a.jsx("p",{className:"text-gray-600",children:"Manage your account security and preferences"})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Account Information"}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Name"}),a.jsx("p",{className:"text-gray-900 font-medium",children:i.name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Email"}),a.jsx("p",{className:"text-gray-900 font-medium",children:i.email})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Role"}),a.jsx("p",{className:"text-gray-900 font-medium capitalize",children:i.role})]}),i.phone&&a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold",children:"Phone"}),a.jsx("p",{className:"text-gray-900 font-medium",children:i.phone})]})]})})]}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:a.jsx(vV,{})})]})]})})]})})]}),K&&a.jsx(yV,{users:t,onClose:()=>{M(!1),me(null)},onSave:ot,initialProject:Ve})]})}var My;(function(n){n.Dark="DARK",n.Light="LIGHT",n.Default="DEFAULT"})(My||(My={}));var IN;(function(n){n.None="NONE",n.Slide="SLIDE",n.Fade="FADE"})(IN||(IN={}));const Fx=nm("StatusBar");async function IV(){try{if(!(window.cordova||window.capacitor)){console.log("StatusBar not available on web platform");return}await Fx.setStyle({style:My.Dark}),await Fx.setBackgroundColor({color:"#111827"}),await Fx.setOverlaysWebView({overlay:!0}),console.log("StatusBar initialized: light style, dark blue background, overlay mode")}catch(n){console.error("Error initializing StatusBar:",n)}}IV();const lS=document.getElementById("root");if(!lS)throw new Error("Could not find root element to mount to");const EV=YS.createRoot(lS);EV.render(a.jsx(li.StrictMode,{children:a.jsx(_V,{})}));
